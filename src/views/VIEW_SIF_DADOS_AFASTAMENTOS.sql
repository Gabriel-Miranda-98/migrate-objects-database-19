
  CREATE OR REPLACE FORCE EDITIONABLE VIEW "ARTERH"."VIEW_SIF_DADOS_AFASTAMENTOS" ("CODIGO_EMPRESA", "TIPO_CONTRATO", "CODIGO_CONTRATO", "CPF", "DATA_INICIO", "DATA_FIM_SITUACAO", "CODIGO_SITUCAO_FUNCIONAL", "SITUACAO_FUNCIONAL") AS 
  SELECT
ALT.codigo_empresa,
	ALT.tipo_contrato,
	ALT.codigo               AS codigo_contrato,
    TRIM(P.CPF) AS CPF,
	ALT.data_inic_situacao   AS data_inicio,
ALT.DATA_FIM_SITUACAO,
SF.CODIGO AS CODIGO_SITUCAO_FUNCIONAL,
SF.DESCRICAO AS SITUACAO_FUNCIONAL 
FROM
	arterh.rhcged_alt_sit_fun ALT
LEFT OUTER JOIN ARTERH.RHPARM_SIT_FUNC SF
ON SF.CODIGO =ALT.COD_SIT_FUNCIONAL
INNER  JOIN ARTERH.RHPESS_CONTRATO C
ON C.CODIGO=ALT.CODIGO
AND C.TIPO_CONTRATO=ALT.TIPO_CONTRATO
AND C.CODIGO_EMPRESA=ALT.CODIGO_EMPRESA
INNER  JOIN ARTERH.RHPESS_PESSOA P 
ON P.CODIGO_EMPRESA=C.CODIGO_EMPRESA
AND P.CODIGO=C.CODIGO_PESSOA
WHERE ALT.CODIGO_EMPRESA IN ('0001','0003','0005','0007','0013','0014')
  AND 
TO_CHAR(data_inic_situacao,'YYYY')>='2013'
AND C.ANO_MES_REFERENCIA=(SELECT MAX(AUX.ANO_MES_REFERENCIA) FROM ARTERH.RHPESS_CONTRATO AUX
WHERE AUX.CODIGO=C.CODIGO
AND AUX.TIPO_CONTRATO=C.TIPO_CONTRATO
AND AUX.CODIGO_EMPRESA=C.CODIGO_EMPRESA)
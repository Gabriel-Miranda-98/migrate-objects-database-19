
  CREATE OR REPLACE FORCE EDITIONABLE VIEW "ARTERH"."CAD_ATIVOS" ("COD_PLANO", "COD_ORG", "MATRICULA", "DATA_ADMISSAO", "COD_LOTACAO", "DATA_AFAST_DESLIG", "COD_CARGO", "TEXTO_ASSOCIADO", "NOME_CARGO", "NOME_SERVIDOR", "DATA_NASCIMENTO", "NATURALIDADE", "UF_NATURALIDADE", "SEXO", "RACA_COR", "ESTADO_CIVIL", "NOME_PAI", "NOME_MAE", "CPF", "PIS_PASEP", "NUM_IDENTIDADE", "COD_ORGAO_EMITENTE", "DATA_EXPEDICAO", "UF_ORGAO_IDENTIDADE", "NUM_CTPS", "SERIE_CTPS", "NUM_TIT_ELEI", "NUM_ZONA_TIT", "NUM_SECAO_TIT_ELEI", "UF_TIT_ELEI", "EMAIL", "DATA_EMISSAO_CTPS", "UF_CTPS", "DATA_FALECIMENTO", "NUMERO_CERT_OBITO", "NUM_LIVRO_CERT_OBITO", "FOLHA_CERT_OBITO", "COD_GRAU_INST_PESSOA", "DESC_GRAU_INST_PESSOA", "NACIONALIDADE_PESSOA", "MOLESTIA_GRAVE", "DATA_LAUDO", "COD_MUNICIP_NASCIMENTO", "COD_PAIS_NASCI", "COD_PAIS_NACIO", "NOME_SOCIAL", "DATA_EXP_ORGPROF", "DATA_VAL_ORGPROF", "NUM_DNI", "ORG_UF_DNI", "DATA_EXP_DOCDNI", "NUM_INSC_REGESTRANG", "ORG_UF_DOCESTRANG", "DATA_EXP_DOCESTR", "FINAL_DE_REGISTRO") AS 
  SELECT
  CASE
    WHEN to_char(CO.DATA_ADMISSAO,'YYYYMMDD') < '20111230'
    THEN '0001'
    WHEN to_char(CO.DATA_ADMISSAO,'YYYYMMDD') >= '20111230'
    THEN '0002'
  END AS COD_PLANO,  
  co.CODIGO_EMPRESA AS COD_ORG,
  
 TO_NUMBER(SUBSTR(CO.CODIGO, 5,10)) ||CASE WHEN SUBSTR(CO.CODIGO, 15,1) != 'X' THEN TO_NUMBER(SUBSTR(CO.CODIGO, 15,1)) ELSE 7 END AS MATRICULA,
  
  to_char(CO.DATA_ADMISSAO,'YYYYMMDD') AS DATA_ADMISSAO,
  
  
  TO_NUMBER(SUBSTR(CO.COD_LOCAL1,5,2)||SUBSTR(CO.COD_LOCAL2,5,2)||SUBSTR(CO.COD_LOCAL3,5,2)||SUBSTR(CO.COD_LOCAL4,5,2)||SUBSTR(CO.COD_LOCAL5,5,2)||SUBSTR(CO.COD_LOCAL6,4,3)) AS COD_LOTACAO, 

 CASE  WHEN co.situacao_funcional = '5800' and TO_CHAR(PE.DATA_FALECIMENTO,'YYYYMMDD')  IS NULL AND TO_char(CO.DATA_RESCISAO,'YYYYMMDD') IS NULL THEN TO_CHAR('20000101','YYYYMMDD')
       WHEN co.situacao_funcional = '5800' and TO_CHAR(PE.DATA_FALECIMENTO,'YYYYMMDD')  IS NULL THEN TO_CHAR(CO.DATA_RESCISAO,'YYYYMMDD')
       WHEN co.situacao_funcional IN ('5300')  THEN TO_CHAR(CO.DATA_INIC_AFAST,'YYYYMMDD')
       else TO_CHAR(PE.DATA_FALECIMENTO,'YYYYMMDD')
       END  AS  DATA_AFAST_DESLIG,
  SUBSTR(trim(CO.COD_CARGO_EFETIVO),12,4) AS COD_CARGO,
  CO.TEXTO_ASSOCIADO AS TEXTO_ASSOCIADO,
  
  SUBSTR(TRIM(CA.DESCRICAO),1,40) AS NOME_CARGO,
  
  TRIM(PE.NOME) AS NOME_SERVIDOR,
  
    NVL(to_char(PE.DATA_NASCIMENTO,'YYYYMMDD'),TO_DATE('20000101','YYYYMMDD')) AS DATA_NASCIMENTO,
  
  CASE
  WHEN TRIM(RHTABS_MUNICIPIO.DESCRICAO) ='' THEN NULL
  ELSE TRIM(RHTABS_MUNICIPIO.DESCRICAO) END  AS NATURALIDADE,
  
  CASE 
  WHEN TRIM(PE.UF_NATURALIDADE) ='' THEN NULL
  ELSE  SUBSTR(TRIM(PE.UF_NATURALIDADE),1,2) END AS UF_NATURALIDADE,
  
  CASE          
   WHEN PE.SEXO = '0001'  THEN  'M'
   WHEN PE.SEXO = '0002'  THEN  'F'
  END AS SEXO,  
  
  CASE          
   WHEN PE.RACA_COR = '0001'  THEN  '9'/*'N'*/
   WHEN PE.RACA_COR = '0008'  THEN  '8'/*'D'*/
   WHEN PE.RACA_COR = '0002'  THEN  '2'/*'B'*/
   WHEN PE.RACA_COR = '0004'  THEN  '4'/*'P'*/
   WHEN PE.RACA_COR = '0006'  THEN  '6'/*'A'*/
   WHEN PE.RACA_COR = '0000'  THEN  '1'/*'I'*/
  ELSE  '9' 
  END AS RACA_COR,

  CASE          
   WHEN PE.ESTADO_CIVIL = '0001'  THEN  'C' /*Casado*/
   WHEN PE.ESTADO_CIVIL = '0002'  THEN  'S' /*Solteiro*/
   WHEN PE.ESTADO_CIVIL = '0005'  THEN  'D' /*Divorciado*/
   WHEN PE.ESTADO_CIVIL = '0003'  THEN  'V' /*Viúvo*/
   WHEN PE.ESTADO_CIVIL = '0009'  THEN  'P' /*Separado*/
   WHEN PE.ESTADO_CIVIL = '0008'  THEN  'U' /*União Estavel*/
   WHEN PE.ESTADO_CIVIL = '0004'  THEN  'W' /*Desquitado*/
   WHEN PE.ESTADO_CIVIL = '0006'  THEN  'W' /*Separação Judicial*/
  ELSE  'Z' 
  END AS ESTADO_CIVIL,

  TRIM(PE.C_LIVRE_DESCR11) AS NOME_PAI, 

  NVL(TRIM(PE.C_LIVRE_DESCR12),'NAO POSSUI') AS NOME_MAE ,

  SUBSTR(PE.CPF, 1,11) AS CPF,

  nvl(to_number(trim(pe.pis_pasep)),0) AS PIS_PASEP,

  TRIM(PE.IDENTIDADE) AS NUM_IDENTIDADE,

  CASE              
  WHEN  PE.ORGAO_EXPEDIDOR  LIKE  '%SSP%' THEN  '1'
  WHEN  PE.ORGAO_EXPEDIDOR  LIKE  '%AERONAUT%'  THEN  '2'
  WHEN  PE.ORGAO_EXPEDIDOR  LIKE  '%EXERCITO%'  THEN  '3'
  WHEN  PE.ORGAO_EXPEDIDOR  LIKE  '%MARINHA%' THEN  '4'
  WHEN  PE.ORGAO_EXPEDIDOR  LIKE  '%PF%'  THEN  '5'
  WHEN  PE.ORGAO_EXPEDIDOR  LIKE  '%CRA%' THEN  '6'
  WHEN  PE.ORGAO_EXPEDIDOR  LIKE  '%CRAS%'  THEN  '7'
  WHEN  PE.ORGAO_EXPEDIDOR  LIKE  '%CRB%' THEN  '8'
  WHEN  PE.ORGAO_EXPEDIDOR  LIKE  '%CRC%' THEN  '9'
  WHEN  PE.ORGAO_EXPEDIDOR  LIKE  '%CRECI%' THEN  '10'
  WHEN  PE.ORGAO_EXPEDIDOR  LIKE  '%CORECON%' THEN  '11'
  WHEN  PE.ORGAO_EXPEDIDOR  LIKE  '%COREN%' THEN  '12'
  WHEN  PE.ORGAO_EXPEDIDOR  LIKE  '%CREA  %'  THEN  '13'
  WHEN  PE.ORGAO_EXPEDIDOR  LIKE  '%CONRE%' THEN  '14'
  WHEN  PE.ORGAO_EXPEDIDOR  LIKE  '%CRF%' THEN  '15'
  WHEN  PE.ORGAO_EXPEDIDOR  LIKE  '%CREFITO%' THEN  '16'
  WHEN  PE.ORGAO_EXPEDIDOR  LIKE  '%CRM%' THEN  '17'
  WHEN  PE.ORGAO_EXPEDIDOR  LIKE  '%CRMV%'  THEN  '18'
  WHEN  PE.ORGAO_EXPEDIDOR  LIKE  '%OMBCRE%'  THEN  '19'
  WHEN  PE.ORGAO_EXPEDIDOR  LIKE  '%CRN%' THEN  '20'
  WHEN  PE.ORGAO_EXPEDIDOR  LIKE  '%CRO%' THEN  '21'
  WHEN  PE.ORGAO_EXPEDIDOR  LIKE  '%CONRERP%' THEN  '22'
  WHEN  PE.ORGAO_EXPEDIDOR  LIKE  '%CRP%' THEN  '23'
  WHEN  PE.ORGAO_EXPEDIDOR  LIKE  '%CRQ%' THEN  '24'
  WHEN  PE.ORGAO_EXPEDIDOR  LIKE  '%CORE%'  THEN  '25'
  WHEN  PE.ORGAO_EXPEDIDOR  LIKE  '%OAB%' THEN  '26'
  WHEN  PE.ORGAO_EXPEDIDOR  LIKE  '%CRBIO%' THEN  '27'
  WHEN  PE.ORGAO_EXPEDIDOR  LIKE  '%CRFA%'  THEN  '28'
  WHEN  PE.ORGAO_EXPEDIDOR  LIKE  '%CORESS%'  THEN  '29'
  WHEN  PE.ORGAO_EXPEDIDOR  LIKE  '%CRTR%'  THEN  '30'
  WHEN  PE.ORGAO_EXPEDIDOR  LIKE  '%DETRA%' THEN  '31'
  WHEN  PE.ORGAO_EXPEDIDOR  LIKE  '%PM%'  THEN  '32'
  WHEN  PE.ORGAO_EXPEDIDOR  LIKE  '%CBM%' THEN  '33'
  WHEN  PE.ORGAO_EXPEDIDOR  LIKE  '%IBA%' THEN  '34'
  WHEN  PE.ORGAO_EXPEDIDOR  LIKE  '%OUTROS%'  THEN  '99'
  END AS COD_ORGAO_EMITENTE,

  TO_CHAR(PE.DATA_EXPEDICAO,'YYYYMMDD') AS DATA_EXPEDICAO,

 SUBSTR(TRIM(PE.UF_IDENTIDADE),1,2) AS UF_ORGAO_IDENTIDADE,

  Nvl(SUBSTR(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(trim(PE.CART_TRABALHO),'/',''),'-',''),' ',''),'BM:',''),'.',''),1,20),0) AS NUM_CTPS,

  SUBSTR(TRIM(PE.SERIE_CART_TRAB),1,7) AS SERIE_CTPS,

  RPAD(TO_CHAR(NVL(SUBSTR(REPLACE(REPLACE(REPLACE(REPLACE(TRIM(TITULO_ELEITOR),'/',''),'-',''),' ',''),'.',''),1,12), NULL)), 12, '0') AS NUM_TIT_ELEI,

  SUBSTR(TRIM(PE.ZONA_TIT_ELEITOR),1,4) AS NUM_ZONA_TIT,

  SUBSTR(TRIM(PE.SECAO_TIT_ELEITOR),1,5) AS NUM_SECAO_TIT_ELEI,

  NULL AS UF_TIT_ELEI, 

  SUBSTR(TRIM(EN.ENDER_ELETRONICO),1,50) AS EMAIL , 

  TRIM(PE.DATA_CART_TRAB) AS DATA_EMISSAO_CTPS,

  SUBSTR(TRIM(PE.UF_CART_TRAB),1,2) AS UF_CTPS, 

CASE  
WHEN PE.DATA_FALECIMENTO IS NOT NULL THEN  TO_CHAR(PE.DATA_FALECIMENTO,'YYYYMMDD')
WHEN co.situacao_funcional = '5800' AND  TO_CHAR(CO.DATA_RESCISAO,'YYYYMMDD') IS NOT NULL THEN TO_CHAR(CO.DATA_RESCISAO,'YYYYMMDD')
--WHEN co.situacao_funcional = '5800' and TO_CHAR(PE.DATA_FALECIMENTO,'YYYYMMDD')  IS NULL AND TO_CHAR(CO.DATA_RESCISAO,'YYYYMMDD') IS NULL THEN TO_CHAR('24000101','99999999')
WHEN co.situacao_funcional  = '5800'  THEN TO_CHAR(CO.DATA_INIC_AFAST,'99999999')
else NULL
END  AS  DATA_FALECIMENTO,

  RPAD(TO_CHAR(substr(REPLACE(REPLACE(REPLACE(TRIM(PE.NRO_ATESTADO_OBITO),'/',''),'-',''),' ',''),1,20)), 20, '0') AS NUMERO_CERT_OBITO,

  TO_NUMBER(substr(REPLACE(REPLACE(REPLACE(TRIM(PE.NRO_ATESTADO_OBITO),'/',''),'-',''),' ',''),21,20)) AS NUM_LIVRO_CERT_OBITO,

  0 AS FOLHA_CERT_OBITO,  

  TO_NUMBER(SUBSTR(TRIM(PE.GRAU_INSTRUCAO),3,2)) AS COD_GRAU_INST_PESSOA,

  REPLACE(TRIM(G.DESCRICAO),'´','') AS DESC_GRAU_INST_PESSOA,



  TRIM(N.DESCRICAO) AS NACIONALIDADE_PESSOA,
  NULL  AS MOLESTIA_GRAVE,
  NULL AS DATA_LAUDO,
  trim(RHTABS_MUNICIPIO.codigo_rais) AS COD_MUNICIP_NASCIMENTO,
  TRIM(PAIS.codigo_pais_receita) AS COD_PAIS_NASCI,
  TRIM(PAIS.codigo_pais_receita) AS COD_PAIS_NACIO,
  TRIM(PE.nome_social) AS NOME_SOCIAL,
  NULL AS DATA_EXP_ORGPROF,
  NULL AS DATA_VAL_ORGPROF,
  NULL AS NUM_DNI,
  NULL AS Org_UF_DNI,
  NULL AS DATA_EXP_DOCDNI,
  TRIM(PE.ident_estrangeiro) AS NUM_INSC_REGESTRANG,
  TRIM(PE.orgao_emissor_id_estr) ORG_UF_DOCESTRANG,
  TO_CHAR(PE.dt_expedicao_id_estr,'YYYYMMDD') DATA_EXP_DOCESTR,
  '*' AS FINAL_DE_REGISTRO

FROM 

RHPESS_CONTRATO CO,
RHPESS_ENDERECO_P EN,
RHPESS_PESSOA PE,
RHPLCS_CARGO CA,
RHORGA_LOTACAO LO,
RHPARM_SIT_FUNC,
RHTABS_NACIONALID N,
RHTABS_GRAU_INST G,
RHTABS_MUNICIPIO,
RHTABS_PAIS PAIS

WHERE
PAIS.CODIGO(+) =  PE.PAIS_ORIGEM
AND RHTABS_MUNICIPIO.CODIGO(+) = PE.COD_MUNICIPIO
AND CO.CODIGO_PESSOA  = PE.CODIGO
AND CO.CODIGO_EMPRESA = PE.CODIGO_EMPRESA
AND PE.CODIGO_EMPRESA = EN.CODIGO_EMPRESA
AND PE.CODIGO        = EN.CODIGO_PESSOA
AND CO.CODIGO_EMPRESA = CA.CODIGO_EMPRESA
AND CA.CODIGO        = CO.COD_CARGO_EFETIVO
AND CO.CODIGO_EMPRESA     = LO.CODIGO_EMPRESA
AND CO.cod_local1 = LO.COD_LOTACAO1
AND CO.cod_local2 = LO.COD_LOTACAO2
AND CO.cod_local3 = LO.COD_LOTACAO3
AND CO.cod_local4 = LO.COD_LOTACAO4
AND CO.cod_local5 = LO.COD_LOTACAO5
AND CO.cod_local6 = LO.COD_LOTACAO6
AND CO.SITUACAO_FUNCIONAL   = RHPARM_SIT_FUNC.CODIGO
AND PE.NACIONALIDADE = N.CODIGO(+)
AND PE.GRAU_INSTRUCAO = G.CODIGO(+)


AND CO.CODIGO_EMPRESA    in ('0001','0013','0014')
AND CO.TIPO_CONTRATO     in ('0001', '0007')
AND CO.SITUACAO_FUNCIONAL NOT IN ('1710','1715','1800','1850','1900','5000','5001','5002','5003','5004','5005','5006',
                                  '5008','5009','5011', '5019', '5022','5026','5028','5200','5201','5400','5555','5700','5800',
                                  '5801', '5808', '5900','5901','6002','6003','8000')
AND CO.VINCULO IN ('0000','0002')
AND (CO.CODIGO < '000000099999999' AND CO.CODIGO NOT IN('000000000777777','000000000823701','000000000833014','000000000866265','000000000747428','000000000190072','000000000420534')) /*FALECIDOS PIA*/
AND CO.ANO_MES_REFERENCIA  =
  (SELECT MAX(A.ANO_MES_REFERENCIA)
    FROM RHPESS_CONTRATO A
    WHERE A.CODIGO            = CO.CODIGO
    AND A.CODIGO_EMPRESA      = CO.CODIGO_EMPRESA
    AND A.TIPO_CONTRATO       = CO.TIPO_CONTRATO
    AND A.ANO_MES_REFERENCIA <= add_months(sysdate,(-1))-0)
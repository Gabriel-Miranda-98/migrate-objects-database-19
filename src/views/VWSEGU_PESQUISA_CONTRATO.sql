
  CREATE OR REPLACE FORCE EDITIONABLE VIEW "ARTERH"."VWSEGU_PESQUISA_CONTRATO" ("CODIGO_EMPRESA", "CODIGO", "TIPO_CONTRATO", "ANO_MES_REFERENCIA", "NOME", "DATA_RESCISAO", "CODIGO_EMPRESA_AGRUP", "TIPO_AGRUP", "COD_AGRUP1", "COD_AGRUP2", "COD_AGRUP3", "COD_AGRUP4", "COD_AGRUP5", "COD_AGRUP6", "DESCRICAO_AGRUP", "CODIGO_EMPRESA_AGRUP_CLIENTE", "TIPO_AGRUP_CLIENTE", "COD_AGRUP_CLIENTE1", "COD_AGRUP_CLIENTE2", "COD_AGRUP_CLIENTE3", "COD_AGRUP_CLIENTE4", "COD_AGRUP_CLIENTE5", "COD_AGRUP_CLIENTE6", "DESCRICAO_AGRUP_CLIENTE", "CODIGO_EMPRESA_CARGO", "CODIGO_CARGO", "DESCRICAO_CARGO") AS 
  select
	RHPESS_CONTRATO.CODIGO_EMPRESA as CODIGO_EMPRESA,
	RHPESS_CONTRATO.CODIGO as CODIGO,
	RHPESS_CONTRATO.TIPO_CONTRATO as TIPO_CONTRATO,
	RHPESS_CONTRATO.ANO_MES_REFERENCIA as ANO_MES_REFERENCIA, 
	RHPESS_CONTRATO.NOME as NOME,
	RHPESS_CONTRATO.DATA_RESCISAO as DATA_RESCISAO,
	RHORGA_AGRUPADOR.CODIGO_EMPRESA as CODIGO_EMPRESA_AGRUP,
	RHORGA_AGRUPADOR.TIPO_AGRUP as TIPO_AGRUP,
	RHORGA_AGRUPADOR.COD_AGRUP1 as COD_AGRUP1,
	RHORGA_AGRUPADOR.COD_AGRUP2 as COD_AGRUP2,
	RHORGA_AGRUPADOR.COD_AGRUP3 as COD_AGRUP3,
	RHORGA_AGRUPADOR.COD_AGRUP4 as COD_AGRUP4,
	RHORGA_AGRUPADOR.COD_AGRUP5 as COD_AGRUP5,
	RHORGA_AGRUPADOR.COD_AGRUP6 as COD_AGRUP6,
	RHORGA_AGRUPADOR.DESCRICAO as DESCRICAO_AGRUP,
	AGRUPADOR_CLIENTE.CODIGO_EMPRESA as CODIGO_EMPRESA_AGRUP_CLIENTE,
	AGRUPADOR_CLIENTE.TIPO_AGRUP as TIPO_AGRUP_CLIENTE,
	AGRUPADOR_CLIENTE.COD_AGRUP1 as COD_AGRUP_CLIENTE1,
	AGRUPADOR_CLIENTE.COD_AGRUP2 as COD_AGRUP_CLIENTE2,
	AGRUPADOR_CLIENTE.COD_AGRUP3 as COD_AGRUP_CLIENTE3,
	AGRUPADOR_CLIENTE.COD_AGRUP4 as COD_AGRUP_CLIENTE4,
	AGRUPADOR_CLIENTE.COD_AGRUP5 as COD_AGRUP_CLIENTE5,
	AGRUPADOR_CLIENTE.COD_AGRUP6 as COD_AGRUP_CLIENTE6,
	AGRUPADOR_CLIENTE.DESCRICAO as DESCRICAO_AGRUP_CLIENTE,
	RHPLCS_CARGO.CODIGO_EMPRESA as CODIGO_EMPRESA_CARGO,
	RHPLCS_CARGO.CODIGO as CODIGO_CARGO,
	RHPLCS_CARGO.DESCRICAO as DESCRICAO_CARGO

from 
	RHPESS_CONTRATO

inner join RHORGA_AGRUPADOR on 
	RHORGA_AGRUPADOR.CODIGO_EMPRESA  = RHPESS_CONTRATO.CODIGO_EMPRESA
	and RHORGA_AGRUPADOR.TIPO_AGRUP in (
		select SIARTE_PARAMETRO.VALOR from SIARTE_PARAMETRO
		where SIARTE_PARAMETRO.CODIGO_EMPRESA = RHPESS_CONTRATO.CODIGO_EMPRESA
		and SIARTE_PARAMETRO.NOME = 'TIPO_AGRUP_SEGU'
	)
	and (
		(RHORGA_AGRUPADOR.CODIGO_EMPRESA = RHPESS_CONTRATO.CODIGO_EMPRESA
		and RHORGA_AGRUPADOR.TIPO_AGRUP = RHPESS_CONTRATO.TIPO_AGRUP_LOTA
		and RHORGA_AGRUPADOR.COD_AGRUP1 = RHPESS_CONTRATO.COD_LOCAL1
		and RHORGA_AGRUPADOR.COD_AGRUP2 = RHPESS_CONTRATO.COD_LOCAL2
		and RHORGA_AGRUPADOR.COD_AGRUP3 = RHPESS_CONTRATO.COD_LOCAL3
		and RHORGA_AGRUPADOR.COD_AGRUP4 = RHPESS_CONTRATO.COD_LOCAL4
		and RHORGA_AGRUPADOR.COD_AGRUP5 = RHPESS_CONTRATO.COD_LOCAL5
		and RHORGA_AGRUPADOR.COD_AGRUP6 = RHPESS_CONTRATO.COD_LOCAL6 )
		or ( RHORGA_AGRUPADOR.CODIGO_EMPRESA = RHPESS_CONTRATO.CODIGO_EMPRESA
		and RHORGA_AGRUPADOR.TIPO_AGRUP = RHPESS_CONTRATO.TIPO_AGRUP_UNID
		and RHORGA_AGRUPADOR.COD_AGRUP1 = RHPESS_CONTRATO.COD_UNIDADE1
		and RHORGA_AGRUPADOR.COD_AGRUP2 = RHPESS_CONTRATO.COD_UNIDADE2
		and RHORGA_AGRUPADOR.COD_AGRUP3 = RHPESS_CONTRATO.COD_UNIDADE3
		and RHORGA_AGRUPADOR.COD_AGRUP4 = RHPESS_CONTRATO.COD_UNIDADE4
		and RHORGA_AGRUPADOR.COD_AGRUP5 = RHPESS_CONTRATO.COD_UNIDADE5
		and RHORGA_AGRUPADOR.COD_AGRUP6 = RHPESS_CONTRATO.COD_UNIDADE6 )
		or ( RHORGA_AGRUPADOR.CODIGO_EMPRESA    = RHPESS_CONTRATO.CODIGO_EMPRESA
		and RHORGA_AGRUPADOR.TIPO_AGRUP = RHPESS_CONTRATO.TIPO_AGRUP_CONT
		and RHORGA_AGRUPADOR.COD_AGRUP1 = RHPESS_CONTRATO.COD_CUSTO_CONTAB1
		and RHORGA_AGRUPADOR.COD_AGRUP2 = RHPESS_CONTRATO.COD_CUSTO_CONTAB2
		and RHORGA_AGRUPADOR.COD_AGRUP3 = RHPESS_CONTRATO.COD_CUSTO_CONTAB3
		and RHORGA_AGRUPADOR.COD_AGRUP4 = RHPESS_CONTRATO.COD_CUSTO_CONTAB4
		and RHORGA_AGRUPADOR.COD_AGRUP5 = RHPESS_CONTRATO.COD_CUSTO_CONTAB5
		and RHORGA_AGRUPADOR.COD_AGRUP6 = RHPESS_CONTRATO.COD_CUSTO_CONTAB6 )
		or ( RHORGA_AGRUPADOR.CODIGO_EMPRESA    = RHPESS_CONTRATO.CODIGO_EMPRESA
		and RHORGA_AGRUPADOR.TIPO_AGRUP = RHPESS_CONTRATO.TIPO_AGRUP_CGER
		and RHORGA_AGRUPADOR.COD_AGRUP1 = RHPESS_CONTRATO.COD_CUSTO_GERENC1
		and RHORGA_AGRUPADOR.COD_AGRUP2 = RHPESS_CONTRATO.COD_CUSTO_GERENC2
		and RHORGA_AGRUPADOR.COD_AGRUP3 = RHPESS_CONTRATO.COD_CUSTO_GERENC3
		and RHORGA_AGRUPADOR.COD_AGRUP4 = RHPESS_CONTRATO.COD_CUSTO_GERENC4
		and RHORGA_AGRUPADOR.COD_AGRUP5 = RHPESS_CONTRATO.COD_CUSTO_GERENC5
		and RHORGA_AGRUPADOR.COD_AGRUP6 = RHPESS_CONTRATO.COD_CUSTO_GERENC6 )
	)

inner join RHORGA_AGRUPADOR AGRUPADOR_CLIENTE on 
	AGRUPADOR_CLIENTE.CODIGO_EMPRESA  = RHPESS_CONTRATO.CODIGO_EMPRESA	
	and AGRUPADOR_CLIENTE.TIPO_AGRUP in (
		select SIARTE_PARAMETRO.VALOR from SIARTE_PARAMETRO
		where SIARTE_PARAMETRO.CODIGO_EMPRESA = RHPESS_CONTRATO.CODIGO_EMPRESA
		and NOME = 'TIPO_AGRUP_SEGU_CLIENTE' 
	)
	and (
		( AGRUPADOR_CLIENTE.CODIGO_EMPRESA = RHPESS_CONTRATO.CODIGO_EMPRESA
		and AGRUPADOR_CLIENTE.TIPO_AGRUP = RHPESS_CONTRATO.TIPO_AGRUP_LOTA
		and AGRUPADOR_CLIENTE.COD_AGRUP1 = RHPESS_CONTRATO.COD_LOCAL1
		and AGRUPADOR_CLIENTE.COD_AGRUP2 = RHPESS_CONTRATO.COD_LOCAL2
		and AGRUPADOR_CLIENTE.COD_AGRUP3 = RHPESS_CONTRATO.COD_LOCAL3
		and AGRUPADOR_CLIENTE.COD_AGRUP4 = RHPESS_CONTRATO.COD_LOCAL4
		and AGRUPADOR_CLIENTE.COD_AGRUP5 = RHPESS_CONTRATO.COD_LOCAL5
		and AGRUPADOR_CLIENTE.COD_AGRUP6 = RHPESS_CONTRATO.COD_LOCAL6 )
		or ( RHORGA_AGRUPADOR.CODIGO_EMPRESA = RHPESS_CONTRATO.CODIGO_EMPRESA
		and AGRUPADOR_CLIENTE.TIPO_AGRUP = RHPESS_CONTRATO.TIPO_AGRUP_UNID
		and AGRUPADOR_CLIENTE.COD_AGRUP1 = RHPESS_CONTRATO.COD_UNIDADE1
		and AGRUPADOR_CLIENTE.COD_AGRUP2 = RHPESS_CONTRATO.COD_UNIDADE2
		and AGRUPADOR_CLIENTE.COD_AGRUP3 = RHPESS_CONTRATO.COD_UNIDADE3
		and AGRUPADOR_CLIENTE.COD_AGRUP4 = RHPESS_CONTRATO.COD_UNIDADE4
		and AGRUPADOR_CLIENTE.COD_AGRUP5 = RHPESS_CONTRATO.COD_UNIDADE5
		and AGRUPADOR_CLIENTE.COD_AGRUP6 = RHPESS_CONTRATO.COD_UNIDADE6 )
		or ( AGRUPADOR_CLIENTE.CODIGO_EMPRESA = RHPESS_CONTRATO.CODIGO_EMPRESA
		and AGRUPADOR_CLIENTE.TIPO_AGRUP = RHPESS_CONTRATO.TIPO_AGRUP_CONT
		and AGRUPADOR_CLIENTE.COD_AGRUP1 = RHPESS_CONTRATO.COD_CUSTO_CONTAB1
		and AGRUPADOR_CLIENTE.COD_AGRUP2 = RHPESS_CONTRATO.COD_CUSTO_CONTAB2
		and AGRUPADOR_CLIENTE.COD_AGRUP3 = RHPESS_CONTRATO.COD_CUSTO_CONTAB3
		and AGRUPADOR_CLIENTE.COD_AGRUP4 = RHPESS_CONTRATO.COD_CUSTO_CONTAB4
		and AGRUPADOR_CLIENTE.COD_AGRUP5 = RHPESS_CONTRATO.COD_CUSTO_CONTAB5
		and AGRUPADOR_CLIENTE.COD_AGRUP6 = RHPESS_CONTRATO.COD_CUSTO_CONTAB6 )
		or ( AGRUPADOR_CLIENTE.CODIGO_EMPRESA = RHPESS_CONTRATO.CODIGO_EMPRESA
		and AGRUPADOR_CLIENTE.TIPO_AGRUP = RHPESS_CONTRATO.TIPO_AGRUP_CGER
		and AGRUPADOR_CLIENTE.COD_AGRUP1 = RHPESS_CONTRATO.COD_CUSTO_GERENC1
		and AGRUPADOR_CLIENTE.COD_AGRUP2 = RHPESS_CONTRATO.COD_CUSTO_GERENC2
		and AGRUPADOR_CLIENTE.COD_AGRUP3 = RHPESS_CONTRATO.COD_CUSTO_GERENC3
		and AGRUPADOR_CLIENTE.COD_AGRUP4 = RHPESS_CONTRATO.COD_CUSTO_GERENC4
		and AGRUPADOR_CLIENTE.COD_AGRUP5 = RHPESS_CONTRATO.COD_CUSTO_GERENC5
		and AGRUPADOR_CLIENTE.COD_AGRUP6 = RHPESS_CONTRATO.COD_CUSTO_GERENC6 )
	)

inner join RHPLCS_CARGO on
	RHPLCS_CARGO.CODIGO_EMPRESA = RHPESS_CONTRATO.CODIGO_EMPRESA 
	and RHPLCS_CARGO.CODIGO = case RHPESS_CONTRATO.SALARIO_PAGTO
		when 'P' then RHPESS_CONTRATO.COD_CARGO_PAGTO
		when 'E' then RHPESS_CONTRATO.COD_CARGO_EFETIVO
		when 'C' then RHPESS_CONTRATO.COD_CARGO_COMISS
		when 'A' then RHPESS_CONTRATO.COD_CARGO_AMPAR
		when 'F' then RHPESS_CONTRATO.COD_CARGO_EFETIVO else NULL end

where 
	RHPESS_CONTRATO.CODIGO_EMPRESA >= '0001' 
	and ( RHPESS_CONTRATO.ANO_MES_REFERENCIA >= trunc( sysdate, 'YYYY') - (select VALOR
		from SIARTE_PARAMETRO
		where CODIGO_EMPRESA =RHPESS_CONTRATO.CODIGO_EMPRESA
		and CODIGO_ASSUNTO = 'SEGU'
		and NOME = 'NRO_DIAS_RETORNA_DEMITIDOS' ) 
	)
	and RHPESS_CONTRATO.ANO_MES_REFERENCIA = ( select max(C.ANO_MES_REFERENCIA) from RHPESS_CONTRATO C
		where C.CODIGO_EMPRESA = RHPESS_CONTRATO.CODIGO_EMPRESA
		and C.TIPO_CONTRATO = RHPESS_CONTRATO.TIPO_CONTRATO
		and C.CODIGO = RHPESS_CONTRATO.CODIGO
		and C.ANO_MES_REFERENCIA >= (trunc( sysdate, 'YYYY') - (select VALOR
			from SIARTE_PARAMETRO
			where CODIGO_EMPRESA = RHPESS_CONTRATO.CODIGO_EMPRESA
			and CODIGO_ASSUNTO = 'SEGU'
			and NOME = 'NRO_DIAS_RETORNA_DEMITIDOS' )
		)	
	)                    
	and (
		RHPESS_CONTRATO.DATA_RESCISAO IS NULL or
		RHPESS_CONTRATO.DATA_RESCISAO >= trunc( sysdate,'DD') - (select VALOR
				from SIARTE_PARAMETRO
				where CODIGO_EMPRESA = RHPESS_CONTRATO.CODIGO_EMPRESA
				and CODIGO_ASSUNTO = 'SEGU'
				and NOME = 'NRO_DIAS_RETORNA_DEMITIDOS' )
	) 

WITH READ ONLY CONSTRAINT "APENAS_LEITURA"
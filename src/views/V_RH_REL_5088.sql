
  CREATE OR REPLACE FORCE EDITIONABLE VIEW "ARTERH"."V_RH_REL_5088" ("CODIGO_EMPRESA", "TIPO_CONTRATO", "MATRICULA", "NUMERO_ARQUIVO", "NOME", "DATA_ADMISSAO", "DATA_RESCISAO", "CARGO", "DESC_CARGO", "NIVEL_CARGO", "ESTATUTARIO_OPTANTE", "COD_LOTACAO", "LOTACAO", "ABREVIACAO_LOTACAO", "COD_SIT_FUNCIONAL", "DESC_SITUACAO", "DATA_INIC_SITUACAO", "DATA_FIM_SITUACAO", "DT_PREV_RETORNO", "PROXIMA_SITUACAO", "DESC_PROX_SITUACAO") AS 
  SELECT CNT.CODIGO_EMPRESA,
       CNT.TIPO_CONTRATO,
       SUBSTR(CNT.CODIGO,7,8) || '-' ||SUBSTR(CNT.CODIGO,15,1) AS MATRICULA,
       CNT.NUMERO_ARQUIVO,       
       CNT.NOME,
       CNT.DATA_ADMISSAO,
       CNT.DATA_RESCISAO,
       CNT.COD_CARGO_PAGTO AS CARGO,
       CG.DESCRICAO AS DESC_CARGO,
       CNT.NIVEL_CARGO_PAGTO AS NIVEL_CARGO,
       CNT.C_LIVRE_DATA28 AS ESTATUTARIO_OPTANTE,
       SUBSTR(CNT.COD_CUSTO_GERENC1,5,2) || '.' || SUBSTR(CNT.COD_CUSTO_GERENC2,5,2) || '.' || SUBSTR(CNT.COD_CUSTO_GERENC3,5,2) || '.' ||
       SUBSTR(CNT.COD_CUSTO_GERENC4,5,2) || '.' || SUBSTR(CNT.COD_CUSTO_GERENC5,5,2) || '.' || SUBSTR(CNT.COD_CUSTO_GERENC6,4,3) AS COD_LOTACAO,       
       GER.DESCRICAO AS LOTACAO,
       GER.ABREVIACAO AS ABREVIACAO_LOTACAO,
       ALF.COD_SIT_FUNCIONAL,
       SF.DESCRICAO AS DESC_SITUACAO,
       ALF.DATA_INIC_SITUACAO,
       ALF.DATA_FIM_SITUACAO,
       ALF.DT_PREV_RETORNO,
       ALF.PROXIMA_SITUACAO,
       PSF.DESCRICAO AS DESC_PROX_SITUACAO
FROM ARTERH.RHPESS_CONTRATO CNT
     INNER JOIN ARTERH.RHPLCS_CARGO CG            ON CG.CODIGO = CNT.COD_CARGO_PAGTO
                                                 AND CG.CODIGO_EMPRESA = CNT.CODIGO_EMPRESA     
     INNER JOIN ARTERH.RHORGA_CUSTO_GEREN GER     ON GER.COD_CGERENC1 = CNT.COD_CUSTO_GERENC1
                                                 AND GER.COD_CGERENC2 = CNT.COD_CUSTO_GERENC2
                                                 AND GER.COD_CGERENC3 = CNT.COD_CUSTO_GERENC3
                                                 AND GER.COD_CGERENC4 = CNT.COD_CUSTO_GERENC4
                                                 AND GER.COD_CGERENC5 = CNT.COD_CUSTO_GERENC5
                                                 AND GER.COD_CGERENC6 = CNT.COD_CUSTO_GERENC6
                                                 AND GER.CODIGO_EMPRESA = CNT.CODIGO_EMPRESA
     INNER JOIN ARTERH.RHCGED_ALT_SIT_FUN ALF     ON ALF.CODIGO = CNT.CODIGO
                                                 AND ALF.DATA_INIC_SITUACAO >= TO_DATE('01/01/2000','DD/MM/YYYY')
                                                 AND ALF.TIPO_CONTRATO = CNT.TIPO_CONTRATO
                                                 AND ALF.CODIGO_EMPRESA = CNT.CODIGO_EMPRESA
                                                 AND ALF.COD_SIT_FUNCIONAL IN ('1053','1231','1254','1255','1258','5020','5125','6014','6108','6123','6133')                                                  
     LEFT JOIN ARTERH.RHPARM_SIT_FUNC SF         ON SF.CODIGO = ALF.COD_SIT_FUNCIONAL
     LEFT JOIN ARTERH.RHPARM_SIT_FUNC PSF        ON PSF.CODIGO = ALF.PROXIMA_SITUACAO 
WHERE 1 = 1
AND CNT.ANO_MES_REFERENCIA  = ( SELECT MAX (CNT2.ANO_MES_REFERENCIA)
     							FROM ARTERH.RHPESS_CONTRATO CNT2
        						WHERE CNT2.CODIGO              = CNT.CODIGO											  
        						AND   TRUNC(CNT2.ANO_MES_REFERENCIA) <= (SELECT DT_MAX_DATAS FROM ARTERH.RHPARM_P_SIST)
        						AND   CNT2.TIPO_CONTRATO       = CNT.TIPO_CONTRATO
        						AND   CNT2.CODIGO_EMPRESA      = CNT.CODIGO_EMPRESA)
AND CNT.TIPO_CONTRATO = '0001'
AND CNT.CODIGO_EMPRESA = '0002'
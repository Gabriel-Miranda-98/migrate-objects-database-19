
  CREATE OR REPLACE FORCE EDITIONABLE VIEW "ARTERH"."VW_ARTERH_DADOS_SERVIDOR" ("CODIGO_EMPRESA", "RAZAO_SOCIAL", "CODIGO", "CGC", "CPF", "NOME", "PIS_PASEP", "SITUACAO_FUNCIONAL", "DESC_SIT_FUNC", "CONTROLE_FOLHA", "COD_UNIDADE1", "COD_UNIDADE2", "COD_UNIDADE3", "COD_UNIDADE4", "COD_UNIDADE5", "COD_UNIDADE6", "DESCR_UNIDADE", "COD_SEC1", "COD_SEC2", "COD_SEC3", "COD_SEC4", "COD_SEC5", "COD_SEC6", "DESCR_SECRETARIA", "DATA_ADMISSAO", "DATA_RESCISAO", "COD_CARGO_EFETIVO", "DESCR_EFETIVO", "COD_CARGO_COMISS", "DESCR_COMISS", "IDENTIDADE", "ORGAO_EXPEDIDOR", "EMAIL_INST") AS 
  SELECT
    C.CODIGO_EMPRESA,
    E.RAZAO_SOCIAL,
    C.CODIGO,
    E.CGC,
    P.CPF,
    P.NOME,
    P.PIS_PASEP,
    C.SITUACAO_FUNCIONAL,
    SF.DESCRICAO AS DESC_SIT_FUNC,
    case when sf.CONTROLE_FOLHA = 'N' THEN 'N - NORMAL'
         when sf.CONTROLE_FOLHA = 'F' THEN 'F - FERIAS'
         when sf.CONTROLE_FOLHA = 'D' THEN 'D - DESLIGADO'
         when sf.CONTROLE_FOLHA = 'A' THEN 'A - ADMITIDO'
         when sf.CONTROLE_FOLHA = 'P' THEN 'P - AVISO PREVIO'
         when sf.CONTROLE_FOLHA = 'L' THEN 'L - LICENCA'
         when sf.CONTROLE_FOLHA = 'M' THEN 'M - MATERNIDADE'
         when sf.CONTROLE_FOLHA = 'S' THEN 'S - APOSENTADO'
         when sf.CONTROLE_FOLHA = 'O' THEN 'O - OUTRO' END AS CONTROLE_FOLHA,
    C.COD_UNIDADE1,
    C.COD_UNIDADE2,
    C.COD_UNIDADE3,
    C.COD_UNIDADE4,
    C.COD_UNIDADE5,
    C.COD_UNIDADE6,
    U.DESCRICAO AS DESCR_UNIDADE,
    SEC.COD_UNIDADE1 AS COD_SEC1,
    SEC.COD_UNIDADE2 AS COD_SEC2,
    SEC.COD_UNIDADE3 AS COD_SEC3,
    SEC.COD_UNIDADE4 AS COD_SEC4,
    SEC.COD_UNIDADE5 AS COD_SEC5,
    SEC.COD_UNIDADE6 AS COD_SEC6,
    SEC.DESCRICAO AS DESCR_SECRETARIA,
    C.DATA_ADMISSAO,
    C.DATA_RESCISAO,
    C.COD_CARGO_EFETIVO,
    EFET.DESCRICAO AS DESCR_EFETIVO,
    C.COD_CARGO_COMISS,
    COMISS.DESCRICAO AS DESCR_COMISS,
    P.IDENTIDADE,
    P.ORGAO_EXPEDIDOR,
    C.E_MAIL AS EMAIL_INST
  FROM
    RHPESS_CONTRATO    C
      LEFT JOIN ARTERH.RHORGA_EMPRESA     E ON C.CODIGO_EMPRESA = E.CODIGO
      LEFT JOIN ARTERH.RHPESS_PESSOA      P ON C.CODIGO_EMPRESA = P.CODIGO_EMPRESA
       AND C.CODIGO_PESSOA = P.CODIGO
      LEFT JOIN ARTERH.RHPARM_SIT_FUNC    SF ON C.SITUACAO_FUNCIONAL = SF.CODIGO
      LEFT JOIN ARTERH.RHORGA_UNIDADE     U ON C.COD_UNIDADE1 = U.COD_UNIDADE1
       AND C.COD_UNIDADE2 = U.COD_UNIDADE2
       AND C.COD_UNIDADE3 = U.COD_UNIDADE3
       AND C.COD_UNIDADE4 = U.COD_UNIDADE4
       AND C.COD_UNIDADE5 = U.COD_UNIDADE5
       AND C.COD_UNIDADE6 = U.COD_UNIDADE6
       AND C.CODIGO_EMPRESA = U.CODIGO_EMPRESA
      LEFT JOIN(
        SELECT
            *
          FROM
            ARTERH.RHORGA_UNIDADE UU
         WHERE
                UU.COD_UNIDADE2 = '000000'
               AND UU.COD_UNIDADE3 = '000000'
               AND UU.COD_UNIDADE4 = '000000'
               AND UU.COD_UNIDADE5 = '000000'
               AND UU.COD_UNIDADE6 = '000000'
    )                   SEC ON C.CODIGO_EMPRESA = SEC.CODIGO_EMPRESA
       AND C.COD_UNIDADE1 = SEC.COD_UNIDADE1
      LEFT JOIN ARTERH.RHPLCS_CARGO       EFET ON C.CODIGO_EMPRESA = EFET.CODIGO_EMPRESA
       AND C.COD_CARGO_EFETIVO = EFET.CODIGO
      LEFT JOIN ARTERH.RHPLCS_CARGO       COMISS ON C.CODIGO_EMPRESA = COMISS.CODIGO_EMPRESA
       AND C.COD_CARGO_COMISS = COMISS.CODIGO
      
 WHERE
        /*C.CODIGO_EMPRESA = '0001'
       AND C.TIPO_CONTRATO      = '0001'
       AND*/ C.ANO_MES_REFERENCIA =(
        SELECT
            MAX( A.ANO_MES_REFERENCIA )
          FROM
            ARTERH.RHPESS_CONTRATO A
         WHERE
                A.CODIGO_EMPRESA = C.CODIGO_EMPRESA
               AND A.TIPO_CONTRATO = C.TIPO_CONTRATO
               AND A.CODIGO        = C.CODIGO
               AND A.ANO_MES_REFERENCIA <=(
                SELECT
                    DATA_DO_SISTEMA
                  FROM
                    RHPARM_P_SIST
            )
    )

       ORDER BY C.DATA_ADMISSAO
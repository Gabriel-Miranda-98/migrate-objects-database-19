
  CREATE OR REPLACE FORCE EDITIONABLE VIEW "ARTERH"."V_RH_HORA_EXPTRA_BIP" ("MATRICULA", "NOME", "GERENCIA", "SUPERINDENTENCIA", "DIRETORIA", "QTD_HORAS", "COD_HORA", "DESCRICAO_HORA", "VALOR_HORA", "MES_OCORRENCIA", "ANO_OCORRENCIA", "CARGO", "NIVEL_CARGO") AS 
  SELECT  SUBSTR(CNT.CODIGO,7,8) || '-' ||SUBSTR(CNT.CODIGO,15,1) AS MATRICULA,
        CNT.NOME,
        GER.ABREVIACAO AS GERENCIA,
        SUP.ABREVIACAO AS SUPERINDENTENCIA,
        DIR.ABREVIACAO AS DIRETORIA,
        MV.REF_VERBA AS QTD_HORAS,
        MV.CODIGO_VERBA AS COD_HORA,
        VB.DESCRICAO AS DESCRICAO_HORA,
        MV.VALOR_VERBA AS VALOR_HORA,
        TO_CHAR(MV.ANO_MES_REFERENCIA,'MM') AS MES_OCORRENCIA,
        TO_CHAR(MV.ANO_MES_REFERENCIA,'YYYY') AS ANO_OCORRENCIA,
		CNT.COD_CARGO_PAGTO || ' - ' || CG.DESCRICAO AS CARGO,
		CNT.NIVEL_CARGO_PAGTO AS NIVEL_CARGO
FROM    ARTERH.RHPESS_CONTRATO CNT         
        INNER JOIN ARTERH.RHMOVI_MOVIMENTO MV ON MV.CODIGO_CONTRATO = CNT.CODIGO 
                                             AND MV.TIPO_MOVIMENTO = 'ME' 
                                             AND MV.MODO_OPERACAO = 'R' 
                                             AND MV.CODIGO_VERBA IN ('1P05','1P06','1P07','1P2K','1P2L','1P2M','1P25','1P51')
                                             AND MV.TIPO_CONTRATO = CNT.TIPO_CONTRATO 
                                             AND MV.CODIGO_EMPRESA = CNT.CODIGO_EMPRESA
                                             AND MV.VALOR_VERBA <> 0
        INNER JOIN ARTERH.RHORGA_UNIDADE GER  ON GER.COD_UNIDADE1 = CNT.COD_UNIDADE1
                                             AND GER.COD_UNIDADE2 = CNT.COD_UNIDADE2
                                             AND GER.COD_UNIDADE3 = CNT.COD_UNIDADE3
                                             AND GER.COD_UNIDADE4 = CNT.COD_UNIDADE4
                                             AND GER.COD_UNIDADE5 = CNT.COD_UNIDADE5
                                             AND GER.COD_UNIDADE6 = CNT.COD_UNIDADE6
                                             AND GER.CODIGO_EMPRESA = CNT.CODIGO_EMPRESA
        INNER JOIN ARTERH.RHORGA_UNIDADE SUP  ON SUP.COD_UNIDADE1 = CNT.COD_UNIDADE1
                                             AND SUP.COD_UNIDADE2 = CNT.COD_UNIDADE2
                                             AND SUP.COD_UNIDADE3 = CNT.COD_UNIDADE3
                                             AND SUP.COD_UNIDADE4 = '000000'
                                             AND SUP.COD_UNIDADE5 = '000000'
                                             AND SUP.COD_UNIDADE6 = '000000'
                                             AND SUP.CODIGO_EMPRESA = CNT.CODIGO_EMPRESA
        INNER JOIN ARTERH.RHORGA_UNIDADE DIR  ON DIR.COD_UNIDADE1 = CNT.COD_UNIDADE1
                                             AND DIR.COD_UNIDADE2 = CNT.COD_UNIDADE2
                                             AND DIR.COD_UNIDADE3 = '000000'
                                             AND DIR.COD_UNIDADE4 = '000000'
                                             AND DIR.COD_UNIDADE5 = '000000'
                                             AND DIR.COD_UNIDADE6 = '000000'
                                             AND DIR.CODIGO_EMPRESA = CNT.CODIGO_EMPRESA
        INNER JOIN ARTERH.RHPARM_VERBA VB     ON VB.CODIGO = MV.CODIGO_VERBA
        INNER JOIN ARTERH.RHPLCS_CARGO CG        ON CG.CODIGO = CNT.COD_CARGO_PAGTO
                                                AND CG.CODIGO_EMPRESA = CNT.CODIGO_EMPRESA
WHERE CNT.ANO_MES_REFERENCIA = (SELECT MAX(AUX.ANO_MES_REFERENCIA)
                                FROM ARTERH.RHPESS_CONTRATO AUX
                                WHERE AUX.CODIGO              = CNT.CODIGO
                                AND   AUX.ANO_MES_REFERENCIA <= SYSDATE
                                AND   AUX.TIPO_CONTRATO       = CNT.TIPO_CONTRATO
                                AND   AUX.CODIGO_EMPRESA      = CNT.CODIGO_EMPRESA)
AND   CNT.TIPO_CONTRATO      = '0001'
AND   CNT.CODIGO_EMPRESA     = '0002'
AND   (   (CNT.SITUACAO_CONTRATO = 'N')
       OR (CNT.SITUACAO_CONTRATO = 'F')
       OR (CNT.SITUACAO_CONTRATO = 'A')
       OR (CNT.SITUACAO_CONTRATO = 'M')
       OR (CNT.SITUACAO_CONTRATO = 'L')
       OR (CNT.SITUACAO_CONTRATO = 'S')
       OR (CNT.SITUACAO_CONTRATO = 'O'))
AND   CNT.SITUACAO_FUNCIONAL <> '1042'
AND   CNT.SITUACAO_FUNCIONAL <> '5000'
AND   CNT.SITUACAO_FUNCIONAL <> '5001'
AND   CNT.SITUACAO_FUNCIONAL <> '5002'
AND   CNT.SITUACAO_FUNCIONAL <> '5003'
AND   CNT.SITUACAO_FUNCIONAL <> '5004'
AND   CNT.SITUACAO_FUNCIONAL <> '5005'
AND   CNT.SITUACAO_FUNCIONAL <> '5019'
AND   CNT.SITUACAO_FUNCIONAL <> '5030'
AND   CNT.SITUACAO_FUNCIONAL <> '5800'
AND   CNT.SITUACAO_FUNCIONAL <> '6116'
AND   CNT.SITUACAO_FUNCIONAL <> '6401'
AND   CNT.SITUACAO_FUNCIONAL <> '6704'
AND   CNT.SITUACAO_FUNCIONAL <> '7000'
AND   MV.ANO_MES_REFERENCIA  BETWEEN TO_DATE('01/01/2019','DD/MM/YYYY') AND TO_DATE('01/'||TO_CHAR(ADD_MONTHS(SYSDATE,-1),'MM')||'/'||TO_CHAR(SYSDATE,'YYYY'))
ORDER BY CNT.CODIGO,MV.CODIGO_VERBA,MV.ANO_MES_REFERENCIA
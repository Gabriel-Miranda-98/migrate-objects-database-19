
  CREATE OR REPLACE EDITIONABLE PROCEDURE "ARTERH"."PR_RHPONT_PL_SIT_OCOR" (ID NUMBER)AS

BEGIN-- 1ยบ BEGIN

  DECLARE
  vID NUMBER;

  BEGIN
  dbms_output.enable(NULL);
  vID := ID;

  FOR C1 IN (
    select SUGESP_RHPONT_PLSITOCOR_AUDITO.*,RHPONT_SITUACAO.tipo_situacao  --ID into vID 
    FROM SUGESP_RHPONT_PLSITOCOR_AUDITO 
    INNER JOIN RHPONT_SITUACAO ON
    RHPONT_SITUACAO.CODIGO = SUGESP_RHPONT_PLSITOCOR_AUDITO.CODIGO_SITUACAO
    WHERE ID = vID
  )
  LOOP

  dbms_output.put_line(vID);

  IF C1.TIPO_DML = 'I' THEN

  FOR C2 IN (
  select D.DATA_DIA from RHTABS_DATAS D WHERE trunc(D.DATA_DIA) BETWEEN trunc(C1.NEW_DATA_INICIO_OCORRE) AND trunc(C1.NEW_DATA_TERMINO_OCORR) order by d.data_dia
  )
  LOOP

   if( C1.tipo_situacao <> 'C' ) then
      dbms_output.put_line('DELETE DO INSERT: '|| C2.DATA_DIA);
      delete RHPONT_RES_SIT_DIA where CODIGO_EMPRESA = C1.CODIGO_EMPRESA and TIPO_CONTRATO = C1.TIPO_CONTRATO and CODIGO_CONTRATO = C1.CODIGO_CONTRATO and trunc(DATA) = trunc(C2.DATA_DIA)
      and CODIGO_SITUACAO = C1.CODIGO_SITUACAO and REF_HORAS = 1 and TIPO_APURACAO = 'F'; --commit;
      dbms_output.put_line('INSERT: '|| C2.DATA_DIA);
      INSERT INTO RHPONT_RES_SIT_DIA (CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, DATA, CODIGO_SITUACAO, REF_HORAS, LOGIN_USUARIO, DT_ULT_ALTER_USUA, TIPO_APURACAO , FORCA_SITUACAO )
      VALUES (C1.CODIGO_EMPRESA, C1.TIPO_CONTRATO, C1.CODIGO_CONTRATO,trunc(C2.DATA_DIA), C1.CODIGO_SITUACAO, 1, C1.LOGIN_USUARIO, SYSDATE , 'F', 'N');
  ELSE 
     /*ESTORNO DE FALTA ADD LETICIA  */
     FOR C3 IN (

        SELECT SP.CODIGO_SITUACAO SITUACAO, S.TIPO_SITUACAO TIPO_SITUACAO
        FROM RHPONT_RES_SIT_DIA SP
        LEFT OUTER JOIN RHPONT_SITUACAO S ON SP.CODIGO_SITUACAO = S.CODIGO
        WHERE SP.CODIGO_EMPRESA = C1.CODIGO_EMPRESA AND SP.TIPO_CONTRATO = C1.TIPO_CONTRATO AND SP.CODIGO_CONTRATO = C1.CODIGO_CONTRATO
        AND trunc(SP.DATA) = trunc(C2.DATA_DIA)
      )
      LOOP
            /* LETICIA EM 23/09/2021 */
          FOR C4 IN (  
            SELECt  codigo FROM RHPONT_SITUACAO
            WHERE RHPONT_SITUACAO.situacao_assoc = C1.codigo_situacao
            )
          LOOP
            IF (C4.CODIGO = C3.SITUACAO) THEN
            /* FIM 23/09/2021 */
                  dbms_output.put_line('PARTE DO 1015 '|| C2.DATA_DIA);
                  IF ( C3.SITUACAO IS NOT NULL AND C3.TIPO_SITUACAO = 'F' ) THEN
                   dbms_output.put_line('INSERT 1015: '|| C2.DATA_DIA);  
                    delete RHPONT_RES_SIT_DIA where CODIGO_EMPRESA = C1.CODIGO_EMPRESA and TIPO_CONTRATO = C1.TIPO_CONTRATO and CODIGO_CONTRATO = C1.CODIGO_CONTRATO and trunc(DATA) = trunc(C2.DATA_DIA)
                    and CODIGO_SITUACAO = C1.CODIGO_SITUACAO and REF_HORAS = 1 and TIPO_APURACAO = 'F'; --commit;
                    INSERT INTO RHPONT_RES_SIT_DIA (CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, DATA, CODIGO_SITUACAO, REF_HORAS, LOGIN_USUARIO, DT_ULT_ALTER_USUA, TIPO_APURACAO, FORCA_SITUACAO  )
                    VALUES (C1.CODIGO_EMPRESA, C1.TIPO_CONTRATO, C1.CODIGO_CONTRATO,trunc(C2.DATA_DIA), C1.CODIGO_SITUACAO, 1, C1.LOGIN_USUARIO, SYSDATE , 'F', 'N');
                  END IF;
            END IF;
           END LOOP;-- END C4
      END LOOP; -- END C3
     /*FIM ESTORNO DE FALTA ADD LETICIA  */
    END IF;
  END LOOP; --END C2

    ELSIF C1.TIPO_DML = 'D' THEN
      dbms_output.put_line('DELETE GERAL: '|| C1.CODIGO_EMPRESA|| '-' ||C1.TIPO_CONTRATO|| '-' ||C1.CODIGO_CONTRATO|| '-' ||C1.CODIGO_SITUACAO|| '-' || C1.OLD_DATA_INICIO_OCORRE || '-' ||C1.OLD_DATA_TERMINO_OCORR);
      delete RHPONT_RES_SIT_DIA where CODIGO_EMPRESA = C1.CODIGO_EMPRESA and TIPO_CONTRATO = C1.TIPO_CONTRATO and CODIGO_CONTRATO = C1.CODIGO_CONTRATO
      and trunc(DATA) BETWEEN trunc(C1.OLD_DATA_INICIO_OCORRE) AND trunc(C1.OLD_DATA_TERMINO_OCORR)
      and CODIGO_SITUACAO = C1.CODIGO_SITUACAO and REF_HORAS = 1 and TIPO_APURACAO = 'F';--commit;

    END IF;

  END LOOP;--END C1


  END;



END;
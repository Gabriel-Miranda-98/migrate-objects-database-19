
  CREATE OR REPLACE EDITIONABLE PROCEDURE "PONTO_ELETRONICO"."PRG3_PREPARA_SIT_FUNC_OCOR" (DATA_INICIO IN DATE, DATA_FIM IN DATE)
AS
BEGIN
--Kellysson em 8/4/22 baseado (preparar_SIT_FUNC_da_OCORRENCIA_v3.sql)

--KELLYSSON EM 7/1/20
--Kellysson em 8/1/21 - Para gravar no Arterh como SITUAÃ‡ÃƒO FUNCIONAL o que for de OCORRENCIA e JUSTIFICATIVA lanÃ§adas no Ifponto autorizadas para esse processo baseado tabela de conversÃ£o do Arterh IFP2, TRATADA CONVERTENDO DIAS DE JUSTIFICATIVA EM PERIODOS DE SIT FUNC
--Kellysson em 7/7/21 migrando para v2 para comparar com marcacao no dia se teve ou nao
--Kellysson em 3/11/21 migrando para v3 fazendo ajustes devido a erros fechamento set/21 ------------------------trocar datas
--/*
DECLARE 
vDATA_INICIO DATE;
vDATA_FIM DATE;
vCONTADOR NUMBER (10);
--vDATA_INICIO DATE;
--vDATA_FIM DATE;

BEGIN
vDATA_INICIO := DATA_INICIO;
vDATA_FIM := DATA_FIM;
dbms_output.enable(null);
vCONTADOR :=0;
--vDATA_INICIO := NULL;
--vDATA_FIM := NULL;

FOR C1 IN(
--*/

SELECT
E.MARCACAO_E1,E.MARCACAO_E2,
CASE 
--WHEN X3.TIPO = 'OCORRENCIA' 
--THEN '*********GRAVA OCORRENCIA'
WHEN /*X3.TIPO <> 'OCORRENCIA' AND*/ X3.MATRICULA_ANTERIOR IS NULL AND X3.MATRICULA = X3.PROXIMA_MATRICULA  AND X3.DIF_DIA_DTINICIO = 1 AND X3.ANTERIOR_DIF_DIA_DTINICIO IS NULL AND X3.PROXIMA_DIF_DIA_DTINICIO = 1-- AND E.MARCACAO_E1 = 0 AND E.MARCACAO_E2 = 0
THEN 'PRIMEIRO DIA SITUACAO SEQ 1' 
WHEN /*X3.TIPO <> 'OCORRENCIA' AND*/ X3.MATRICULA_ANTERIOR IS NOT NULL AND X3.MATRICULA = X3.PROXIMA_MATRICULA  AND X3.DIF_DIA_DTINICIO = 1 AND X3.ANTERIOR_DIF_DIA_DTINICIO <> 1 AND X3.PROXIMA_DIF_DIA_DTINICIO <> 1-- AND E.MARCACAO_E1 = 0 AND E.MARCACAO_E2 = 0
THEN 'PRIMEIRO DIA SITUACAO SEQ 2' --NOVO 3/11/21

WHEN /*X3.TIPO <> 'OCORRENCIA' AND*/ X3.MATRICULA_ANTERIOR IS NOT NULL AND X3.MATRICULA = X3.PROXIMA_MATRICULA  AND X3.DIF_DIA_DTINICIO = 1 AND X3.ANTERIOR_DIF_DIA_DTINICIO = 1 AND X3.PROXIMA_DIF_DIA_DTINICIO = 1 --AND E.MARCACAO_E1 = 0 AND E.MARCACAO_E2 = 0
THEN 'DIA DO MEIO SITUACAO SEQ 1'
WHEN /*X3.TIPO <> 'OCORRENCIA' AND*/ X3.MATRICULA_ANTERIOR IS NOT NULL AND X3.MATRICULA = X3.PROXIMA_MATRICULA  AND X3.DIF_DIA_DTINICIO = 1 AND X3.ANTERIOR_DIF_DIA_DTINICIO = 1 AND X3.PROXIMA_DIF_DIA_DTINICIO <> 1 --AND E.MARCACAO_E1 = 0 AND E.MARCACAO_E2 = 0
THEN 'DIA DO MEIO SITUACAO SEQ 2'--NOVO 3/11/21

WHEN /*X3.TIPO <> 'OCORRENCIA' AND*/ X3.PROXIMA_MATRICULA IS NULL AND X3.DIF_DIA_DTINICIO = 1 AND X3.ORDEM_DIA_MESMO_LANC <> 1 AND X3.ANTERIOR_DIF_DIA_DTINICIO = 1 AND X3.PROXIMA_DIF_DIA_DTINICIO IS NULL --AND E.MARCACAO_E1 = 0 AND E.MARCACAO_E2 = 0
THEN 'ULTIMO DIA SITUACAO SEQ'

WHEN /*X3.TIPO <> 'OCORRENCIA' AND*/ X3.PROXIMA_MATRICULA IS NULL AND X3.DIF_DIA_DTINICIO = 1 AND X3.ORDEM_DIA_MESMO_LANC = 1 AND X3.ANTERIOR_DIF_DIA_DTINICIO IS NULL AND X3.PROXIMA_DIF_DIA_DTINICIO IS NULL --AND E.MARCACAO_E1 = 0 AND E.MARCACAO_E2 = 0
THEN '1 DIA DE SITUACAO'

WHEN /*X3.TIPO <> 'OCORRENCIA' AND*/ X3.MATRICULA_ANTERIOR IS NULL AND X3.DIF_DIA_DTINICIO <> 1 --AND E.MARCACAO_E1 = 0 AND E.MARCACAO_E2 = 0
THEN '1 DIA DE SITUACAO NAO SEQUENCIAL C1'

WHEN /*X3.TIPO <> 'OCORRENCIA' AND*/ X3.PROXIMA_MATRICULA IS NULL AND X3.ANTERIOR_DIF_DIA_DTINICIO <> 1 --AND E.MARCACAO_E1 = 0 AND E.MARCACAO_E2 = 0
THEN '1 DIA DE SITUACAO NAO SEQUENCIAL C2'

WHEN /*X3.TIPO <> 'OCORRENCIA' AND*/ X3.PROXIMA_MATRICULA IS NOT NULL AND X3.ANTERIOR_DIF_DIA_DTINICIO <> 1 AND X3.DIF_DIA_DTINICIO <> 1 --AND E.MARCACAO_E1 = 0 AND E.MARCACAO_E2 = 0
THEN '1 DIA DE SITUACAO NAO SEQUENCIAL C3' --NOVO 1/11/21

WHEN /*X3.TIPO <> 'OCORRENCIA' AND*/ X3.MATRICULA = X3.PROXIMA_MATRICULA  AND X3.DIF_DIA_DTINICIO = 1 AND X3.ANTERIOR_DIF_DIA_DTINICIO IS NULL AND X3.PROXIMA_DIF_DIA_DTINICIO <> 1 --AND E.MARCACAO_E1 = 0 AND E.MARCACAO_E2 = 0
THEN 'PRIMEIRO DIA SITUACAO NAO SEQ C1'

WHEN /*X3.TIPO <> 'OCORRENCIA' AND*/ X3.MATRICULA = X3.PROXIMA_MATRICULA  AND X3.DIF_DIA_DTINICIO = 1 AND X3.ANTERIOR_DIF_DIA_DTINICIO <> 1 AND X3.PROXIMA_DIF_DIA_DTINICIO = 1 --AND E.MARCACAO_E1 = 0 AND E.MARCACAO_E2 = 0
THEN 'PRIMEIRO DIA SITUACAO NAO SEQ C2'

WHEN /*X3.TIPO <> 'OCORRENCIA' AND*/ X3.DIF_DIA_DTINICIO <> 1 AND X3.ORDEM_DIA_MESMO_LANC <> 1 AND X3.ANTERIOR_DIF_DIA_DTINICIO = 1 --AND E.MARCACAO_E1 = 0 AND E.MARCACAO_E2 = 0
THEN 'ULTIMO DIA SITUACAO NA0 SEQ C1'

--WHEN /*E.MARCACAO_E1 <> 0 OR E.MARCACAO_E2 <> 0 OR*/ E.MARCACAO_E1 IS NULL OR E.MARCACAO_E2 IS NULL THEN '----DIA COM MARCACAO OU FORA DO PERIODO NAO ENTRA NA LOGICA'

ELSE '-----*********************CENARIO NAO MAPEADO AINDA'
END CENARIO, 
X3.*
/*X3.TIPO, X3.PERIODO, X3.SIT_FUNC,
 X3.TIPO_CONTRATO, X3.MATRICULA, X3.SIT_PONTO, X3.DTINICIO, X3.DTFIM, X3.EMPRESA
 ,X3.COD_EMPRESA, X3.CODIGO, X3.COD_JUSTIFICATIVA_PONTO, X3.COD_PESSOA, X3.DTCADASTRO, X3.LOGIN_CADASTRO, X3.SITUACAO, X3.OBS, X3.CODIGO_LEGADO, X3.DTAPAGOU, X3.LOGIN_APAGOU, X3.COMPROVANTE, X3.LOGIN_APROVACAO, X3.DTAPROVACAO, X3.QTD_HORAS
*/
FROM (

SELECT 
--X2.ANTERIOR_ORDEM_DIA_MESMO_LANC,
X2.ORDEM_DIA_MESMO_LANC, X2.PROXIMA_ORDEM_DIA_MESMO_LANC, 
LAG(X2.DIF_DIA_DTINICIO, 1, NULL) OVER (PARTITION BY X2.TIPO, X2.PERIODO, X2.SIT_FUNC, X2.EMPRESA, X2.TIPO_CONTRATO, X2.MATRICULA, X2.SIT_PONTO ORDER BY X2.DTINICIO) AS ANTERIOR_DIF_DIA_DTINICIO,
X2.DIF_DIA_DTINICIO,
LEAD(X2.DIF_DIA_DTINICIO, 1, NULL) OVER (PARTITION BY X2.TIPO, X2.PERIODO, X2.SIT_FUNC, X2.EMPRESA, X2.TIPO_CONTRATO, X2.MATRICULA, X2.SIT_PONTO ORDER BY X2.DTINICIO) AS PROXIMA_DIF_DIA_DTINICIO,
X2.MATRICULA_ANTERIOR, X2.MATRICULA, X2.PROXIMA_MATRICULA, X2.DTINICIO, X2.PROXIMA_DTINICIO, X2.DTFIM, X2.SIT_PONTO, X2.SIT_FUNC, X2.TIPO, X2.PERIODO, X2.EMPRESA, X2.TIPO_CONTRATO
,X2.COD_EMPRESA, X2.CODIGO, X2.COD_JUSTIFICATIVA_PONTO, X2.COD_PESSOA, X2.DTCADASTRO, X2.LOGIN_CADASTRO, X2.SITUACAO, X2.OBS, X2.CODIGO_LEGADO, X2.DTAPAGOU, X2.LOGIN_APAGOU, X2.COMPROVANTE, X2.LOGIN_APROVACAO, X2.DTAPROVACAO, X2.QTD_HORAS
FROM(

SELECT 
X.*
,TRUNC(X.PROXIMA_DTINICIO)-TRUNC(X.DTINICIO) DIF_DIA_DTINICIO
--,LAG(X.ORDEM_DIA_MESMO_LANC, 1, NULL) OVER (PARTITION BY X.TIPO, X.PERIODO, X.SIT_FUNC, X.EMPRESA, X.TIPO_CONTRATO, X.MATRICULA, X.SIT_PONTO ORDER BY X.DTINICIO) AS ANTERIOR_ORDEM_DIA_MESMO_LANC
,LEAD(X.ORDEM_DIA_MESMO_LANC, 1, NULL) OVER (PARTITION BY X.TIPO, X.PERIODO, X.SIT_FUNC, X.EMPRESA, X.TIPO_CONTRATO, X.MATRICULA, X.SIT_PONTO ORDER BY X.DTINICIO) AS PROXIMA_ORDEM_DIA_MESMO_LANC
FROM(
--inicio------------- DO NUCLEO DO SQL --tinha antes na v1b 101 registros agora na v2 tem que ter 271 registros
--inicio --novo
SELECT 
--X2.ORDEM_MESMO_CODIGO, 
ROW_NUMBER() OVER (PARTITION BY TC.TIPO, TC.PERIODO, TC.SIT_FUNC, X2.EMPRESA, X2.TIPO_CONTRATO, X2.MATRICULA, X2.SIT_PONTO ORDER BY X2.DTINICIO) AS ORDEM_DIA_MESMO_LANC,
TC.TIPO, TC.PERIODO, TC.SIT_FUNC, 
X2.EMPRESA, X2.TIPO_CONTRATO, 
LAG(X2.MATRICULA, 1, NULL) OVER (PARTITION BY TC.TIPO, TC.PERIODO, TC.SIT_FUNC, X2.EMPRESA, X2.TIPO_CONTRATO, X2.MATRICULA, X2.SIT_PONTO ORDER BY X2.DTINICIO) AS MATRICULA_ANTERIOR,
X2.MATRICULA,
LEAD(X2.MATRICULA, 1, NULL) OVER (PARTITION BY TC.TIPO, TC.PERIODO, TC.SIT_FUNC, X2.EMPRESA, X2.TIPO_CONTRATO, X2.MATRICULA, X2.SIT_PONTO ORDER BY X2.DTINICIO) AS PROXIMA_MATRICULA,
X2.SIT_PONTO, X2.DTINICIO, X2.DTFIM
,LEAD(X2.DTINICIO, 1, TRUNC(X2.DTINICIO)+1) OVER (PARTITION BY TC.TIPO, TC.PERIODO, TC.SIT_FUNC, X2.EMPRESA, X2.TIPO_CONTRATO, X2.MATRICULA, X2.SIT_PONTO ORDER BY X2.DTINICIO) AS PROXIMA_DTINICIO
,X2.COD_EMPRESA, X2.CODIGO, X2.COD_JUSTIFICATIVA_PONTO, X2.COD_PESSOA, X2.DTCADASTRO, 
X2.LOGIN_CADASTRO,  X2.SITUACAO, X2.OBS, X2.CODIGO_LEGADO, X2.DTAPAGOU, X2.LOGIN_APAGOU, X2.COMPROVANTE, X2.LOGIN_APROVACAO, X2.DTAPROVACAO, X2.QTD_HORAS, X2.DATA_PROCESSAMENTO
FROM(
SELECT ROW_NUMBER() OVER (PARTITION BY X.COD_EMPRESA, X.TIPO_CONTRATO, X.MATRICULA, X.CODIGO, X.DTINICIO ORDER BY X.CODIGO ) ORDEM_MESMO_CODIGO,
X.* 
FROM PONTO_ELETRONICO.IFPONTO_OCOR_JUST_SIT_FUNC_TR X 
WHERE X.DATA_PROCESSAMENTO IS NULL AND ((X.DTINICIO = X.DTFIM AND X.COD_JUSTIFICATIVA_PONTO = 150)OR X.COD_JUSTIFICATIVA_PONTO = 151)
AND TRUNC(X.DTINICIO) BETWEEN vDATA_INICIO AND vDATA_FIM --BETWEEN TO_DATE('01/03/2022','DD/MM/YYYY') AND TO_DATE('31/03/2022','DD/MM/YYYY')--APENAS OS REGISTROS DO MES DE FECHAMENTO --NOVO EM 1/11/21 ------------------------trocar datas
ORDER BY X.COD_EMPRESA, X.TIPO_CONTRATO, X.MATRICULA, X.DTINICIO, X.CODIGO--292 DEPOIS DE CONVERTIDOS, TIRANDO OS ORIGINAIS DE OCORRENCIA VAI PARA 278
)X2 
LEFT OUTER JOIN (SELECT DADO_ORIGEM, SUBSTR(DADO_ORIGEM,1,10) TIPO, SUBSTR(DADO_ORIGEM,11,4) SIT_PONTO, DADO_DESTINO, SUBSTR(DADO_DESTINO,18,3)PERIODO,  SUBSTR(DADO_DESTINO,21,4) SIT_FUNC FROM RHINTE_ED_IT_CONV WHERE CODIGO_CONVERSAO = 'IFP2')TC
ON X2.SIT_PONTO = TC.SIT_PONTO
WHERE X2.ORDEM_MESMO_CODIGO = 1
--fim-- novo
--fim------------ DO NUCLEO DO SQL --tinha antes na v1b 101 registros agora na v2 tem que ter 271 registros
)X

)X2
--testes
--where x2.matricula in ('000000001032206','000000001168167','000000000288385','000000003082626','000000000439774') ORDER BY  x2.matricula ,X2.DTINICIO
)X3
LEFT OUTER JOIN (SELECT * FROM PONTO_ELETRONICO.IFPONTO_ESPELHO_HISTORICA WHERE DATA_PROCESSAMENTO IS NULL
AND LPAD(EMPRESA,4,'0') IN (SELECT DADO_ORIGEM FROM ARTERH.RHINTE_ED_IT_CONV WHERE CODIGO_CONVERSAO = 'IFP4')--NOVO EM 7/11/23
)E 
ON E.EMPRESA = X3.EMPRESA AND E.TIPO_CONTRATO = X3.TIPO_CONTRATO AND E.MATRICULA = X3.MATRICULA AND TRUNC(E.DATA) = TRUNC(X3.DTINICIO)

WHERE E.DATA IS NOT NULL --APENAS OS REGISTROS DO MES DE FECHAMENTO --NOVO EM 1/11/21

--WHERE E.MARCACAO_E1 = 0 AND E.MARCACAO_E2 = 0 --205
--and 
--x3.matricula = '000000000387731' -- TESTES 1/11/21

--and x3.matricula in ('000000001160247','000000001184294','000000001250300')--testes 23/9/21


ORDER BY X3.COD_EMPRESA, X3.TIPO_CONTRATO, X3.MATRICULA, X3.DTINICIO, X3.CODIGO




--/*
)

LOOP
vCONTADOR :=vCONTADOR+1;
dbms_output.put_line('vCONTADOR: '|| vCONTADOR || '-'|| C1.MATRICULA||'-'||TRUNC(C1.DTINICIO) ||'-'||TRUNC(C1.DTFIM));



--INICIO --DEFINIR DATA INICIO E FIM
IF C1.MATRICULA_ANTERIOR IS NULL AND C1.MATRICULA = C1.PROXIMA_MATRICULA  AND C1.DIF_DIA_DTINICIO = 1 AND C1.ANTERIOR_DIF_DIA_DTINICIO IS NULL AND C1.PROXIMA_DIF_DIA_DTINICIO = 1 THEN
vDATA_INICIO := C1.DTINICIO;
vDATA_FIM := C1.DTINICIO;
dbms_output.put_line('PRIMEIRO DIA SITUACAO SEQ 1 '||C1.MATRICULA||'-'||vDATA_INICIO||'-'||vDATA_FIM|| ' - *GRAVA NADA');

 --NOVO 3/11/21
ELSIF C1.MATRICULA_ANTERIOR IS NOT NULL AND C1.MATRICULA = C1.PROXIMA_MATRICULA  AND C1.DIF_DIA_DTINICIO = 1 AND C1.ANTERIOR_DIF_DIA_DTINICIO <> 1 AND C1.PROXIMA_DIF_DIA_DTINICIO <> 1 THEN
vDATA_INICIO := C1.DTINICIO;
vDATA_FIM := C1.DTINICIO;
dbms_output.put_line('PRIMEIRO DIA SITUACAO SEQ 2 '||C1.MATRICULA||'-'||vDATA_INICIO||'-'||vDATA_FIM|| ' - *GRAVA NADA');

ELSIF C1.MATRICULA_ANTERIOR IS NOT NULL AND C1.MATRICULA = C1.PROXIMA_MATRICULA  AND C1.DIF_DIA_DTINICIO = 1 AND C1.ANTERIOR_DIF_DIA_DTINICIO = 1 AND C1.PROXIMA_DIF_DIA_DTINICIO = 1 THEN
vDATA_FIM := C1.DTINICIO;
dbms_output.put_line('DIA DO MEIO SITUACAO SEQ 1 '||C1.MATRICULA||'-'||vDATA_INICIO||'-'||vDATA_FIM || ' - *GRAVA NADA');

--NOVO 3/11/21
ELSIF C1.MATRICULA_ANTERIOR IS NOT NULL AND C1.MATRICULA = C1.PROXIMA_MATRICULA  AND C1.DIF_DIA_DTINICIO = 1 AND C1.ANTERIOR_DIF_DIA_DTINICIO = 1 AND C1.PROXIMA_DIF_DIA_DTINICIO <> 1 THEN
vDATA_FIM := C1.DTINICIO;
dbms_output.put_line('DIA DO MEIO SITUACAO SEQ 2 '||C1.MATRICULA||'-'||vDATA_INICIO||'-'||vDATA_FIM || ' - *GRAVA NADA');

ELSIF C1.PROXIMA_MATRICULA IS NULL AND C1.DIF_DIA_DTINICIO = 1 AND C1.ORDEM_DIA_MESMO_LANC <> 1 AND C1.ANTERIOR_DIF_DIA_DTINICIO = 1 AND C1.PROXIMA_DIF_DIA_DTINICIO IS NULL THEN
vDATA_FIM := C1.DTINICIO;
dbms_output.put_line('ULTIMO DIA SITUACAO SEQ '||C1.MATRICULA||'-'||vDATA_INICIO||'-'||vDATA_FIM || ' **GRAVAR REGISTRO**');
INSERT INTO PONTO_ELETRONICO.IFPONTO_OCOR_JUST_SIT_FUNC_T2 (COD_EMPRESA, TIPO_CONTRATO, MATRICULA, SIT_PONTO, CODIGO, COD_JUSTIFICATIVA_PONTO, COD_PESSOA, DTCADASTRO, LOGIN_CADASTRO, DTINICIO, DTFIM, SITUACAO, OBS, CODIGO_LEGADO, DTAPAGOU, LOGIN_APAGOU, COMPROVANTE, LOGIN_APROVACAO, DTAPROVACAO, QTD_HORAS,  EMPRESA)
VALUES (C1.COD_EMPRESA, C1.TIPO_CONTRATO, C1.MATRICULA, C1.SIT_PONTO, C1.CODIGO, C1.COD_JUSTIFICATIVA_PONTO, C1.COD_PESSOA, C1.DTCADASTRO, C1.LOGIN_CADASTRO, vDATA_INICIO, vDATA_FIM, C1.SITUACAO, C1.OBS, C1.CODIGO_LEGADO, C1.DTAPAGOU, C1.LOGIN_APAGOU, C1.COMPROVANTE, C1.LOGIN_APROVACAO, C1.DTAPROVACAO, C1.QTD_HORAS,  C1.EMPRESA);
COMMIT;

ELSIF C1.PROXIMA_MATRICULA IS NULL AND C1.DIF_DIA_DTINICIO = 1 AND C1.ORDEM_DIA_MESMO_LANC = 1 AND C1.ANTERIOR_DIF_DIA_DTINICIO IS NULL AND C1.PROXIMA_DIF_DIA_DTINICIO IS NULL THEN
vDATA_INICIO := C1.DTINICIO;
vDATA_FIM := C1.DTINICIO;
dbms_output.put_line('1 DIA DE SITUACAO '||C1.MATRICULA||'-'||vDATA_INICIO||'-'||vDATA_FIM || ' **GRAVAR REGISTRO**');
INSERT INTO PONTO_ELETRONICO.IFPONTO_OCOR_JUST_SIT_FUNC_T2 (COD_EMPRESA, TIPO_CONTRATO, MATRICULA, SIT_PONTO, CODIGO, COD_JUSTIFICATIVA_PONTO, COD_PESSOA, DTCADASTRO, LOGIN_CADASTRO, DTINICIO, DTFIM, SITUACAO, OBS, CODIGO_LEGADO, DTAPAGOU, LOGIN_APAGOU, COMPROVANTE, LOGIN_APROVACAO, DTAPROVACAO, QTD_HORAS,  EMPRESA)
VALUES (C1.COD_EMPRESA, C1.TIPO_CONTRATO, C1.MATRICULA, C1.SIT_PONTO, C1.CODIGO, C1.COD_JUSTIFICATIVA_PONTO, C1.COD_PESSOA, C1.DTCADASTRO, C1.LOGIN_CADASTRO, vDATA_INICIO, vDATA_FIM, C1.SITUACAO, C1.OBS, C1.CODIGO_LEGADO, C1.DTAPAGOU, C1.LOGIN_APAGOU, C1.COMPROVANTE, C1.LOGIN_APROVACAO, C1.DTAPROVACAO, C1.QTD_HORAS,  C1.EMPRESA);
COMMIT;

ELSIF C1.MATRICULA_ANTERIOR IS NULL AND C1.DIF_DIA_DTINICIO <> 1 THEN
vDATA_INICIO := C1.DTINICIO;
vDATA_FIM := C1.DTINICIO;
dbms_output.put_line('1 DIA DE SITUACAO NAO SEQUENCIAL C1 '||C1.MATRICULA||'-'||vDATA_INICIO||'-'||vDATA_FIM || ' **GRAVAR REGISTRO**');
INSERT INTO PONTO_ELETRONICO.IFPONTO_OCOR_JUST_SIT_FUNC_T2 (COD_EMPRESA, TIPO_CONTRATO, MATRICULA, SIT_PONTO, CODIGO, COD_JUSTIFICATIVA_PONTO, COD_PESSOA, DTCADASTRO, LOGIN_CADASTRO, DTINICIO, DTFIM, SITUACAO, OBS, CODIGO_LEGADO, DTAPAGOU, LOGIN_APAGOU, COMPROVANTE, LOGIN_APROVACAO, DTAPROVACAO, QTD_HORAS,  EMPRESA)
VALUES (C1.COD_EMPRESA, C1.TIPO_CONTRATO, C1.MATRICULA, C1.SIT_PONTO, C1.CODIGO, C1.COD_JUSTIFICATIVA_PONTO, C1.COD_PESSOA, C1.DTCADASTRO, C1.LOGIN_CADASTRO, vDATA_INICIO, vDATA_FIM, C1.SITUACAO, C1.OBS, C1.CODIGO_LEGADO, C1.DTAPAGOU, C1.LOGIN_APAGOU, C1.COMPROVANTE, C1.LOGIN_APROVACAO, C1.DTAPROVACAO, C1.QTD_HORAS,  C1.EMPRESA);
COMMIT;

ELSIF C1.PROXIMA_MATRICULA IS NULL AND C1.ANTERIOR_DIF_DIA_DTINICIO <> 1 THEN
vDATA_INICIO := C1.DTINICIO;
vDATA_FIM := C1.DTINICIO;
dbms_output.put_line('1 DIA DE SITUACAO NAO SEQUENCIAL C2 '||C1.MATRICULA||'-'||vDATA_INICIO||'-'||vDATA_FIM || ' **GRAVAR REGISTRO**');
INSERT INTO PONTO_ELETRONICO.IFPONTO_OCOR_JUST_SIT_FUNC_T2 (COD_EMPRESA, TIPO_CONTRATO, MATRICULA, SIT_PONTO, CODIGO, COD_JUSTIFICATIVA_PONTO, COD_PESSOA, DTCADASTRO, LOGIN_CADASTRO, DTINICIO, DTFIM, SITUACAO, OBS, CODIGO_LEGADO, DTAPAGOU, LOGIN_APAGOU, COMPROVANTE, LOGIN_APROVACAO, DTAPROVACAO, QTD_HORAS,  EMPRESA)
VALUES (C1.COD_EMPRESA, C1.TIPO_CONTRATO, C1.MATRICULA, C1.SIT_PONTO, C1.CODIGO, C1.COD_JUSTIFICATIVA_PONTO, C1.COD_PESSOA, C1.DTCADASTRO, C1.LOGIN_CADASTRO, vDATA_INICIO, vDATA_FIM, C1.SITUACAO, C1.OBS, C1.CODIGO_LEGADO, C1.DTAPAGOU, C1.LOGIN_APAGOU, C1.COMPROVANTE, C1.LOGIN_APROVACAO, C1.DTAPROVACAO, C1.QTD_HORAS,  C1.EMPRESA);
COMMIT;

--NOVO 1/11/21
ELSIF C1.PROXIMA_MATRICULA IS NOT NULL AND C1.ANTERIOR_DIF_DIA_DTINICIO <> 1 AND C1.DIF_DIA_DTINICIO <> 1 THEN
vDATA_INICIO := C1.DTINICIO;
vDATA_FIM := C1.DTINICIO;
dbms_output.put_line('1 DIA DE SITUACAO NAO SEQUENCIAL C3 '||C1.MATRICULA||'-'||vDATA_INICIO||'-'||vDATA_FIM || ' **GRAVAR REGISTRO**');
INSERT INTO PONTO_ELETRONICO.IFPONTO_OCOR_JUST_SIT_FUNC_T2 (COD_EMPRESA, TIPO_CONTRATO, MATRICULA, SIT_PONTO, CODIGO, COD_JUSTIFICATIVA_PONTO, COD_PESSOA, DTCADASTRO, LOGIN_CADASTRO, DTINICIO, DTFIM, SITUACAO, OBS, CODIGO_LEGADO, DTAPAGOU, LOGIN_APAGOU, COMPROVANTE, LOGIN_APROVACAO, DTAPROVACAO, QTD_HORAS,  EMPRESA)
VALUES (C1.COD_EMPRESA, C1.TIPO_CONTRATO, C1.MATRICULA, C1.SIT_PONTO, C1.CODIGO, C1.COD_JUSTIFICATIVA_PONTO, C1.COD_PESSOA, C1.DTCADASTRO, C1.LOGIN_CADASTRO, vDATA_INICIO, vDATA_FIM, C1.SITUACAO, C1.OBS, C1.CODIGO_LEGADO, C1.DTAPAGOU, C1.LOGIN_APAGOU, C1.COMPROVANTE, C1.LOGIN_APROVACAO, C1.DTAPROVACAO, C1.QTD_HORAS,  C1.EMPRESA);
COMMIT;

ELSIF  C1.MATRICULA = C1.PROXIMA_MATRICULA  AND C1.DIF_DIA_DTINICIO = 1 AND C1.ANTERIOR_DIF_DIA_DTINICIO IS NULL AND C1.PROXIMA_DIF_DIA_DTINICIO <> 1 THEN
vDATA_INICIO := C1.DTINICIO;
vDATA_FIM := C1.DTINICIO;
dbms_output.put_line('PRIMEIRO DIA SITUACAO NAO SEQ C1 '||C1.MATRICULA||'-'||vDATA_INICIO||'-'||vDATA_FIM || ' - *GRAVA NADA');

ELSIF C1.MATRICULA = C1.PROXIMA_MATRICULA  AND C1.DIF_DIA_DTINICIO = 1 AND C1.ANTERIOR_DIF_DIA_DTINICIO <> 1 AND C1.PROXIMA_DIF_DIA_DTINICIO = 1 THEN
vDATA_INICIO := C1.DTINICIO;
vDATA_FIM := C1.DTINICIO;
dbms_output.put_line('PRIMEIRO DIA SITUACAO NAO SEQ C2 '||C1.MATRICULA||'-'||vDATA_INICIO||'-'||vDATA_FIM || ' - *GRAVA NADA');

ELSIF C1.DIF_DIA_DTINICIO <> 1 AND C1.ORDEM_DIA_MESMO_LANC <> 1 AND C1.ANTERIOR_DIF_DIA_DTINICIO = 1  THEN
vDATA_FIM := C1.DTINICIO;
dbms_output.put_line('ULTIMO DIA SITUACAO NA0 SEQ C1 '||C1.MATRICULA||'-'||vDATA_INICIO||'-'||vDATA_FIM || ' **GRAVAR REGISTRO**');
INSERT INTO PONTO_ELETRONICO.IFPONTO_OCOR_JUST_SIT_FUNC_T2 (COD_EMPRESA, TIPO_CONTRATO, MATRICULA, SIT_PONTO, CODIGO, COD_JUSTIFICATIVA_PONTO, COD_PESSOA, DTCADASTRO, LOGIN_CADASTRO, DTINICIO, DTFIM, SITUACAO, OBS, CODIGO_LEGADO, DTAPAGOU, LOGIN_APAGOU, COMPROVANTE, LOGIN_APROVACAO, DTAPROVACAO, QTD_HORAS, EMPRESA)
VALUES (C1.COD_EMPRESA, C1.TIPO_CONTRATO, C1.MATRICULA, C1.SIT_PONTO, C1.CODIGO, C1.COD_JUSTIFICATIVA_PONTO, C1.COD_PESSOA, C1.DTCADASTRO, C1.LOGIN_CADASTRO, vDATA_INICIO, vDATA_FIM, C1.SITUACAO, C1.OBS, C1.CODIGO_LEGADO, C1.DTAPAGOU, C1.LOGIN_APAGOU, C1.COMPROVANTE, C1.LOGIN_APROVACAO, C1.DTAPROVACAO, C1.QTD_HORAS, C1.EMPRESA);
COMMIT;

ELSE
dbms_output.put_line('-----*********************CENARIO NAO MAPEADO AINDA' );

END IF;
--IF --FIM--DEFINIR DATA INICIO E FIM

--END IF;

END LOOP;

END;
--*/

END;


  CREATE OR REPLACE EDITIONABLE PROCEDURE "ARTERH"."PR_SANEAMENTO_DEP" (DATA_ACERTO IN DATE)
AS
  CONT               NUMBER;
  TABELA             VARCHAR2(200);
  COLUNA_DESTINO     VARCHAR2(200);
  COLUNA_DESTINO_EMP VARCHAR2(200);
  vCODIGO_PESSOA     CHAR(15);
  vCPF               VARCHAR2(11);
  vDATA_NASCIMENTO   DATE;
  vSQL               VARCHAR2(256);
  vSQL1              VARCHAR2(256);
  vTABELA_RETORNO    VARCHAR2(200);
  vTROCAR            NUMBER ;
  ACAO               VARCHAR2(200);
  vCODIGO_EMPRESA    CHAR(4);
  vCOLUNA            VARCHAR2(200BYTE);
  vlinha_att         NUMBER;
  vCODIGO_PESSOA_A   VARCHAR2(15 BYTE);
  vDATA_ACERTO DATE;
  ---- COMANDO PARA CLASSIFICAR PESSOA ATIVA E INATIVA
  /*BEGIN
  DECLARE
  CONT NUMBER;
  V_CODIGO_PESSOA VARCHAR2(15BYTE);
  BEGIN
  CONT:=0;
  FOR C1 IN (
  SELECT X1.* FROM (
  SELECT  quant,
  TIPO,
  CODIGO,
  CPF,
  IDENTIDADE,
  TRIM(NOME_ACESSO)AS NOME_ACESSO,
  DATA_NASCIMENTO,
  CASE WHEN CPF IS NULL THEN TRIM(NOME_ACESSO) ELSE TRIM(CPF) END AS CHAVE_BUSCA
  FROM SANEAMENTO_PES_DEP A
  where TRIM(NOME_ACESSO) not  IN ('MARIA APARECIDA DE ALMEIDA',
  'SIMONE APARECIDA DA SILVA',
  'MARCIA DOS SANTOS',
  'LUCIANA MARIA DE SOUZA',
  'SILVANA APARECIDA DE OLIVEIRA',
  'MARIA APARECIDA NUNES',
  'MARCIA LUCIA PEREIRA',
  'CRISTIANO OLIVEIRA CASTRO',
  'MARIA HELENA DE OLIVEIRA',
  'MARIA APARECIDA GOMES',
  'CIDELIA MARIA DE LACERDA OLIVEIRA',
  'DULCILENE BARBOSA SILVA',
  'ISABELA ROSSI ALMEIDA FERREIRA',
  'LAURA LIMA DE ANDRADE',
  'ADRIANA CRISTINA DA SILVA',
  'FATIMA APARECIDA DA SILVA',
  'LEONARDO AUGUSTO RAMOS MARTINS',
  'PATRICIA PEREIRA DE SOUZA',
  'VALDENE BATISTA MARTINS',
  'ERIKA CAMPOS PLOTZ FREITAS',
  'LEONARDO AUGUSTO MACHADO CAMPOS',
  'MARIA HELENA DA SILVA',
  'MARIANA CORDEIRO FONSECA',
  'NILSON ALVES',
  'AURA VERONICA DOS SANTOS',
  'CARLA DEGANI DE ARAUJO ZILLER',
  'ERIKA DE OLIVEIRA',
  'ISABEL ANA DE SOUZA',
  'RENATA PEREIRA DOS SANTOS',
  'RUTH CASTELO BRANCO LOURENCO',
  'ANA PAULA DE SOUZA',
  'HELIANE MARIA MONTEIRO',
  'MARCOS ANTONIO DIAS',
  'MARIA APARECIDA DE JESUS',
  'LUCIANA ALESSANDRA FONTOURA',
  'RENATA MUNIZ RIBEIRO',
  'LEICEANE TEIXEIRA MORAES',
  'MARCELLA ALINE CORDEIRO OLIVEIRA')
  AND NOT EXISTS (SELECT TRIM(NOME_ACESSO) FROM NOME_ERRO AUX
  WHERE TRIM(AUX.CPF)=TRIM(A.CPF)
  AND TRIM (AUX.CODIGO)=TRIM(A.CODIGO)
  AND TRIM(AUX.NOME_ACESSO)=TRIM(A.NOME_ACESSO))
  ORDER BY NOME_ACESSO,
  tipo
  )X1 WHERE TRIM(X1.TIPO)='DT_FIM'
  )LOOP
  CONT:=CONT+1;
  BEGIN
  BEGIN
  IF LENGTH(C1.CHAVE_BUSCA) =11 THEN
  ---  dbms_output.put_line('ERRO CPF DUPLICADO'||C1.CHAVE_BUSCA||'----'||C1.NOME_ACESSO);
  SELECT CODIGO INTO V_CODIGO_PESSOA FROM SANEAMENTO_PES_DEP WHERE TRIM(CPF)=C1.CHAVE_BUSCA and TRIM(TIPO)='MANTER';
  UPDATE SANEAMENTO_PES_DEP SET CODIGO_P_ATIVO=V_CODIGO_PESSOA WHERE CODIGO=C1.CODIGO;
  COMMIT;
  END IF;
  IF  LENGTH(C1.CHAVE_BUSCA) >11 THEN
  ---   dbms_output.put_line('ERRO NOME ACESSO DUPLICADO'||C1.CHAVE_BUSCA||'----'||C1.NOME_ACESSO);
  SELECT CODIGO INTO V_CODIGO_PESSOA FROM SANEAMENTO_PES_DEP WHERE TRIM(NOME_ACESSO)=C1.CHAVE_BUSCA and TRIM(TIPO)='MANTER';
  UPDATE SANEAMENTO_PES_DEP SET CODIGO_P_ATIVO=V_CODIGO_PESSOA WHERE CODIGO=C1.CODIGO;
  END IF;
  EXCEPTION
  WHEN NO_DATA_FOUND THEN
  dbms_output.put_line('ERRO NAO ENCONTROU   '||C1.CHAVE_BUSCA||'----'||C1.NOME_ACESSO);
  V_CODIGO_PESSOA:=NULL;
  SELECT CODIGO INTO V_CODIGO_PESSOA FROM SANEAMENTO_PES_DEP WHERE TRIM(NOME_ACESSO)=C1.NOME_ACESSO and TRIM(TIPO)='MANTER';
  UPDATE SANEAMENTO_PES_DEP SET CODIGO_P_ATIVO=V_CODIGO_PESSOA WHERE CODIGO=C1.CODIGO;
  dbms_output.put_line(' BUSCOU CODIGO POR NOME_ACESSO '||V_CODIGO_PESSOA);
  WHEN OTHERS THEN
  dbms_output.put_line('ERRO  DUPLICADO   '||C1.CHAVE_BUSCA||'----'||C1.NOME_ACESSO);
  INSERT INTO NOME_ERRO(CPF,NOME_ACESSO,CODIGO,TIPO_ERRO)VALUES(C1.CPF,C1.NOME_ACESSO,C1.CODIGO,'DUPLICADO');
  END ;
  EXCEPTION
  WHEN NO_DATA_FOUND THEN
  INSERT INTO NOME_ERRO(CPF,NOME_ACESSO,CODIGO,TIPO_ERRO)VALUES(C1.CPF,C1.NOME_ACESSO,C1.CODIGO,'NAO_ENCONTOU');
  END ;
  END LOOP;
  END;
  END;
  ------------------ para pra refinar a logica de econtrat pessoa ativa do cadastro
  BEGIN
  DECLARE
    CONT NUMBER;
  BEGIN
    CONT:=0;
    FOR C1 IN (
    SELECT CODIGO,
      NOME_ACESSO,
      DATA_NASCIMENTO,
      DT_ULT_ALTER_USUA,
      IDENTIDADE,
      CPF
    FROM SANEAMENTO_PES_DEP
    WHERE TIPO          ='DT_FIM'
    AND CODIGO_P_ATIVO IS NULL
    ORDER BY NOME_ACESSO,
      CPF
      )LOOP
      CONT:=CONT+1;

      FOR C2 IN (
      SELECT CODIGO FROM SANEAMENTO_PES_DEP WHERE TRIM(NOME_ACESSO) =C1.NOME_ACESSO AND TIPO='MANTER' ORDER BY NOME_ACESSO,CPF
      )LOOP
      IF C2.CODIGO IS NOT NULL THEN 
      UPDATE SANEAMENTO_PES_DEP SET CODIGO_P_ATIVO=C2.CODIGO WHERE CODIGO=C1.CODIGO;
      ELSIF C2.CODIGO IS NULL THEN 
      FOR C3 IN (
      SELECT CODIGO,NOME_ACESSO,DATA_NASCIMENTO,DT_ULT_ALTER_USUA,IDENTIDADE,CPF,TIPO FROM SANEAMENTO_PES_DEP WHERE TRIM(CPF)=C1.CPF AND TIPO='MANTER' ORDER BY NOME_ACESSO,CPF)
      LOOP 
         IF C3.CODIGO IS NOT NULL THEN 
      UPDATE SANEAMENTO_PES_DEP SET CODIGO_P_ATIVO=C3.CODIGO WHERE CODIGO=C1.CODIGO;
       ELSIF C3.CODIGO IS NULL THEN FOR C4 IN (
          SELECT CODIGO,NOME_ACESSO,DATA_NASCIMENTO,DT_ULT_ALTER_USUA,IDENTIDADE,CPF,TIPO FROM SANEAMENTO_PES_DEP WHERE TRIM(IDENTIDADE)=C1.IDENTIDADE ORDER BY NOME_ACESSO,CPF
          ) LOOP
             IF C4.CODIGO IS NOT NULL THEN 
               UPDATE SANEAMENTO_PES_DEP SET CODIGO_P_ATIVO=C4.CODIGO WHERE CODIGO=C1.CODIGO;
             END IF;
            END LOOP;
        END IF;
      END LOOP;

      END IF;
      END LOOP;


      END LOOP;


  END;
END;
  */
  ----- RETORNA TABELA QUE CONTEM REGISTROS PARA O FOR
  FUNCTION TABELA_REGISTRO(
      vCODIGO_PESSOA     IN VARCHAR2,
      TABELA             IN VARCHAR2,
      COLUNA_DESTINO     IN VARCHAR2,
      COLUNA_DESTINO_EMP IN VARCHAR2 )
    RETURN VARCHAR2
  IS
  BEGIN
    --dbms_output.put_line('TABELA DA FUNCAO ----'||TABELA);
    --dbms_output.put_line('CODIGO_PESSOA ---------'||vCODIGO_PESSOA);
    IF COLUNA_DESTINO_EMP IS NOT NULL THEN
      vSQL1                 := 'SELECT COUNT(1)QUANT FROM '||TRIM(TABELA)||' WHERE '||TRIM(COLUNA_DESTINO)||' =  '''||TRIM(vCODIGO_PESSOA)||''' AND '||TRIM(COLUNA_DESTINO_EMP)||' = '||'''0001'' ' ;
      dbms_output.put_line('// comando sql ---'||vSQL1 );
    ELSIF COLUNA_DESTINO_EMP IS NULL THEN
      vSQL1                   := 'SELECT COUNT(1)QUANT FROM '||TRIM(TABELA)||' WHERE '||TRIM(COLUNA_DESTINO)||' =  '''||TRIM(vCODIGO_PESSOA)||''' ' ;
      dbms_output.put_line('// comando sql ---'||vSQL1 );
    END IF;
    EXECUTE IMMEDIATE vSQL1  INTO vTROCAR;
    IF vTROCAR>0 THEN
      ACAO   :='TROCAR';
      RETURN TABELA||';' ||TO_CHAR(vTROCAR)||';'||TO_CHAR(TRIM(COLUNA_DESTINO))||';'||TRIM(vCODIGO_PESSOA)||';'||ACAO;
    ELSE
      ACAO:='SEM_REFERENCIA';
      RETURN TABELA||';'||ACAO;
    END IF;
  END;
-- PARTE PRA GERAR COMANDOS DE ATUALIZACAO PARA PESSOA COM DATA FIM
  PROCEDURE FINALIZA_PESSOA(
      vCODIGO_PESSOA IN VARCHAR2,
      vCOD_EMPRESA   IN CHAR )
  AS
    vCONTADOR NUMBER;
    vSQL      VARCHAR2 (5000BYTE) ;
  BEGIN
  vDATA_ACERTO:=DATA_ACERTO;
    vCODIGO_PESSOA_A:= NULL;
    SELECT CODIGO_P_ATIVO
    INTO vCODIGO_PESSOA_A
    FROM SANEAMENTO_PES_DEP
    WHERE CODIGO=''
      ||vCODIGO_PESSOA
      ||'';
    vSQL:='UPDATE RHPESS_PESSOA SET dt_termino =to_date('''||vDATA_ACERTO||''',''dd/mm/yyyy''),LOGIN_USUARIO=''PR_SANEAMENTO_DEP'',DT_ULT_ALTER_USUA=SYSDATE where codigo='''||vCODIGO_PESSOA||''' AND CODIGO_EMPRESA='''||vCOD_EMPRESA||''';commit;';
    dbms_output.put_line('PESSOA RECEBE DATA FIM  '||vCODIGO_PESSOA);
    SELECT COUNT(1)QUAN
    INTO vCONTADOR
    FROM COMANDO_SANEAMENTO
    WHERE CODIGO_PESSOA_ANTIGO=''
      ||vCODIGO_PESSOA
      ||'';
    IF vCONTADOR   =0 THEN
      vCONTADOR   :=1;
    ELSIF vCONTADOR>0 THEN
      vCONTADOR   :=vCONTADOR+1;
    END IF;
    INSERT
    INTO COMANDO_SANEAMENTO
      (
        ID,
        CODIGO_PESSOA_ANTIGO,
        CODIGO_PESSOA_NOVO,
        MOVIMENTO,
        TIPO_DML,
        COMANDO
      )
      VALUES
      (
        vCONTADOR,
        vCODIGO_PESSOA,
        vCODIGO_PESSOA_A,
        'UPDATE_FIM_PESSOA',
        'U',
        vsql
      );
  END;
------ INSERT NA TABELA DE HISTORICO DE PESSOA
  PROCEDURE INSERE_LINHA_P_H
    (
      vCODIGO_PESSOA IN VARCHAR2,
      vCOD_EMPRESA   IN CHAR
    )
  AS
    vSQL VARCHAR2
    (
      5000 byte
    )
    ;
    vCONTADOR NUMBER;

  BEGIN
    vCODIGO_PESSOA_A:= NULL;
    SELECT CODIGO_P_ATIVO
    INTO vCODIGO_PESSOA_A
    FROM SANEAMENTO_PES_DEP
    WHERE CODIGO=''
      ||vCODIGO_PESSOA
      ||'';
    dbms_output.put_line('INSERE PESSOA H  '||vCODIGO_PESSOA);
    vSQL :=
    'INSERT INTO ARTERH.RHPESS_PESSOA_H (CODIGO_EMPRESA,CODIGO,ANO_MES_REFERENCIA,NOME,PRONOME_TRATAMENTO,APELIDO,NACIONALIDADE,ANO_CHEGADA,NATURALIDADE,UF_NATURALIDADE,IDENT_ESTRANGEIRO,DATA_VALIDADE,NATURALIZADO,DATA_NATURALIZACAO,DATA_NASCIMENTO,DATA_FALECIMENTO,GRAU_INSTRUCAO,UNIVERSITARIO,SEXO,ESTADO_CIVIL,TELEFONE,CPF,C_LIVRE_DOC01,C_LIVRE_DOC02,C_LIVRE_DOC_DATA01,CART_TRABALHO,REG_MINIST_TRAB,SERIE_CART_TRAB,UF_CART_TRAB,C_LIVRE_DOC03,C_LIVRE_DOC04,DATA_CART_TRAB,IDENTIDADE,ORGAO_EXPEDIDOR,LOCAL_EXPEDICAO,DATA_EXPEDICAO,PIS_PASEP,C_LIVRE_DOC05,C_LIVRE_DOC06,DATA_CADAST_PIS,HABILITACAO,CATEGORIA,C_LIVRE_DOC07,DATA_HABILITACAO,CATEGORIA_MILITAR,CERT_RESERVISTA,C_LIVRE_DOC08,C_LIVRE_DOC_DATA03,TITULO_ELEITOR,ZONA_TIT_ELEITOR,SECAO_TIT_ELEITOR,C_LIVRE_DOC09,C_LIVRE_DOC10,C_LIVRE_DOC_DATA04,CONSELHO_REGIONAL,INSCRICAO_CONSELHO,C_LIVRE_DOC11,C_LIVRE_DOC_DATA05,ESPEC_FORMACAO,GRUPO_SANGUINEO,FATOR_RH,ALTURA,PESO,RENDA_PROPRIA,DT_INIC_REND_PROP,PESSOA_CONTATO,C_LIVRE_SELEC01,C_LIVRE_SELEC02,C_LIVRE_SELEC03,C_LIVRE_SELEC04,C_LIVRE_SELEC05,C_LIVRE_VALOR06,C_LIVRE_VALOR07,C_LIVRE_VALOR08,C_LIVRE_VALOR09,C_LIVRE_VALOR10,C_LIVRE_DESCR11,C_LIVRE_DESCR12,C_LIVRE_DESCR13,C_LIVRE_DESCR14,C_LIVRE_DESCR15,C_LIVRE_DATA16,C_LIVRE_DATA17,C_LIVRE_DATA18,C_LIVRE_DATA19,C_LIVRE_DATA20,FOTO_PESSOA,FOTO_LIVRE1,FOTO_LIVRE2,TEXTO_ASSOCIADO,LOGIN_USUARIO,DT_ULT_ALTER_USUA,BANCO_AGENCIA,CONTA_CORRENTE,CATEG_PRINCIPAL,COD_DEFICIENCIA,COD_ATIVIDADE,DT_INICIO_ATIV,DT_PREVIS_TER_ATIV,DT_TERMINO,DURACAO_ATIV,ANO_SERIE_ATIV,SEMESTRE_PERI_ATIV,COD_STATUS_ATIV,COD_MUNICIPIO,DT_TERMINO_ATIV,RACA_COR,INSCRICAO_ISS,INSCRICAO_INSS,CERT_NASCIMENTO,CERT_CASAMENTO,DATA_CASAMENTO,UF_CONSELHO,DATA_EXP_CONSELHO,ISENTO_TIT_ELEITOR,NRO_HABILITACAO,DT_VAL_HABILITACAO,ORGAO_EXP_CERT,VISTO_PERMANENTE,UF_IDENTIDADE,PAIS_ORIGEM,PESO_ASSINATURA,NOME_ACESSO,FORMA_PAGAMENTO,C_LIVRE_OPCAO01,C_LIVRE_OPCAO02,C_LIVRE_OPCAO03,C_LIVRE_OPCAO04,C_LIVRE_OPCAO05,DECL_NASC_VIVO,CARTAO_NACIO_SAUDE,NUM_RIC,ORGAO_EMISSOR_RIC,DT_EXPEDICAO_RIC,ORGAO_EMISSOR_ID_ESTR,DT_EXPEDICAO_ID_ESTR,DT_VALIDADE_CONSELHO,ORGAO_EMISSOR_HAB,RESIDENCIA_PROPRIA,RECURSO_FGTS,CASADO_BR,FILHOS_BR,TP_CONTA_BANCARIA,OBS_DEFICIENCIA,NRO_ATESTADO_OBITO,DT_PROC_ESOCIAL,DT_ALTER_ESOCIAL,INCAPACIDADE_LABOR,DATA_APOSENTA,TIPO_APOSENTA,PORTARIA_NATURALIZACAO,UF_HABILITACAO,DT_PRIM_HABILITACAO,CLASS_TRAB_ESTRANG,IND_NIF,NIF_BENEF,NOME_SOCIAL,CBO2002,FORMACAO_PROFISSIONAL)     
SELECT CODIGO_EMPRESA,CODIGO,to_date(''01/''||'''||substr(vDATA_ACERTO,4,7)||''',''dd/mm/yyyy'') AS ANO_MES_REFERENCIA,NOME,PRONOME_TRATAMENTO,APELIDO,NACIONALIDADE,ANO_CHEGADA,NATURALIDADE,UF_NATURALIDADE,IDENT_ESTRANGEIRO,DATA_VALIDADE,NATURALIZADO,DATA_NATURALIZACAO,DATA_NASCIMENTO,DATA_FALECIMENTO,GRAU_INSTRUCAO,UNIVERSITARIO,SEXO,ESTADO_CIVIL,TELEFONE,CPF,C_LIVRE_DOC01,C_LIVRE_DOC02,C_LIVRE_DOC_DATA01,CART_TRABALHO,REG_MINIST_TRAB,SERIE_CART_TRAB,UF_CART_TRAB,C_LIVRE_DOC03,C_LIVRE_DOC04,DATA_CART_TRAB,IDENTIDADE,ORGAO_EXPEDIDOR,LOCAL_EXPEDICAO,DATA_EXPEDICAO,PIS_PASEP,C_LIVRE_DOC05,C_LIVRE_DOC06,DATA_CADAST_PIS,HABILITACAO,CATEGORIA,C_LIVRE_DOC07,DATA_HABILITACAO,CATEGORIA_MILITAR,CERT_RESERVISTA,C_LIVRE_DOC08,C_LIVRE_DOC_DATA03,TITULO_ELEITOR,ZONA_TIT_ELEITOR,SECAO_TIT_ELEITOR,C_LIVRE_DOC09,C_LIVRE_DOC10,C_LIVRE_DOC_DATA04,CONSELHO_REGIONAL,INSCRICAO_CONSELHO,C_LIVRE_DOC11,C_LIVRE_DOC_DATA05,ESPEC_FORMACAO,GRUPO_SANGUINEO,FATOR_RH,ALTURA,PESO,RENDA_PROPRIA,DT_INIC_REND_PROP,PESSOA_CONTATO,C_LIVRE_SELEC01,C_LIVRE_SELEC02,C_LIVRE_SELEC03,C_LIVRE_SELEC04,C_LIVRE_SELEC05,C_LIVRE_VALOR06,C_LIVRE_VALOR07,C_LIVRE_VALOR08,C_LIVRE_VALOR09,C_LIVRE_VALOR10,C_LIVRE_DESCR11,C_LIVRE_DESCR12,C_LIVRE_DESCR13,C_LIVRE_DESCR14,C_LIVRE_DESCR15,C_LIVRE_DATA16,C_LIVRE_DATA17,C_LIVRE_DATA18,C_LIVRE_DATA19,C_LIVRE_DATA20,FOTO_PESSOA,FOTO_LIVRE1,FOTO_LIVRE2,TEXTO_ASSOCIADO,LOGIN_USUARIO,DT_ULT_ALTER_USUA,BANCO_AGENCIA,CONTA_CORRENTE,CATEG_PRINCIPAL,COD_DEFICIENCIA,COD_ATIVIDADE,DT_INICIO_ATIV,DT_PREVIS_TER_ATIV,DT_TERMINO,DURACAO_ATIV,ANO_SERIE_ATIV,SEMESTRE_PERI_ATIV,COD_STATUS_ATIV,COD_MUNICIPIO,DT_TERMINO_ATIV,RACA_COR,INSCRICAO_ISS,INSCRICAO_INSS,CERT_NASCIMENTO,CERT_CASAMENTO,DATA_CASAMENTO,UF_CONSELHO,DATA_EXP_CONSELHO,ISENTO_TIT_ELEITOR,NRO_HABILITACAO,DT_VAL_HABILITACAO,ORGAO_EXP_CERT,VISTO_PERMANENTE,UF_IDENTIDADE,PAIS_ORIGEM,PESO_ASSINATURA,NOME_ACESSO,FORMA_PAGAMENTO,C_LIVRE_OPCAO01,C_LIVRE_OPCAO02,C_LIVRE_OPCAO03,C_LIVRE_OPCAO04,C_LIVRE_OPCAO05,DECL_NASC_VIVO,CARTAO_NACIO_SAUDE,NUM_RIC,ORGAO_EMISSOR_RIC,DT_EXPEDICAO_RIC,ORGAO_EMISSOR_ID_ESTR,DT_EXPEDICAO_ID_ESTR,DT_VALIDADE_CONSELHO,ORGAO_EMISSOR_HAB,RESIDENCIA_PROPRIA,RECURSO_FGTS,CASADO_BR,FILHOS_BR,TP_CONTA_BANCARIA,OBS_DEFICIENCIA,NRO_ATESTADO_OBITO,DT_PROC_ESOCIAL,DT_ALTER_ESOCIAL,INCAPACIDADE_LABOR,DATA_APOSENTA,TIPO_APOSENTA,PORTARIA_NATURALIZACAO,UF_HABILITACAO,DT_PRIM_HABILITACAO,CLASS_TRAB_ESTRANG,IND_NIF,NIF_BENEF,NOME_SOCIAL,CBO2002,FORMACAO_PROFISSIONAL    
FROM ARTERH.RHPESS_PESSOA WHERE CODIGO_EMPRESA='''
    || vCOD_EMPRESA||''' AND CODIGO='''||vCODIGO_PESSOA||''';commit;';
    SELECT COUNT(1)QUAN
    INTO vCONTADOR
    FROM COMANDO_SANEAMENTO
    WHERE CODIGO_PESSOA_ANTIGO=''
      ||vCODIGO_PESSOA
      ||'';
    IF vCONTADOR   =0 THEN
      vCONTADOR   :=1;
    ELSIF vCONTADOR>0 THEN
      vCONTADOR   :=vCONTADOR+1;
    END IF;
    INSERT
    INTO COMANDO_SANEAMENTO
      (
        ID,
        CODIGO_PESSOA_ANTIGO,
        CODIGO_PESSOA_NOVO,
        MOVIMENTO,
        TIPO_DML,
        COMANDO
      )
      VALUES
      (
        vCONTADOR,
        vCODIGO_PESSOA,
        vCODIGO_PESSOA_A,
        'INSERT_PESSOA_H',
        'I',
        vsql
      );
  END;
---- TABELAS QUE SERAO ATUALIZADAS
--RHBENF_CONCESSOES,RHBENF_SOLIC_BENEF,RHPESS_ALT_PESSOA(OLHAR TABELA COM A ROSSANE),RHPESS_DEPENDENCIA,RHPESS_DEPEND_PARM,RHPESS_ENDERECO_P,RHPESS_ENDER_P_H,RHPESS_RL_PESS_PES,RHPESS_TELEFONE_P
---- RECUPERA DADOS PARA PASSAR PARA FUNCAO
  FUNCTION ATUALIZA_TABELA
    (
      vCODIGO_PESSOA IN VARCHAR2,
      vTABELA        IN VARCHAR2,
      vCOLUNA        IN VARCHAR2
    )
    RETURN NUMBER
  IS
    vSQL         VARCHAR2(5000 byte);
    vCONTADOR    NUMBER;
    vDATA        DATE;
    vVERIFICADOR NUMBER;
  BEGIN
    IF vTABELA         ='RHBENF_CONCESSOES' THEN
      vCODIGO_PESSOA_A:= NULL;
      vSQL            :=NULL;
------RECUPERA CODIGO DE PESSOA QUE VAI FICAR ATIVO DA PESSOA QUE ESTA RECEBNDO DATA FIM       
      SELECT CODIGO_P_ATIVO
      INTO vCODIGO_PESSOA_A
      FROM SANEAMENTO_PES_DEP
      WHERE CODIGO=''||vCODIGO_PESSOA||'';

------ BUSCAR A OREDEM DO ID DE EXECUCAO DOS COMANDOS DO SANEMANTO       
      SELECT COUNT(1)QUAN
      INTO vCONTADOR
      FROM COMANDO_SANEAMENTO
      WHERE CODIGO_PESSOA_ANTIGO=''||vCODIGO_PESSOA||'';

      vSQL :='INSERT INTO ARTERH.RHBENF_CONCESSOES
(CODIGO_EMPRESA,CODIGO_BENEFIC,DATA_CONCESSAO,OCORRENCIA,CODIGO_BENEFICIO,CATEGORIA_BENEF,PERCENT_PARTICIPAC,VALOR_BENEFICIO,DATA_PAGTO_FOLHA,DATA_DEPOSITO,MOTIVO_CONCESSAO,DATA_CANCELAMENTO,LOGIN_USUARIO,DT_ULT_ALTER_USUA,C_LIVRE_SELEC01,C_LIVRE_SELEC02,C_LIVRE_SELEC03,C_LIVRE_VALOR04,C_LIVRE_VALOR05,C_LIVRE_VALOR06,C_LIVRE_DESCR07,C_LIVRE_DESCR08,C_LIVRE_DESCR09,C_LIVRE_DATA10,C_LIVRE_DATA11,C_LIVRE_DATA12,CODIGO_MOT_CANCEL,TEXTO_ASSOCIADO,ASSINATURA_01,ASSINATURA_02,ASSINATURA_03,ASSINATURA_04,C_LIVRE_OPCAO01,C_LIVRE_OPCAO02,C_LIVRE_OPCAO03,NUMERO_PARCELA,TIPO_CONTRATO,CODIGO_CONTRATO,CODIGO_DOENCA,ID_AGRUP,ID_DIMENSAO,DT_REF_CONCEC_RETR,DT_REF_CANCEL_RETR,CODIGO_FORNECEDOR,MUNICIPIO_ORIGEM,MUNICIPIO_DESTINO,BANCO_AGENCIA,CONTA_CORRENTE,TP_CONTA_BANCARIA )
SELECT  CODIGO_EMPRESA,'''||vCODIGO_PESSOA_A||''' AS CODIGO_PESSOA,DATA_CONCESSAO,OCORRENCIA,CODIGO_BENEFICIO,CATEGORIA_BENEF,PERCENT_PARTICIPAC,VALOR_BENEFICIO,DATA_PAGTO_FOLHA,DATA_DEPOSITO,MOTIVO_CONCESSAO,null DATA_CANCELAMENTO,''PR_SANEAMENTO_DEP'' LOGIN_USUARIO,SYSDATE DT_ULT_ALTER_USUA,C_LIVRE_SELEC01,C_LIVRE_SELEC02,C_LIVRE_SELEC03,C_LIVRE_VALOR04,C_LIVRE_VALOR05,C_LIVRE_VALOR06,C_LIVRE_DESCR07,C_LIVRE_DESCR08,C_LIVRE_DESCR09,C_LIVRE_DATA10,C_LIVRE_DATA11,C_LIVRE_DATA12,CODIGO_MOT_CANCEL,TEXTO_ASSOCIADO,ASSINATURA_01,ASSINATURA_02,ASSINATURA_03,ASSINATURA_04,C_LIVRE_OPCAO01,C_LIVRE_OPCAO02,C_LIVRE_OPCAO03,NUMERO_PARCELA,TIPO_CONTRATO,CODIGO_CONTRATO,CODIGO_DOENCA,ID_AGRUP,ID_DIMENSAO,DT_REF_CONCEC_RETR,DT_REF_CANCEL_RETR,CODIGO_FORNECEDOR,MUNICIPIO_ORIGEM,MUNICIPIO_DESTINO,BANCO_AGENCIA,CONTA_CORRENTE,TP_CONTA_BANCARIA FROM ARTERH.RHBENF_CONCESSOES
WHERE CODIGO_EMPRESA=''0001'' AND CODIGO_BENEFIC='''||vcodigo_pessoa||''' AND DATA_CANCELAMENTO IS NULL;commit;';

----- COMANDO PARA INCREMETNER O ID SEMPRE QUE JA PASSAR O REGISTRO DA PESSOA QUE ESTA SENDO DESLIGADA    
      IF vCONTADOR   =0 THEN
        vCONTADOR   :=1;
      ELSIF vCONTADOR>0 THEN
        vCONTADOR   :=vCONTADOR+1;
      END IF;

      INSERT
      INTO COMANDO_SANEAMENTO
        (
          ID,
          CODIGO_PESSOA_ANTIGO,
          CODIGO_PESSOA_NOVO,
          MOVIMENTO,
          TIPO_DML,
          COMANDO
        )
        VALUES
        (
          vCONTADOR,
          vCODIGO_PESSOA,
          vCODIGO_PESSOA_A,
          'INSERT_RHBENF_CONCESSOES',
          'I',
          vsql
        );
      COMMIT;
      vlinha_att:=sql%rowcount;
------ FIM DA PRIMERIA      
-------INICIO FINALIZA REGISTRO  RHBENF_CONCESSOES
      vSQL      :=NULL;
      vCONTADOR:= NULL;
      ------ BUSCAR A OREDEM DO ID DE EXECUCAO DOS COMANDOS DO SANEMANTO       
      SELECT COUNT(1)QUAN
      INTO vCONTADOR
      FROM COMANDO_SANEAMENTO
      WHERE CODIGO_PESSOA_ANTIGO=''||vCODIGO_PESSOA||'';
      ----- COMANDO PARA INCREMETNER O ID SEMPRE QUE JA PASSAR O REGISTRO DA PESSOA QUE ESTA SENDO DESLIGADA    
      IF vCONTADOR   =0 THEN
        vCONTADOR   :=1;
      ELSIF vCONTADOR>0 THEN
        vCONTADOR   :=vCONTADOR+1;
      END IF;

      vSQL:='UPDATE ARTERH.RHBENF_CONCESSOES SET DATA_CANCELAMENTO=to_date('''||vDATA_ACERTO||''',''dd/mm/yyyy''),LOGIN_USUARIO=''PR_SANEAMENTO_DEP'',DT_ULT_ALTER_USUA=sysdate WHERE CODIGO_BENEFIC ='''||vcodigo_pessoa||''' AND DATA_CANCELAMENTO IS NULL AND CODIGO_EMPRESA=''0001'';commit';

      INSERT
      INTO COMANDO_SANEAMENTO
        (
          ID,
          CODIGO_PESSOA_ANTIGO,
          CODIGO_PESSOA_NOVO,
          MOVIMENTO,
          TIPO_DML,
          COMANDO
        )
        VALUES
        (
          vCONTADOR,
          vCODIGO_PESSOA,
          vCODIGO_PESSOA_A,
          'UPDATE_RHBENF_CONCESSOES',
          'U',
          vsql
        );
      COMMIT;
      vlinha_att:=vlinha_att+sql%rowcount;
      RETURN vlinha_att;
    END IF;
------FIM RHBENF_CONCESSOES-------------------    


    IF vTABELA   ='RHBENF_SOLIC_BENEF' THEN
    vlinha_att:=0;
      SELECT MAX(DATA_SOLICITACAO)
      INTO vDATA
      FROM RHBENF_SOLIC_BENEF
      WHERE CODIGO_PESSOA=''
        ||vCODIGO_PESSOA
        ||''
      AND CODIGO_EMPRESA='0001';
      IF vDATA         >=to_date(''||vDATA_ACERTO||'','dd/mm/yyyy') THEN
        dbms_output.put_line(' PRECISA COLOCAR O INSERT DA RHBENF_SOLIC_BENEF '||vCODIGO_PESSOA);
      END IF;
    END IF;

----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------    
    IF vTABELA         ='RHPESS_DEPENDENCIA' THEN
      vCONTADOR       :=0;
      vCODIGO_PESSOA_A:= NULL;
      vSQL            :=NULL;
--------------------BUSCA PESSOA ATIVA------------------------      
      SELECT CODIGO_P_ATIVO
      INTO vCODIGO_PESSOA_A
      FROM SANEAMENTO_PES_DEP
      WHERE CODIGO=''||vCODIGO_PESSOA||'';
-------------------------BUSCA CONTADOR DA TABELA DE COMANDOS       
      SELECT COUNT(1)QUAN
      INTO vCONTADOR
      FROM COMANDO_SANEAMENTO
      WHERE CODIGO_PESSOA_ANTIGO=''||vCODIGO_PESSOA||'';
      vSQL      :='UPDATE ARTERH.RHPESS_DEPENDENCIA SET DATA_FIM=to_date('''||vDATA_ACERTO||''',''dd/mm/yyyy''), LOGIN_USUARIO=''PR_SANEAMENTO_DEP'' ,DT_ULT_ALTER_USUA=SYSDATE WHERE CODIGO_EMPRESA=''0001'' AND CODIGO_PESSOA='''||vCODIGO_PESSOA||'''AND DATA_FIM IS NULL;commit;';


 ----- COMANDO PARA INCREMETNER O ID SEMPRE QUE JA PASSAR O REGISTRO DA PESSOA QUE ESTA SENDO DESLIGADA    

      IF vCONTADOR   =0 THEN
        vCONTADOR   :=1;
      ELSIF vCONTADOR>0 THEN
        vCONTADOR   :=vCONTADOR+1;
      END IF;

      INSERT
      INTO COMANDO_SANEAMENTO
        (
          ID,
          CODIGO_PESSOA_ANTIGO,
          CODIGO_PESSOA_NOVO,
          MOVIMENTO,
          TIPO_DML,
          COMANDO
        )
        VALUES
        (
          vCONTADOR,
          vCODIGO_PESSOA,
          vCODIGO_PESSOA_A,
          'UPDATE_RHPESS_DEPENDENCIA',
          'U',
          vsql
        );
      COMMIT;
      vlinha_att:=sql%rowcount;
--------------------------FIM PRIEIRA PARTE ----------------------------------      
      vCONTADOR       :=0;
      vSQL      :=NULL;
-------------------------BUSCA CONTADOR DA TABELA DE COMANDOS       
      SELECT COUNT(1)QUAN
      INTO vCONTADOR
      FROM COMANDO_SANEAMENTO
      WHERE CODIGO_PESSOA_ANTIGO=''||vCODIGO_PESSOA||'';      


     vSQL:='INSERT INTO ARTERH.RHPESS_DEPENDENCIA ( CODIGO_EMPRESA,TIPO_CONTRATO,CODIGO_CONTRATO,COD_CLASSE_DEPEND,CODIGO_PESSOA,DATA_INICIO,DATA_FIM,E_DEPENDENTE,E_EXCECAO,DATA_INI_EXCECAO,DATA_FIM_EXCECAO,CONTROLE_VERIFICAD,DT_VERIF_CONTROLE,VERBA_ASSOC,C_LIVRE_OPCAO01,C_LIVRE_OPCAO02,C_LIVRE_SELEC03,C_LIVRE_SELEC04,C_LIVRE_VALOR05,C_LIVRE_VALOR06,C_LIVRE_DATA07,C_LIVRE_DATA08,C_LIVRE_DESCR09,C_LIVRE_DESCR10,LOGIN_USUARIO,DT_ULT_ALTER_USUA,HIST_EXCECAO,DT_PROX_VERIFIC,C_LIVRE_OPCAO03,C_LIVRE_OPCAO04,C_LIVRE_SELEC01,C_LIVRE_SELEC02,C_LIVRE_VALOR01,C_LIVRE_VALOR02,C_LIVRE_DATA01,C_LIVRE_DATA02,C_LIVRE_DESCR01,C_LIVRE_DESCR02,OCORRENCIA,ASSINATURA_01,ASSINATURA_02,C_LIVRE_DESCR11,C_LIVRE_DESCR12,C_LIVRE_DATA03,C_LIVRE_DESCR03,C_LIVRE_DESCR04,C_LIVRE_DESCR05,C_LIVRE_DESCR06,TIPO_CONTRATO_DEP,COD_CONTRATO_DEP,VERBA_ASSOC_2,VERBA_ASSOC_3,VERBA_ASSOC_4,E_REPRESENTANTE,CODIGO_MOT_CANCEL,BANCO_AGENCIA,CONTA_CORRENTE,TP_CONTA_BANCARIA ) 
            SELECT CODIGO_EMPRESA,TIPO_CONTRATO,CODIGO_CONTRATO,COD_CLASSE_DEPEND,'''||vCODIGO_PESSOA_A||''',DATA_INICIO,NULL AS DATA_FIM,E_DEPENDENTE,E_EXCECAO,DATA_INI_EXCECAO,DATA_FIM_EXCECAO,CONTROLE_VERIFICAD,DT_VERIF_CONTROLE,VERBA_ASSOC,C_LIVRE_OPCAO01,C_LIVRE_OPCAO02,C_LIVRE_SELEC03,C_LIVRE_SELEC04,C_LIVRE_VALOR05,C_LIVRE_VALOR06,C_LIVRE_DATA07,C_LIVRE_DATA08,C_LIVRE_DESCR09,C_LIVRE_DESCR10,''PR_SANEAMENTO_DEP'' AS LOGIN_USUARIO,SYSDATE DT_ULT_ALTER_USUA,HIST_EXCECAO,DT_PROX_VERIFIC,C_LIVRE_OPCAO03,C_LIVRE_OPCAO04,C_LIVRE_SELEC01,C_LIVRE_SELEC02,C_LIVRE_VALOR01,C_LIVRE_VALOR02,C_LIVRE_DATA01,C_LIVRE_DATA02,C_LIVRE_DESCR01,C_LIVRE_DESCR02,OCORRENCIA,ASSINATURA_01,ASSINATURA_02,C_LIVRE_DESCR11,C_LIVRE_DESCR12,C_LIVRE_DATA03,C_LIVRE_DESCR03,C_LIVRE_DESCR04,C_LIVRE_DESCR05,C_LIVRE_DESCR06,TIPO_CONTRATO_DEP,COD_CONTRATO_DEP,VERBA_ASSOC_2,VERBA_ASSOC_3,VERBA_ASSOC_4,E_REPRESENTANTE,CODIGO_MOT_CANCEL,BANCO_AGENCIA,CONTA_CORRENTE,TP_CONTA_BANCARIA 
            FROM ARTERH.RHPESS_DEPENDENCIA X WHERE X.CODIGO_EMPRESA=''0001'' AND X.CODIGO_PESSOA='''||vCODIGO_PESSOA||'''
            AND X.DATA_FIM IS NOT NULL AND X.LOGIN_USUARIO=''PR_SANEAMENTO_DEP''
AND NOT EXISTS (SELECT * FROM ARTERH.RHPESS_DEPENDENCIA AUX 
            WHERE AUX.CODIGO_PESSOA='''||vCODIGO_PESSOA_A||'''
            AND AUX.CODIGO_CONTRATO=X.CODIGO_CONTRATO
            AND AUX.COD_CLASSE_DEPEND=X.COD_CLASSE_DEPEND
            AND AUX.TIPO_CONTRATO=X.TIPO_CONTRATO
            AND AUX.CODIGO_EMPRESA=X.CODIGO_EMPRESA
            AND AUX.DATA_FIM IS NULL
            )
            ;commit;';
 ----- COMANDO PARA INCREMETNER O ID SEMPRE QUE JA PASSAR O REGISTRO DA PESSOA QUE ESTA SENDO DESLIGADA    

      IF vCONTADOR   =0 THEN
        vCONTADOR   :=1;
      ELSIF vCONTADOR>0 THEN
        vCONTADOR   :=vCONTADOR+1;
      END IF;

      INSERT
      INTO COMANDO_SANEAMENTO
        (
          ID,
          CODIGO_PESSOA_ANTIGO,
          CODIGO_PESSOA_NOVO,
          MOVIMENTO,
          TIPO_DML,
          COMANDO
        )
        VALUES
        (
          vCONTADOR,
          vCODIGO_PESSOA,
          vCODIGO_PESSOA_A,
          'INSERT_RHPESS_DEPENDENCIA',
          'I',
          vsql
        );
      COMMIT;
      vlinha_att:=vlinha_att+sql%rowcount;
      RETURN vlinha_att;
    END IF;
---------------------------FIM-----------------------------------------------------------------------------------------------------

    IF vTABELA         ='RHPESS_DEPEND_PARM' THEN
      vCONTADOR       :=0;
      vCODIGO_PESSOA_A:= NULL;
      vSQL            :=NULL;
-------------------------BUSCA PESSOA ATIVA       
      SELECT CODIGO_P_ATIVO 
      INTO vCODIGO_PESSOA_A
      FROM SANEAMENTO_PES_DEP
      WHERE CODIGO=''||vCODIGO_PESSOA||'';
  -------------------------BUSCA CONTADOR DA TABELA DE COMANDOS      
      SELECT COUNT(1)QUAN
      INTO vCONTADOR
      FROM COMANDO_SANEAMENTO
      WHERE CODIGO_PESSOA_ANTIGO=''||vCODIGO_PESSOA||'';

      vSQL:='INSERT INTO ARTERH.RHPESS_DEPEND_PARM ( CODIGO_EMPRESA,TIPO_CONTRATO,CODIGO_CONTRATO,COD_CLASSE_DEPEND,CODIGO_PESSOA,OCORRENCIA,OCORRENCIA_PARM,DATA_INI_VIGENCIA,DATA_FIM_VIGENCIA,CODIGO_CLASSE_D_IT,FONTE_VALOR,CODIGO_VERBA,INCIDENCIA_BASE,PERCENTUAL,PISO_VALOR_GERADO,TETO_VALOR_GERADO,USA_NORMAL,USA_FERIAS,USA_13SAL,USA_RESCISAO,USA_PROVISAO,USA_ROTEIRO,USA_VALE,USA_COMPLRESC,USA_PROCTRAB,C_LIVRE_SELEC01,C_LIVRE_SELEC02,C_LIVRE_VALOR01,C_LIVRE_VALOR02,C_LIVRE_DESCR01,C_LIVRE_DESCR02,C_LIVRE_DATA01,C_LIVRE_DATA02,C_LIVRE_OPCAO01,C_LIVRE_OPCAO02,TEXTO_ASSOCIADO,LOGIN_USUARIO,DT_ULT_ALTER_USUA ) 
             SELECT CODIGO_EMPRESA,TIPO_CONTRATO,CODIGO_CONTRATO,COD_CLASSE_DEPEND,'''||vCODIGO_PESSOA_A||''' AS CODIGO_PESSOA,OCORRENCIA,OCORRENCIA_PARM,DATA_INI_VIGENCIA, NULL AS DATA_FIM_VIGENCIA,CODIGO_CLASSE_D_IT,FONTE_VALOR,CODIGO_VERBA,INCIDENCIA_BASE,PERCENTUAL,PISO_VALOR_GERADO,TETO_VALOR_GERADO,USA_NORMAL,USA_FERIAS,USA_13SAL,USA_RESCISAO,USA_PROVISAO,USA_ROTEIRO,USA_VALE,USA_COMPLRESC,USA_PROCTRAB,C_LIVRE_SELEC01,C_LIVRE_SELEC02,C_LIVRE_VALOR01,C_LIVRE_VALOR02,C_LIVRE_DESCR01,C_LIVRE_DESCR02,C_LIVRE_DATA01,C_LIVRE_DATA02,C_LIVRE_OPCAO01,C_LIVRE_OPCAO02,TEXTO_ASSOCIADO,''PR_SANEAMENTO_DEP'' AS LOGIN_USUARIO,SYSDATE AS DT_ULT_ALTER_USUA 
             FROM ARTERH.RHPESS_DEPENDENCIA WHERE CODIGO_EMPRESA=''0001'' AND CODIGO_PESSOA='''||vCODIGO_PESSOA||''' AND DATA_FIM IS NULL;commit;';
 ----- COMANDO PARA INCREMETNER O ID SEMPRE QUE JA PASSAR O REGISTRO DA PESSOA QUE ESTA SENDO DESLIGADA    
      IF vCONTADOR   =0 THEN
        vCONTADOR   :=1;
      ELSIF vCONTADOR>0 THEN
        vCONTADOR   :=vCONTADOR+1;
      END IF;

      INSERT
      INTO COMANDO_SANEAMENTO
        (
          ID,
          CODIGO_PESSOA_ANTIGO,
          CODIGO_PESSOA_NOVO,
          MOVIMENTO,
          TIPO_DML,
          COMANDO
        )
        VALUES
        (
          vCONTADOR,
          vCODIGO_PESSOA,
          vCODIGO_PESSOA_A,
          'INSERT_RHPESS_DEPEND_PARM',
          'I',
          vsql
        );
      COMMIT;
      vlinha_att:=sql%rowcount;
----------------------------------------------------------FIM-----------------------------------------      
      vCONTADOR       :=0;
      vSQL      :=NULL;
      SELECT COUNT(1)QUAN
      INTO vCONTADOR
      FROM COMANDO_SANEAMENTO
      WHERE CODIGO_PESSOA_ANTIGO=''||vCODIGO_PESSOA||'';
      vSQL      :='UPDATE ARTERH.RHPESS_DEPEND_PARM SET DATA_FIM_VIGENCIA=to_date('''||vDATA_ACERTO||''',''dd/mm/yyyy''), LOGIN_USUARIO=''PR_SANEAMENTO_DEP'' ,DT_ULT_ALTER_USUA=SYSDATE WHERE CODIGO_EMPRESA=''0001'' AND CODIGO_PESSOA='''||vCODIGO_PESSOA||'''AND DATA_FIM IS NULL;commit;';
-----COMANDO PARA INCREMETNER O ID SEMPRE QUE JA PASSAR O REGISTRO DA PESSOA QUE ESTA SENDO DESLIGADA            
      IF vCONTADOR   =0 THEN
        vCONTADOR   :=1;
      ELSIF vCONTADOR>0 THEN
        vCONTADOR   :=vCONTADOR+1;
      END IF;


      INSERT
      INTO COMANDO_SANEAMENTO
        (
          ID,
          CODIGO_PESSOA_ANTIGO,
          CODIGO_PESSOA_NOVO,
          MOVIMENTO,
          TIPO_DML,
          COMANDO
        )
        VALUES
        (
          vCONTADOR,
          vCODIGO_PESSOA,
          vCODIGO_PESSOA_A,
          'UPDATE_RHPESS_DEPEND_PARM',
          'U',
          vsql
        );
      COMMIT;
      vlinha_att:=vlinha_att+sql%rowcount;
      RETURN vlinha_att;
    END IF;
--------------------------------------------------------------------FIM -------------------------------------------------------------------------    
    IF vTABELA         ='RHPESS_ENDERECO_P' THEN
      vCONTADOR       :=0;
      vCODIGO_PESSOA_A:= NULL;
      vSQL            :=NULL;
      vVERIFICADOR    :=0;
 ------ BUSCAR PESSOA ATIVA ----------------------------------     
      SELECT CODIGO_P_ATIVO
      INTO vCODIGO_PESSOA_A
      FROM SANEAMENTO_PES_DEP
      WHERE CODIGO=''||vCODIGO_PESSOA||'';
-----------------------BUSCAR ID TABELA DE COMANDOS -------------------------      
      SELECT COUNT(1)QUAN
      INTO vCONTADOR
      FROM COMANDO_SANEAMENTO
      WHERE CODIGO_PESSOA_ANTIGO=''||vCODIGO_PESSOA ||'';
-----------------------BUSCAR SE JA EXISTE ENDERECAO PARA NOVA PESSOA ---------------------------------      
      SELECT COUNT(1)QUANT
      INTO vVERIFICADOR
      FROM RHPESS_ENDERECO_P
      WHERE CODIGO_EMPRESA='0001'
      AND CODIGO_PESSOA   =''||vCODIGO_PESSOA_A||'';

      vSQL :='INSERT INTO ARTERH.RHPESS_ENDERECO_P ( CODIGO_EMPRESA,CODIGO_PESSOA,TIPO_LOGRADOURO,ENDERECO,NUMERO,COMPLEMENTO,BAIRRO,MUNICIPIO,AREA,DISTRITO,UF,PROVINCIA,ZONA,PAIS,CEP,CAIXA_POSTAL,TELEFONE,FAX,TELEX,ENDER_ELETRONICO,C_LIVRE_DESCR01,C_LIVRE_DESCR02,LOGIN_USUARIO,DT_ULT_ALTER_USUA,TEXTO_ASSOCIADO,C_LIVRE_DATA01,C_LIVRE_DATA02,C_LIVRE_SELEC01,C_LIVRE_SELEC02,C_LIVRE_OPCAO01,C_LIVRE_OPCAO02 )  
                       SELECT CODIGO_EMPRESA,'''||vCODIGO_PESSOA_A||''',TIPO_LOGRADOURO,ENDERECO,NUMERO,COMPLEMENTO,BAIRRO,MUNICIPIO,AREA,DISTRITO,UF,PROVINCIA,ZONA,PAIS,CEP,CAIXA_POSTAL,TELEFONE,FAX,TELEX,ENDER_ELETRONICO,C_LIVRE_DESCR01,C_LIVRE_DESCR02,''PR_SANEAMENTO_DEP'' AS LOGIN_USUARIO,SYSDATE AS DT_ULT_ALTER_USUA,TEXTO_ASSOCIADO,C_LIVRE_DATA01,C_LIVRE_DATA02,C_LIVRE_SELEC01,C_LIVRE_SELEC02,C_LIVRE_OPCAO01,C_LIVRE_OPCAO02 FROM ARTERH.RHPESS_ENDERECO_P WHERE CODIGO_EMPRESA=''0001'' AND CODIGO_PESSOA='''||vCODIGO_PESSOA||''';commit;';
-----COMANDO PARA INCREMETNER O ID SEMPRE QUE JA PASSAR O REGISTRO DA PESSOA QUE ESTA SENDO DESLIGADA   
      IF vCONTADOR   =0 THEN
        vCONTADOR   :=1;
      ELSIF vCONTADOR>0 THEN
        vCONTADOR   :=vCONTADOR+1;
      END IF;

      IF vVERIFICADOR=0 THEN
        INSERT
        INTO COMANDO_SANEAMENTO
          (
            ID,
            CODIGO_PESSOA_ANTIGO,
            CODIGO_PESSOA_NOVO,
            MOVIMENTO,
            TIPO_DML,
            COMANDO
          )
          VALUES
          (
            vCONTADOR,
            vCODIGO_PESSOA,
            vCODIGO_PESSOA_A,
            'INSERT_RHPESS_ENDERECO_P',
            'I',
            vsql
          );
        COMMIT;
        vlinha_att:=sql%rowcount;
        RETURN vlinha_att;
      ELSIF vVERIFICADOR>0 THEN
        INSERT
        INTO COMANDO_SANEAMENTO
          (
            ID,
            CODIGO_PESSOA_ANTIGO,
            CODIGO_PESSOA_NOVO,
            MOVIMENTO,
            TIPO_DML,
            COMANDO
          )
          VALUES
          (
            vCONTADOR,
            vCODIGO_PESSOA,
            vCODIGO_PESSOA_A,
            'JA_POSSUI_COD_TAB '||'---'||'RHPESS_ENDERECO_P',
            'X',
            NULL
          );
      END IF;
   END IF;
------------------------------------------------------------------FIM -----------------------------------------------------------------      
   IF vTABELA         ='RHPESS_ENDER_P_H' THEN
      vCONTADOR       :=0;
      vCODIGO_PESSOA_A:= NULL;
      vSQL            :=NULL;
      vVERIFICADOR    :=0;

 ---------BUSCAR PESSOA ATIVA ----------------------------------     
      SELECT CODIGO_P_ATIVO
      INTO vCODIGO_PESSOA_A
      FROM SANEAMENTO_PES_DEP
      WHERE CODIGO=''||vCODIGO_PESSOA||'';
----------------------------------------------------BUSCAR ID TABELA DE COMANDOS--------------------------------------      
      SELECT COUNT(1)QUAN
      INTO vCONTADOR
      FROM COMANDO_SANEAMENTO
      WHERE CODIGO_PESSOA_ANTIGO=''||vCODIGO_PESSOA||'';
--------------VERIFICAR SE JA EXISTE REGISTRO PRA PESSOA NOVA -------------------------------------------------------------      
      SELECT COUNT(1)QUANT
      INTO vVERIFICADOR
      FROM RHPESS_ENDER_P_H
      WHERE CODIGO_EMPRESA='0001'
      AND CODIGO_PESSOA   =''||vCODIGO_PESSOA_A||'' AND DATA_FIM_VALIDADE IS NULL;      

      vSQL                  :='INSERT INTO ARTERH.RHPESS_ENDER_P_H (CODIGO_EMPRESA,CODIGO_PESSOA,OCORRENCIA,TIPO_LOGRADOURO,ENDERECO,NUMERO,COMPLEMENTO,BAIRRO,MUNICIPIO,UF,PAIS,CEP,TELEFONE,LOGIN_USUARIO_P,DT_ULT_ALT_USUA_P,LOGIN_USUARIO,DT_ULT_ALTER_USUA,C_LIVRE_DESCR01,DATA_INI_VALIDADE,DATA_FIM_VALIDADE )
SELECT CODIGO_EMPRESA,'''||vCODIGO_PESSOA_A||''',OCORRENCIA,TIPO_LOGRADOURO,ENDERECO,NUMERO,COMPLEMENTO,BAIRRO,MUNICIPIO,UF,PAIS,CEP,TELEFONE,LOGIN_USUARIO_P,DT_ULT_ALT_USUA_P,''PR_SANEAMENTO_DEP'' AS LOGIN_USUARIO, SYSDATE AS DT_ULT_ALTER_USUA,C_LIVRE_DESCR01,DATA_INI_VALIDADE, NULL AS DATA_FIM_VALIDADE
FROM ARTERH.RHPESS_ENDER_P_H WHERE CODIGO_EMPRESA=''0001'' AND CODIGO_PESSOA='''||vCODIGO_PESSOA||'''AND DATA_FIM_VALIDADE IS NULL;commit;';
 ------------------MONTAR SEQUENCIA DE COMANDO      
      IF vCONTADOR           =0 THEN
        vCONTADOR           :=1;
      ELSIF vCONTADOR        >0 THEN
        vCONTADOR           :=vCONTADOR+1;
      END IF;

      IF vVERIFICADOR=0 THEN
        INSERT
        INTO COMANDO_SANEAMENTO
          (
            ID,
            CODIGO_PESSOA_ANTIGO,
            CODIGO_PESSOA_NOVO,
            MOVIMENTO,
            TIPO_DML,
            COMANDO
          )
          VALUES
          (
            vCONTADOR,
            vCODIGO_PESSOA,
            vCODIGO_PESSOA_A,
            'INSERT_RHPESS_ENDER_P_H',
            'I',
            vsql
          );
        COMMIT;
        vlinha_att:=sql%rowcount;
-------------------------FIM PRIMEIRA PARTE 
        vCONTADOR :=0;
        vSQL      :=NULL;
------------------BUSCAR CONTADOR ------------------
        SELECT COUNT(1)QUAN
        INTO vCONTADOR
        FROM COMANDO_SANEAMENTO
        WHERE CODIGO_PESSOA_ANTIGO=''||vCODIGO_PESSOA||'';

       vSQL      :='UPDATE ARTERH.RHPESS_ENDER_P_H SET DATA_FIM_VALIDADE=to_date('''||vDATA_ACERTO||''',''dd/mm/yyyy''), LOGIN_USUARIO=''PR_SANEAMENTO_DEP'' ,DT_ULT_ALTER_USUA=SYSDATE WHERE CODIGO_EMPRESA=''0001'' AND CODIGO_PESSOA='''||vCODIGO_PESSOA||'''AND DATA_FIM_VALIDADE IS NULL;commit;';
    ------------------MONTAR SEQUENCIA DE COMANDO        
        IF vCONTADOR   =0 THEN
          vCONTADOR   :=1;
        ELSIF vCONTADOR>0 THEN
          vCONTADOR   :=vCONTADOR+1;
        END IF;

        INSERT
        INTO COMANDO_SANEAMENTO
          (
            ID,
            CODIGO_PESSOA_ANTIGO,
            CODIGO_PESSOA_NOVO,
            MOVIMENTO,
            TIPO_DML,
            COMANDO
          )
          VALUES
          (
            vCONTADOR,
            vCODIGO_PESSOA,
            vCODIGO_PESSOA_A,
            'UPDATE_RHPESS_ENDER_P_H',
            'U',
            vsql
          );
        COMMIT;
        vlinha_att:=vlinha_att+sql%rowcount;
        RETURN vlinha_att;

---------------------------------------FIM-------------------        
      ELSIF vVERIFICADOR>0 THEN
       vSQL :=NULL;
       vCONTADOR:=0;
  ------BUSCAR CONTADOR---------------------------     
          SELECT COUNT(1)QUAN
        INTO vCONTADOR
        FROM COMANDO_SANEAMENTO
        WHERE CODIGO_PESSOA_ANTIGO=''||vCODIGO_PESSOA||'';

      vSQL      :='UPDATE ARTERH.RHPESS_ENDER_P_H SET DATA_FIM_VALIDADE=to_date('''||vDATA_ACERTO||''',''dd/mm/yyyy''), LOGIN_USUARIO=''PR_SANEAMENTO_DEP'' ,DT_ULT_ALTER_USUA=SYSDATE WHERE CODIGO_EMPRESA=''0001'' AND CODIGO_PESSOA='''||vCODIGO_PESSOA||'''AND DATA_FIM_VALIDADE IS NULL;commit;';
 INSERT
        INTO COMANDO_SANEAMENTO
          (
            ID,
            CODIGO_PESSOA_ANTIGO,
            CODIGO_PESSOA_NOVO,
            MOVIMENTO,
            TIPO_DML,
            COMANDO
          )
          VALUES
          (
            vCONTADOR,
            vCODIGO_PESSOA,
            vCODIGO_PESSOA_A,
            'UPDATE_FECHA_H_RHPESS_ENDER_P_H',
            'U',
             vSQL
          );
          COMMIT;
          vlinha_att:=sql%rowcount;
       INSERT
        INTO COMANDO_SANEAMENTO
          (
            ID,
            CODIGO_PESSOA_ANTIGO,
            CODIGO_PESSOA_NOVO,
            MOVIMENTO,
            TIPO_DML,
            COMANDO
          )
          VALUES
          (
            vCONTADOR,
            vCODIGO_PESSOA,
            vCODIGO_PESSOA_A,
            'JA_POSSUI_COD_TAB '||'---'||'RHPESS_ENDER_P_H',
            'X',
            NULL
          );
      END IF;
      vlinha_att:=vlinha_att+sql%rowcount;
      RETURN vlinha_att;
    END IF;
------------------------------------------------------------------------------FIM------------------------------------------------------------    
    IF vTABELA         ='RHPESS_RL_PESS_PES' THEN
      vDATA           :=NULL;
      vCONTADOR       :=0;
      vCODIGO_PESSOA_A:= NULL;
      vSQL            :=NULL;
      vVERIFICADOR    :=0;
-------BUSCA PESSOA ATIVA--------------------     
      SELECT CODIGO_P_ATIVO
      INTO vCODIGO_PESSOA_A
      FROM SANEAMENTO_PES_DEP
      WHERE CODIGO=''||vCODIGO_PESSOA||'';
--------------------BUSCA CONTADOR TABELA COMANDOS ------------      
      SELECT COUNT(1)QUAN
      INTO vCONTADOR
      FROM COMANDO_SANEAMENTO
      WHERE CODIGO_PESSOA_ANTIGO=''||vCODIGO_PESSOA||'';
 ----------VERIFICA SE JA EXISTE O REGISTRO -----------------------------------------------------------------------------------     
      SELECT COUNT(1)QUANT
      INTO vVERIFICADOR
      FROM RHPESS_RL_PESS_PES
      WHERE COD_EMPRESA   ='0001'
      AND COD_PESSOA_RELAC=''||vCODIGO_PESSOA_A||''
      AND DATA_FIM_VIGENCIA IS NULL;
--------------------------------------------------------INICIA LOOP PARA VEIFICAR SE TEM DATA INICIO VIGENCIA NO REGISTRO   
      FOR P IN
      (SELECT MIN(DATA_FIM) AS DATA_FIM,DATA_INI_VIGENCIA FROM ( SELECT 
       DATA_INI_VIGENCIA,
      CASE  
      WHEN DATA_INI_VIGENCIA IS NULL AND P.DATA_NASCIMENTO <=C.DATA_EFETIVO_EXERC  THEN C.DATA_EFETIVO_EXERC
      WHEN DATA_INI_VIGENCIA IS NULL AND P.DATA_NASCIMENTO >C.DATA_EFETIVO_EXERC THEN P.DATA_NASCIMENTO
      WHEN DATA_INI_VIGENCIA IS NOT NULL THEN DATA_INI_VIGENCIA ELSE to_date(''||vDATA_ACERTO||'','dd/mm/yyyy') END AS DATA_FIM,
      P.DATA_NASCIMENTO
      FROM RHPESS_RL_PESS_PES PL
      LEFT OUTER JOIN RHPESS_CONTRATO C
      ON PL.COD_PESSOA=C.CODIGO_PESSOA
      AND PL.COD_EMPRESA=C.CODIGO_EMPRESA
      LEFT OUTER JOIN RHPESS_PESSOA P
      ON P.CODIGO=PL.COD_PESSOA_RELAC
      WHERE PL.COD_EMPRESA   ='0001'
      AND PL.COD_PESSOA_RELAC=''||vcodigo_pessoa||''
      AND PL.DATA_FIM_VIGENCIA IS NULL
      AND C.TIPO_CONTRATO='0001'
      AND C.ANO_MES_REFERENCIA=(SELECT MAX (AUX.ANO_MES_REFERENCIA) FROM RHPESS_CONTRATO AUX WHERE 
      C.CODIGO_EMPRESA=AUX.CODIGO_EMPRESA
      AND C.CODIGO=AUX.CODIGO
      AND C.TIPO_CONTRATO=AUX.TIPO_CONTRATO)
      )
      GROUP BY DATA_INI_VIGENCIA
      )
      LOOP
        vDATA           :=P.DATA_FIM;
        IF p.DATA_INI_VIGENCIA       IS NULL THEN
          vSQL          :='UPDATE ARTERH.RHPESS_RL_PESS_PES SET DATA_INI_VIGENCIA=to_date('''||vDATA||''',''dd/mm/yyyy''), LOGIN_USUARIO=''PR_SANEAMENTO_DEP'' ,DT_ULT_ALTER_USUA=SYSDATE WHERE COD_EMPRESA=''0001'' AND COD_PESSOA_RELAC='''||vCODIGO_PESSOA||'''AND DATA_FIM_VIGENCIA IS NULL;commit;';
------------------------------------MONTAR SEQUENCIA DE COMANDOS--------------------------------         
          IF vCONTADOR   =0 THEN
            vCONTADOR   :=1;
          ELSIF vCONTADOR>0 THEN
            vCONTADOR   :=vCONTADOR+1;
          END IF;

          INSERT
          INTO COMANDO_SANEAMENTO
            (
              ID,
              CODIGO_PESSOA_ANTIGO,
              CODIGO_PESSOA_NOVO,
              MOVIMENTO,
              TIPO_DML,
              COMANDO
            )
            VALUES
            (
              vCONTADOR,
              vCODIGO_PESSOA,
              vCODIGO_PESSOA_A,
              'UPDATE_DATA_INI_RHPESS_RL_PESS_PES',
              'U',
              vSQL
            );COMMIT;
        END IF;
      END LOOP;
      IF vVERIFICADOR=0 THEN
        vSQL        := NULL;
        vCONTADOR   :=0;
------------------------MONTAR CONTADOR-------------------------------        
        SELECT COUNT(1)QUAN
        INTO vCONTADOR
        FROM COMANDO_SANEAMENTO
        WHERE CODIGO_PESSOA_ANTIGO=''||vCODIGO_PESSOA||'';

        vSQL :='INSERT INTO ARTERH.RHPESS_RL_PESS_PES (COD_EMPRESA,COD_PESSOA,TP_RELACIONAMENTO,COD_PESSOA_RELAC,LOGIN_USUARIO,DT_ULT_ALTER_USUA,C_LIVRE_SELEC01,C_LIVRE_VALOR01,C_LIVRE_DESCR01,C_LIVRE_DATA01,C_LIVRE_OPCAO01,OCORRENCIA,DATA_INI_VIGENCIA,DATA_FIM_VIGENCIA ) 
                SELECT COD_EMPRESA,COD_PESSOA,TP_RELACIONAMENTO,'''||vCODIGO_PESSOA_A||''',LOGIN_USUARIO,DT_ULT_ALTER_USUA,C_LIVRE_SELEC01,C_LIVRE_VALOR01,C_LIVRE_DESCR01,C_LIVRE_DATA01,C_LIVRE_OPCAO01,OCORRENCIA, DATA_INI_VIGENCIA ,DATA_FIM_VIGENCIA  
                FROM ARTERH.RHPESS_RL_PESS_PES X WHERE X.COD_EMPRESA=''0001'' AND X.COD_PESSOA_RELAC='''||vCODIGO_PESSOA||'''AND X.DATA_FIM_VIGENCIA IS NULL AND X.DT_ULT_ALTER_USUA =(SELECT MAX (AUX.DT_ULT_ALTER_USUA) FROM ARTERH.RHPESS_RL_PESS_PES AUX 
                WHERE AUX.COD_EMPRESA=X.COD_EMPRESA AND AUX.COD_PESSOA_RELAC=X.COD_PESSOA_RELAC);commit;';
-------------------MONTAR SEQUENCIA DE COMANDOS   
        IF vCONTADOR   =0 THEN
          vCONTADOR   :=1;
        ELSIF vCONTADOR>0 THEN
          vCONTADOR   :=vCONTADOR+1;
        END IF;

        INSERT
        INTO COMANDO_SANEAMENTO
          (
            ID,
            CODIGO_PESSOA_ANTIGO,
            CODIGO_PESSOA_NOVO,
            MOVIMENTO,
            TIPO_DML,
            COMANDO
          )
          VALUES
          (
            vCONTADOR,
            vCODIGO_PESSOA,
            vCODIGO_PESSOA_A,
            'INSERT_RHPESS_RL_PESS_PES',
            'I',
            vSQL
          );
        COMMIT;
        vlinha_att:=sql%rowcount;
---------------------------------------------FIM PRIMEIRA PARTE -------------------------------------------------------------------------        
        vSQL     := NULL;
        vCONTADOR:=0;
 ------------------------------BUSCAR CONTADOR TABELAS DE COMANDOS ------------------------       
        SELECT COUNT(1)QUAN
        INTO vCONTADOR
        FROM COMANDO_SANEAMENTO
        WHERE CODIGO_PESSOA_ANTIGO=''||vCODIGO_PESSOA||'';

        vSQL:='UPDATE ARTERH.RHPESS_RL_PESS_PES SET DATA_FIM_VIGENCIA=to_date('''||vDATA_ACERTO||''',''dd/mm/yyyy''), LOGIN_USUARIO=''PR_SANEAMENTO_DEP'' ,DT_ULT_ALTER_USUA=SYSDATE WHERE COD_EMPRESA=''0001'' AND COD_PESSOA_RELAC='''||vCODIGO_PESSOA||'''AND  DATA_FIM_VIGENCIA IS NULL;commit;';

----------------MONTAR SEQUENCIA COMANDOS -------------------------

        IF vCONTADOR   =0 THEN
          vCONTADOR   :=1;
        ELSIF vCONTADOR>0 THEN
          vCONTADOR   :=vCONTADOR+1;
        END IF;

        INSERT
        INTO COMANDO_SANEAMENTO
          (
            ID,
            CODIGO_PESSOA_ANTIGO,
            CODIGO_PESSOA_NOVO,
            MOVIMENTO,
            TIPO_DML,
            COMANDO
          )
          VALUES
          (
            vCONTADOR,
            vCODIGO_PESSOA,
            vCODIGO_PESSOA_A,
            'UPDATE_RHPESS_RL_PESS_PES',
            'U',
            vSQL
          );
        COMMIT;
        vlinha_att:=vlinha_att+sql%rowcount;
        RETURN vlinha_att;


        ELSIF vVERIFICADOR>0 THEN
        vSQL        := NULL;
        vCONTADOR   :=0;
------------------------MONTAR CONTADOR-------------------------------        
        SELECT COUNT(1)QUAN
        INTO vCONTADOR
        FROM COMANDO_SANEAMENTO
        WHERE CODIGO_PESSOA_ANTIGO=''||vCODIGO_PESSOA||'';

        vSQL:='UPDATE ARTERH.RHPESS_RL_PESS_PES SET DATA_FIM_VIGENCIA=to_date('''||vDATA_ACERTO||''',''dd/mm/yyyy''), LOGIN_USUARIO=''PR_SANEAMENTO_DEP'' ,DT_ULT_ALTER_USUA=SYSDATE WHERE COD_EMPRESA=''0001'' AND COD_PESSOA_RELAC='''||vCODIGO_PESSOA||'''AND  DATA_FIM_VIGENCIA IS NULL;commit;';        
      ----------------MONTAR SEQUENCIA COMANDOS -------------------------

        IF vCONTADOR   =0 THEN
          vCONTADOR   :=1;
        ELSIF vCONTADOR>0 THEN
          vCONTADOR   :=vCONTADOR+1;
        END IF;

        INSERT
        INTO COMANDO_SANEAMENTO
          (
            ID,
            CODIGO_PESSOA_ANTIGO,
            CODIGO_PESSOA_NOVO,
            MOVIMENTO,
            TIPO_DML,
            COMANDO
          )
          VALUES
          (
            vCONTADOR,
            vCODIGO_PESSOA,
            vCODIGO_PESSOA_A,
            'UPDATE_RHPESS_RL_PESS_PES_FECHA_REGISTRO',
            'U',
            vSQL
          );
        COMMIT;  
           vlinha_att:=sql%rowcount;
        RETURN vlinha_att;

      END IF;

    END IF;
---------------------------------FIM--------------------------------------    
     IF vTABELA         ='RHPESS_RL_PESS_PES' THEN
      vDATA           :=NULL;
      vCONTADOR       :=0;
      vCODIGO_PESSOA_A:= NULL;
      vSQL            :=NULL;
      vVERIFICADOR    :=0;
-------BUSCA PESSOA ATIVA--------------------     
      SELECT CODIGO_P_ATIVO
      INTO vCODIGO_PESSOA_A
      FROM SANEAMENTO_PES_DEP
      WHERE CODIGO=''||vCODIGO_PESSOA||'';
--------------------BUSCA CONTADOR TABELA COMANDOS ------------      
      SELECT COUNT(1)QUAN
      INTO vCONTADOR
      FROM COMANDO_SANEAMENTO
      WHERE CODIGO_PESSOA_ANTIGO=''||vCODIGO_PESSOA||'';
 ----------VERIFICA SE JA EXISTE O REGISTRO -----------------------------------------------------------------------------------     
      SELECT COUNT(1)QUANT
      INTO vVERIFICADOR
      FROM RHPESS_TELEFONE_P
      WHERE CODIGO_EMPRESA   ='0001'
      AND CODIGO_PESSOA=''||vCODIGO_PESSOA_A||''
      AND DATA_FIM_VIGENCIA IS NULL;


    vSQL :='INSERT INTO ARTERH.RHPESS_TELEFONE_P ( CODIGO_EMPRESA,CODIGO_PESSOA,COD_TIPO_TELEFONE,OCORRENCIA,DATA_INI_VIGENCIA,DATA_FIM_VIGENCIA,CODIGO_PAIS,PREFERENCIAL,DDD,TELEFONE,LOGIN_USUARIO,DT_ULT_ALTER_USUA )
 SELECT CODIGO_EMPRESA,'''||vCODIGO_PESSOA_A||''',COD_TIPO_TELEFONE,OCORRENCIA,DATA_INI_VIGENCIA,NULL AS DATA_FIM_VIGENCIA,CODIGO_PAIS,PREFERENCIAL,DDD,TELEFONE,''PR_SANEAMENTO_DEP'' AS LOGIN_USUARIO,
 SYSDATE DT_ULT_ALTER_USUA FROM ARTERH.RHPESS_TELEFONE_P WHERE CODIGO_EMPRESA=''0001''
 AND CODIGO_PESSOA='''||vCODIGO_PESSOA||''' AND DATA_FIM_VIGENCIA IS NULL;commit;'; 
 IF vVERIFICADOR=0 THEN 
 -----------------------------MONTA SEQUENCIA DE COMANDO--------------------------------
       IF vCONTADOR   =0 THEN
          vCONTADOR   :=1;
        ELSIF vCONTADOR>0 THEN
          vCONTADOR   :=vCONTADOR+1;
        END IF;

        INSERT
        INTO COMANDO_SANEAMENTO
          (
            ID,
            CODIGO_PESSOA_ANTIGO,
            CODIGO_PESSOA_NOVO,
            MOVIMENTO,
            TIPO_DML,
            COMANDO
          )
          VALUES
          (
            vCONTADOR,
            vCODIGO_PESSOA,
            vCODIGO_PESSOA_A,
            'INSERT_RHPESS_TELEFONE_P',
            'I',
            vSQL
          );
        COMMIT;  
           vlinha_att:=sql%rowcount;
     ------FIM PRIMEIRA PARTE ---------------      
           vCONTADOR:=0;
           vSQL:=NULL;
    --------------------BUSCA CONTADOR TABELA COMANDOS ------------      
      SELECT COUNT(1)QUAN
      INTO vCONTADOR
      FROM COMANDO_SANEAMENTO
      WHERE CODIGO_PESSOA_ANTIGO=''||vCODIGO_PESSOA||'';
      vSQL:='UPDATE ARTERH.RHPESS_TELEFONE_P SET DATA_FIM_VIGENCIA=to_date('''||vDATA_ACERTO||''',''dd/mm/yyyy''),LOGIN_USUARIO=''PR_SANEAMENTO_DEP'',DT_ULT_ALTER_USUA=SYSDATE WHERE CODIGO_EMPRESA=''0001''
             AND CODIGO_PESSOA='''||vCODIGO_PESSOA||''' AND DATA_FIM_VIGENCIA IS NULL;commit;';
     ---------------------------MONDAS SEQUENCIA DE COMANDOS---------------------------   
         IF vCONTADOR   =0 THEN
          vCONTADOR   :=1;
        ELSIF vCONTADOR>0 THEN
          vCONTADOR   :=vCONTADOR+1;
        END IF;

        INSERT
        INTO COMANDO_SANEAMENTO
          (
            ID,
            CODIGO_PESSOA_ANTIGO,
            CODIGO_PESSOA_NOVO,
            MOVIMENTO,
            TIPO_DML,
            COMANDO
          )
          VALUES
          (
            vCONTADOR,
            vCODIGO_PESSOA,
            vCODIGO_PESSOA_A,
            'UPDATE_RHPESS_TELEFONE_P',
            'U',
            vSQL
          );
        COMMIT;  
           vlinha_att:=vlinha_att+sql%rowcount;   
        RETURN vlinha_att;

        ELSIF vVERIFICADOR>0 THEN
        vSQL:=NULL;
        vCONTADOR:=0;
        vlinha_att:=0;
        --------------------BUSCA CONTADOR TABELA COMANDOS ------------      
      SELECT COUNT(1)QUAN
      INTO vCONTADOR
      FROM COMANDO_SANEAMENTO
      WHERE CODIGO_PESSOA_ANTIGO=''||vCODIGO_PESSOA||'';

       vSQL:='UPDATE ARTERH.RHPESS_TELEFONE_P SET DATA_FIM_VIGENCIA=to_date('''||vDATA_ACERTO||''',''dd/mm/yyyy''),LOGIN_USUARIO=''PR_SANEAMENTO_DEP'',DT_ULT_ALTER_USUA=SYSDATE WHERE CODIGO_EMPRESA=''0001''
             AND CODIGO_PESSOA='''||vCODIGO_PESSOA||''' AND DATA_FIM_VIGENCIA IS NULL;commit;';
      ---------------------------MONDAS SEQUENCIA DE COMANDOS---------------------------   
         IF vCONTADOR   =0 THEN
          vCONTADOR   :=1;
        ELSIF vCONTADOR>0 THEN
          vCONTADOR   :=vCONTADOR+1;
        END IF;

        INSERT
        INTO COMANDO_SANEAMENTO
          (
            ID,
            CODIGO_PESSOA_ANTIGO,
            CODIGO_PESSOA_NOVO,
            MOVIMENTO,
            TIPO_DML,
            COMANDO
          )
          VALUES
          (
            vCONTADOR,
            vCODIGO_PESSOA,
            vCODIGO_PESSOA_A,
            'UPDATE_RHPESS_TELEFONE_P_FECHA_REGISTRO',
            'U',
            vSQL
          );
        COMMIT; 
        vlinha_att:=sql%rowcount;   
        RETURN vlinha_att;
      END IF ;

   END IF;    
   RETURN vlinha_att;
END;
--------FIM FUNCA ATUALIZA TABELA
BEGIN
  CONT:=0;
  dbms_output.enable(NULL);
  FOR C1 IN
  (SELECT CODIGO,
      CODIGO_EMPRESA
    FROM SANEAMENTO_PES_DEP
    WHERE TRIM(TIPO)='DT_FIM'
 ----  AND CODIGO     IN ('200181100000073','000008857150002','000008766270004')
  )
  LOOP
    BEGIN
      CONT              :=CONT+1;
      vCODIGO_PESSOA    :=C1.CODIGO;
      IF vCODIGO_PESSOA IS NOT NULL THEN
        FOR C2 IN
        (SELECT NOME_TABELA,
            COLUNA_DESTINO_PESS,
            COLUNA_DESTINO_EMP
          FROM TABELA_RELAC
        )
        LOOP
          TABELA                   :=C2.NOME_TABELA;
          COLUNA_DESTINO           :=C2.COLUNA_DESTINO_PESS;
          COLUNA_DESTINO_EMP       :=C2.COLUNA_DESTINO_EMP;
          IF COLUNA_DESTINO_EMP    IS NOT NULL THEN
            vTABELA_RETORNO        :=TABELA_REGISTRO(vCODIGO_PESSOA,TABELA,COLUNA_DESTINO,COLUNA_DESTINO_EMP);
          ELSIF COLUNA_DESTINO_EMP IS NULL THEN
            vTABELA_RETORNO        :=TABELA_REGISTRO(vCODIGO_PESSOA,TABELA,COLUNA_DESTINO,NULL);
          END IF ;
          IF vTABELA_RETORNO IS NOT NULL AND regexp_substr(REPLACE(vTABELA_RETORNO,';;','; ;'), '[^;]+', 1, 5) IS NOT NULL THEN
            INSERT
            INTO TB_SANEAMENTO_DEP_CONTOL
              (
                TABELA,
                QTD_REGISTRO,
                COLUNA_REFERENCIA,
                CODIGO_PESSOA,
                ACAO
              )
              VALUES
              (
                regexp_substr(REPLACE(vTABELA_RETORNO,';;','; ;'), '[^;]+', 1, 1),
                regexp_substr(REPLACE(vTABELA_RETORNO,';;','; ;'), '[^;]+', 1, 2),
                regexp_substr(REPLACE(vTABELA_RETORNO,';;','; ;'), '[^;]+', 1, 3),
                regexp_substr(REPLACE(vTABELA_RETORNO,';;','; ;'), '[^;]+', 1, 4),
                regexp_substr(REPLACE(vTABELA_RETORNO,';;','; ;'), '[^;]+', 1, 5)
              );
            COMMIT;
          END IF;
        END LOOP;
      END IF;
    END;
    BEGIN
      FINALIZA_PESSOA(vCODIGO_PESSOA,C1.CODIGO_EMPRESA);
      INSERE_LINHA_P_H(vCODIGO_PESSOA,C1.CODIGO_EMPRESA);
    END ;
  END LOOP;
  ------ PARA QUE VAI INSERIR E ATUALIZAR REGISTROS NAS TABELAS QUE FOI ENCONTADO REFERENCIA ---
  BEGIN
    CONT          :=0;
    TABELA        :=NULL;
    vCODIGO_PESSOA:= NULL;
    vlinha_att    :=0;
    FOR P1 IN
    (SELECT TABELA,
        COLUNA_REFERENCIA,
        CODIGO_PESSOA
      FROM TB_SANEAMENTO_DEP_CONTOL
      WHERE TABELA      IN ('RHBENF_CONCESSOES', 'RHBENF_SOLIC_BENEF','RHPESS_ALT_PESSOA','RHPESS_DEPENDENCIA','RHPESS_DEPEND_PARM','RHPESS_ENDERECO_P','RHPESS_ENDER_P_H','RHPESS_RL_PESS_PES','RHPESS_TELEFONE_P')
  ---AND CODIGO_PESSOA IN ('200181100000073','000008857150002')
      GROUP BY TABELA,
        COLUNA_REFERENCIA ,
        CODIGO_PESSOA
    )
    LOOP
      CONT          :=CONT+1;
      TABELA        :=P1.TABELA;
      vCOLUNA       :=P1.COLUNA_REFERENCIA;
      vCODIGO_PESSOA:=P1.CODIGO_PESSOA;
      ---ORDERM FUNCAO ATUALIZA_TABELA (vCODIGO_PESSOA in varchar2,vTABELA in varchar2,vCOLUNA in varchar2
      vlinha_att:= ATUALIZA_TABELA (vCODIGO_PESSOA,TABELA,vCOLUNA);
    END LOOP;
  END;
END PR_SANEAMENTO_DEP;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "PONTO_ELETRONICO"."PRT1_GREVE_PARALIZ_DESCONTO" (DATA_INICIO IN DATE, DATA_FIM IN DATE) AS
--comentado para testes-- 
BEGIN

--KELLYSSON -- CRIADO EM 30/3/23 --BASEADO PRT1_GREVE_PARALIZACAO_TC_0211_DESCONTO.sql EMAIL (GREVE/PARALISAÇÃO CONTRATOS ADMINISTRATIVOS SMSA)

DECLARE
vCONTADOR NUMBER ;
vNUMERO NUMBER  ;
vSTRING VARCHAR2(100 BYTE);
vDATA_INICIO DATE;
vDATA_FIM DATE;
vLOG VARCHAR2(4000);

BEGIN
dbms_output.enable(null);
vCONTADOR :=0;
vNUMERO := 0;
vSTRING := NULL;
--comentado para testes--
vDATA_INICIO := TO_DATE(DATA_INICIO,'DD/MM/YYYY'); --TO_DATE('01/02/2023','DD/MM/YYYY');-------------ALTERAR DATAS
--comentado para testes-- 
vDATA_FIM := TO_DATE(DATA_FIM,'DD/MM/YYYY');--TO_DATE('28/02/2023','DD/MM/YYYY');-----------ALTERAR DATAS
vLOG := NULL;

--/*
--CABECALHO DO LOG
INSERT INTO PONTO_ELETRONICO.IFPONTO_FECHAMENTO_LOG_RELAT (CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, DATA_DADOS, CAMPO_1, CONSIDERACOES)
VALUES(NULL,NULL,NULL, SYSDATE,'PRT1_GREVE_PARALIZ_DESCONTO',
'CODIGO_EMPRESA|TIPO_CONTRATO|CODIGO_CONTRATO|DATA|CODIGO_SITUACAO|REFERENCIA|ACAO'
);COMMIT;

------------------------------------INICIO----------------------------1ª PARTE PARA A GREVE---------------------------------------------------------------------------------------------------------------------------------------------------

FOR C1 IN (

SELECT 
SP.DESCRICAO, SP.TIPO_REFERENCIA, SP.TIPO_SITUACAO, SP.situacao_assoc SIT_ESTORNO,
X.*
FROM RHPONT_RES_SIT_DIA X 
LEFT OUTER JOIN RHPONT_SITUACAO SP ON SP.CODIGO =  X.CODIGO_SITUACAO
WHERE 
--X.CODIGO_EMPRESA = '0001' AND X.TIPO_CONTRATO = '0211' AND --FICA LENTO A CONSULTA
X.LOGIN_USUARIO = 'IFPONTO' AND TRUNC(X.DT_ULT_ALTER_USUA)= TRUNC(SYSDATE)-- comentado para testes--  to_date('11/03/2023','dd/mm/yyyy') --
--comentado para testes-- 
AND TRUNC(X.DATA) >= TO_DATE('22/03/2023','DD/MM/YYYY') 
AND TRUNC(X.DATA) BETWEEN TO_DATE(vDATA_INICIO,'DD/MM/YYYY')AND TO_DATE(vDATA_FIM,'DD/MM/YYYY') ---diferencial da demanda atual EMAIL (GREVE/PARALISAÇÃO CONTRATOS ADMINISTRATIVOS SMSA)
--AND TRUNC(X.DATA)  BETWEEN TO_DATE('01/02/2023','DD/MM/YYYY')AND TO_DATE('28/02/2023','DD/MM/YYYY') --TESTES
AND X.CODIGO_SITUACAO = '0514'--GREVE
--and x.codigo_contrato = '000000001332218'--testes
ORDER BY X.CODIGO_EMPRESA, X.TIPO_CONTRATO, X.CODIGO_CONTRATO, X.DATA

)LOOP
vCONTADOR :=vCONTADOR+1;
dbms_output.put_line('--'||vCONTADOR);

IF C1.CODIGO_EMPRESA = '0001' AND C1.TIPO_CONTRATO = '0211' 
AND TRUNC(C1.DATA) >= TO_DATE('22/03/2023','DD/MM/YYYY') --COMENTADO PARA TESTES--
THEN

----comentado para testes-- 
DELETE ARTERH.RHPONT_RES_SIT_DIA WHERE TIPO_APURACAO = 'F' AND CODIGO_EMPRESA = C1.CODIGO_EMPRESA AND TIPO_CONTRATO = C1.TIPO_CONTRATO AND CODIGO_CONTRATO = C1.CODIGO_CONTRATO AND TRUNC(DATA) = C1.DATA AND CODIGO_SITUACAO = '1124'; COMMIT; 
--comentado para testes-- 
INSERT INTO ARTERH.RHPONT_RES_SIT_DIA (CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, DATA, CODIGO_SITUACAO, REF_HORAS, TIPO_APURACAO, DT_ULT_ALTER_USUA, LOGIN_USUARIO, FORCA_SITUACAO, TEXTO_ASSOCIADO) VALUES (C1.CODIGO_EMPRESA, C1.TIPO_CONTRATO, C1.CODIGO_CONTRATO, C1.DATA, '1124', 1 , 'F', SYSDATE, 'IFPONTO', 'N','PRT1_GREVE_PARALIZ_DESCONTO'); COMMIT;
vLOG := C1.CODIGO_EMPRESA ||'|' || C1.TIPO_CONTRATO ||'|'|| C1.CODIGO_CONTRATO ||'|'||TRUNC(C1.DATA)||'|1124|1|ESTORNO DE GREVE';
dbms_output.put_line('--vLOG: '||vLOG);
INSERT INTO PONTO_ELETRONICO.IFPONTO_FECHAMENTO_LOG_RELAT (CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, DATA_DADOS, CAMPO_1, CONSIDERACOES)
VALUES(C1.CODIGO_EMPRESA,C1.TIPO_CONTRATO,C1.CODIGO_CONTRATO, SYSDATE,'PRT1_GREVE_PARALIZ_DESCONTO' ,vLOG);COMMIT;
vLOG := NULL;

----comentado para testes-- 
DELETE ARTERH.RHPONT_RES_SIT_DIA WHERE TIPO_APURACAO = 'F' AND CODIGO_EMPRESA = C1.CODIGO_EMPRESA AND TIPO_CONTRATO = C1.TIPO_CONTRATO AND CODIGO_CONTRATO = C1.CODIGO_CONTRATO AND TRUNC(DATA) = C1.DATA AND CODIGO_SITUACAO = '0020'; COMMIT; 
--comentado para testes-- 
INSERT INTO ARTERH.RHPONT_RES_SIT_DIA (CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, DATA, CODIGO_SITUACAO, REF_HORAS, TIPO_APURACAO, DT_ULT_ALTER_USUA, LOGIN_USUARIO, FORCA_SITUACAO, TEXTO_ASSOCIADO) VALUES (C1.CODIGO_EMPRESA, C1.TIPO_CONTRATO, C1.CODIGO_CONTRATO, C1.DATA, '0020', 1 , 'F', SYSDATE, 'IFPONTO', 'N','PRT1_GREVE_PARALIZ_DESCONTO'); COMMIT;
vLOG := C1.CODIGO_EMPRESA ||'|' || C1.TIPO_CONTRATO ||'|'|| C1.CODIGO_CONTRATO ||'|'||TRUNC(C1.DATA)||'|0020|1|GEROU FALTA';
dbms_output.put_line('--vLOG: '||vLOG);
INSERT INTO PONTO_ELETRONICO.IFPONTO_FECHAMENTO_LOG_RELAT (CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, DATA_DADOS, CAMPO_1, CONSIDERACOES)
VALUES(C1.CODIGO_EMPRESA,C1.TIPO_CONTRATO,C1.CODIGO_CONTRATO, SYSDATE,'PRT1_GREVE_PARALIZ_DESCONTO' ,vLOG);COMMIT;
vLOG := NULL;

END IF;

END LOOP;
--*/
------------------------------------FIM----------------------------1ª PARTE PARA A GREVE---------------------------------------------------------------------------------------------------------------------------------------------------



------------------------------------INICIO----------------------------2ª PARTE PARA A PARALIZACAO---------------------------------------------------------------------------------------------------------------------------------------------------
FOR C1 IN (

SELECT 
SP.DESCRICAO, SP.TIPO_REFERENCIA, SP.TIPO_SITUACAO, SP.situacao_assoc SIT_ESTORNO,
X.*
FROM RHPONT_RES_SIT_DIA X 
LEFT OUTER JOIN RHPONT_SITUACAO SP ON SP.CODIGO =  X.CODIGO_SITUACAO
WHERE 
--X.CODIGO_EMPRESA = '0001' AND X.TIPO_CONTRATO = '0211' AND --FICA LENTO A CONSULTA
X.LOGIN_USUARIO = 'IFPONTO' AND TRUNC(X.DT_ULT_ALTER_USUA) =  TRUNC(SYSDATE) -- comentado para testes-- to_date('11/03/2023','dd/mm/yyyy')
--comentado para testes-- 
AND TRUNC(X.DATA) >= TO_DATE('22/03/2023','DD/MM/YYYY') 
AND TRUNC(X.DATA) BETWEEN TO_DATE(vDATA_INICIO,'DD/MM/YYYY')AND TO_DATE(vDATA_FIM,'DD/MM/YYYY') ---diferencial da demanda atual EMAIL (GREVE/PARALISAÇÃO CONTRATOS ADMINISTRATIVOS SMSA)
--AND TRUNC(X.DATA) BETWEEN TO_DATE('01/02/2023','DD/MM/YYYY')AND TO_DATE('28/02/2023','DD/MM/YYYY') --TESTES
AND X.CODIGO_SITUACAO = '0569'--PARALIZACAO
--AND X.CODIGO_CONTRATO IN ('000000001411320','000000001411819')--TESTES
ORDER BY X.CODIGO_EMPRESA, X.TIPO_CONTRATO, X.CODIGO_CONTRATO, X.DATA

)LOOP
vCONTADOR :=vCONTADOR+1;
dbms_output.put_line('--'||vCONTADOR);

IF C1.CODIGO_EMPRESA = '0001' AND C1.TIPO_CONTRATO = '0211' 
AND TRUNC(C1.DATA) >= TO_DATE('22/03/2023','DD/MM/YYYY') --COMENTADO PARA TESTES-- 
THEN

FOR C2 IN (

SELECT X.* FROM(
SELECT 
ROW_NUMBER()OVER(PARTITION BY CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, DATA ORDER BY CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, DATA, CODIGO_SITUACAO)ORDEM_BM,
CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, DATA, CODIGO_SITUACAO, REF_HORAS,
LEAD(CODIGO_SITUACAO,1,NULL) OVER(PARTITION BY CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, DATA ORDER BY CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, DATA, CODIGO_SITUACAO)PROXIMA_SIT_PONTO,
LEAD(REF_HORAS,1,NULL) OVER(PARTITION BY CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, DATA ORDER BY CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, DATA, CODIGO_SITUACAO)PROXIMA_REF_HORAS
FROM RHPONT_RES_SIT_DIA WHERE CODIGO_EMPRESA = C1.CODIGO_EMPRESA AND TIPO_CONTRATO = C1.TIPO_CONTRATO AND CODIGO_CONTRATO = C1.CODIGO_CONTRATO AND TRUNC(DATA) = TRUNC(C1.DATA) AND CODIGO_SITUACAO IN ('0569','1001')
ORDER BY CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, DATA, CODIGO_SITUACAO
)X WHERE X.ORDEM_BM = 1
)LOOP

dbms_output.put_line(C2.ORDEM_BM ||'-' || C2.CODIGO_EMPRESA ||'-' || C2.TIPO_CONTRATO ||'-'|| C2.CODIGO_CONTRATO ||'-'||TRUNC(C2.DATA)||'-'|| C2.CODIGO_SITUACAO||'-'||C2.REF_HORAS||'-'||C2.PROXIMA_SIT_PONTO||'-'||C2.PROXIMA_REF_HORAS);


----comentado para testes--
DELETE ARTERH.RHPONT_RES_SIT_DIA WHERE TIPO_APURACAO = 'F' AND CODIGO_EMPRESA = C1.CODIGO_EMPRESA AND TIPO_CONTRATO = C1.TIPO_CONTRATO AND CODIGO_CONTRATO = C1.CODIGO_CONTRATO AND TRUNC(DATA) = C1.DATA AND CODIGO_SITUACAO = '1209'; COMMIT; 
--comentado para testes-- 
INSERT INTO ARTERH.RHPONT_RES_SIT_DIA (CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, DATA, CODIGO_SITUACAO, REF_HORAS, TIPO_APURACAO, DT_ULT_ALTER_USUA, LOGIN_USUARIO, FORCA_SITUACAO, TEXTO_ASSOCIADO) VALUES (C1.CODIGO_EMPRESA, C1.TIPO_CONTRATO, C1.CODIGO_CONTRATO, C1.DATA, '1209', C1.REF_HORAS , 'F', SYSDATE, 'IFPONTO', 'N','PRT1_GREVE_PARALIZ_DESCONTO'); COMMIT;
--/*--comentado para testes
vLOG := C2.CODIGO_EMPRESA ||'|' || C2.TIPO_CONTRATO ||'|'|| C2.CODIGO_CONTRATO ||'|'||TRUNC(C2.DATA)||'|1209|'||C2.REF_HORAS||'|ESTORNO DE PARALISACAO';
dbms_output.put_line('--vLOG: '||vLOG);
INSERT INTO PONTO_ELETRONICO.IFPONTO_FECHAMENTO_LOG_RELAT (CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, DATA_DADOS, CAMPO_1, CONSIDERACOES)
VALUES(C2.CODIGO_EMPRESA,C2.TIPO_CONTRATO,C2.CODIGO_CONTRATO, SYSDATE,'PRT1_GREVE_PARALIZ_DESCONTO' ,vLOG);COMMIT;
vLOG := NULL;


IF C2.PROXIMA_SIT_PONTO IS NULL THEN

----comentado para testes--
DELETE ARTERH.RHPONT_RES_SIT_DIA WHERE TIPO_APURACAO = 'F' AND CODIGO_EMPRESA = C1.CODIGO_EMPRESA AND TIPO_CONTRATO = C1.TIPO_CONTRATO AND CODIGO_CONTRATO = C1.CODIGO_CONTRATO AND TRUNC(DATA) = C1.DATA AND CODIGO_SITUACAO = '1001'; COMMIT; 
--comentado para testes-- 
INSERT INTO ARTERH.RHPONT_RES_SIT_DIA (CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, DATA, CODIGO_SITUACAO, REF_HORAS, TIPO_APURACAO, DT_ULT_ALTER_USUA, LOGIN_USUARIO, FORCA_SITUACAO, TEXTO_ASSOCIADO) VALUES (C1.CODIGO_EMPRESA, C1.TIPO_CONTRATO, C1.CODIGO_CONTRATO, C1.DATA, '1001', C1.REF_HORAS , 'F', SYSDATE, 'IFPONTO', 'N','PRT1_GREVE_PARALIZ_DESCONTO'); COMMIT;
--/*--comentado para testes
vLOG := C2.CODIGO_EMPRESA ||'|' || C2.TIPO_CONTRATO ||'|'|| C2.CODIGO_CONTRATO ||'|'||TRUNC(C2.DATA)||'|1001|'||C2.REF_HORAS||'|GEROU HORAS DIFERENCIADAS';
dbms_output.put_line('--vLOG: '||vLOG);
INSERT INTO PONTO_ELETRONICO.IFPONTO_FECHAMENTO_LOG_RELAT (CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, DATA_DADOS, CAMPO_1, CONSIDERACOES)
VALUES(C2.CODIGO_EMPRESA,C2.TIPO_CONTRATO,C2.CODIGO_CONTRATO, SYSDATE,'PRT1_GREVE_PARALIZ_DESCONTO' ,vLOG);COMMIT;
vLOG := NULL;
--*/

ELSE
----comentado para testes-- 
DELETE ARTERH.RHPONT_RES_SIT_DIA WHERE TIPO_APURACAO = 'F' AND CODIGO_EMPRESA = C2.CODIGO_EMPRESA AND TIPO_CONTRATO = C2.TIPO_CONTRATO AND CODIGO_CONTRATO = C2.CODIGO_CONTRATO AND TRUNC(DATA) = C2.DATA AND CODIGO_SITUACAO = '1001'; COMMIT; 
--comentado para testes-- 
INSERT INTO ARTERH.RHPONT_RES_SIT_DIA (CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, DATA, CODIGO_SITUACAO, REF_HORAS, TIPO_APURACAO, DT_ULT_ALTER_USUA, LOGIN_USUARIO, FORCA_SITUACAO, TEXTO_ASSOCIADO) VALUES (C2.CODIGO_EMPRESA, C2.TIPO_CONTRATO, C2.CODIGO_CONTRATO, C2.DATA, '1001', C2.REF_HORAS+C2.PROXIMA_REF_HORAS , 'F', SYSDATE, 'IFPONTO', 'N','PRT1_GREVE_PARALIZ_DESCONTO'); COMMIT;
--/*--comentado para testes
vLOG := C2.CODIGO_EMPRESA ||'|' || C2.TIPO_CONTRATO ||'|'|| C2.CODIGO_CONTRATO ||'|'||TRUNC(C2.DATA)||'|1001|'||C2.REF_HORAS||' +'|| C2.PROXIMA_REF_HORAS||'|SOMOU AS HORAS DIFERENCIADAS: '||C2.REF_HORAS||' COM AS QUE JA TINHAM: '||C2.PROXIMA_REF_HORAS;
dbms_output.put_line('--vLOG: '||vLOG);

INSERT INTO PONTO_ELETRONICO.IFPONTO_FECHAMENTO_LOG_RELAT (CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, DATA_DADOS, CAMPO_1, CONSIDERACOES)
VALUES(C2.CODIGO_EMPRESA,C2.TIPO_CONTRATO,C2.CODIGO_CONTRATO, SYSDATE,'PRT1_GREVE_PARALIZ_DESCONTO' ,vLOG);COMMIT;
vLOG := NULL;

END IF;

END LOOP;--C2

END IF;
END LOOP;--C1
------------------------------------FIM----------------------------2ª PARTE PARA A PARALIZACAO---------------------------------------------------------------------------------------------------------------------------------------------------



------------------------------------INICIO----------------------------3ª PARTE PARA A TOTAL PARALIZACAO NA 1013---------------------------------------------------------------------------------------------------------------------------------------------------
FOR C1 IN (

SELECT 
SP.DESCRICAO, SP.TIPO_REFERENCIA, SP.TIPO_SITUACAO, SP.situacao_assoc SIT_ESTORNO,
X.*
FROM RHPONT_RES_SIT_DIA X 
LEFT OUTER JOIN RHPONT_SITUACAO SP ON SP.CODIGO =  X.CODIGO_SITUACAO
WHERE 
--X.CODIGO_EMPRESA = '0001' AND X.TIPO_CONTRATO = '0211' AND --FICA LENTO A CONSULTA
X.LOGIN_USUARIO = 'IFPONTO' AND TRUNC(X.DT_ULT_ALTER_USUA)= TRUNC(SYSDATE)-- comentado para testes--  to_date('11/03/2023','dd/mm/yyyy') 
--comentado para testes-- 
AND TRUNC(X.DATA) >= TO_DATE('22/03/2023','DD/MM/YYYY') 
AND TRUNC(X.DATA) BETWEEN TO_DATE(vDATA_INICIO,'DD/MM/YYYY')AND TO_DATE(vDATA_FIM,'DD/MM/YYYY') ---diferencial da demanda atual EMAIL (GREVE/PARALISAÇÃO CONTRATOS ADMINISTRATIVOS SMSA)
--AND TRUNC(X.DATA) BETWEEN TO_DATE('01/02/2023','DD/MM/YYYY')AND TO_DATE('28/02/2023','DD/MM/YYYY') --TESTES
AND X.CODIGO_SITUACAO = '0569'--PARALIZACAO
--AND X.CODIGO_CONTRATO IN ('000000001411320','000000001411819')--TESTES
ORDER BY X.CODIGO_EMPRESA, X.TIPO_CONTRATO, X.CODIGO_CONTRATO, X.DATA

)LOOP
vCONTADOR :=vCONTADOR+1;
dbms_output.put_line('--'||vCONTADOR);

IF C1.CODIGO_EMPRESA = '0001' AND C1.TIPO_CONTRATO = '0211' 
AND TRUNC(C1.DATA) >= TO_DATE('22/03/2023','DD/MM/YYYY') --COMENTADO PARA TESTES-- 
THEN

FOR C2 IN (

SELECT X.* FROM(
SELECT 
ROW_NUMBER()OVER(ORDER BY CODIGO_SITUACAO)ORDEM_BM,
CODIGO_SITUACAO, SOMA_REF_HORAS,
LEAD(CODIGO_SITUACAO,1,NULL) OVER(ORDER BY CODIGO_SITUACAO)PROXIMA_SIT_PONTO,
LEAD(SOMA_REF_HORAS,1,NULL) OVER(ORDER BY CODIGO_SITUACAO)PROXIMA_SOMA_REF_HORAS
FROM(
SELECT CODIGO_SITUACAO, SUM(REF_HORAS)SOMA_REF_HORAS FROM RHPONT_RES_SIT_DIA 
WHERE CODIGO_EMPRESA = C1.CODIGO_EMPRESA AND TIPO_CONTRATO = C1.TIPO_CONTRATO AND CODIGO_CONTRATO = C1.CODIGO_CONTRATO AND TRUNC(DATA) BETWEEN vDATA_INICIO AND vDATA_FIM AND CODIGO_SITUACAO = '0569' GROUP BY CODIGO_SITUACAO
UNION ALL
SELECT CODIGO_SITUACAO, REF_HORAS SOMA_REF_HORAS FROM RHPONT_RES_SIT_DIA 
WHERE CODIGO_EMPRESA = C1.CODIGO_EMPRESA AND TIPO_CONTRATO = C1.TIPO_CONTRATO AND CODIGO_CONTRATO = C1.CODIGO_CONTRATO AND TRUNC(DATA) = vDATA_FIM AND CODIGO_SITUACAO = '1013' 
)
ORDER BY CODIGO_SITUACAO
)X WHERE X.ORDEM_BM = 1
)LOOP

dbms_output.put_line(C2.ORDEM_BM ||'-' || C1.CODIGO_EMPRESA ||'-' || C1.TIPO_CONTRATO ||'-'|| C1.CODIGO_CONTRATO ||'-'||vDATA_FIM||'-'|| C2.CODIGO_SITUACAO||'-'||C2.SOMA_REF_HORAS||'-'||C2.PROXIMA_SIT_PONTO||'-'||C2.PROXIMA_SOMA_REF_HORAS);

IF C2.PROXIMA_SIT_PONTO IS NULL THEN
----comentado para testes--
DELETE ARTERH.RHPONT_RES_SIT_DIA WHERE TIPO_APURACAO = 'F' AND CODIGO_EMPRESA = C1.CODIGO_EMPRESA AND TIPO_CONTRATO = C1.TIPO_CONTRATO AND CODIGO_CONTRATO = C1.CODIGO_CONTRATO AND TRUNC(DATA) = vDATA_FIM AND CODIGO_SITUACAO = '1013'; COMMIT; 
--comentado para testes-- 
INSERT INTO ARTERH.RHPONT_RES_SIT_DIA (CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, DATA, CODIGO_SITUACAO, REF_HORAS, TIPO_APURACAO, DT_ULT_ALTER_USUA, LOGIN_USUARIO, FORCA_SITUACAO, TEXTO_ASSOCIADO) VALUES (C1.CODIGO_EMPRESA, C1.TIPO_CONTRATO, C1.CODIGO_CONTRATO, vDATA_FIM , '1013', C2.SOMA_REF_HORAS , 'F', SYSDATE, 'IFPONTO', 'N','PRT1_GREVE_PARALIZ_DESCONTO'); COMMIT;
--/*--comentado para testes
vLOG := C1.CODIGO_EMPRESA ||'|' || C1.TIPO_CONTRATO ||'|'|| C1.CODIGO_CONTRATO ||'|'||vDATA_FIM||'|1013|'||C2.SOMA_REF_HORAS||'|GEROU TOTAL HORAS DIFERENCIADAS PERÍODO';
dbms_output.put_line('--vLOG: '||vLOG);

INSERT INTO PONTO_ELETRONICO.IFPONTO_FECHAMENTO_LOG_RELAT (CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, DATA_DADOS, CAMPO_1, CONSIDERACOES)
VALUES(C1.CODIGO_EMPRESA ,C1.TIPO_CONTRATO, C1.CODIGO_CONTRATO, SYSDATE,'PRT1_GREVE_PARALIZ_DESCONTO' ,vLOG);COMMIT;
vLOG := NULL; 
--*/

ELSE
----comentado para testes-- 
DELETE ARTERH.RHPONT_RES_SIT_DIA WHERE TIPO_APURACAO = 'F' AND CODIGO_EMPRESA = C1.CODIGO_EMPRESA AND TIPO_CONTRATO = C1.TIPO_CONTRATO AND CODIGO_CONTRATO = C1.CODIGO_CONTRATO AND TRUNC(DATA) = vDATA_FIM AND CODIGO_SITUACAO = '1013'; COMMIT; 
--comentado para testes-- 
INSERT INTO ARTERH.RHPONT_RES_SIT_DIA (CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, DATA, CODIGO_SITUACAO, REF_HORAS, TIPO_APURACAO, DT_ULT_ALTER_USUA, LOGIN_USUARIO, FORCA_SITUACAO, TEXTO_ASSOCIADO) VALUES (C1.CODIGO_EMPRESA, C1.TIPO_CONTRATO, C1.CODIGO_CONTRATO, vDATA_FIM, '1013', C2.SOMA_REF_HORAS+C2.PROXIMA_SOMA_REF_HORAS , 'F', SYSDATE, 'IFPONTO', 'N','PRT1_GREVE_PARALIZ_DESCONTO'); COMMIT;
--/*--comentado para testes
vLOG := C1.CODIGO_EMPRESA ||'|' || C1.TIPO_CONTRATO ||'|'|| C1.CODIGO_CONTRATO ||'|'||vDATA_FIM||'|1013|'||C2.SOMA_REF_HORAS||' +'|| C2.PROXIMA_SOMA_REF_HORAS||'|SOMOU TOTAL HORAS DIFERENCIADAS PERÍODO: '||C2.SOMA_REF_HORAS||' COM AS QUE JA TINHAM: '||C2.PROXIMA_SOMA_REF_HORAS;
dbms_output.put_line('--vLOG: '||vLOG);

INSERT INTO PONTO_ELETRONICO.IFPONTO_FECHAMENTO_LOG_RELAT (CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, DATA_DADOS, CAMPO_1, CONSIDERACOES)
VALUES(C1.CODIGO_EMPRESA, C1.TIPO_CONTRATO, C1.CODIGO_CONTRATO, SYSDATE,'PRT1_GREVE_PARALIZ_DESCONTO' ,vLOG);COMMIT;
vLOG := NULL;

END IF;

END LOOP;--C2

END IF;
END LOOP;--C1
------------------------------------FIM----------------------------3ª PARTE PARA A TOTAL PARALIZACAO NA 1013---------------------------------------------------------------------------------------------------------------------------------------------------


END; 

END;


  CREATE OR REPLACE EDITIONABLE PROCEDURE "ARTERH"."PR_RETORNA_DT_TERMINO" (P_CODIGO IN VARCHAR, P_CODIGO_EMPRESA IN VARCHAR, P_LOGIN IN VARCHAR)  AS 
V_DATA_SISTEMA DATE;
V_HIST NUMBER;
BEGIN
update ARTERH.rhpess_pessoa set dt_termino = null, login_usuario = P_LOGIN, dt_ult_alter_usua = sysdate where codigo = LPAD(P_CODIGO,15,0) and codigo_empresa = LPAD(P_CODIGO_EMPRESA,4,0);
SELECT DATA_DO_SISTEMA INTO V_DATA_SISTEMA FROM ARTERH.RHPARM_P_SIST;
SELECT COUNT(1) INTO V_HIST FROM ARTERH.RHPESS_PESSOA_H WHERE CODIGO_EMPRESA = LPAD(P_CODIGO_EMPRESA,4,0) AND CODIGO = LPAD(P_CODIGO,15,0) AND ANO_MES_REFERENCIA = TRUNC(V_DATA_SISTEMA);
IF (V_HIST = 0) THEN
INSERT INTO ARTERH.RHPESS_PESSOA_H (CODIGO_EMPRESA,CODIGO,ANO_MES_REFERENCIA,NOME,PRONOME_TRATAMENTO,APELIDO,NACIONALIDADE,ANO_CHEGADA,NATURALIDADE,UF_NATURALIDADE,IDENT_ESTRANGEIRO,DATA_VALIDADE,NATURALIZADO,DATA_NATURALIZACAO,DATA_NASCIMENTO,DATA_FALECIMENTO,GRAU_INSTRUCAO,UNIVERSITARIO,SEXO,ESTADO_CIVIL,TELEFONE,CPF,C_LIVRE_DOC01,C_LIVRE_DOC02,C_LIVRE_DOC_DATA01,CART_TRABALHO,REG_MINIST_TRAB,SERIE_CART_TRAB,UF_CART_TRAB,C_LIVRE_DOC03,C_LIVRE_DOC04,DATA_CART_TRAB,IDENTIDADE,ORGAO_EXPEDIDOR,LOCAL_EXPEDICAO,DATA_EXPEDICAO,PIS_PASEP,C_LIVRE_DOC05,C_LIVRE_DOC06,DATA_CADAST_PIS,HABILITACAO,CATEGORIA,C_LIVRE_DOC07,DATA_HABILITACAO,CATEGORIA_MILITAR,CERT_RESERVISTA,C_LIVRE_DOC08,C_LIVRE_DOC_DATA03,TITULO_ELEITOR,ZONA_TIT_ELEITOR,SECAO_TIT_ELEITOR,C_LIVRE_DOC09,C_LIVRE_DOC10,C_LIVRE_DOC_DATA04,CONSELHO_REGIONAL,INSCRICAO_CONSELHO,C_LIVRE_DOC11,C_LIVRE_DOC_DATA05,ESPEC_FORMACAO,GRUPO_SANGUINEO,FATOR_RH,ALTURA,PESO,RENDA_PROPRIA,DT_INIC_REND_PROP,PESSOA_CONTATO,C_LIVRE_SELEC01,C_LIVRE_SELEC02,C_LIVRE_SELEC03,C_LIVRE_SELEC04,C_LIVRE_SELEC05,C_LIVRE_VALOR06,C_LIVRE_VALOR07,C_LIVRE_VALOR08,C_LIVRE_VALOR09,C_LIVRE_VALOR10,C_LIVRE_DESCR11,C_LIVRE_DESCR12,C_LIVRE_DESCR13,C_LIVRE_DESCR14,C_LIVRE_DESCR15,C_LIVRE_DATA16,C_LIVRE_DATA17,C_LIVRE_DATA18,C_LIVRE_DATA19,C_LIVRE_DATA20,FOTO_PESSOA,FOTO_LIVRE1,FOTO_LIVRE2,TEXTO_ASSOCIADO,LOGIN_USUARIO,DT_ULT_ALTER_USUA,BANCO_AGENCIA,CONTA_CORRENTE,CATEG_PRINCIPAL,COD_DEFICIENCIA,COD_ATIVIDADE,DT_INICIO_ATIV,DT_PREVIS_TER_ATIV,DT_TERMINO,DURACAO_ATIV,ANO_SERIE_ATIV,SEMESTRE_PERI_ATIV,COD_STATUS_ATIV,COD_MUNICIPIO,DT_TERMINO_ATIV,RACA_COR,INSCRICAO_ISS,INSCRICAO_INSS,CERT_NASCIMENTO,CERT_CASAMENTO,DATA_CASAMENTO,UF_CONSELHO,DATA_EXP_CONSELHO,ISENTO_TIT_ELEITOR,NRO_HABILITACAO,DT_VAL_HABILITACAO,ORGAO_EXP_CERT,VISTO_PERMANENTE,UF_IDENTIDADE,PAIS_ORIGEM,PESO_ASSINATURA,NOME_ACESSO,FORMA_PAGAMENTO,C_LIVRE_OPCAO01,C_LIVRE_OPCAO02,C_LIVRE_OPCAO03,C_LIVRE_OPCAO04,C_LIVRE_OPCAO05,DECL_NASC_VIVO,CARTAO_NACIO_SAUDE,NUM_RIC,ORGAO_EMISSOR_RIC,DT_EXPEDICAO_RIC,ORGAO_EMISSOR_ID_ESTR,DT_EXPEDICAO_ID_ESTR,DT_VALIDADE_CONSELHO,ORGAO_EMISSOR_HAB,RESIDENCIA_PROPRIA,RECURSO_FGTS,CASADO_BR,FILHOS_BR,TP_CONTA_BANCARIA,OBS_DEFICIENCIA,NRO_ATESTADO_OBITO,DT_PROC_ESOCIAL,DT_ALTER_ESOCIAL,INCAPACIDADE_LABOR,DATA_APOSENTA,TIPO_APOSENTA,PORTARIA_NATURALIZACAO,UF_HABILITACAO,DT_PRIM_HABILITACAO,CLASS_TRAB_ESTRANG,IND_NIF,NIF_BENEF,NOME_SOCIAL,CBO2002,FORMACAO_PROFISSIONAL)     
SELECT CODIGO_EMPRESA,CODIGO,to_date(TRUNC( V_DATA_SISTEMA) ,'dd/mm/RRRR') AS ANO_MES_REFERENCIA,NOME,PRONOME_TRATAMENTO,APELIDO,NACIONALIDADE,ANO_CHEGADA,NATURALIDADE,UF_NATURALIDADE,IDENT_ESTRANGEIRO,DATA_VALIDADE,NATURALIZADO,DATA_NATURALIZACAO,DATA_NASCIMENTO,DATA_FALECIMENTO,GRAU_INSTRUCAO,UNIVERSITARIO,SEXO,ESTADO_CIVIL,TELEFONE,CPF,C_LIVRE_DOC01,C_LIVRE_DOC02,C_LIVRE_DOC_DATA01,CART_TRABALHO,REG_MINIST_TRAB,SERIE_CART_TRAB,UF_CART_TRAB,C_LIVRE_DOC03,C_LIVRE_DOC04,DATA_CART_TRAB,IDENTIDADE,ORGAO_EXPEDIDOR,LOCAL_EXPEDICAO,DATA_EXPEDICAO,PIS_PASEP,C_LIVRE_DOC05,C_LIVRE_DOC06,DATA_CADAST_PIS,HABILITACAO,CATEGORIA,C_LIVRE_DOC07,DATA_HABILITACAO,CATEGORIA_MILITAR,CERT_RESERVISTA,C_LIVRE_DOC08,C_LIVRE_DOC_DATA03,TITULO_ELEITOR,ZONA_TIT_ELEITOR,SECAO_TIT_ELEITOR,C_LIVRE_DOC09,C_LIVRE_DOC10,C_LIVRE_DOC_DATA04,CONSELHO_REGIONAL,INSCRICAO_CONSELHO,C_LIVRE_DOC11,C_LIVRE_DOC_DATA05,ESPEC_FORMACAO,GRUPO_SANGUINEO,FATOR_RH,ALTURA,PESO,RENDA_PROPRIA,DT_INIC_REND_PROP,PESSOA_CONTATO,C_LIVRE_SELEC01,C_LIVRE_SELEC02,C_LIVRE_SELEC03,C_LIVRE_SELEC04,C_LIVRE_SELEC05,C_LIVRE_VALOR06,C_LIVRE_VALOR07,C_LIVRE_VALOR08,C_LIVRE_VALOR09,C_LIVRE_VALOR10,C_LIVRE_DESCR11,C_LIVRE_DESCR12,C_LIVRE_DESCR13,C_LIVRE_DESCR14,C_LIVRE_DESCR15,C_LIVRE_DATA16,C_LIVRE_DATA17,C_LIVRE_DATA18,C_LIVRE_DATA19,C_LIVRE_DATA20,FOTO_PESSOA,FOTO_LIVRE1,FOTO_LIVRE2,TEXTO_ASSOCIADO,LOGIN_USUARIO,DT_ULT_ALTER_USUA,BANCO_AGENCIA,CONTA_CORRENTE,CATEG_PRINCIPAL,COD_DEFICIENCIA,COD_ATIVIDADE,DT_INICIO_ATIV,DT_PREVIS_TER_ATIV,DT_TERMINO,DURACAO_ATIV,ANO_SERIE_ATIV,SEMESTRE_PERI_ATIV,COD_STATUS_ATIV,COD_MUNICIPIO,DT_TERMINO_ATIV,RACA_COR,INSCRICAO_ISS,INSCRICAO_INSS,CERT_NASCIMENTO,CERT_CASAMENTO,DATA_CASAMENTO,UF_CONSELHO,DATA_EXP_CONSELHO,ISENTO_TIT_ELEITOR,NRO_HABILITACAO,DT_VAL_HABILITACAO,ORGAO_EXP_CERT,VISTO_PERMANENTE,UF_IDENTIDADE,PAIS_ORIGEM,PESO_ASSINATURA,NOME_ACESSO,FORMA_PAGAMENTO,C_LIVRE_OPCAO01,C_LIVRE_OPCAO02,C_LIVRE_OPCAO03,C_LIVRE_OPCAO04,C_LIVRE_OPCAO05,DECL_NASC_VIVO,CARTAO_NACIO_SAUDE,NUM_RIC,ORGAO_EMISSOR_RIC,DT_EXPEDICAO_RIC,ORGAO_EMISSOR_ID_ESTR,DT_EXPEDICAO_ID_ESTR,DT_VALIDADE_CONSELHO,ORGAO_EMISSOR_HAB,RESIDENCIA_PROPRIA,RECURSO_FGTS,CASADO_BR,FILHOS_BR,TP_CONTA_BANCARIA,OBS_DEFICIENCIA,NRO_ATESTADO_OBITO,DT_PROC_ESOCIAL,DT_ALTER_ESOCIAL,INCAPACIDADE_LABOR,DATA_APOSENTA,TIPO_APOSENTA,PORTARIA_NATURALIZACAO,UF_HABILITACAO,DT_PRIM_HABILITACAO,CLASS_TRAB_ESTRANG,IND_NIF,NIF_BENEF,NOME_SOCIAL,CBO2002,FORMACAO_PROFISSIONAL    
FROM ARTERH.RHPESS_PESSOA WHERE CODIGO_EMPRESA = LPAD(P_CODIGO_EMPRESA,4,0) AND CODIGO = LPAD(P_CODIGO,15,0);
ELSE
  UPDATE ARTERH.RHPESS_PESSOA_H set dt_termino = null, login_usuario = P_LOGIN, dt_ult_alter_usua = sysdate  WHERE CODIGO_EMPRESA = LPAD(P_CODIGO_EMPRESA,4,0) AND CODIGO = LPAD(P_CODIGO,15,0) AND ANO_MES_REFERENCIA = TRUNC(V_DATA_SISTEMA);
END IF;
END PR_RETORNA_DT_TERMINO;

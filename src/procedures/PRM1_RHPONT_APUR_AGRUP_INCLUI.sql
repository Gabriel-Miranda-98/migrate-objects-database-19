
  CREATE OR REPLACE EDITIONABLE PROCEDURE "PONTO_ELETRONICO"."PRM1_RHPONT_APUR_AGRUP_INCLUI" AS
BEGIN

  --Kellysson em 30/5/20
DECLARE   
vCONTADOR NUMBER (10);
vCONTADOR2 NUMBER (10);
vDATA_INICIO DATE;
vDATA_FIM DATE;
vEMPRESA VARCHAR2 (4 BYTE);
vLOCAL VARCHAR2 (50 BYTE);
vDESC_LOCAL VARCHAR2 (200 BYTE);
vCOD_AGRUP1 VARCHAR2 (6 BYTE);
vCOD_AGRUP2 VARCHAR2 (6 BYTE);
vCOD_AGRUP3 VARCHAR2 (6 BYTE);
vCOD_AGRUP4 VARCHAR2 (6 BYTE);
vCOD_AGRUP5 VARCHAR2 (6 BYTE);
vCOD_AGRUP6 VARCHAR2 (6 BYTE);
vDATA_GUARDA DATE;

begin
dbms_output.enable(null);
vCONTADOR :=0;
vCONTADOR2 :=0;
vDATA_INICIO := NULL;
vDATA_FIM := NULL;
vEMPRESA := NULL;
vLOCAL := NULL;
vDESC_LOCAL := NULL;
vCOD_AGRUP1 := NULL;
vCOD_AGRUP2 := NULL;
vCOD_AGRUP3 := NULL;
vCOD_AGRUP4 := NULL;
vCOD_AGRUP5 := NULL;
vCOD_AGRUP6 := NULL;


--novo INICIO-- em 22/2/22 -- 2 locais novos para os guardas email (URGENTE: Atualização campo "Frequência atualizada até)
--000099	000098	000004	000000	000000	000006	GUARDA MUNICIPAL AREA DA EDUCAÇÃO - SMSE	31/01/2022
--000099	000098	000004	000000	000000	000007	GUARDA MUNICIPAL AREA DA SAUDE    - SMSE	31/01/2022
select 
MAX(DATA_FIM_FOLHA)
INTO vDATA_GUARDA
from ARTERH.RHPONT_APUR_AGRUP 
WHERE 
C_LIVRE_SELEC01 = 1 AND STATUS_APUR = 'C' AND C_LIVRE_DATA02 IS NULL AND C_LIVRE_DATA03 IS NULL;


--novo inicio-- em 22/2/22 -- 2 locais novos para os guardas email (URGENTE: Atualização campo "Frequência atualizada até)
--dbms_output.put_line('UPDATE RHORGA_UNIDADE SET LOGIN_USUARIO = ''IFPONTO'', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE('''||vDATA_GUARDA||''',''DD/MM/YYYY'')WHERE CODIGO_EMPRESA = ''0001'' AND COD_UNIDADE1 = ''000099'' AND COD_UNIDADE2 = ''000098'' AND COD_UNIDADE3 = ''000004'' AND COD_UNIDADE4 = ''000000'' AND COD_UNIDADE5 = ''000000'' AND COD_UNIDADE6 = ''000006'';COMMIT;');	
UPDATE ARTERH.RHORGA_UNIDADE SET LOGIN_USUARIO = 'IFPONTO', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE(vDATA_GUARDA,'DD/MM/YYYY')WHERE CODIGO_EMPRESA = '0001' AND COD_UNIDADE1 = '000099' AND COD_UNIDADE2 = '000098' AND COD_UNIDADE3 = '000004' AND COD_UNIDADE4 = '000000' AND COD_UNIDADE5 = '000000' AND COD_UNIDADE6 = '000006';COMMIT;	
--dbms_output.put_line('UPDATE ARTERH.RHORGA_AGRUPADOR SET LOGIN_USUARIO = ''IFPONTO'', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE('''||vDATA_GUARDA||''',''DD/MM/YYYY'')WHERE TIPO_AGRUP = ''U'' AND CODIGO_EMPRESA = ''0001'' AND COD_AGRUP1 = ''000099'' AND COD_AGRUP2 = ''000098'' AND COD_AGRUP3 = ''000004'' AND COD_AGRUP4 = ''000000'' AND COD_AGRUP5 = ''000000'' AND COD_AGRUP6 = ''000006'';COMMIT;');	
UPDATE ARTERH.RHORGA_AGRUPADOR SET LOGIN_USUARIO = 'IFPONTO', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE(vDATA_GUARDA,'DD/MM/YYYY')WHERE TIPO_AGRUP = 'U' AND CODIGO_EMPRESA = '0001' AND COD_AGRUP1 = '000099' AND COD_AGRUP2 = '000098' AND COD_AGRUP3 = '000004' AND COD_AGRUP4 = '000000' AND COD_AGRUP5 = '000000' AND COD_AGRUP6 = '000006';COMMIT;	
--dbms_output.put_line('UPDATE ARTERH.RHORGA_AGRUPADOR_H SET LOGIN_USUARIO = ''IFPONTO'', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE('''||vDATA_GUARDA||''',''DD/MM/YYYY'')WHERE ANO_MES_REFERENCIA = (SELECT MAX(A.ANO_MES_REFERENCIA) FROM ARTERH.RHORGA_AGRUPADOR_H A WHERE A.TIPO_AGRUP = ''U'' AND A.CODIGO_EMPRESA = ''0001'' AND A.COD_AGRUP1 = ''000099'' AND A.COD_AGRUP2 = ''000098'' AND A.COD_AGRUP3 = ''000004'' AND A.COD_AGRUP4 = ''000000'' AND A.COD_AGRUP5 = ''000000'' AND A.COD_AGRUP6 = ''000006'') AND TIPO_AGRUP = ''U'' AND CODIGO_EMPRESA = ''0001'' AND COD_AGRUP1 = ''000099'' AND COD_AGRUP2 = ''000098'' AND COD_AGRUP3 = ''000004'' AND COD_AGRUP4 = ''000000'' AND COD_AGRUP5 = ''000000'' AND COD_AGRUP6 = ''000006'';COMMIT;');	
UPDATE ARTERH.RHORGA_AGRUPADOR_H SET LOGIN_USUARIO = 'IFPONTO', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE(vDATA_GUARDA,'DD/MM/YYYY')WHERE ANO_MES_REFERENCIA = (SELECT MAX(A.ANO_MES_REFERENCIA) FROM ARTERH.RHORGA_AGRUPADOR_H A WHERE A.TIPO_AGRUP = 'U' AND A.CODIGO_EMPRESA = '0001' AND A.COD_AGRUP1 = '000099' AND A.COD_AGRUP2 = '000098' AND A.COD_AGRUP3 = '000004' AND A.COD_AGRUP4 = '000000' AND A.COD_AGRUP5 = '000000' AND A.COD_AGRUP6 = '000006') AND TIPO_AGRUP = 'U' AND CODIGO_EMPRESA = '0001' AND COD_AGRUP1 = '000099' AND COD_AGRUP2 = '000098' AND COD_AGRUP3 = '000004' AND COD_AGRUP4 = '000000' AND COD_AGRUP5 = '000000' AND COD_AGRUP6 = '000006';COMMIT;	

--dbms_output.put_line('UPDATE RHORGA_UNIDADE SET LOGIN_USUARIO = ''IFPONTO'', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE('''||vDATA_GUARDA||''',''DD/MM/YYYY'')WHERE CODIGO_EMPRESA = ''0001'' AND COD_UNIDADE1 = ''000099'' AND COD_UNIDADE2 = ''000098'' AND COD_UNIDADE3 = ''000004'' AND COD_UNIDADE4 = ''000000'' AND COD_UNIDADE5 = ''000000'' AND COD_UNIDADE6 = ''000007'';COMMIT;');	
UPDATE ARTERH.RHORGA_UNIDADE SET LOGIN_USUARIO = 'IFPONTO', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE(vDATA_GUARDA,'DD/MM/YYYY')WHERE CODIGO_EMPRESA = '0001' AND COD_UNIDADE1 = '000099' AND COD_UNIDADE2 = '000098' AND COD_UNIDADE3 = '000004' AND COD_UNIDADE4 = '000000' AND COD_UNIDADE5 = '000000' AND COD_UNIDADE6 = '000007';COMMIT;	
--dbms_output.put_line('UPDATE ARTERH.RHORGA_AGRUPADOR SET LOGIN_USUARIO = ''IFPONTO'', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE('''||vDATA_GUARDA||''',''DD/MM/YYYY'')WHERE TIPO_AGRUP = ''U'' AND CODIGO_EMPRESA = ''0001'' AND COD_AGRUP1 = ''000099'' AND COD_AGRUP2 = ''000098'' AND COD_AGRUP3 = ''000004'' AND COD_AGRUP4 = ''000000'' AND COD_AGRUP5 = ''000000'' AND COD_AGRUP6 = ''000007'';COMMIT;');	
UPDATE ARTERH.RHORGA_AGRUPADOR SET LOGIN_USUARIO = 'IFPONTO', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE(vDATA_GUARDA,'DD/MM/YYYY')WHERE TIPO_AGRUP = 'U' AND CODIGO_EMPRESA = '0001' AND COD_AGRUP1 = '000099' AND COD_AGRUP2 = '000098' AND COD_AGRUP3 = '000004' AND COD_AGRUP4 = '000000' AND COD_AGRUP5 = '000000' AND COD_AGRUP6 = '000007';COMMIT;	
--dbms_output.put_line('UPDATE ARTERH.RHORGA_AGRUPADOR_H SET LOGIN_USUARIO = ''IFPONTO'', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE('''||vDATA_GUARDA||''',''DD/MM/YYYY'')WHERE ANO_MES_REFERENCIA = (SELECT MAX(A.ANO_MES_REFERENCIA) FROM ARTERH.RHORGA_AGRUPADOR_H A WHERE A.TIPO_AGRUP = ''U'' AND A.CODIGO_EMPRESA = ''0001'' AND A.COD_AGRUP1 = ''000099'' AND A.COD_AGRUP2 = ''000098'' AND A.COD_AGRUP3 = ''000004'' AND A.COD_AGRUP4 = ''000000'' AND A.COD_AGRUP5 = ''000000'' AND A.COD_AGRUP6 = ''000007'') AND TIPO_AGRUP = ''U'' AND CODIGO_EMPRESA = ''0001'' AND COD_AGRUP1 = ''000099'' AND COD_AGRUP2 = ''000098'' AND COD_AGRUP3 = ''000004'' AND COD_AGRUP4 = ''000000'' AND COD_AGRUP5 = ''000000'' AND COD_AGRUP6 = ''000007'';COMMIT;');	
UPDATE ARTERH.RHORGA_AGRUPADOR_H SET LOGIN_USUARIO = 'IFPONTO', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE(vDATA_GUARDA,'DD/MM/YYYY')WHERE ANO_MES_REFERENCIA = (SELECT MAX(A.ANO_MES_REFERENCIA) FROM ARTERH.RHORGA_AGRUPADOR_H A WHERE A.TIPO_AGRUP = 'U' AND A.CODIGO_EMPRESA = '0001' AND A.COD_AGRUP1 = '000099' AND A.COD_AGRUP2 = '000098' AND A.COD_AGRUP3 = '000004' AND A.COD_AGRUP4 = '000000' AND A.COD_AGRUP5 = '000000' AND A.COD_AGRUP6 = '000007') AND TIPO_AGRUP = 'U' AND CODIGO_EMPRESA = '0001' AND COD_AGRUP1 = '000099' AND COD_AGRUP2 = '000098' AND COD_AGRUP3 = '000004' AND COD_AGRUP4 = '000000' AND COD_AGRUP5 = '000000' AND COD_AGRUP6 = '000007';COMMIT;	
--novo FIM-- em 22/2/22 -- 2 locais novos para os guardas email (URGENTE: Atualização campo "Frequência atualizada até)

--inicio--novo em 12/4/22 email (URGENTE: Atualização campo "Frequência atualizada até")
--dbms_output.put_line('UPDATE ARTERH.RHORGA_CUSTO_GEREN SET LOGIN_USUARIO = ''IFPONTO'', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE('''||vDATA_GUARDA||''',''DD/MM/YYYY'')WHERE CODIGO_EMPRESA = ''0001'' AND COD_CGERENC1 = ''000099'' AND COD_CGERENC2 = ''000098'' AND COD_CGERENC3 = ''000004'' AND COD_CGERENC4 = ''000000'' AND COD_CGERENC5 = ''000000'' AND COD_CGERENC6 = ''000006'';COMMIT;');	
UPDATE ARTERH.RHORGA_CUSTO_GEREN SET LOGIN_USUARIO = 'IFPONTO', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE(vDATA_GUARDA,'DD/MM/YYYY')WHERE CODIGO_EMPRESA = '0001' AND COD_CGERENC1 = '000099' AND COD_CGERENC2 = '000098' AND COD_CGERENC3 = '000004' AND COD_CGERENC4 = '000000' AND COD_CGERENC5 = '000000' AND COD_CGERENC6 = '000006';COMMIT;	
--dbms_output.put_line('UPDATE ARTERH.RHORGA_AGRUPADOR SET LOGIN_USUARIO = ''IFPONTO'', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE('''||vDATA_GUARDA||''',''DD/MM/YYYY'')WHERE TIPO_AGRUP = ''G'' AND CODIGO_EMPRESA = ''0001'' AND COD_AGRUP1 = ''000099'' AND COD_AGRUP2 = ''000098'' AND COD_AGRUP3 = ''000004'' AND COD_AGRUP4 = ''000000'' AND COD_AGRUP5 = ''000000'' AND COD_AGRUP6 = ''000006'';COMMIT;');	
UPDATE ARTERH.RHORGA_AGRUPADOR SET LOGIN_USUARIO = 'IFPONTO', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE(vDATA_GUARDA,'DD/MM/YYYY')WHERE TIPO_AGRUP = 'G' AND CODIGO_EMPRESA = '0001' AND COD_AGRUP1 = '000099' AND COD_AGRUP2 = '000098' AND COD_AGRUP3 = '000004' AND COD_AGRUP4 = '000000' AND COD_AGRUP5 = '000000' AND COD_AGRUP6 = '000006';COMMIT;	
--dbms_output.put_line('UPDATE ARTERH.RHORGA_AGRUPADOR_H SET LOGIN_USUARIO = ''IFPONTO'', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE('''||vDATA_GUARDA||''',''DD/MM/YYYY'')WHERE ANO_MES_REFERENCIA = (SELECT MAX(A.ANO_MES_REFERENCIA) FROM ARTERH.RHORGA_AGRUPADOR_H A WHERE A.TIPO_AGRUP = ''G'' AND A.CODIGO_EMPRESA = ''0001'' AND A.COD_AGRUP1 = ''000099'' AND A.COD_AGRUP2 = ''000098'' AND A.COD_AGRUP3 = ''000004'' AND A.COD_AGRUP4 = ''000000'' AND A.COD_AGRUP5 = ''000000'' AND A.COD_AGRUP6 = ''000006'') AND TIPO_AGRUP = ''G'' AND CODIGO_EMPRESA = ''0001'' AND COD_AGRUP1 = ''000099'' AND COD_AGRUP2 = ''000098'' AND COD_AGRUP3 = ''000004'' AND COD_AGRUP4 = ''000000'' AND COD_AGRUP5 = ''000000'' AND COD_AGRUP6 = ''000006'';COMMIT;');	
UPDATE ARTERH.RHORGA_AGRUPADOR_H SET LOGIN_USUARIO = 'IFPONTO', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE(vDATA_GUARDA,'DD/MM/YYYY')WHERE ANO_MES_REFERENCIA = (SELECT MAX(A.ANO_MES_REFERENCIA) FROM ARTERH.RHORGA_AGRUPADOR_H A WHERE A.TIPO_AGRUP = 'G' AND A.CODIGO_EMPRESA = '0001' AND A.COD_AGRUP1 = '000099' AND A.COD_AGRUP2 = '000098' AND A.COD_AGRUP3 = '000004' AND A.COD_AGRUP4 = '000000' AND A.COD_AGRUP5 = '000000' AND A.COD_AGRUP6 = '000006') AND TIPO_AGRUP = 'G' AND CODIGO_EMPRESA = '0001' AND COD_AGRUP1 = '000099' AND COD_AGRUP2 = '000098' AND COD_AGRUP3 = '000004' AND COD_AGRUP4 = '000000' AND COD_AGRUP5 = '000000' AND COD_AGRUP6 = '000006';COMMIT;

--dbms_output.put_line('UPDATE ARTERH.RHORGA_CUSTO_GEREN SET LOGIN_USUARIO = ''IFPONTO'', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE('''||vDATA_GUARDA||''',''DD/MM/YYYY'')WHERE CODIGO_EMPRESA = ''0001'' AND COD_CGERENC1 = ''000099'' AND COD_CGERENC2 = ''000098'' AND COD_CGERENC3 = ''000004'' AND COD_CGERENC4 = ''000000'' AND COD_CGERENC5 = ''000000'' AND COD_CGERENC6 = ''000007'';COMMIT;');	
UPDATE ARTERH.RHORGA_CUSTO_GEREN SET LOGIN_USUARIO = 'IFPONTO', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE(vDATA_GUARDA,'DD/MM/YYYY')WHERE CODIGO_EMPRESA = '0001' AND COD_CGERENC1 = '000099' AND COD_CGERENC2 = '000098' AND COD_CGERENC3 = '000004' AND COD_CGERENC4 = '000000' AND COD_CGERENC5 = '000000' AND COD_CGERENC6 = '000007';COMMIT;
--dbms_output.put_line('UPDATE ARTERH.RHORGA_AGRUPADOR SET LOGIN_USUARIO = ''IFPONTO'', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE('''||vDATA_GUARDA||''',''DD/MM/YYYY'')WHERE TIPO_AGRUP = ''G'' AND CODIGO_EMPRESA = ''0001'' AND COD_AGRUP1 = ''000099'' AND COD_AGRUP2 = ''000098'' AND COD_AGRUP3 = ''000004'' AND COD_AGRUP4 = ''000000'' AND COD_AGRUP5 = ''000000'' AND COD_AGRUP6 = ''000007'';COMMIT;');	
UPDATE ARTERH.RHORGA_AGRUPADOR SET LOGIN_USUARIO = 'IFPONTO', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE(vDATA_GUARDA,'DD/MM/YYYY')WHERE TIPO_AGRUP = 'G' AND CODIGO_EMPRESA = '0001' AND COD_AGRUP1 = '000099' AND COD_AGRUP2 = '000098' AND COD_AGRUP3 = '000004' AND COD_AGRUP4 = '000000' AND COD_AGRUP5 = '000000' AND COD_AGRUP6 = '000007';COMMIT;
--dbms_output.put_line('UPDATE ARTERH.RHORGA_AGRUPADOR_H SET LOGIN_USUARIO = ''IFPONTO'', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE('''||vDATA_GUARDA||''',''DD/MM/YYYY'')WHERE ANO_MES_REFERENCIA = (SELECT MAX(A.ANO_MES_REFERENCIA) FROM ARTERH.RHORGA_AGRUPADOR_H A WHERE A.TIPO_AGRUP = ''G'' AND A.CODIGO_EMPRESA = ''0001'' AND A.COD_AGRUP1 = ''000099'' AND A.COD_AGRUP2 = ''000098'' AND A.COD_AGRUP3 = ''000004'' AND A.COD_AGRUP4 = ''000000'' AND A.COD_AGRUP5 = ''000000'' AND A.COD_AGRUP6 = ''000007'') AND TIPO_AGRUP = ''G'' AND CODIGO_EMPRESA = ''0001'' AND COD_AGRUP1 = ''000099'' AND COD_AGRUP2 = ''000098'' AND COD_AGRUP3 = ''000004'' AND COD_AGRUP4 = ''000000'' AND COD_AGRUP5 = ''000000'' AND COD_AGRUP6 = ''000007'';COMMIT;');	
UPDATE ARTERH.RHORGA_AGRUPADOR_H SET LOGIN_USUARIO = 'IFPONTO', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE(vDATA_GUARDA,'DD/MM/YYYY')WHERE ANO_MES_REFERENCIA = (SELECT MAX(A.ANO_MES_REFERENCIA) FROM ARTERH.RHORGA_AGRUPADOR_H A WHERE A.TIPO_AGRUP = 'G' AND A.CODIGO_EMPRESA = '0001' AND A.COD_AGRUP1 = '000099' AND A.COD_AGRUP2 = '000098' AND A.COD_AGRUP3 = '000004' AND A.COD_AGRUP4 = '000000' AND A.COD_AGRUP5 = '000000' AND A.COD_AGRUP6 = '000007') AND TIPO_AGRUP = 'G' AND CODIGO_EMPRESA = '0001' AND COD_AGRUP1 = '000099' AND COD_AGRUP2 = '000098' AND COD_AGRUP3 = '000004' AND COD_AGRUP4 = '000000' AND COD_AGRUP5 = '000000' AND COD_AGRUP6 = '000007';COMMIT;
--fim--novo em 12/4/22 email (URGENTE: Atualização campo "Frequência atualizada até")


for C1 in(

select 
CODIGO_EMPRESA, TIPO_APUR, OCORRENCIA, DATA_INI_VIGENCIA, DATA_FIM_VIGENCIA, DATA_INI_FOLHA, DATA_FIM_FOLHA, ID_AGRUP, STATUS_APUR
, C_LIVRE_SELEC01 TIPO_FECHAMENTO, C_LIVRE_OPCAO01 FECHAMENTO_LOCAL_UNICO, C_LIVRE_DATA01 DATA_CADASTRO, C_LIVRE_DATA02 DATA_PROCESSAMENTO, C_LIVRE_DATA03 DATA_ESTORNO
from ARTERH.RHPONT_APUR_AGRUP 
WHERE 
--CODIGO_EMPRESA = '0001' AND ----comentado em 12/3/21
C_LIVRE_SELEC01 = 1 AND STATUS_APUR = 'C' AND C_LIVRE_DATA02 IS NULL AND C_LIVRE_DATA03 IS NULL
ORDER BY OCORRENCIA

)
LOOP
vCONTADOR :=vCONTADOR+1;
dbms_output.put_line('--vCONTADOR:'|| vCONTADOR);
vDATA_INICIO := C1.DATA_INI_FOLHA;
vDATA_FIM := C1.DATA_FIM_FOLHA;


--INICIO--------------------------------------------------------------------------------FECHAMENTO TODOS LOCAIS DEPENDENTES DO ORGANOGRAMA
IF C1.FECHAMENTO_LOCAL_UNICO = 'N' THEN
--dbms_output.put_line('C1.OCORRENCIA'||C1.OCORRENCIA||'-C1.FECHAMENTO_LOCAL_UNICO = N-FECHAMENTO TODOS LOCAIS DEPENDENTES DO ORGANOGRAMA'); 

FOR C2 IN (

SELECT 
E.ID_AGRUP,E.NIVEL_AGRUP_ESTRUT, E.ID_AGRUP_SUP,  E.NIVEL_SUP_AGR_EST, E.ORDEM_ESTRUT
,A.CODIGO_EMPRESA, A.TIPO_AGRUP, A.COD_AGRUP1, A.COD_AGRUP2, A.COD_AGRUP3, A.COD_AGRUP4, A.COD_AGRUP5, A.COD_AGRUP6, A.DESCRICAO, A.ABREVIACAO, A.CGC, A.RAZAO_SOCIAL, A.DATA_EXTINCAO 
FROM ARTERH.RHORGA_ESTRUT_AGR E 
LEFT OUTER JOIN ARTERH.RHORGA_AGRUPADOR A ON E.ID_AGRUP = A.ID_AGRUP
WHERE 
E.CODIGO_EMPRESA = C1.CODIGO_EMPRESA --'0001'-TROCADO EM 12/3/21 
AND E.ID_AGRUP_SUP = C1.ID_AGRUP--152123--PBH--25415--SMPOG---------COD DA TELA DE FECHAMENTO
--comentado em 19/8/20--AND ((A.COD_AGRUP1 = '000094' AND A.DESCRICAO NOT LIKE '%ESCOLA%' AND A.DESCRICAO NOT LIKE '%EMEI%')OR A.COD_AGRUP1 <> '000094')--tirando escolas e emeis da SMED
AND E.ANO_MES_REFERENCIA = (SELECT MAX(AUX.ANO_MES_REFERENCIA) FROM RHORGA_ESTRUT_AGR AUX WHERE AUX.ID_AGRUP = E.ID_AGRUP
AND AUX.CODIGO_EMPRESA = E.CODIGO_EMPRESA --ADICIONADO EM 13/3/23 DEVIDO A ERRO EM 11/3/23
)
AND A.CODIGO_EMPRESA = C1.CODIGO_EMPRESA --'0001'-TROCADO EM 12/3/21 
AND 
(A.DATA_EXTINCAO IS NULL OR TRUNC(A.DATA_EXTINCAO)>= TRUNC(SYSDATE)-42)--AJUSTE EM 22/2/22

AND (A.COD_AGRUP1 <> '000099' AND A.COD_AGRUP2 <>'000095')--TIRAR ESTRUTURA SMSA INFORMAL
--AND E.NIVEL_AGRUP_ESTRUT = 2 AND A.CGC = '18715383000140'--TESTES DE NIVEL SECRETARIA
ORDER BY A.COD_AGRUP1, A.COD_AGRUP2, A.COD_AGRUP3, A.COD_AGRUP4, A.COD_AGRUP5, A.COD_AGRUP6--E.ORDEM_ESTRUT

)
LOOP
vCONTADOR2 := vCONTADOR2+1;
vEMPRESA := C2.CODIGO_EMPRESA;
vLOCAL := C2.COD_AGRUP1||'.'||C2.COD_AGRUP2||'.'||C2.COD_AGRUP3||'.'||C2.COD_AGRUP4||'.'||C2.COD_AGRUP5||'.'||C2.COD_AGRUP6;

--dbms_output.put_line('vCONTADOR2: '||vCONTADOR2||' vDATA_INICIO: '||vDATA_INICIO||' vDATA_FIM: '||vDATA_FIM ||' vEMPRESA: ' ||vEMPRESA ||' vLOCAL: '||vLOCAL); 
--dbms_output.put_line('INSERT INTO	PONTO_ELETRONICO.IFPONTO_FECHAMENTO (TIPO, TIPO_FECHAMENTO, CODIGO, EMPRESA, DESCRICAO, DATA_INICIO, DATA_FIM, INCLUIR_DEMITIDOS, ASSINATURA_ESPELHO, DT_SAIU_ARTE)VALUES(''INCLUIR'', ''DEPARTAMENTO'', '''|| SUBSTR(C2.CODIGO_EMPRESA,3,2)||'.'||vLOCAL||''','''|| vEMPRESA ||''',''FECHAMENTO DEPARTAMENTO: '||C2.DESCRICAO ||''', TO_DATE('''||C1.DATA_INI_FOLHA||''',''DD/MM/YYYY''), TO_DATE('''||C1.DATA_FIM_FOLHA||''',''DD/MM/YYYY''),	''SIM'', ''SIM'', SYSDATE); COMMIT;');	
INSERT INTO	PONTO_ELETRONICO.IFPONTO_FECHAMENTO (TIPO, TIPO_FECHAMENTO, CODIGO, EMPRESA, DESCRICAO, DATA_INICIO, DATA_FIM, INCLUIR_DEMITIDOS, ASSINATURA_ESPELHO, DT_SAIU_ARTE, DT_ENVIADO_IFPONTO_SURICATO)VALUES('INCLUIR', 'DEPARTAMENTO', SUBSTR(C2.CODIGO_EMPRESA,3,2)||'.'||vLOCAL, vEMPRESA,'FECHAMENTO DEPARTAMENTO:'|| C2.DESCRICAO, TO_DATE(C1.DATA_INI_FOLHA,'DD/MM/YYYY'), TO_DATE(C1.DATA_FIM_FOLHA,'DD/MM/YYYY'),'SIM', 'SIM', SYSDATE, SYSDATE); COMMIT;	
--dbms_output.put_line('UPDATE RHORGA_UNIDADE SET LOGIN_USUARIO = ''IFPONTO'', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE('''||C1.DATA_FIM_FOLHA||''',''DD/MM/YYYY'')WHERE CODIGO_EMPRESA = '''||C2.CODIGO_EMPRESA ||''' AND COD_UNIDADE1 = '''|| C2.COD_AGRUP1 ||''' AND COD_UNIDADE2 = '''|| C2.COD_AGRUP2 ||''' AND COD_UNIDADE3 = '''|| C2.COD_AGRUP3 ||''' AND COD_UNIDADE4 = '''|| C2.COD_AGRUP4 ||''' AND COD_UNIDADE5 = '''|| C2.COD_AGRUP5 ||''' AND COD_UNIDADE6 = '''|| C2.COD_AGRUP6||''';COMMIT;');	
UPDATE ARTERH.RHORGA_UNIDADE SET LOGIN_USUARIO = 'IFPONTO', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE(C1.DATA_FIM_FOLHA,'DD/MM/YYYY') WHERE CODIGO_EMPRESA = C2.CODIGO_EMPRESA AND COD_UNIDADE1 = C2.COD_AGRUP1 AND COD_UNIDADE2 = C2.COD_AGRUP2 AND COD_UNIDADE3 = C2.COD_AGRUP3 AND COD_UNIDADE4 = C2.COD_AGRUP4 AND COD_UNIDADE5 = C2.COD_AGRUP5 AND COD_UNIDADE6 = C2.COD_AGRUP6; COMMIT;
--dbms_output.put_line('UPDATE ARTERH.RHORGA_AGRUPADOR SET LOGIN_USUARIO = ''IFPONTO'', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE('''||C1.DATA_FIM_FOLHA||''',''DD/MM/YYYY'')WHERE TIPO_AGRUP = ''U'' AND CODIGO_EMPRESA = '''||C2.CODIGO_EMPRESA ||''' AND COD_AGRUP1 = '''|| C2.COD_AGRUP1 ||''' AND COD_AGRUP2 = '''|| C2.COD_AGRUP2 ||''' AND COD_AGRUP3 = '''|| C2.COD_AGRUP3 ||''' AND COD_AGRUP4 = '''|| C2.COD_AGRUP4 ||''' AND COD_AGRUP5 = '''|| C2.COD_AGRUP5 ||''' AND COD_AGRUP6 = '''|| C2.COD_AGRUP6||''';COMMIT;');	
UPDATE ARTERH.RHORGA_AGRUPADOR SET LOGIN_USUARIO = 'IFPONTO', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE(C1.DATA_FIM_FOLHA,'DD/MM/YYYY') WHERE TIPO_AGRUP = 'U' AND CODIGO_EMPRESA = C2.CODIGO_EMPRESA AND COD_AGRUP1 = C2.COD_AGRUP1 AND COD_AGRUP2 = C2.COD_AGRUP2 AND COD_AGRUP3 = C2.COD_AGRUP3 AND COD_AGRUP4 = C2.COD_AGRUP4 AND COD_AGRUP5 = C2.COD_AGRUP5 AND COD_AGRUP6 = C2.COD_AGRUP6; COMMIT;
--dbms_output.put_line('UPDATE ARTERH.RHORGA_AGRUPADOR_H SET LOGIN_USUARIO = ''IFPONTO'', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE('''||C1.DATA_FIM_FOLHA||''',''DD/MM/YYYY'')WHERE ANO_MES_REFERENCIA = (SELECT MAX(A.ANO_MES_REFERENCIA) FROM ARTERH.RHORGA_AGRUPADOR_H A WHERE TIPO_AGRUP = ''U'' AND CODIGO_EMPRESA = '''||C2.CODIGO_EMPRESA ||''' AND COD_AGRUP1 = '''|| C2.COD_AGRUP1 ||''' AND COD_AGRUP2 = '''|| C2.COD_AGRUP2 ||''' AND COD_AGRUP3 = '''|| C2.COD_AGRUP3 ||''' AND COD_AGRUP4 = '''|| C2.COD_AGRUP4 ||''' AND COD_AGRUP5 = '''|| C2.COD_AGRUP5 ||''' AND COD_AGRUP6 = '''|| C2.COD_AGRUP6||''') AND TIPO_AGRUP = ''U'' AND CODIGO_EMPRESA = '''||C2.CODIGO_EMPRESA ||''' AND COD_AGRUP1 = '''|| C2.COD_AGRUP1 ||''' AND COD_AGRUP2 = '''|| C2.COD_AGRUP2 ||''' AND COD_AGRUP3 = '''|| C2.COD_AGRUP3 ||''' AND COD_AGRUP4 = '''|| C2.COD_AGRUP4 ||''' AND COD_AGRUP5 = '''|| C2.COD_AGRUP5 ||''' AND COD_AGRUP6 = '''|| C2.COD_AGRUP6||''';COMMIT;');	
UPDATE ARTERH.RHORGA_AGRUPADOR_H SET LOGIN_USUARIO = 'IFPONTO', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE(C1.DATA_FIM_FOLHA,'DD/MM/YYYY') WHERE ANO_MES_REFERENCIA = (SELECT MAX(A.ANO_MES_REFERENCIA) FROM ARTERH.RHORGA_AGRUPADOR_H A WHERE TIPO_AGRUP = 'U' AND CODIGO_EMPRESA = C2.CODIGO_EMPRESA AND COD_AGRUP1 = C2.COD_AGRUP1 AND COD_AGRUP2 = C2.COD_AGRUP2 AND COD_AGRUP3 = C2.COD_AGRUP3 AND COD_AGRUP4 = C2.COD_AGRUP4 AND COD_AGRUP5 = C2.COD_AGRUP5 AND COD_AGRUP6 = C2.COD_AGRUP6) AND TIPO_AGRUP = 'U' AND CODIGO_EMPRESA = C2.CODIGO_EMPRESA AND COD_AGRUP1 = C2.COD_AGRUP1 AND COD_AGRUP2 = C2.COD_AGRUP2 AND COD_AGRUP3 = C2.COD_AGRUP3 AND COD_AGRUP4 = C2.COD_AGRUP4 AND COD_AGRUP5 = C2.COD_AGRUP5 AND COD_AGRUP6 = C2.COD_AGRUP6; COMMIT;

--inicio--novo em 12/4/22 email (URGENTE: Atualização campo "Frequência atualizada até")
--dbms_output.put_line('UPDATE ARTERH.RHORGA_CUSTO_GEREN SET LOGIN_USUARIO = ''IFPONTO'', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE('''||C1.DATA_FIM_FOLHA||''',''DD/MM/YYYY'')WHERE CODIGO_EMPRESA = '''||C2.CODIGO_EMPRESA ||''' AND COD_CGERENC1 = '''|| C2.COD_AGRUP1 ||''' AND COD_CGERENC2 = '''|| C2.COD_AGRUP2 ||''' AND COD_CGERENC3 = '''|| C2.COD_AGRUP3 ||''' AND COD_CGERENC4 = '''|| C2.COD_AGRUP4 ||''' AND COD_CGERENC5 = '''|| C2.COD_AGRUP5 ||''' AND COD_CGERENC6 = '''|| C2.COD_AGRUP6||''';COMMIT;');	
UPDATE ARTERH.RHORGA_CUSTO_GEREN SET LOGIN_USUARIO = 'IFPONTO', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE(C1.DATA_FIM_FOLHA,'DD/MM/YYYY')WHERE CODIGO_EMPRESA = C2.CODIGO_EMPRESA AND COD_CGERENC1 = C2.COD_AGRUP1 AND COD_CGERENC2 = C2.COD_AGRUP2 AND COD_CGERENC3 = C2.COD_AGRUP3 AND COD_CGERENC4 = C2.COD_AGRUP4 AND COD_CGERENC5 = C2.COD_AGRUP5 AND COD_CGERENC6 = C2.COD_AGRUP6; COMMIT;
--dbms_output.put_line('UPDATE ARTERH.RHORGA_AGRUPADOR SET LOGIN_USUARIO = ''IFPONTO'', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE('''||C1.DATA_FIM_FOLHA||''',''DD/MM/YYYY'')WHERE TIPO_AGRUP = ''G'' AND CODIGO_EMPRESA = '''||C2.CODIGO_EMPRESA ||''' AND COD_AGRUP1 = '''|| C2.COD_AGRUP1 ||''' AND COD_AGRUP2 = '''|| C2.COD_AGRUP2 ||''' AND COD_AGRUP3 = '''|| C2.COD_AGRUP3 ||''' AND COD_AGRUP4 = '''|| C2.COD_AGRUP4 ||''' AND COD_AGRUP5 = '''|| C2.COD_AGRUP5 ||''' AND COD_AGRUP6 = '''|| C2.COD_AGRUP6||''';COMMIT;');	
UPDATE ARTERH.RHORGA_AGRUPADOR SET LOGIN_USUARIO = 'IFPONTO', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE(C1.DATA_FIM_FOLHA,'DD/MM/YYYY')WHERE TIPO_AGRUP = 'G' AND CODIGO_EMPRESA = C2.CODIGO_EMPRESA  AND COD_AGRUP1 =  C2.COD_AGRUP1  AND COD_AGRUP2 =  C2.COD_AGRUP2  AND COD_AGRUP3 =  C2.COD_AGRUP3  AND COD_AGRUP4 =  C2.COD_AGRUP4  AND COD_AGRUP5 =  C2.COD_AGRUP5  AND COD_AGRUP6 =  C2.COD_AGRUP6; COMMIT;
--dbms_output.put_line('UPDATE ARTERH.RHORGA_AGRUPADOR_H SET LOGIN_USUARIO = ''IFPONTO'', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE('''||C1.DATA_FIM_FOLHA||''',''DD/MM/YYYY'')WHERE ANO_MES_REFERENCIA = (SELECT MAX(A.ANO_MES_REFERENCIA) FROM ARTERH.RHORGA_AGRUPADOR_H A WHERE TIPO_AGRUP = ''G'' AND CODIGO_EMPRESA = '''||C2.CODIGO_EMPRESA ||''' AND COD_AGRUP1 = '''|| C2.COD_AGRUP1 ||''' AND COD_AGRUP2 = '''|| C2.COD_AGRUP2 ||''' AND COD_AGRUP3 = '''|| C2.COD_AGRUP3 ||''' AND COD_AGRUP4 = '''|| C2.COD_AGRUP4 ||''' AND COD_AGRUP5 = '''|| C2.COD_AGRUP5 ||''' AND COD_AGRUP6 = '''|| C2.COD_AGRUP6||''') AND TIPO_AGRUP = ''G'' AND CODIGO_EMPRESA = '''||C2.CODIGO_EMPRESA ||''' AND COD_AGRUP1 = '''|| C2.COD_AGRUP1 ||''' AND COD_AGRUP2 = '''|| C2.COD_AGRUP2 ||''' AND COD_AGRUP3 = '''|| C2.COD_AGRUP3 ||''' AND COD_AGRUP4 = '''|| C2.COD_AGRUP4 ||''' AND COD_AGRUP5 = '''|| C2.COD_AGRUP5 ||''' AND COD_AGRUP6 = '''|| C2.COD_AGRUP6||''';COMMIT;');	
UPDATE ARTERH.RHORGA_AGRUPADOR_H SET LOGIN_USUARIO = 'IFPONTO', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE(C1.DATA_FIM_FOLHA,'DD/MM/YYYY')WHERE ANO_MES_REFERENCIA = (SELECT MAX(A.ANO_MES_REFERENCIA) FROM ARTERH.RHORGA_AGRUPADOR_H A WHERE TIPO_AGRUP = 'G' AND CODIGO_EMPRESA = C2.CODIGO_EMPRESA  AND COD_AGRUP1 =  C2.COD_AGRUP1  AND COD_AGRUP2 =  C2.COD_AGRUP2  AND COD_AGRUP3 =  C2.COD_AGRUP3  AND COD_AGRUP4 =  C2.COD_AGRUP4  AND COD_AGRUP5 =  C2.COD_AGRUP5  AND COD_AGRUP6 =  C2.COD_AGRUP6) AND TIPO_AGRUP = 'G' AND CODIGO_EMPRESA = C2.CODIGO_EMPRESA  AND COD_AGRUP1 =  C2.COD_AGRUP1  AND COD_AGRUP2 =  C2.COD_AGRUP2  AND COD_AGRUP3 =  C2.COD_AGRUP3  AND COD_AGRUP4 =  C2.COD_AGRUP4  AND COD_AGRUP5 =  C2.COD_AGRUP5  AND COD_AGRUP6 =  C2.COD_AGRUP6; COMMIT;
--fim--novo em 12/4/22 email (URGENTE: Atualização campo "Frequência atualizada até")


END LOOP; ---FIM C2
vCONTADOR2 := 0;
vEMPRESA := NULL;
vLOCAL := NULL;
--FIM--------------------------------------------------------------------------------FECHAMENTO TODOS LOCAIS DEPENDENTES DO ORGANOGRAMA


--INICIO-----------------------------------------------------------------------------FECHAMENTO LOCAL ESPECIFICO
ELSIF C1.FECHAMENTO_LOCAL_UNICO = 'S' THEN
--dbms_output.put_line('C1.OCORRENCIA'||C1.OCORRENCIA||'-C1.FECHAMENTO_LOCAL_UNICO = S-FECHAMENTO LOCAL ESPECIFICO'); 
SELECT 
A.CODIGO_EMPRESA, A.COD_AGRUP1||'.'||A.COD_AGRUP2||'.'||A.COD_AGRUP3||'.'||A.COD_AGRUP4||'.'||A.COD_AGRUP5||'.'||A.COD_AGRUP6, A.DESCRICAO
, A.COD_AGRUP1, A.COD_AGRUP2, A.COD_AGRUP3, A.COD_AGRUP4, A.COD_AGRUP5, A.COD_AGRUP6
INTO vEMPRESA, vLOCAL, vDESC_LOCAL, vCOD_AGRUP1, vCOD_AGRUP2, vCOD_AGRUP3, vCOD_AGRUP4, vCOD_AGRUP5, vCOD_AGRUP6
from ARTERH.RHORGA_AGRUPADOR A 
WHERE A.CODIGO_EMPRESA = C1.CODIGO_EMPRESA --ALTERADO 11/8/21 --COMENTADO EM 11/8/21--'0001' 
AND A.ID_AGRUP = C1.ID_AGRUP--25415--SMPOG--152123--PBH-------COD DA TELA DE FECHAMENTO
AND 
(A.DATA_EXTINCAO IS NULL OR TRUNC(A.DATA_EXTINCAO)>= TRUNC(SYSDATE)-42 )--AJUSTE EM 22/2/22
;

--dbms_output.put_line('vDATA_INICIO: '||vDATA_INICIO||' vDATA_FIM: '||vDATA_FIM ||' vEMPRESA: ' ||vEMPRESA ||' vLOCAL: '||vLOCAL);
--dbms_output.put_line('INSERT INTO	PONTO_ELETRONICO.IFPONTO_FECHAMENTO (TIPO, TIPO_FECHAMENTO, CODIGO, EMPRESA, DESCRICAO, DATA_INICIO, DATA_FIM, INCLUIR_DEMITIDOS, ASSINATURA_ESPELHO, DT_SAIU_ARTE)VALUES(''INCLUIR'', ''DEPARTAMENTO'', '''|| SUBSTR(vEMPRESA,3,2)||'.'||vLOCAL||''','''|| vEMPRESA ||''',''FECHAMENTO DEPARTAMENTO: '||vDESC_LOCAL ||''', TO_DATE('''||C1.DATA_INI_FOLHA||''',''DD/MM/YYYY''), TO_DATE('''||C1.DATA_FIM_FOLHA||''',''DD/MM/YYYY''),	''SIM'', ''SIM'', SYSDATE);COMMIT;');	
INSERT INTO	PONTO_ELETRONICO.IFPONTO_FECHAMENTO (TIPO, TIPO_FECHAMENTO, CODIGO, EMPRESA, DESCRICAO, DATA_INICIO, DATA_FIM, INCLUIR_DEMITIDOS, ASSINATURA_ESPELHO, DT_SAIU_ARTE, DT_ENVIADO_IFPONTO_SURICATO)VALUES('INCLUIR', 'DEPARTAMENTO',  SUBSTR(vEMPRESA,3,2)||'.'||vLOCAL, vEMPRESA ,'FECHAMENTO DEPARTAMENTO: '|| vDESC_LOCAL , TO_DATE(C1.DATA_INI_FOLHA,'DD/MM/YYYY'), TO_DATE(C1.DATA_FIM_FOLHA,'DD/MM/YYYY'),'SIM', 'SIM', SYSDATE, SYSDATE); COMMIT;
--dbms_output.put_line('UPDATE RHORGA_UNIDADE SET LOGIN_USUARIO = ''IFPONTO'', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE('''||C1.DATA_FIM_FOLHA||''',''DD/MM/YYYY'')WHERE CODIGO_EMPRESA = '''||vEMPRESA ||''' AND COD_UNIDADE1 = '''|| vCOD_AGRUP1 ||''' AND COD_UNIDADE2 = '''|| vCOD_AGRUP2 ||''' AND COD_UNIDADE3 = '''|| vCOD_AGRUP3 ||''' AND COD_UNIDADE4 = '''|| vCOD_AGRUP4 ||''' AND COD_UNIDADE5 = '''|| vCOD_AGRUP5 ||''' AND COD_UNIDADE6 = '''|| vCOD_AGRUP6||''';COMMIT;');	
UPDATE ARTERH.RHORGA_UNIDADE SET LOGIN_USUARIO = 'IFPONTO', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE(C1.DATA_FIM_FOLHA,'DD/MM/YYYY') WHERE CODIGO_EMPRESA = vEMPRESA  AND COD_UNIDADE1 =  vCOD_AGRUP1  AND COD_UNIDADE2 =  vCOD_AGRUP2  AND COD_UNIDADE3 =  vCOD_AGRUP3  AND COD_UNIDADE4 =  vCOD_AGRUP4  AND COD_UNIDADE5 =  vCOD_AGRUP5  AND COD_UNIDADE6 =  vCOD_AGRUP6; COMMIT;
--dbms_output.put_line('UPDATE ARTERH.RHORGA_AGRUPADOR SET LOGIN_USUARIO = ''IFPONTO'', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE('''||C1.DATA_FIM_FOLHA||''',''DD/MM/YYYY'')WHERE TIPO_AGRUP = ''U'' AND CODIGO_EMPRESA = '''||vEMPRESA ||''' AND COD_AGRUP1 = '''|| vCOD_AGRUP1 ||''' AND COD_AGRUP2 = '''|| vCOD_AGRUP2 ||''' AND COD_AGRUP3 = '''|| vCOD_AGRUP3 ||''' AND COD_AGRUP4 = '''|| vCOD_AGRUP4 ||''' AND COD_AGRUP5 = '''|| vCOD_AGRUP5 ||''' AND COD_AGRUP6 = '''|| vCOD_AGRUP6||''';COMMIT;');	
UPDATE ARTERH.RHORGA_AGRUPADOR SET LOGIN_USUARIO = 'IFPONTO', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE(C1.DATA_FIM_FOLHA,'DD/MM/YYYY') WHERE TIPO_AGRUP = 'U' AND CODIGO_EMPRESA = vEMPRESA  AND COD_AGRUP1 =  vCOD_AGRUP1  AND COD_AGRUP2 =  vCOD_AGRUP2  AND COD_AGRUP3 =  vCOD_AGRUP3  AND COD_AGRUP4 =  vCOD_AGRUP4  AND COD_AGRUP5 =  vCOD_AGRUP5  AND COD_AGRUP6 =  vCOD_AGRUP6; COMMIT;
--dbms_output.put_line('UPDATE ARTERH.RHORGA_AGRUPADOR_H SET LOGIN_USUARIO = ''IFPONTO'', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE('''||C1.DATA_FIM_FOLHA||''',''DD/MM/YYYY'')WHERE ANO_MES_REFERENCIA = (SELECT MAX(A.ANO_MES_REFERENCIA) FROM ARTERH.RHORGA_AGRUPADOR_H A WHERE A.TIPO_AGRUP = ''U'' AND A.CODIGO_EMPRESA = '''||vEMPRESA ||''' AND A.COD_AGRUP1 = '''|| vCOD_AGRUP1 ||''' AND A.COD_AGRUP2 = '''|| vCOD_AGRUP2 ||''' AND A.COD_AGRUP3 = '''|| vCOD_AGRUP3 ||''' AND A.COD_AGRUP4 = '''|| vCOD_AGRUP4 ||''' AND A.COD_AGRUP5 = '''|| vCOD_AGRUP5 ||''' AND A.COD_AGRUP6 = '''|| vCOD_AGRUP6||''') AND TIPO_AGRUP = ''U'' AND CODIGO_EMPRESA = '''||vEMPRESA ||''' AND COD_AGRUP1 = '''|| vCOD_AGRUP1 ||''' AND COD_AGRUP2 = '''|| vCOD_AGRUP2 ||''' AND COD_AGRUP3 = '''|| vCOD_AGRUP3 ||''' AND COD_AGRUP4 = '''|| vCOD_AGRUP4 ||''' AND COD_AGRUP5 = '''|| vCOD_AGRUP5 ||''' AND COD_AGRUP6 = '''|| vCOD_AGRUP6||''';COMMIT;');	
UPDATE ARTERH.RHORGA_AGRUPADOR_H SET LOGIN_USUARIO = 'IFPONTO', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE(C1.DATA_FIM_FOLHA,'DD/MM/YYYY') WHERE ANO_MES_REFERENCIA = (SELECT MAX(A.ANO_MES_REFERENCIA) FROM ARTERH.RHORGA_AGRUPADOR_H A WHERE A.TIPO_AGRUP = 'U' AND A.CODIGO_EMPRESA = vEMPRESA  AND A.COD_AGRUP1 =  vCOD_AGRUP1  AND A.COD_AGRUP2 =  vCOD_AGRUP2  AND A.COD_AGRUP3 =  vCOD_AGRUP3  AND A.COD_AGRUP4 =  vCOD_AGRUP4  AND A.COD_AGRUP5 =  vCOD_AGRUP5  AND A.COD_AGRUP6 =  vCOD_AGRUP6) AND TIPO_AGRUP = 'U' AND CODIGO_EMPRESA = vEMPRESA  AND COD_AGRUP1 =  vCOD_AGRUP1  AND COD_AGRUP2 =  vCOD_AGRUP2  AND COD_AGRUP3 =  vCOD_AGRUP3  AND COD_AGRUP4 =  vCOD_AGRUP4  AND COD_AGRUP5 =  vCOD_AGRUP5  AND COD_AGRUP6 =  vCOD_AGRUP6; COMMIT;
--inicio--novo em 12/4/22 email (URGENTE: Atualização campo "Frequência atualizada até")
--dbms_output.put_line('UPDATE ARTERH.RHORGA_CUSTO_GEREN SET LOGIN_USUARIO = ''IFPONTO'', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE('''||C1.DATA_FIM_FOLHA||''',''DD/MM/YYYY'')WHERE CODIGO_EMPRESA = '''||vEMPRESA ||''' AND COD_CGERENC1 = '''|| vCOD_AGRUP1 ||''' AND COD_CGERENC2 = '''|| vCOD_AGRUP2 ||''' AND COD_CGERENC3 = '''|| vCOD_AGRUP3 ||''' AND COD_CGERENC4 = '''|| vCOD_AGRUP4 ||''' AND COD_CGERENC5 = '''|| vCOD_AGRUP5 ||''' AND COD_CGERENC6 = '''|| vCOD_AGRUP6||''';COMMIT;');	
UPDATE ARTERH.RHORGA_CUSTO_GEREN SET LOGIN_USUARIO = 'IFPONTO', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE(C1.DATA_FIM_FOLHA,'DD/MM/YYYY') WHERE CODIGO_EMPRESA = vEMPRESA  AND COD_CGERENC1 =  vCOD_AGRUP1  AND COD_CGERENC2 =  vCOD_AGRUP2  AND COD_CGERENC3 =  vCOD_AGRUP3  AND COD_CGERENC4 =  vCOD_AGRUP4  AND COD_CGERENC5 =  vCOD_AGRUP5  AND COD_CGERENC6 =  vCOD_AGRUP6; COMMIT;	
--dbms_output.put_line('UPDATE ARTERH.RHORGA_AGRUPADOR SET LOGIN_USUARIO = ''IFPONTO'', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE('''||C1.DATA_FIM_FOLHA||''',''DD/MM/YYYY'')WHERE TIPO_AGRUP = ''G'' AND CODIGO_EMPRESA = '''||vEMPRESA ||''' AND COD_AGRUP1 = '''|| vCOD_AGRUP1 ||''' AND COD_AGRUP2 = '''|| vCOD_AGRUP2 ||''' AND COD_AGRUP3 = '''|| vCOD_AGRUP3 ||''' AND COD_AGRUP4 = '''|| vCOD_AGRUP4 ||''' AND COD_AGRUP5 = '''|| vCOD_AGRUP5 ||''' AND COD_AGRUP6 = '''|| vCOD_AGRUP6||''';COMMIT;');	
UPDATE ARTERH.RHORGA_AGRUPADOR SET LOGIN_USUARIO = 'IFPONTO', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE(C1.DATA_FIM_FOLHA,'DD/MM/YYYY') WHERE TIPO_AGRUP = 'G' AND CODIGO_EMPRESA = vEMPRESA  AND COD_AGRUP1 =  vCOD_AGRUP1  AND COD_AGRUP2 =  vCOD_AGRUP2  AND COD_AGRUP3 =  vCOD_AGRUP3  AND COD_AGRUP4 =  vCOD_AGRUP4  AND COD_AGRUP5 =  vCOD_AGRUP5  AND COD_AGRUP6 =  vCOD_AGRUP6; COMMIT;
--dbms_output.put_line('UPDATE ARTERH.RHORGA_AGRUPADOR_H SET LOGIN_USUARIO = ''IFPONTO'', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE('''||C1.DATA_FIM_FOLHA||''',''DD/MM/YYYY'')WHERE ANO_MES_REFERENCIA = (SELECT MAX(A.ANO_MES_REFERENCIA) FROM ARTERH.RHORGA_AGRUPADOR_H A WHERE A.TIPO_AGRUP = ''G'' AND A.CODIGO_EMPRESA = '''||vEMPRESA ||''' AND A.COD_AGRUP1 = '''|| vCOD_AGRUP1 ||''' AND A.COD_AGRUP2 = '''|| vCOD_AGRUP2 ||''' AND A.COD_AGRUP3 = '''|| vCOD_AGRUP3 ||''' AND A.COD_AGRUP4 = '''|| vCOD_AGRUP4 ||''' AND A.COD_AGRUP5 = '''|| vCOD_AGRUP5 ||''' AND A.COD_AGRUP6 = '''|| vCOD_AGRUP6||''') AND TIPO_AGRUP = ''G'' AND CODIGO_EMPRESA = '''||vEMPRESA ||''' AND COD_AGRUP1 = '''|| vCOD_AGRUP1 ||''' AND COD_AGRUP2 = '''|| vCOD_AGRUP2 ||''' AND COD_AGRUP3 = '''|| vCOD_AGRUP3 ||''' AND COD_AGRUP4 = '''|| vCOD_AGRUP4 ||''' AND COD_AGRUP5 = '''|| vCOD_AGRUP5 ||''' AND COD_AGRUP6 = '''|| vCOD_AGRUP6||''';COMMIT;');	
UPDATE ARTERH.RHORGA_AGRUPADOR_H SET LOGIN_USUARIO = 'IFPONTO', DT_ULT_ALTER_USUA = SYSDATE, c_livre_data15 = TO_DATE(C1.DATA_FIM_FOLHA,'DD/MM/YYYY')WHERE ANO_MES_REFERENCIA = (SELECT MAX(A.ANO_MES_REFERENCIA) FROM ARTERH.RHORGA_AGRUPADOR_H A WHERE A.TIPO_AGRUP = 'G' AND A.CODIGO_EMPRESA = vEMPRESA  AND A.COD_AGRUP1 =  vCOD_AGRUP1  AND A.COD_AGRUP2 =  vCOD_AGRUP2  AND A.COD_AGRUP3 =  vCOD_AGRUP3  AND A.COD_AGRUP4 =  vCOD_AGRUP4  AND A.COD_AGRUP5 =  vCOD_AGRUP5  AND A.COD_AGRUP6 =  vCOD_AGRUP6) AND TIPO_AGRUP = 'G' AND CODIGO_EMPRESA = vEMPRESA  AND COD_AGRUP1 =  vCOD_AGRUP1  AND COD_AGRUP2 =  vCOD_AGRUP2  AND COD_AGRUP3 =  vCOD_AGRUP3  AND COD_AGRUP4 =  vCOD_AGRUP4  AND COD_AGRUP5 =  vCOD_AGRUP5  AND COD_AGRUP6 =  vCOD_AGRUP6; COMMIT;	
--fim--novo em 12/4/22 email (URGENTE: Atualização campo "Frequência atualizada até")

--FIM-----------------------------------------------------------------------------FECHAMENTO LOCAL ESPECIFICO

--ERRO
ELSE
dbms_output.put_line('C1.OCORRENCIA'||C1.OCORRENCIA||'-ERRO'); 

END IF;

--atualizar dados na tabela RHPONT_APUR_AGRUP
--comentado em 8/9/20--dbms_output.put_line('update RHPONT_APUR_AGRUP set STATUS_APUR = ''P'', C_LIVRE_DATA02 = SYSDATE WHERE CODIGO_EMPRESA = ''0001'' AND OCORRENCIA = '||C1.OCORRENCIA||'; COMMIT;');

END LOOP; --FIM LOOP C1
vEMPRESA := NULL;
vLOCAL := NULL;
vDESC_LOCAL := NULL;
vCOD_AGRUP1 := NULL;
vCOD_AGRUP2 := NULL;
vCOD_AGRUP3 := NULL;
vCOD_AGRUP4 := NULL;
vCOD_AGRUP5 := NULL;
vCOD_AGRUP6 := NULL;

END;

END;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "ARTERH"."PRR_PUBLICO_TEG_MENSAL" AS
BEGIN

DECLARE               
vCONTADOR NUMBER; 

BEGIN
dbms_output.enable(null);
vCONTADOR := 0;

FOR C1 IN(

SELECT 'CODIGO_EMPRESA|TIPO_CONTRATO|CODIGO_PESSOA|CODIGO_CONTRATO|NOME|NOME_SOCIAL|DATA_NASCIMENTO|SEXO|CPF|PIS_PASEP_NIT|IDENTIDADE|CEP|TIPO_LOGRADOURO|CODIGO_SITUACAO_FUNCIONAL|SITUACAO_FUNCIONAL|LOGRADOURO|NUMERO|COMPLEMENTO|BAIRRO|MUNICIPIO|UF|VINCULO|DESCRICAO_VINCULO|COD_CARGO_EFETIVO|CARGO_EFETIVO|COD_CARGO_COMISS|CARGO_COMISSIONADO|ESPECIALIDADE|COD_UNIDADE1|COD_UNIDADE2|COD_UNIDADE3|COD_UNIDADE4|COD_UNIDADE5|COD_UNIDADE6|LOTACAO|DATA_ADMISSAO|DATA_EFETIVO_EXERC|DATA_RESCISAO|JORNADA_MENSAL|ESCALA|REMUNERACAO|CODIGO_GRO|DESCRICAO_GRO' 
AS LINHA FROM DUAL 
UNION ALL
SELECT 
X7.CODIGO_EMPRESA||'|'||X7.TIPO_CONTRATO||'|'||X7.CODIGO_PESSOA||'|'||X7.CODIGO_CONTRATO||'|'||X7.NOME||'|'||X7.NOME_SOCIAL||'|'||X7.DATA_NASCIMENTO||'|'||X7.SEXO||'|'||X7.CPF||'|'||X7.PIS_PASEP_NIT||'|'||X7.IDENTIDADE||'|'||X7.CEP||'|'||X7.TIPO_LOGRADOURO||'|'||X7.CODIGO_SITUACAO_FUNCIONAL||'|'||X7.SITUACAO_FUNCIONAL||'|'||X7.LOGRADOURO||'|'||X7.NUMERO||'|'||X7.COMPLEMENTO||'|'||X7.BAIRRO||'|'||X7.MUNICIPIO||'|'||X7.UF||'|'||X7.VINCULO||'|'||X7.DESCRICAO_VINCULO||'|'||X7.COD_CARGO_EFETIVO||'|'||X7.CARGO_EFETIVO||'|'||X7.COD_CARGO_COMISS||'|'||X7.CARGO_COMISSIONADO||'|'||X7.ESPECIALIDADE||'|'||X7.COD_UNIDADE1||'|'||X7.COD_UNIDADE2||'|'||X7.COD_UNIDADE3||'|'||X7.COD_UNIDADE4||'|'||X7.COD_UNIDADE5||'|'||X7.COD_UNIDADE6||'|'||X7.LOTACAO||'|'||X7.DATA_ADMISSAO||'|'||X7.DATA_EFETIVO_EXERC||'|'||X7.DATA_RESCISAO||'|'||X7.JORNADA_MENSAL||'|'||X7.ESCALA||'|'||X7.REMUNERACAO||'|'||G.CODIGO_GRO||'|'||G.DESCRICAO_GRO
AS LINHA
FROM(

SELECT      
--x6.publico_atual, X6.STATUS_SITUACAO_FUNCIONAL ,
x6.CODIGO_EMPRESA   
,x6.tipo_contrato 
,x6.CODIGO_PESSOA ,x6.CODIGO_CONTRATO ,x6.NOME ,x6.NOME_SOCIAL ,x6.DATA_NASCIMENTO ,x6.SEXO ,x6.CPF ,x6.PIS_PASEP_NIT ,x6.IDENTIDADE ,x6.CEP ,x6.TIPO_LOGRADOURO ,x6.CODIGO_SITUACAO_FUNCIONAL ,x6.SITUACAO_FUNCIONAL ,x6.LOGRADOURO ,x6.NUMERO ,x6.COMPLEMENTO ,x6.BAIRRO ,x6.MUNICIPIO ,x6.UF ,x6.VINCULO ,x6.DESCRICAO_VINCULO ,x6.COD_CARGO_EFETIVO ,x6.CARGO_EFETIVO ,x6.COD_CARGO_COMISS ,x6.CARGO_COMISSIONADO ,x6.ESPECIALIDADE ,x6.COD_UNIDADE1 ,x6.COD_UNIDADE2 ,x6.COD_UNIDADE3 ,x6.COD_UNIDADE4 ,x6.COD_UNIDADE5 ,x6.COD_UNIDADE6 ,x6.LOTACAO ,x6.DATA_ADMISSAO ,x6.DATA_EFETIVO_EXERC ,x6.DATA_RESCISAO ,x6.JORNADA_MENSAL ,x6.ESCALA ,x6.REMUNERACAO 
FROM( 
SELECT 
CASE 
WHEN X5.PRE_TRATATIVA = '2-ENVIAR PARA TEG LEVANDO EM CONSIDERAÇÕES OS DEMAIS CAMPOS' AND  X5.PUBLICO_ATUAL  = 'SIM' AND X5.STATUS_SITUACAO_FUNCIONAL = 'PODE_USAR_TEG'  THEN '2.1- CADASTRAR NA METALSOFT' 
WHEN X5.PRE_TRATATIVA = '2-ENVIAR PARA TEG LEVANDO EM CONSIDERAÇÕES OS DEMAIS CAMPOS' AND (X5.PUBLICO_ATUAL <> 'SIM' OR X5.STATUS_SITUACAO_FUNCIONAL <> 'PODE_USAR_TEG') THEN '2.2- NAO CADASTRAR NA METALSOFT' 
WHEN X5.PRE_TRATATIVA = '3.1- AVALIAR POR QUE NÃO LOCALIZADO NO ARTERH'                                                                                         THEN '3.1- TIRAR DO METALSOFT SE NÃO FOR DAS EMPRESAS QUE ESTÃO EM OUTRAS BASES DE DADOS' 
WHEN X5.PRE_TRATATIVA = '3.2- AVALIAR POR QUE NÃO LOCALIZADO NO ARTERH'                                                                                         THEN '3.2- TIRAR DO METALSOFT SE NÃO FOR DAS EMPRESAS QUE ESTÃO EM OUTRAS BASES DE DADOS' 
WHEN X5.PRE_TRATATIVA = '4.1- AVALIAR SE ESTE BMS ESTÃO NOS CENARIOS 3.1 OU 3.2' AND X5.PUBLICO_ATUAL = 'SIM' AND X5.TEM_RESCISAO = 'NAO'                 THEN '4.1- CADASTRAR NA METALSOFT' 
WHEN X5.PRE_TRATATIVA = '4.1- AVALIAR SE ESTE BMS ESTÃO NOS CENARIOS 3.1 OU 3.2' AND (X5.PUBLICO_ATUAL <> 'SIM' OR X5.TEM_RESCISAO <> 'NAO')               THEN '4.1- NAO CADASTRAR NA METALSOFT' 
WHEN X5.PRE_TRATATIVA = '4.2- AVALIAR SE ESTE BMS ESTÃO NOS CENARIOS 3.1 OU 3.2' AND X5.PUBLICO_ATUAL = 'SIM' AND X5.TEM_RESCISAO = 'NAO'                 THEN '4.2- CADASTRAR NA METALSOFT' 
WHEN X5.PRE_TRATATIVA = '4.2- AVALIAR SE ESTE BMS ESTÃO NOS CENARIOS 3.1 OU 3.2' AND (X5.PUBLICO_ATUAL <> 'SIM' OR X5.TEM_RESCISAO <> 'NAO')               THEN '4.2- NAO CADASTRAR NA METALSOFT' 
WHEN X5.PRE_TRATATIVA = '5.1- AVALIAR POR QUE NÃO LOCALIZADO NO ARTERH'       THEN '5.1- TIRAR DO METALSOFT SE NÃO FOR DAS EMPRESAS QUE ESTÃO EM OUTRAS BASES DE DADOS' 
WHEN X5.PRE_TRATATIVA = '9.1- SE ESTIVER NO PUBLICO_ALVO e algum dos campos com prefixo DIFERE igual a SIM atualizar TEG' THEN '9.1- PESSOAS EM AMBAS AS BASES ATIVAS AVALIAR CAMPOS DESATUALIZADOS' 
WHEN X5.PRE_TRATATIVA = '9.2- SE ESTIVER NO PUBLICO_ALVO e algum dos campos com prefixo DIFERE igual a SIM atualizar TEG'  THEN '9.2 - PESSOAS EM AMBAS AS BASES DESLIGADA AVALIAR SE NECESSITA ATUALIZAR CAMPOS' 
ELSE '****************VERIFICAR*******************' 
END TRATATIVA_FINAL, 
X5.PRE_TRATATIVA, X5.CENARIOS, X5.PUBLICO_ATUAL, X5.STATUS_SITUACAO_FUNCIONAL, X5.TEM_RESCISAO, X5.TEM_RESCISAO_ANTERIOR 
, X5.DIFERE_VINCULO, X5.DIFERE_COD_CARGO_EFETIVO, X5.DIFERE_COD_LOCAL, X5.DIFERE_VALOR_VERBA, X5.DIFERE_TEM_RESCISAO, X5.DIA, X5.DIA_ANTERIOR, X5.TIPO, X5.TIPO_ANTERIOR, X5.CODIGO_EMPRESA, X5.TIPO_CONTRATO, X5.VINCULO, X5.CODIGO_CONTRATO, X5.NOME 
, X5.ORDEM_BM, X5.DT_SAIU_ARTE, X5.DT_SAIU_ARTE_ANTERIOR, X5.CODIGO_EMPRESA_DIA, X5.CODIGO_EMPRESA_ANTERIOR, X5.TIPO_CONTRATO_DIA, X5.TIPO_CONTRATO_ANTERIOR, X5.CPF, X5.CPF_ANTERIOR, X5.VINCULO_DIA, X5.VINCULO_ANTERIOR	 
, X5.COD_CARGO_EFETIVO, X5.COD_CARGO_EFETIVO_ANTERIOR, X5.COD_LOCAL, X5.COD_LOCAL_ANTERIOR, X5.VALOR_VERBA, X5.VALOR_VERBA_ANTERIOR, X5.CODIGO_SITUACAO_FUNCIONAL, X5.SITUACAO_FUNCIONAL, X5.DESCRICAO_VINCULO, X5.CARGO_EFETIVO 
, X5.CARGO_COMISSIONADO, X5.ESPECIALIDADE, X5.LOCAL 
,X5.DATA_NASCIMENTO ,X5.SEXO ,X5.PIS_PASEP_NIT ,X5.IDENTIDADE ,X5.COD_UNIDADE1 ,X5.COD_UNIDADE2 ,X5.COD_UNIDADE3 ,X5.COD_UNIDADE4 ,X5.COD_UNIDADE5 ,X5.COD_UNIDADE6 ,X5.DATA_ADMISSAO ,X5.DATA_EFETIVO_EXERC ,X5.DATA_RESCISAO ,X5.COD_CAUSA_RESCISAO ,X5.CAUSA_RESCISAO ,X5.JORNADA_MENSAL ,X5.ESCALA ,X5.E_MAIL ,X5.TELEFONE ,X5.ANO_MES_VERBA 
,X5.CODIGO_PESSOA,X5.NOME_SOCIAL,X5.CEP,X5.TIPO_LOGRADOURO,X5.LOGRADOURO,X5.NUMERO,X5.COMPLEMENTO,X5.BAIRRO,X5.MUNICIPIO,X5.UF,  
X5.VALOR_VERBA REMUNERACAO, X5.LOTACAO, x5.COD_CARGO_COMISS
FROM( 
SELECT  
CASE 
WHEN X4.CENARIOS = '1- COM RESCISAO NO ARTERH E NÃO TEM NA METALSOFT' THEN '1-SOMENTE SE VOLTAR ATIVO NO ARTERH ENVIAR PARA TEG' 
WHEN X4.CENARIOS = '2- TEM NO ARTERH SEM RESCISAO E NÃO TEM NA METALSOFT' THEN '2-ENVIAR PARA TEG LEVANDO EM CONSIDERAÇÕES OS DEMAIS CAMPOS' 
WHEN X4.CENARIOS = '3.1- TEM NA METALSOFT E NAO TEM NO ARTERH com RESCISAO' THEN '3.1- AVALIAR POR QUE NÃO LOCALIZADO NO ARTERH' 
WHEN X4.CENARIOS = '3.2- TEM NA METALSOFT E NAO TEM NO ARTERH sem RESCISAO' THEN '3.2- AVALIAR POR QUE NÃO LOCALIZADO NO ARTERH' 
WHEN X4.CENARIOS = '4.1- SOMENTE ARTERH DUPLICADO POR FALTA DO TIPO_CONTRATO com RESCISAO' THEN '4.1- AVALIAR SE ESTE BMS ESTÃO NOS CENARIOS 3.1 OU 3.2' 
WHEN X4.CENARIOS = '4.2- SOMENTE ARTERH DUPLICADO POR FALTA DO TIPO_CONTRATO sem RESCISAO' THEN '4.2- AVALIAR SE ESTE BMS ESTÃO NOS CENARIOS 3.1 OU 3.2' 
WHEN X4.CENARIOS = '5.1- SOMENTE METALSOFT com RESCISAO' THEN '5.1- AVALIAR POR QUE NÃO LOCALIZADO NO ARTERH' 
WHEN X4.CENARIOS = '5.2- SOMENTE METALSOFT sem RESCISAO' THEN '5.2- AVALIAR POR QUE NÃO LOCALIZADO NO ARTERH' 
WHEN X4.CENARIOS = '9.1-A SER COMPARADO CAMPOS sem RESCISAO' THEN '9.1- SE ESTIVER NO PUBLICO_ALVO e algum dos campos com prefixo DIFERE igual a SIM atualizar TEG' 
WHEN X4.CENARIOS = '9.2-A SER COMPARADO CAMPOS com RESCISAO' THEN '9.2- SE ESTIVER NO PUBLICO_ALVO e algum dos campos com prefixo DIFERE igual a SIM atualizar TEG' 
END PRE_TRATATIVA, 
X4.* FROM( 
SELECT  
CASE 
WHEN X3.DT_SAIU_ARTE_ANTERIOR IS NULL AND X3.DIA = 'ULTIMO' AND X3.TIPO = 'ARTERH' AND X3.TEM_RESCISAO = 'SIM' THEN '1- COM RESCISAO NO ARTERH E NÃO TEM NA METALSOFT' 
WHEN X3.DT_SAIU_ARTE_ANTERIOR IS NULL AND X3.DIA = 'ULTIMO' AND X3.TIPO = 'ARTERH' AND X3.TEM_RESCISAO = 'NAO' THEN '2- TEM NO ARTERH SEM RESCISAO E NÃO TEM NA METALSOFT' 
WHEN X3.DT_SAIU_ARTE_ANTERIOR IS NULL AND X3.DIA = 'PENULTIMO' AND X3.TIPO = 'METALSOFT' AND X3.TEM_RESCISAO = 'SIM' THEN '3.1- TEM NA METALSOFT E NAO TEM NO ARTERH com RESCISAO' 
WHEN X3.DT_SAIU_ARTE_ANTERIOR IS NULL AND X3.DIA = 'PENULTIMO' AND X3.TIPO = 'METALSOFT' AND X3.TEM_RESCISAO = 'NAO' THEN '3.2- TEM NA METALSOFT E NAO TEM NO ARTERH sem RESCISAO' 
WHEN X3.DT_SAIU_ARTE IS NOT NULL AND X3.DT_SAIU_ARTE_ANTERIOR IS NOT NULL AND TRUNC(X3.DT_SAIU_ARTE) = TRUNC(X3.DT_SAIU_ARTE_ANTERIOR)  
AND X3.DIA = 'ULTIMO' AND X3.DIA_ANTERIOR = 'ULTIMO' AND X3.TIPO = 'ARTERH'  AND X3.TIPO_ANTERIOR = 'ARTERH' AND X3.TEM_RESCISAO = 'SIM' THEN '4.1- SOMENTE ARTERH DUPLICADO POR FALTA DO TIPO_CONTRATO com RESCISAO' 
WHEN X3.DT_SAIU_ARTE IS NOT NULL AND X3.DT_SAIU_ARTE_ANTERIOR IS NOT NULL AND TRUNC(X3.DT_SAIU_ARTE) = TRUNC(X3.DT_SAIU_ARTE_ANTERIOR)  
AND X3.DIA = 'ULTIMO' AND X3.DIA_ANTERIOR = 'ULTIMO' AND X3.TIPO = 'ARTERH'  AND X3.TIPO_ANTERIOR = 'ARTERH' AND X3.TEM_RESCISAO = 'NAO' THEN '4.2- SOMENTE ARTERH DUPLICADO POR FALTA DO TIPO_CONTRATO sem RESCISAO' 
WHEN X3.DT_SAIU_ARTE IS NOT NULL AND X3.DT_SAIU_ARTE_ANTERIOR IS NOT NULL AND TRUNC(X3.DT_SAIU_ARTE) = TRUNC(X3.DT_SAIU_ARTE_ANTERIOR)  
AND X3.DIA = 'PENULTIMO' AND X3.DIA_ANTERIOR = 'PENULTIMO' AND X3.TIPO = 'METALSOFT'  AND X3.TIPO_ANTERIOR = 'METALSOFT' AND X3.TEM_RESCISAO = 'SIM' THEN '5.1- SOMENTE METALSOFT com RESCISAO' 
WHEN X3.DT_SAIU_ARTE IS NOT NULL AND X3.DT_SAIU_ARTE_ANTERIOR IS NOT NULL AND TRUNC(X3.DT_SAIU_ARTE) = TRUNC(X3.DT_SAIU_ARTE_ANTERIOR)  
AND X3.DIA = 'PENULTIMO' AND X3.DIA_ANTERIOR = 'PENULTIMO' AND X3.TIPO = 'METALSOFT'  AND X3.TIPO_ANTERIOR = 'METALSOFT' AND X3.TEM_RESCISAO = 'NAO' THEN '5.2- SOMENTE METALSOFT sem RESCISAO' 
WHEN X3.DT_SAIU_ARTE IS NOT NULL AND X3.DT_SAIU_ARTE_ANTERIOR IS NOT NULL AND TRUNC(X3.DT_SAIU_ARTE) <> TRUNC(X3.DT_SAIU_ARTE_ANTERIOR)  
AND X3.DIA = 'ULTIMO' AND X3.DIA_ANTERIOR = 'PENULTIMO' AND X3.TIPO = 'ARTERH'  AND X3.TIPO_ANTERIOR = 'METALSOFT' AND X3.TEM_RESCISAO = 'NAO' THEN '9.1-A SER COMPARADO CAMPOS sem RESCISAO' 
WHEN X3.DT_SAIU_ARTE IS NOT NULL AND X3.DT_SAIU_ARTE_ANTERIOR IS NOT NULL AND TRUNC(X3.DT_SAIU_ARTE) <> TRUNC(X3.DT_SAIU_ARTE_ANTERIOR)  
AND X3.DIA = 'ULTIMO' AND X3.DIA_ANTERIOR = 'PENULTIMO' AND X3.TIPO = 'ARTERH'  AND X3.TIPO_ANTERIOR = 'METALSOFT' AND X3.TEM_RESCISAO = 'SIM' THEN '9.2-A SER COMPARADO CAMPOS com RESCISAO' 
ELSE 'FALTA MAPEAR' 
END CENARIOS, 
CASE WHEN X3.CODIGO_EMPRESA_DIA = X3.CODIGO_EMPRESA_ANTERIOR THEN 'NAO' ELSE 'SIM' END DIFERE_CODIGO_EMPRESA, 
CASE WHEN X3.TIPO_CONTRATO_DIA = X3.TIPO_CONTRATO_ANTERIOR THEN 'NAO' ELSE 'SIM' END DIFERE_TIPO_CONTRATO, 
CASE WHEN X3.VINCULO_DIA = X3.VINCULO_ANTERIOR THEN 'NAO' ELSE 'SIM' END DIFERE_VINCULO, 
CASE WHEN X3.COD_CARGO_EFETIVO = X3.COD_CARGO_EFETIVO_ANTERIOR THEN 'NAO' ELSE 'SIM' END DIFERE_COD_CARGO_EFETIVO, 
CASE WHEN X3.COD_LOCAL = X3.COD_LOCAL_ANTERIOR THEN 'NAO' ELSE 'SIM' END DIFERE_COD_LOCAL, 
CASE WHEN X3.VALOR_VERBA = X3.VALOR_VERBA_ANTERIOR THEN 'NAO' ELSE 'SIM' END DIFERE_VALOR_VERBA, 
CASE WHEN X3.TEM_RESCISAO = X3.TEM_RESCISAO_ANTERIOR THEN 'NAO' ELSE 'SIM' END DIFERE_TEM_RESCISAO, 
X3.* FROM( 
SELECT 
CASE WHEN TEG6.DADO_ORIGEM IS NOT NULL THEN 'SIM' ELSE 'NAO' END PUBLICO_ATUAL, 
X2.CODIGO_EMPRESA, X2.TIPO_CONTRATO,  X2.VINCULO, X2.CODIGO_CONTRATO, X2.NOME 
,Row_Number() Over(Partition BY X2.CODIGO_EMPRESA, X2.TIPO_CONTRATO, X2.CODIGO_CONTRATO Order By X2.CODIGO_EMPRESA, X2.TIPO_CONTRATO, X2.CODIGO_CONTRATO, X2.DIA DESC)ORDEM_BM 
,X2.DT_SAIU_ARTE 
,LEAD(X2.DT_SAIU_ARTE, 1, NULL) Over(Partition BY X2.CODIGO_EMPRESA, X2.TIPO_CONTRATO, X2.CODIGO_CONTRATO Order By X2.CODIGO_EMPRESA, X2.TIPO_CONTRATO, X2.CODIGO_CONTRATO, X2.DIA DESC)DT_SAIU_ARTE_ANTERIOR 
,X2.CODIGO_EMPRESA CODIGO_EMPRESA_DIA 
,LEAD(X2.CODIGO_EMPRESA, 1, NULL) Over(Partition BY X2.CODIGO_EMPRESA, X2.TIPO_CONTRATO, X2.CODIGO_CONTRATO Order By X2.CODIGO_EMPRESA, X2.TIPO_CONTRATO, X2.CODIGO_CONTRATO, X2.DIA DESC)CODIGO_EMPRESA_ANTERIOR 
,X2.TIPO_CONTRATO TIPO_CONTRATO_DIA 
,LEAD(X2.TIPO_CONTRATO, 1, NULL) Over(Partition BY X2.CODIGO_EMPRESA, X2.TIPO_CONTRATO, X2.CODIGO_CONTRATO Order By X2.CODIGO_EMPRESA, X2.TIPO_CONTRATO, X2.CODIGO_CONTRATO, X2.DIA DESC)TIPO_CONTRATO_ANTERIOR 
,X2.DIA 
,LEAD(X2.DIA, 1, NULL) Over(Partition BY X2.CODIGO_EMPRESA, X2.TIPO_CONTRATO, X2.CODIGO_CONTRATO Order By X2.CODIGO_EMPRESA, X2.TIPO_CONTRATO, X2.CODIGO_CONTRATO, X2.DIA DESC)DIA_ANTERIOR 
,X2.TIPO 
,LEAD(X2.TIPO, 1, NULL) Over(Partition BY X2.CODIGO_EMPRESA, X2.TIPO_CONTRATO, X2.CODIGO_CONTRATO Order By X2.CODIGO_EMPRESA, X2.TIPO_CONTRATO, X2.CODIGO_CONTRATO, X2.DIA DESC)TIPO_ANTERIOR 
,X2.CPF 
,LEAD(X2.CPF, 1, NULL) Over(Partition BY X2.CODIGO_EMPRESA, X2.TIPO_CONTRATO, X2.CODIGO_CONTRATO Order By X2.CODIGO_EMPRESA, X2.TIPO_CONTRATO, X2.CODIGO_CONTRATO, X2.DIA DESC)CPF_ANTERIOR 
,X2.VINCULO VINCULO_DIA 
,LEAD(X2.VINCULO, 1, NULL) Over(Partition BY X2.CODIGO_EMPRESA, X2.TIPO_CONTRATO, X2.CODIGO_CONTRATO Order By X2.CODIGO_EMPRESA, X2.TIPO_CONTRATO, X2.CODIGO_CONTRATO, X2.DIA DESC)VINCULO_ANTERIOR 
,X2.COD_CARGO_EFETIVO 
,LEAD(X2.COD_CARGO_EFETIVO, 1, NULL) Over(Partition BY X2.CODIGO_EMPRESA, X2.TIPO_CONTRATO, X2.CODIGO_CONTRATO Order By X2.CODIGO_EMPRESA, X2.TIPO_CONTRATO, X2.CODIGO_CONTRATO, X2.DIA DESC)COD_CARGO_EFETIVO_ANTERIOR 
,X2.COD_LOCAL 
,LEAD(X2.COD_LOCAL, 1, NULL) Over(Partition BY X2.CODIGO_EMPRESA, X2.TIPO_CONTRATO, X2.CODIGO_CONTRATO Order By X2.CODIGO_EMPRESA, X2.TIPO_CONTRATO, X2.CODIGO_CONTRATO, X2.DIA DESC)COD_LOCAL_ANTERIOR 
,X2.VALOR_VERBA 
,LEAD(X2.VALOR_VERBA, 1, NULL) Over(Partition BY X2.CODIGO_EMPRESA, X2.TIPO_CONTRATO, X2.CODIGO_CONTRATO Order By X2.CODIGO_EMPRESA, X2.TIPO_CONTRATO, X2.CODIGO_CONTRATO, X2.DIA DESC)VALOR_VERBA_ANTERIOR 
,X2.TEM_RESCISAO 
,LEAD(X2.TEM_RESCISAO, 1, NULL) Over(Partition BY X2.CODIGO_EMPRESA, X2.TIPO_CONTRATO, X2.CODIGO_CONTRATO Order By X2.CODIGO_EMPRESA, X2.TIPO_CONTRATO, X2.CODIGO_CONTRATO, X2.DIA DESC)TEM_RESCISAO_ANTERIOR 
,CASE WHEN TEG6SF.DADO_ORIGEM IS NOT NULL THEN 'PODE_USAR_TEG' ELSE 'NAO_PODE_USAR_TEG' END STATUS_SITUACAO_FUNCIONAL 
,X2.CODIGO_SITUACAO_FUNCIONAL, X2.SITUACAO_FUNCIONAL, X2.DESCRICAO_VINCULO, X2.CARGO_EFETIVO, X2.CARGO_COMISSIONADO, X2.ESPECIALIDADE, X2.LOTACAO LOCAL 
,X2.DATA_NASCIMENTO ,X2.SEXO ,X2.PIS_PASEP_NIT ,X2.IDENTIDADE ,X2.COD_UNIDADE1 ,X2.COD_UNIDADE2 ,X2.COD_UNIDADE3 ,X2.COD_UNIDADE4 ,X2.COD_UNIDADE5 ,X2.COD_UNIDADE6 ,X2.DATA_ADMISSAO ,X2.DATA_EFETIVO_EXERC ,X2.DATA_RESCISAO ,X2.COD_CAUSA_RESCISAO ,X2.CAUSA_RESCISAO ,X2.JORNADA_MENSAL ,X2.ESCALA ,X2.E_MAIL ,X2.TELEFONE ,X2.ANO_MES_VERBA 
,X2.CODIGO_PESSOA,X2.NOME_SOCIAL,X2.CEP,X2.TIPO_LOGRADOURO,X2.LOGRADOURO,X2.NUMERO,X2.COMPLEMENTO,X2.BAIRRO,X2.MUNICIPIO,X2.UF 
, X2.VALOR_VERBA REMUNERACAO, X2.LOTACAO, x2.COD_CARGO_COMISS
FROM(  
SELECT  
'ULTIMO' DIA,  
U.COD_UNIDADE1||'.'||U.COD_UNIDADE2||'.'||U.COD_UNIDADE3||'.'||U.COD_UNIDADE4||'.'||U.COD_UNIDADE5||'.'||U.COD_UNIDADE6 COD_LOCAL, 
U.*  FROM SUGESP_FOTO_PARA_TEG_HISTORIC U WHERE U.dt_saiu_arte =(SELECT MAX(dt_saiu_arte)FROM SUGESP_FOTO_PARA_TEG_HISTORIC) 
UNION ALL  
SELECT 
'PENULTIMO' DIA,  
P.COD_UNIDADE1||'.'||P.COD_UNIDADE2||'.'||P.COD_UNIDADE3||'.'||P.COD_UNIDADE4||'.'||P.COD_UNIDADE5||'.'||P.COD_UNIDADE6 COD_LOCAL, 
P.* FROM SUGESP_FOTO_PARA_TEG_HISTORIC P WHERE P.dt_saiu_arte =(SELECT X.DT_SAIU_ARTE FROM(SELECT K.DT_SAIU_ARTE,ROWNUM ORDEM_DATA FROM(SELECT Z.*FROM(SELECT x.dt_saiu_arte 
          FROM SUGESP_FOTO_PARA_TEG_HISTORIC x 
          GROUP BY x.dt_saiu_arte 
          ORDER BY x.dt_saiu_arte DESC)Z)K)X 
            WHERE X.ORDEM_DATA = 2) 
)X2  
LEFT OUTER JOIN RHPARM_SIT_FUNC SF ON SF.CODIGO = X2.CODIGO_SITUACAO_FUNCIONAL 
LEFT OUTER JOIN  
(SELECT * FROM RHINTE_ED_IT_CONV WHERE CODIGO_CONVERSAO = 'TEG6' AND DADO_DESTINO ='EMPRESATIPOCONTRATOVINCULO' )TEG6  
ON X2.CODIGO_EMPRESA = SUBSTR(TEG6.DADO_ORIGEM,27,4) AND X2.TIPO_CONTRATO = SUBSTR(TEG6.DADO_ORIGEM,31,4) AND X2.VINCULO = SUBSTR(TEG6.DADO_ORIGEM,35,4)  
LEFT OUTER JOIN   
(SELECT * FROM RHINTE_ED_IT_CONV WHERE CODIGO_CONVERSAO = 'TEG6' AND DADO_DESTINO ='CONTROLE_FOLHAE_AFASTAMENTOSUSPENDE_REMUNERA' )TEG6SF  
ON SF.CONTROLE_FOLHA = SUBSTR(TEG6SF.DADO_ORIGEM,1,1) AND SF.E_AFASTAMENTO = SUBSTR(TEG6SF.DADO_ORIGEM,2,1) AND SF.SUSPENDE_REMUNERA = SUBSTR(TEG6SF.DADO_ORIGEM,3,1)  
ORDER BY X2.CODIGO_EMPRESA, X2.TIPO_CONTRATO, X2.CODIGO_CONTRATO, X2.TIPO DESC 
)X3 
WHERE X3.ORDEM_BM = 1 
)X4  
)X5 
)X6 
where x6.publico_atual = 'SIM'
AND X6.STATUS_SITUACAO_FUNCIONAL = 'PODE_USAR_TEG'                                             
order by x6.codigo_empresa ,x6.tipo_contrato ,x6.codigo_pessoa, x6.codigo_contrato
)X7

/*inicio parte nova GRO em 23/3/23*/
LEFT OUTER JOIN
(
SELECT  X.CODIGO_EMPRESA, X.TIPO_CONTRATO ,X.CODIGO_CONTRATO ,X.ID_AGRUP  ,X.CODIGO_AREA_RISCO CODIGO_GRO ,A.DESCRICAO DESCRICAO_GRO ,X.CODIGO_TP_ATIV ,X.DATA_INI_VIGENCIA ,X.DATA_FIM_VIGENCIA ,A.STATUS ,A.DATA_CRIACAO 
FROM ARTERH.RHSEGU_RES_AREA_CONTR X
LEFT JOIN ARTERH.RHSEGU_AREA_RISCO A ON A.CODIGO = X.CODIGO_AREA_RISCO AND A.codigo_empresa = X.codigo_empresa
WHERE X.DATA_INI_VIGENCIA = (SELECT MAX(AUX.DATA_INI_VIGENCIA) FROM ARTERH.RHSEGU_RES_AREA_CONTR AUX 
                            WHERE X.CODIGO_EMPRESA = AUX.CODIGO_EMPRESA AND X.TIPO_CONTRATO = AUX.TIPO_CONTRATO AND X.CODIGO_CONTRATO = AUX.CODIGO_CONTRATO)
)G ON X7.CODIGO_EMPRESA = G.CODIGO_EMPRESA AND X7.TIPO_CONTRATO = G.TIPO_CONTRATO AND X7.CODIGO_CONTRATO = G.CODIGO_CONTRATO


)LOOP

vCONTADOR :=vCONTADOR+1;
dbms_output.put_line('--vCONTADOR: '||vCONTADOR||' C1.LINHA: '||C1.LINHA);
INSERT INTO ARTERH.SUGESP_AJUSTE_LOTE_CAMPO_HIST (DATA_DADOS, CAMPO_VALOR_1, CONSIDERACOES)VALUES(SYSDATE,'PRR_PUBLICO_TEG_MENSAL',C1.LINHA);COMMIT;

END LOOP;

END;
END;

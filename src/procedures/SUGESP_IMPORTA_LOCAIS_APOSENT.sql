
  CREATE OR REPLACE EDITIONABLE PROCEDURE "ARTERH"."SUGESP_IMPORTA_LOCAIS_APOSENT" AS 

BEGIN 
DECLARE 
QTD_LINHAS_AFETADAS NUMBER;
QTD_LINHAS_ALTERADA NUMBER;
ANALISA_C NUMBER;
ATUALIZA_CAMPOS NUMBER;
COD_AGRUP_NOVO RETORNO_NOVO_CODIGO;
INSERT_LOCAL NUMBER;
vDATA_SISTEMA DATE;

/* FUNÇÃO QUE VERIFICA SE O LOCAL POSSUI A DESCRICAO, DATA DE INICIO E DATA FIM PREENCHIDA */
FUNCTION ANALISA_LOCAL ( vCOD1 IN CHAR, vCOD2 IN CHAR, vCOD3 IN CHAR, vCOD4 IN CHAR, vCOD5 IN CHAR, vCOD6 IN CHAR, vCOD_EMPRESA IN CHAR, vNUMERO_LINHA IN CHAR) RETURN NUMBER IS
VERIFICA NUMBER;
BEGIN --BEGIN1
VERIFICA:=0;

FOR C2 IN (
SELECT FAZER,
  CODIGO_EMPRESA,
  COD_AGRUP1,
  COD_AGRUP2,
  COD_AGRUP3,
  COD_AGRUP4,
  COD_AGRUP5,
  COD_AGRUP6,
  DESCRICAO,
  SUBSTR(ABREVIACAO,1,15) AS ABREVIACAO,
  DATA_CRIACAO,
  DATA_EXCLUSAO,
  DATA_CARGA,
  DATA_PROCESSAMENTO,
  LOGIN_PROCESSAMENTO,
  STATUS_PROCESSAMENTO,
  LOGIN_USUARIO,
  DT_ULT_ALTER_USUA,
  COD_AGRUP1_NOVO,
  NUMERO_LINHA,
  ANALISE,
CASE WHEN DESCRICAO IS NULL AND DATA_CRIACAO IS NOT NULL AND DATA_EXCLUSAO IS NOT NULL THEN 'DESCRICAO EM BRANCO'
       WHEN DESCRICAO IS NULL AND DATA_CRIACAO IS NULL AND DATA_EXCLUSAO IS NOT NULL THEN 'DESCRICAO E DATA DE CRIACAO EM BRANCO'
       WHEN DESCRICAO IS NULL AND DATA_CRIACAO IS NOT NULL AND DATA_EXCLUSAO IS NULL THEN 'DESCRICAO E DATA DE EXCLUSÃO EM BRANCO'
       WHEN DESCRICAO IS NULL AND DATA_CRIACAO IS NULL AND DATA_EXCLUSAO IS NULL THEN 'DESCRICAO, DATA DE CRIACAO, DATA DE EXCLUSÃO EM BRANCO'       
       WHEN DESCRICAO IS NOT NULL AND DATA_CRIACAO IS NULL AND DATA_EXCLUSAO IS NULL THEN 'DATA DE CRIACAO E DATA DE CRIACAO EM BRANCO'
       WHEN DESCRICAO IS NOT NULL AND DATA_CRIACAO IS NULL AND DATA_EXCLUSAO IS NOT NULL THEN 'DATA DE CRIACAO EM BRANCO'
       WHEN DESCRICAO IS NOT NULL AND DATA_CRIACAO IS NOT NULL AND DATA_EXCLUSAO IS NULL THEN 'DATA DE EXCLUSÃO EM BRANCO'
       WHEN DESCRICAO IS NOT NULL AND DATA_CRIACAO IS NOT NULL AND DATA_EXCLUSAO IS NOT NULL THEN 'OS CAMPOS ESTÃO PREENCHIDOS CORRETAMENTE'
END AS ANALISE_CAMPOS
FROM ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT
WHERE DATA_CARGA =
  (SELECT MAX (a.DATA_CARGA)
  FROM ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT a
  WHERE a.COD_AGRUP1   = ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.COD_AGRUP1
  AND a.COD_AGRUP2     = ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.COD_AGRUP2
  AND a.COD_AGRUP3     = ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.COD_AGRUP3
  AND a.COD_AGRUP4     = ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.COD_AGRUP4
  AND a.COD_AGRUP5     = ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.COD_AGRUP5
  AND a.COD_AGRUP6     = ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.COD_AGRUP6
  AND a.codigo_empresa = ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.codigo_empresa
  AND a.NUMERO_LINHA   = ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.NUMERO_LINHA
  )
AND FAZER NOT            IN ('N')
AND CODIGO_EMPRESA        = vCOD_EMPRESA
AND COD_AGRUP1            = vCOD1
AND COD_AGRUP2            = vCOD2
AND COD_AGRUP3            = vCOD3
AND COD_AGRUP4            = vCOD4
AND COD_AGRUP5            = vCOD5
AND COD_AGRUP6            = vCOD6
AND NUMERO_LINHA          = vNUMERO_LINHA
AND STATUS_PROCESSAMENTO IS NULL
AND DATA_PROCESSAMENTO   IS NULL
ORDER BY CODIGO_EMPRESA,
  COD_AGRUP1,
  COD_AGRUP2,
  COD_AGRUP3,
  COD_AGRUP4,
  COD_AGRUP5,
  COD_AGRUP6,
  NUMERO_LINHA

) LOOP

IF C2.ANALISE_CAMPOS = 'DESCRICAO EM BRANCO' THEN 
VERIFICA:= 0;

UPDATE ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT SET ANALISE = ''||C2.ANALISE_CAMPOS||'', DATA_PROCESSAMENTO = SYSDATE, LOGIN_PROCESSAMENTO = 'LOGIN', STATUS_PROCESSAMENTO = 'N'
WHERE CODIGO_EMPRESA = ''||C2.CODIGO_EMPRESA||'' AND COD_AGRUP1 = ''||C2.COD_AGRUP1||'' AND COD_AGRUP2 = ''||C2.COD_AGRUP2||'' AND COD_AGRUP3 = ''||C2.COD_AGRUP3||'' AND COD_AGRUP4 = ''||C2.COD_AGRUP4||'' AND COD_AGRUP5 = ''||C2.COD_AGRUP5||''
AND COD_AGRUP6 = ''||C2.COD_AGRUP6||'' AND NUMERO_LINHA = ''||C2.NUMERO_LINHA||'' AND TRUNC(DATA_CARGA) = ''||TRUNC(C2.DATA_CARGA)||'' AND DATA_PROCESSAMENTO IS NULL AND STATUS_PROCESSAMENTO IS NULL ; COMMIT WORK;

END IF;


IF C2.ANALISE_CAMPOS = 'DESCRICAO E DATA DE CRIACAO EM BRANCO' THEN 
VERIFICA:= 0;

UPDATE ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT SET ANALISE = ''||C2.ANALISE_CAMPOS||'', DATA_PROCESSAMENTO = SYSDATE, LOGIN_PROCESSAMENTO = 'LOGIN', STATUS_PROCESSAMENTO = 'N'
WHERE CODIGO_EMPRESA = ''||C2.CODIGO_EMPRESA||'' AND COD_AGRUP1 = ''||C2.COD_AGRUP1||'' AND COD_AGRUP2 = ''||C2.COD_AGRUP2||'' AND COD_AGRUP3 = ''||C2.COD_AGRUP3||'' AND COD_AGRUP4 = ''||C2.COD_AGRUP4||'' AND COD_AGRUP5 = ''||C2.COD_AGRUP5||''
AND COD_AGRUP6 = ''||C2.COD_AGRUP6||'' AND NUMERO_LINHA = ''||C2.NUMERO_LINHA||'' AND TRUNC(DATA_CARGA) = ''||TRUNC(C2.DATA_CARGA)||'' AND DATA_PROCESSAMENTO IS NULL AND STATUS_PROCESSAMENTO IS NULL ; COMMIT WORK;

END IF;

IF C2.ANALISE_CAMPOS = 'DESCRICAO E DATA DE EXCLUSÃO EM BRANCO' THEN 
VERIFICA:= 0;

UPDATE ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT SET ANALISE = ''||C2.ANALISE_CAMPOS||'', DATA_PROCESSAMENTO = SYSDATE, LOGIN_PROCESSAMENTO = 'LOGIN', STATUS_PROCESSAMENTO = 'N'
WHERE CODIGO_EMPRESA = ''||C2.CODIGO_EMPRESA||'' AND COD_AGRUP1 = ''||C2.COD_AGRUP1||'' AND COD_AGRUP2 = ''||C2.COD_AGRUP2||'' AND COD_AGRUP3 = ''||C2.COD_AGRUP3||'' AND COD_AGRUP4 = ''||C2.COD_AGRUP4||'' AND COD_AGRUP5 = ''||C2.COD_AGRUP5||''
AND COD_AGRUP6 = ''||C2.COD_AGRUP6||'' AND NUMERO_LINHA = ''||C2.NUMERO_LINHA||'' AND TRUNC(DATA_CARGA) = ''||TRUNC(C2.DATA_CARGA)||'' AND DATA_PROCESSAMENTO IS NULL AND STATUS_PROCESSAMENTO IS NULL ; COMMIT WORK;

END IF;

IF C2.ANALISE_CAMPOS = 'DESCRICAO, DATA DE CRIACAO, DATA DE EXCLUSÃO EM BRANCO' THEN 
VERIFICA:= 0;

UPDATE ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT SET ANALISE = ''||C2.ANALISE_CAMPOS||'', DATA_PROCESSAMENTO = SYSDATE, LOGIN_PROCESSAMENTO = 'LOGIN', STATUS_PROCESSAMENTO = 'N'
WHERE CODIGO_EMPRESA = ''||C2.CODIGO_EMPRESA||'' AND COD_AGRUP1 = ''||C2.COD_AGRUP1||'' AND COD_AGRUP2 = ''||C2.COD_AGRUP2||'' AND COD_AGRUP3 = ''||C2.COD_AGRUP3||'' AND COD_AGRUP4 = ''||C2.COD_AGRUP4||'' AND COD_AGRUP5 = ''||C2.COD_AGRUP5||''
AND COD_AGRUP6 = ''||C2.COD_AGRUP6||'' AND NUMERO_LINHA = ''||C2.NUMERO_LINHA||'' AND TRUNC(DATA_CARGA) = ''||TRUNC(C2.DATA_CARGA)||'' AND DATA_PROCESSAMENTO IS NULL AND STATUS_PROCESSAMENTO IS NULL ; COMMIT WORK;

END IF;

IF C2.ANALISE_CAMPOS = 'DATA DE CRIACAO E DATA DE CRIACAO EM BRANCO' THEN 
VERIFICA:= 0;

UPDATE ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT SET ANALISE = ''||C2.ANALISE_CAMPOS||'', DATA_PROCESSAMENTO = SYSDATE, LOGIN_PROCESSAMENTO = 'LOGIN', STATUS_PROCESSAMENTO = 'N'
WHERE CODIGO_EMPRESA = ''||C2.CODIGO_EMPRESA||'' AND COD_AGRUP1 = ''||C2.COD_AGRUP1||'' AND COD_AGRUP2 = ''||C2.COD_AGRUP2||'' AND COD_AGRUP3 = ''||C2.COD_AGRUP3||'' AND COD_AGRUP4 = ''||C2.COD_AGRUP4||'' AND COD_AGRUP5 = ''||C2.COD_AGRUP5||''
AND COD_AGRUP6 = ''||C2.COD_AGRUP6||'' AND NUMERO_LINHA = ''||C2.NUMERO_LINHA||'' AND TRUNC(DATA_CARGA) = ''||TRUNC(C2.DATA_CARGA)||'' AND DATA_PROCESSAMENTO IS NULL AND STATUS_PROCESSAMENTO IS NULL ; COMMIT WORK;

END IF;

IF C2.ANALISE_CAMPOS = 'DATA DE CRIACAO EM BRANCO' THEN 
VERIFICA:= 0;

UPDATE ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT SET ANALISE = ''||C2.ANALISE_CAMPOS||'', DATA_PROCESSAMENTO = SYSDATE, LOGIN_PROCESSAMENTO = 'LOGIN', STATUS_PROCESSAMENTO = 'N'
WHERE CODIGO_EMPRESA = ''||C2.CODIGO_EMPRESA||'' AND COD_AGRUP1 = ''||C2.COD_AGRUP1||'' AND COD_AGRUP2 = ''||C2.COD_AGRUP2||'' AND COD_AGRUP3 = ''||C2.COD_AGRUP3||'' AND COD_AGRUP4 = ''||C2.COD_AGRUP4||'' AND COD_AGRUP5 = ''||C2.COD_AGRUP5||''
AND COD_AGRUP6 = ''||C2.COD_AGRUP6||'' AND NUMERO_LINHA = ''||C2.NUMERO_LINHA||'' AND TRUNC(DATA_CARGA) = ''||TRUNC(C2.DATA_CARGA)||'' AND DATA_PROCESSAMENTO IS NULL AND STATUS_PROCESSAMENTO IS NULL ; COMMIT WORK;

END IF;

IF C2.ANALISE_CAMPOS = 'DATA DE EXCLUSÃO EM BRANCO' THEN 
VERIFICA:= 0;

UPDATE ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT SET ANALISE = ''||C2.ANALISE_CAMPOS||'', DATA_PROCESSAMENTO = SYSDATE, LOGIN_PROCESSAMENTO = 'LOGIN', STATUS_PROCESSAMENTO = 'N'
WHERE CODIGO_EMPRESA = ''||C2.CODIGO_EMPRESA||'' AND COD_AGRUP1 = ''||C2.COD_AGRUP1||'' AND COD_AGRUP2 = ''||C2.COD_AGRUP2||'' AND COD_AGRUP3 = ''||C2.COD_AGRUP3||'' AND COD_AGRUP4 = ''||C2.COD_AGRUP4||'' AND COD_AGRUP5 = ''||C2.COD_AGRUP5||''
AND COD_AGRUP6 = ''||C2.COD_AGRUP6||'' AND NUMERO_LINHA = ''||C2.NUMERO_LINHA||'' AND TRUNC(DATA_CARGA) = trunc(C2.DATA_CARGA) AND DATA_PROCESSAMENTO IS NULL AND STATUS_PROCESSAMENTO IS NULL ; COMMIT WORK;

END IF;  

IF C2.ANALISE_CAMPOS = 'OS CAMPOS ESTÃO PREENCHIDOS CORRETAMENTE' THEN 
VERIFICA:= 1;

UPDATE ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT SET ANALISE = ''||C2.ANALISE_CAMPOS||''
WHERE CODIGO_EMPRESA = ''||C2.CODIGO_EMPRESA||'' AND COD_AGRUP1 = ''||C2.COD_AGRUP1||'' AND COD_AGRUP2 = ''||C2.COD_AGRUP2||'' AND COD_AGRUP3 = ''||C2.COD_AGRUP3||'' AND COD_AGRUP4 = ''||C2.COD_AGRUP4||'' AND COD_AGRUP5 = ''||C2.COD_AGRUP5||''
AND COD_AGRUP6 = ''||C2.COD_AGRUP6||'' AND NUMERO_LINHA = ''||C2.NUMERO_LINHA||'' AND TRUNC(DATA_CARGA) = trunc(C2.DATA_CARGA) AND DATA_PROCESSAMENTO IS NULL AND STATUS_PROCESSAMENTO IS NULL ; COMMIT WORK;

END IF;

END LOOP;

RETURN VERIFICA; /*SE RETORNAR IGUAL A 0 (ZERO) INDICA QUE O DADO ESTA ERRADO, SEJA FALTANDO A DATA INICIO OU FIM OU DESCRIÇÃO, RETORNANDO IGUAL 1 (UM) O DADO ESTA CORRETO */

END; /*FIM FUNÇÃO*/

/* FUNÇÃO CRIADA PARA CRIAR O NOVO CODIGO DO LOCAL DE ACORDO COM A REGRA PASSADA PELA GEVIF, ONDE SERÁ ALTERADO OS NUMEROS A ESQUERDA */
FUNCTION CRIACAO_COD ( vCOD1 IN CHAR, vCOD2 IN CHAR, vCOD3 IN CHAR, vCOD4 IN CHAR, vCOD5 IN CHAR, vCOD6 IN CHAR, vCOD_EMPRESA IN CHAR, vNUMERO_LINHA NUMBER, vDATA_CARGA DATE) RETURN RETORNO_NOVO_CODIGO IS
RECUP_COD RETORNO_NOVO_CODIGO;
BEGIN 
RECUP_COD := RETORNO_NOVO_CODIGO(NULL,0);
FOR C3 IN (
SELECT LPAD(X.AGRUP1_NOVO,6,0) AS COD_NOVO FROM (
SELECT ROW_NUMBER () OVER (PARTITION BY COD_AGRUP1 ORDER BY COD_AGRUP1)||SUBSTR(COD_AGRUP1,5,2) AGRUP1_NOVO 
FROM ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT
WHERE  FAZER NOT            IN ('N')
AND ANALISE              = 'OS CAMPOS ESTÃO PREENCHIDOS CORRETAMENTE'
AND CODIGO_EMPRESA = vCOD_EMPRESA
AND COD_AGRUP1 = vCOD1
GROUP BY COD_AGRUP1, COD_AGRUP1_NOVO
) X

) LOOP

IF C3.COD_NOVO IS NOT NULL THEN 
RECUP_COD.REC_COD := 1;
RECUP_COD.NOVO_COD := C3.COD_NOVO;

UPDATE ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT SET COD_AGRUP1_NOVO = ''||C3.COD_NOVO||'' 
WHERE CODIGO_EMPRESA = ''||vCOD_EMPRESA||'' AND COD_AGRUP1 = ''||vCOD1||'' AND COD_AGRUP2 = ''||vCOD2||'' AND COD_AGRUP3 = ''||vCOD3||'' AND COD_AGRUP4 = ''||vCOD4||'' AND COD_AGRUP5 = ''||vCOD5||''
AND COD_AGRUP6 = ''||vCOD6||'' AND NUMERO_LINHA = ''||vNUMERO_LINHA||'' AND TRUNC(DATA_CARGA) = ''||TRUNC(vDATA_CARGA)||'' AND DATA_PROCESSAMENTO IS NULL AND STATUS_PROCESSAMENTO IS NULL;
COMMIT WORK;
END IF;

IF C3.COD_NOVO IS NULL THEN 
RECUP_COD.REC_COD := 0;
END IF;

END LOOP;

RETURN RECUP_COD; /*SE RETORNAR IGUAL A 0 (ZERO) INDICA QUE O DADO ESTA ERRADO RETORNANDO IGUAL 1 (UM) O DADO ESTA CORRETO E FOI CRIADO O CODIGO 1 */
END;

/* FUNÇÃO QUE REALIZADA A INSERÇÃO NAS TABELAS INDIVIDUAIS E HISTORICA NO ARTERH */
FUNCTION INSERT_INDIVIDUAL ( vCOD1 IN CHAR, vCOD2 IN CHAR, vCOD3 IN CHAR, vCOD4 IN CHAR, vCOD5 IN CHAR, vCOD6 IN CHAR, vCOD_EMPRESA IN CHAR, vNUMERO_LINHA NUMBER, vDATA_CARGA DATE) RETURN NUMBER IS
REC_INSERT NUMBER;
INFO_AGRUPADOR_H RHORGA_AGRUPADOR_H%ROWTYPE;
INFO_UNIDADE RHORGA_UNIDADE%ROWTYPE;
INFO_LOTACAO RHORGA_LOTACAO%ROWTYPE;
INFO_CONTABIL RHORGA_CUSTO_CONT%ROWTYPE;
INFO_GERENCIAL RHORGA_CUSTO_GEREN%ROWTYPE;


BEGIN 
REC_INSERT := 0;
FOR C4 IN (
SELECT L.COD_AGRUP1_NOVO,
  G.*
FROM ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT L,
  RHORGA_AGRUPADOR G
WHERE L.CODIGO_EMPRESA      = G.CODIGO_EMPRESA
AND L.COD_AGRUP1_NOVO       = G.COD_AGRUP1
AND L.COD_AGRUP2            = G.COD_AGRUP2
AND L.COD_AGRUP3            = G.COD_AGRUP3
AND L.COD_AGRUP4            = G.COD_AGRUP4
AND L.COD_AGRUP5            = G.COD_AGRUP5
AND L.COD_AGRUP6            = G.COD_AGRUP6
AND G.TIPO_AGRUP           IN ('L','U','C','G')
AND L.STATUS_PROCESSAMENTO IS NULL
AND L.DATA_PROCESSAMENTO   IS NULL
AND L.CODIGO_EMPRESA        = vCOD_EMPRESA
AND L.COD_AGRUP1_NOVO       = vCOD1
AND L.COD_AGRUP2            = vCOD2
AND L.COD_AGRUP3            = vCOD3
AND L.COD_AGRUP4            = vCOD4
AND L.COD_AGRUP5            = vCOD5
AND L.COD_AGRUP6            = vCOD6
AND L.NUMERO_LINHA          = vNUMERO_LINHA
AND TRUNC(L.DATA_CARGA)     = TRUNC(vDATA_CARGA)
ORDER BY G.CODIGO_EMPRESA,
  G.COD_AGRUP1,
  G.COD_AGRUP2,
  G.COD_AGRUP3,
  G.COD_AGRUP4,
  G.COD_AGRUP5,
  G.COD_AGRUP6
) LOOP
QTD_LINHAS_AFETADAS:=0;

/*INSERÇÃO NA TABELA DE RHORGA_LOTACAO DE ACORDO COM O TIPO AGRUP L DA RHORGA_AGRUPADOR */
IF C4.TIPO_AGRUP = 'L' THEN

INFO_LOTACAO.COD_LOTACAO1 := VCOD1;
INFO_LOTACAO.COD_LOTACAO2 := VCOD2;
INFO_LOTACAO.COD_LOTACAO3:= VCOD3;
INFO_LOTACAO.COD_LOTACAO4 := VCOD4;
INFO_LOTACAO.COD_LOTACAO5 := VCOD5;
INFO_LOTACAO.COD_LOTACAO6 := VCOD6;
INFO_LOTACAO.CODIGO_EMPRESA := VCOD_EMPRESA;
INFO_LOTACAO.DESCRICAO := C4.DESCRICAO;
INFO_LOTACAO.ABREVIACAO := SUBSTR(C4.ABREVIACAO,1,15);
INFO_LOTACAO.DATA_IMPLANT := C4.DATA_IMPLANT;
INFO_LOTACAO.DATA_EXTINCAO := C4.DATA_EXTINCAO;
INFO_LOTACAO.LOGIN_USUARIO := 'IMPORT_PROJ_APOSENT';
INFO_LOTACAO.DT_ULT_ALTER_USUA := SYSDATE;
INFO_LOTACAO.C_LIVRE_DESCR07 := C4.C_LIVRE_DESCR07;
INFO_LOTACAO.C_LIVRE_DATA16 :=  C4.C_LIVRE_DATA16;
INFO_LOTACAO.CGC :=  C4.CGC;
INFO_LOTACAO.MOTIVO_EXTINCAO :=  C4.MOTIVO_EXTINCAO;
INFO_LOTACAO.DATA_IMPLANT :=  C4.DATA_IMPLANT;
INFO_LOTACAO.TEXTO_ASSOCIADO :=  C4.TEXTO_ASSOCIADO;
INFO_LOTACAO.ID_AGRUP :=  C4.ID_AGRUP;
INFO_LOTACAO.CGC_CONSOL :=  C4.CGC_CONSOL;
INFO_LOTACAO.RAZAO_SOCIAL :=  C4.RAZAO_SOCIAL;
INFO_LOTACAO.NATUREZA_ESTAB :=  C4.NATUREZA_ESTAB;
INFO_LOTACAO.COD_CALENDARIO :=  C4.COD_CALENDARIO;
INFO_LOTACAO.CEI_VALIDO :=  C4.CEI_VALIDO;
INFO_LOTACAO.EMPRESA_PEQ_PORTE :=  C4.EMPRESA_PEQ_PORTE;
INFO_LOTACAO.MICROEMPRESA :=  C4.MICROEMPRESA;
INFO_LOTACAO.PARTICIPA_PAT :=  C4.PARTICIPA_PAT;
INFO_LOTACAO.ENTE_FED_RESP_ESOCIAL :=  C4.ENTE_FED_RESP_ESOCIAL;
INFO_LOTACAO.TP_INSC_CONTRA_ESOCIAL :=  C4.TP_INSC_CONTRA_ESOCIAL;
INFO_LOTACAO.COD_LOTACAO_SUP1 := C4.COD_AGRUP_SUP1;
INFO_LOTACAO.COD_LOTACAO_SUP2 := C4.COD_AGRUP_SUP2;
INFO_LOTACAO.COD_LOTACAO_SUP3 := C4.COD_AGRUP_SUP3;
INFO_LOTACAO.COD_LOTACAO_SUP4 := C4.COD_AGRUP_SUP4;
INFO_LOTACAO.COD_LOTACAO_SUP5 := C4.COD_AGRUP_SUP5;
INFO_LOTACAO.COD_LOTACAO_SUP6 := C4.COD_AGRUP_SUP6;

INSERT INTO RHORGA_LOTACAO VALUES INFO_LOTACAO;
QTD_LINHAS_AFETADAS:=SQL%ROWCOUNT;
COMMIT WORK;
REC_INSERT := 1;
END IF;

/*INSERÇÃO NA TABELA DE RHORGA_UNIDADE DE ACORDO COM O TIPO AGRUP U DA RHORGA_AGRUPADOR */
IF C4.TIPO_AGRUP = 'U' THEN

INFO_UNIDADE.COD_UNIDADE1 := vCOD1;
INFO_UNIDADE.COD_UNIDADE2 := vCOD2;
INFO_UNIDADE.COD_UNIDADE3 := vCOD3;
INFO_UNIDADE.COD_UNIDADE4 := vCOD4;
INFO_UNIDADE.COD_UNIDADE5 := vCOD5;
INFO_UNIDADE.COD_UNIDADE6 := vCOD6;
INFO_UNIDADE.CODIGO_EMPRESA := vCOD_EMPRESA;
INFO_UNIDADE.DESCRICAO := C4.DESCRICAO;
INFO_UNIDADE.ABREVIACAO := SUBSTR(C4.ABREVIACAO,1,15);
INFO_UNIDADE.DATA_IMPLANT := C4.DATA_IMPLANT;
INFO_UNIDADE.DATA_EXTINCAO := C4.DATA_EXTINCAO;
INFO_UNIDADE.LOGIN_USUARIO := 'IMPORT_PROJ_APOSENT';
INFO_UNIDADE.DT_ULT_ALTER_USUA := SYSDATE;
INFO_UNIDADE.C_LIVRE_DESCR07 := C4.C_LIVRE_DESCR07;
INFO_UNIDADE.C_LIVRE_DATA16 :=  C4.C_LIVRE_DATA16;
INFO_UNIDADE.CGC :=  C4.CGC;
INFO_UNIDADE.MOTIVO_EXTINCAO :=  C4.MOTIVO_EXTINCAO;
INFO_UNIDADE.DATA_IMPLANT :=  C4.DATA_IMPLANT;
INFO_UNIDADE.TEXTO_ASSOCIADO :=  C4.TEXTO_ASSOCIADO;
INFO_UNIDADE.ID_AGRUP :=  C4.ID_AGRUP;
INFO_UNIDADE.CGC_CONSOL :=  C4.CGC_CONSOL;
INFO_UNIDADE.RAZAO_SOCIAL :=  C4.RAZAO_SOCIAL;
INFO_UNIDADE.NATUREZA_ESTAB :=  C4.NATUREZA_ESTAB;
INFO_UNIDADE.COD_CALENDARIO :=  C4.COD_CALENDARIO;
INFO_UNIDADE.CEI_VALIDO :=  C4.CEI_VALIDO;
INFO_UNIDADE.EMPRESA_PEQ_PORTE :=  C4.EMPRESA_PEQ_PORTE;
INFO_UNIDADE.MICROEMPRESA :=  C4.MICROEMPRESA;
INFO_UNIDADE.PARTICIPA_PAT :=  C4.PARTICIPA_PAT;
INFO_UNIDADE.ENTE_FED_RESP_ESOCIAL :=  C4.ENTE_FED_RESP_ESOCIAL;
INFO_UNIDADE.TP_INSC_CONTRA_ESOCIAL :=  C4.TP_INSC_CONTRA_ESOCIAL;
INFO_UNIDADE.COD_UNIDADE_SUP1 := C4.COD_AGRUP_SUP1;
INFO_UNIDADE.COD_UNIDADE_SUP2 := C4.COD_AGRUP_SUP2;
INFO_UNIDADE.COD_UNIDADE_SUP3 := C4.COD_AGRUP_SUP3;
INFO_UNIDADE.COD_UNIDADE_SUP4 := C4.COD_AGRUP_SUP4;
INFO_UNIDADE.COD_UNIDADE_SUP5 := C4.COD_AGRUP_SUP4;
INFO_UNIDADE.COD_UNIDADE_SUP6 := C4.COD_AGRUP_SUP6;

INSERT INTO RHORGA_UNIDADE VALUES INFO_UNIDADE;
QTD_LINHAS_AFETADAS:=SQL%ROWCOUNT;
COMMIT WORK;
REC_INSERT := 1;
END IF;

/*INSERÇÃO NA TABELA DE RHORGA_CUSTO_CONT DE ACORDO COM O TIPO AGRUP C DA RHORGA_AGRUPADOR */
IF C4.TIPO_AGRUP = 'C' THEN

INFO_CONTABIL.COD_CCONTAB1 := vCOD1;
INFO_CONTABIL.COD_CCONTAB2 := vCOD2;
INFO_CONTABIL.COD_CCONTAB3 := vCOD3;
INFO_CONTABIL.COD_CCONTAB4 := vCOD4;
INFO_CONTABIL.COD_CCONTAB5 := vCOD5;
INFO_CONTABIL.COD_CCONTAB6 := vCOD6;
INFO_CONTABIL.CODIGO_EMPRESA := vCOD_EMPRESA;
INFO_CONTABIL.DESCRICAO := C4.DESCRICAO;
INFO_CONTABIL.ABREVIACAO := SUBSTR(C4.ABREVIACAO,1,15);
INFO_CONTABIL.DATA_IMPLANT := C4.DATA_IMPLANT;
INFO_CONTABIL.DATA_EXTINCAO := C4.DATA_EXTINCAO;
INFO_CONTABIL.LOGIN_USUARIO := 'IMPORT_PROJ_APOSENT';
INFO_CONTABIL.DT_ULT_ALTER_USUA := SYSDATE;
INFO_CONTABIL.C_LIVRE_DESCR07 := C4.C_LIVRE_DESCR07;
INFO_CONTABIL.C_LIVRE_DATA16 :=  C4.C_LIVRE_DATA16;
INFO_CONTABIL.CGC :=  C4.CGC;
INFO_CONTABIL.MOTIVO_EXTINCAO :=  C4.MOTIVO_EXTINCAO;
INFO_CONTABIL.DATA_IMPLANT :=  C4.DATA_IMPLANT;
INFO_CONTABIL.TEXTO_ASSOCIADO :=  C4.TEXTO_ASSOCIADO;
INFO_CONTABIL.ID_AGRUP :=  C4.ID_AGRUP;
INFO_CONTABIL.CGC_CONSOL :=  C4.CGC_CONSOL;
INFO_CONTABIL.RAZAO_SOCIAL :=  C4.RAZAO_SOCIAL;
INFO_CONTABIL.NATUREZA_ESTAB :=  C4.NATUREZA_ESTAB;
INFO_CONTABIL.COD_CALENDARIO :=  C4.COD_CALENDARIO;
INFO_CONTABIL.CEI_VALIDO :=  C4.CEI_VALIDO;
INFO_CONTABIL.EMPRESA_PEQ_PORTE :=  C4.EMPRESA_PEQ_PORTE;
INFO_CONTABIL.MICROEMPRESA :=  C4.MICROEMPRESA;
INFO_CONTABIL.PARTICIPA_PAT :=  C4.PARTICIPA_PAT;
INFO_CONTABIL.ENTE_FED_RESP_ESOCIAL :=  C4.ENTE_FED_RESP_ESOCIAL;
INFO_CONTABIL.TP_INSC_CONTRA_ESOCIAL :=  C4.TP_INSC_CONTRA_ESOCIAL;
INFO_CONTABIL.COD_CCONTAB_SUP1 := C4.COD_AGRUP_SUP1;
INFO_CONTABIL.COD_CCONTAB_SUP2 := C4.COD_AGRUP_SUP2;
INFO_CONTABIL.COD_CCONTAB_SUP3 := C4.COD_AGRUP_SUP3;
INFO_CONTABIL.COD_CCONTAB_SUP4 := C4.COD_AGRUP_SUP4;
INFO_CONTABIL.COD_CCONTAB_SUP5 := C4.COD_AGRUP_SUP5;
INFO_CONTABIL.COD_CCONTAB_SUP6 := C4.COD_AGRUP_SUP6;

INSERT INTO RHORGA_CUSTO_CONT VALUES INFO_CONTABIL;
QTD_LINHAS_AFETADAS:=SQL%ROWCOUNT;
COMMIT WORK;

REC_INSERT := 1;
END IF;

/*INSERÇÃO NA TABELA DE RHORGA_CUSTO_GEREN DE ACORDO COM O TIPO AGRUP G DA RHORGA_AGRUPADOR */
IF C4.TIPO_AGRUP = 'G' THEN

INFO_GERENCIAL.COD_CGERENC1 := vCOD1;
INFO_GERENCIAL.COD_CGERENC2 := vCOD2;
INFO_GERENCIAL.COD_CGERENC3 := vCOD3;
INFO_GERENCIAL.COD_CGERENC4 := vCOD4;
INFO_GERENCIAL.COD_CGERENC5 := vCOD5;
INFO_GERENCIAL.COD_CGERENC6 := vCOD6;
INFO_GERENCIAL.CODIGO_EMPRESA := vCOD_EMPRESA;
INFO_GERENCIAL.DESCRICAO := C4.DESCRICAO;
INFO_GERENCIAL.ABREVIACAO := SUBSTR(C4.ABREVIACAO,1,15);
INFO_GERENCIAL.DATA_IMPLANT := C4.DATA_IMPLANT;
INFO_GERENCIAL.DATA_EXTINCAO := C4.DATA_EXTINCAO;
INFO_GERENCIAL.LOGIN_USUARIO := 'IMPORT_PROJ_APOSENT';
INFO_GERENCIAL.DT_ULT_ALTER_USUA := SYSDATE;
INFO_GERENCIAL.C_LIVRE_DESCR07 := C4.C_LIVRE_DESCR07;
INFO_GERENCIAL.C_LIVRE_DATA16 :=  C4.C_LIVRE_DATA16;
INFO_GERENCIAL.CGC :=  C4.CGC;
INFO_GERENCIAL.MOTIVO_EXTINCAO :=  C4.MOTIVO_EXTINCAO;
INFO_GERENCIAL.DATA_IMPLANT :=  C4.DATA_IMPLANT;
INFO_GERENCIAL.TEXTO_ASSOCIADO :=  C4.TEXTO_ASSOCIADO;
INFO_GERENCIAL.ID_AGRUP :=  C4.ID_AGRUP;
INFO_GERENCIAL.CGC_CONSOL :=  C4.CGC_CONSOL;
INFO_GERENCIAL.RAZAO_SOCIAL :=  C4.RAZAO_SOCIAL;
INFO_GERENCIAL.NATUREZA_ESTAB :=  C4.NATUREZA_ESTAB;
INFO_GERENCIAL.COD_CALENDARIO :=  C4.COD_CALENDARIO;
INFO_GERENCIAL.CEI_VALIDO :=  C4.CEI_VALIDO;
INFO_GERENCIAL.EMPRESA_PEQ_PORTE :=  C4.EMPRESA_PEQ_PORTE;
INFO_GERENCIAL.MICROEMPRESA :=  C4.MICROEMPRESA;
INFO_GERENCIAL.PARTICIPA_PAT :=  C4.PARTICIPA_PAT;
INFO_GERENCIAL.ENTE_FED_RESP_ESOCIAL :=  C4.ENTE_FED_RESP_ESOCIAL;
INFO_GERENCIAL.TP_INSC_CONTRA_ESOCIAL :=  C4.TP_INSC_CONTRA_ESOCIAL;
INFO_GERENCIAL.COD_CGERENC_SUP1 := C4.COD_AGRUP_SUP1;
INFO_GERENCIAL.COD_CGERENC_SUP2 := C4.COD_AGRUP_SUP2;
INFO_GERENCIAL.COD_CGERENC_SUP3 := C4.COD_AGRUP_SUP3;
INFO_GERENCIAL.COD_CGERENC_SUP4 := C4.COD_AGRUP_SUP4;
INFO_GERENCIAL.COD_CGERENC_SUP5 := C4.COD_AGRUP_SUP5;
INFO_GERENCIAL.COD_CGERENC_SUP6 := C4.COD_AGRUP_SUP6;

INSERT INTO RHORGA_CUSTO_GEREN VALUES INFO_GERENCIAL;
QTD_LINHAS_AFETADAS:=SQL%ROWCOUNT;
COMMIT WORK;
REC_INSERT := 1;
END IF;

END LOOP;

BEGIN
SELECT DATA_DO_SISTEMA INTO vDATA_SISTEMA FROM RHPARM_P_SIST;
FOR C5 IN (
SELECT N.*,
  G.TIPO_AGRUP,
  G.ID_AGRUP
FROM ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT N,
  RHORGA_AGRUPADOR G
WHERE NOT EXISTS
  (SELECT H.*
  FROM RHORGA_AGRUPADOR_H H
  WHERE H.TIPO_AGRUP      IN ('L','U','C','G')
  AND H.ANO_MES_REFERENCIA =
    (SELECT MAX (A.ANO_MES_REFERENCIA)
    FROM RHORGA_AGRUPADOR_H A
    WHERE A.COD_AGRUP1   = H.COD_AGRUP1
    AND A.COD_AGRUP2     = H.COD_AGRUP2
    AND A.COD_AGRUP3     = H.COD_AGRUP3
    AND A.COD_AGRUP4     = H.COD_AGRUP4
    AND A.COD_AGRUP5     = H.COD_AGRUP5
    AND A.COD_AGRUP6     = H.COD_AGRUP6
    AND A.CODIGO_EMPRESA = H.CODIGO_EMPRESA
    AND A.TIPO_AGRUP     = A.TIPO_AGRUP
    )
  AND H.COD_AGRUP1     = N.COD_AGRUP1_NOVO
  AND H.COD_AGRUP2     = N.COD_AGRUP2
  AND H.COD_AGRUP3     = N.COD_AGRUP3
  AND H.COD_AGRUP4     = N.COD_AGRUP4
  AND H.COD_AGRUP5     = N.COD_AGRUP5
  AND H.COD_AGRUP6     = N.COD_AGRUP6
  AND H.CODIGO_EMPRESA = N.CODIGO_EMPRESA
  )
AND G.COD_AGRUP1            = N.COD_AGRUP1_NOVO
AND G.COD_AGRUP2            = N.COD_AGRUP2
AND G.COD_AGRUP3            = N.COD_AGRUP3
AND G.COD_AGRUP4            = N.COD_AGRUP4
AND G.COD_AGRUP5            = N.COD_AGRUP5
AND G.COD_AGRUP6            = N.COD_AGRUP6
AND G.CODIGO_EMPRESA        = N.CODIGO_EMPRESA
AND N.COD_AGRUP1_NOVO       = vCOD1
AND N.COD_AGRUP2            = vCOD2
AND N.COD_AGRUP3            = vCOD3
AND N.COD_AGRUP4            = vCOD4
AND N.COD_AGRUP5            = vCOD5
AND N.COD_AGRUP6            = vCOD6
AND N.CODIGO_EMPRESA        = vCOD_EMPRESA
AND N.NUMERO_LINHA          = vNUMERO_LINHA
AND TRUNC(N.DATA_CARGA)     = TRUNC(vDATA_CARGA)
AND N.STATUS_PROCESSAMENTO IS NULL
AND N.DATA_PROCESSAMENTO   IS NULL
) LOOP

IF C5.TIPO_AGRUP = 'L' THEN 
INFO_AGRUPADOR_H.COD_AGRUP1 := vCOD1;
INFO_AGRUPADOR_H.COD_AGRUP2 := vCOD2;
INFO_AGRUPADOR_H.COD_AGRUP3 := vCOD3;
INFO_AGRUPADOR_H.COD_AGRUP4 := vCOD4;
INFO_AGRUPADOR_H.COD_AGRUP5 := vCOD5;
INFO_AGRUPADOR_H.COD_AGRUP6 := vCOD6;
INFO_AGRUPADOR_H.CODIGO_EMPRESA := vCOD_EMPRESA;
INFO_AGRUPADOR_H.DESCRICAO := C5.DESCRICAO;
INFO_AGRUPADOR_H.ABREVIACAO := SUBSTR(C5.ABREVIACAO,1,15);
INFO_AGRUPADOR_H.DATA_IMPLANT := C5.DATA_CRIACAO;
INFO_AGRUPADOR_H.DATA_EXTINCAO := C5.DATA_EXCLUSAO;
INFO_AGRUPADOR_H.ANO_MES_REFERENCIA := vDATA_SISTEMA;
INFO_AGRUPADOR_H.LOGIN_USUARIO := 'IMPORT_PROJ_APOSENT';
INFO_AGRUPADOR_H.DT_ULT_ALTER_USUA := SYSDATE;
INFO_AGRUPADOR_H.ID_AGRUP := C5.ID_AGRUP;
INFO_AGRUPADOR_H.TIPO_AGRUP := 'L';
INFO_AGRUPADOR_H.COD_AGRUP_SUP1 := C5.AGRUP_SUP1;
INFO_AGRUPADOR_H.COD_AGRUP_SUP2 := C5.AGRUP_SUP2;
INFO_AGRUPADOR_H.COD_AGRUP_SUP3 := C5.AGRUP_SUP3;
INFO_AGRUPADOR_H.COD_AGRUP_SUP4 := C5.AGRUP_SUP4;
INFO_AGRUPADOR_H.COD_AGRUP_SUP5 := C5.AGRUP_SUP5;
INFO_AGRUPADOR_H.COD_AGRUP_SUP6 := C5.AGRUP_SUP6;

INSERT INTO RHORGA_AGRUPADOR_H VALUES INFO_AGRUPADOR_H;
QTD_LINHAS_AFETADAS:=SQL%ROWCOUNT;
COMMIT WORK;
END IF;

IF C5.TIPO_AGRUP = 'U' THEN 
INFO_AGRUPADOR_H.COD_AGRUP1 := vCOD1;
INFO_AGRUPADOR_H.COD_AGRUP2 := vCOD2;
INFO_AGRUPADOR_H.COD_AGRUP3 := vCOD3;
INFO_AGRUPADOR_H.COD_AGRUP4 := vCOD4;
INFO_AGRUPADOR_H.COD_AGRUP5 := vCOD5;
INFO_AGRUPADOR_H.COD_AGRUP6 := vCOD6;
INFO_AGRUPADOR_H.CODIGO_EMPRESA := vCOD_EMPRESA;
INFO_AGRUPADOR_H.DESCRICAO := C5.DESCRICAO;
INFO_AGRUPADOR_H.ABREVIACAO := SUBSTR(C5.ABREVIACAO,1,15);
INFO_AGRUPADOR_H.DATA_IMPLANT := C5.DATA_CRIACAO;
INFO_AGRUPADOR_H.DATA_EXTINCAO := C5.DATA_EXCLUSAO;
INFO_AGRUPADOR_H.ANO_MES_REFERENCIA := vDATA_SISTEMA;
INFO_AGRUPADOR_H.LOGIN_USUARIO := 'IMPORT_PROJ_APOSENT';
INFO_AGRUPADOR_H.DT_ULT_ALTER_USUA := SYSDATE;
INFO_AGRUPADOR_H.ID_AGRUP := C5.ID_AGRUP;
INFO_AGRUPADOR_H.TIPO_AGRUP := 'U';
INFO_AGRUPADOR_H.COD_AGRUP_SUP1 := C5.AGRUP_SUP1;
INFO_AGRUPADOR_H.COD_AGRUP_SUP2 := C5.AGRUP_SUP2;
INFO_AGRUPADOR_H.COD_AGRUP_SUP3 := C5.AGRUP_SUP3;
INFO_AGRUPADOR_H.COD_AGRUP_SUP4 := C5.AGRUP_SUP4;
INFO_AGRUPADOR_H.COD_AGRUP_SUP5 := C5.AGRUP_SUP5;
INFO_AGRUPADOR_H.COD_AGRUP_SUP6 := C5.AGRUP_SUP6;

INSERT INTO RHORGA_AGRUPADOR_H VALUES INFO_AGRUPADOR_H;
QTD_LINHAS_AFETADAS:=SQL%ROWCOUNT;
COMMIT WORK;
END IF;

IF C5.TIPO_AGRUP = 'G' THEN 
INFO_AGRUPADOR_H.COD_AGRUP1 := vCOD1;
INFO_AGRUPADOR_H.COD_AGRUP2 := vCOD2;
INFO_AGRUPADOR_H.COD_AGRUP3 := vCOD3;
INFO_AGRUPADOR_H.COD_AGRUP4 := vCOD4;
INFO_AGRUPADOR_H.COD_AGRUP5 := vCOD5;
INFO_AGRUPADOR_H.COD_AGRUP6 := vCOD6;
INFO_AGRUPADOR_H.CODIGO_EMPRESA := vCOD_EMPRESA;
INFO_AGRUPADOR_H.DESCRICAO := C5.DESCRICAO;
INFO_AGRUPADOR_H.ABREVIACAO := SUBSTR(C5.ABREVIACAO,1,15);
INFO_AGRUPADOR_H.DATA_IMPLANT := C5.DATA_CRIACAO;
INFO_AGRUPADOR_H.DATA_EXTINCAO := C5.DATA_EXCLUSAO;
INFO_AGRUPADOR_H.ANO_MES_REFERENCIA := vDATA_SISTEMA;
INFO_AGRUPADOR_H.LOGIN_USUARIO := 'IMPORT_PROJ_APOSENT';
INFO_AGRUPADOR_H.DT_ULT_ALTER_USUA := SYSDATE;
INFO_AGRUPADOR_H.ID_AGRUP := C5.ID_AGRUP;
INFO_AGRUPADOR_H.TIPO_AGRUP := 'G';
INFO_AGRUPADOR_H.COD_AGRUP_SUP1 := C5.AGRUP_SUP1;
INFO_AGRUPADOR_H.COD_AGRUP_SUP2 := C5.AGRUP_SUP2;
INFO_AGRUPADOR_H.COD_AGRUP_SUP3 := C5.AGRUP_SUP3;
INFO_AGRUPADOR_H.COD_AGRUP_SUP4 := C5.AGRUP_SUP4;
INFO_AGRUPADOR_H.COD_AGRUP_SUP5 := C5.AGRUP_SUP5;
INFO_AGRUPADOR_H.COD_AGRUP_SUP6 := C5.AGRUP_SUP6;

INSERT INTO RHORGA_AGRUPADOR_H VALUES INFO_AGRUPADOR_H;
QTD_LINHAS_AFETADAS:=SQL%ROWCOUNT;
COMMIT WORK;
END IF;

IF C5.TIPO_AGRUP = 'C' THEN 
INFO_AGRUPADOR_H.COD_AGRUP1 := vCOD1;
INFO_AGRUPADOR_H.COD_AGRUP2 := vCOD2;
INFO_AGRUPADOR_H.COD_AGRUP3 := vCOD3;
INFO_AGRUPADOR_H.COD_AGRUP4 := vCOD4;
INFO_AGRUPADOR_H.COD_AGRUP5 := vCOD5;
INFO_AGRUPADOR_H.COD_AGRUP6 := vCOD6;
INFO_AGRUPADOR_H.CODIGO_EMPRESA := vCOD_EMPRESA;
INFO_AGRUPADOR_H.DESCRICAO := C5.DESCRICAO;
INFO_AGRUPADOR_H.ABREVIACAO := SUBSTR(C5.ABREVIACAO,1,15);
INFO_AGRUPADOR_H.DATA_IMPLANT := C5.DATA_CRIACAO;
INFO_AGRUPADOR_H.DATA_EXTINCAO := C5.DATA_EXCLUSAO;
INFO_AGRUPADOR_H.ANO_MES_REFERENCIA := vDATA_SISTEMA;
INFO_AGRUPADOR_H.LOGIN_USUARIO := 'IMPORT_PROJ_APOSENT';
INFO_AGRUPADOR_H.DT_ULT_ALTER_USUA := SYSDATE;
INFO_AGRUPADOR_H.ID_AGRUP := C5.ID_AGRUP;
INFO_AGRUPADOR_H.TIPO_AGRUP := 'C';
INFO_AGRUPADOR_H.COD_AGRUP_SUP1 := C5.AGRUP_SUP1;
INFO_AGRUPADOR_H.COD_AGRUP_SUP2 := C5.AGRUP_SUP2;
INFO_AGRUPADOR_H.COD_AGRUP_SUP3 := C5.AGRUP_SUP3;
INFO_AGRUPADOR_H.COD_AGRUP_SUP4 := C5.AGRUP_SUP4;
INFO_AGRUPADOR_H.COD_AGRUP_SUP5 := C5.AGRUP_SUP5;
INFO_AGRUPADOR_H.COD_AGRUP_SUP6 := C5.AGRUP_SUP6;

INSERT INTO RHORGA_AGRUPADOR_H VALUES INFO_AGRUPADOR_H;
QTD_LINHAS_AFETADAS:=SQL%ROWCOUNT;
COMMIT WORK;
END IF;

REC_INSERT := 1;
END LOOP;
END;

RETURN QTD_LINHAS_AFETADAS;
END;

/* FUNÇÃO QUE VERIFICA E ATUALIZA OS CAMPOS DE DESCRIÇÃO, ABREVIAÇÃO, DATA_FIM E DATA_INICIO*/
FUNCTION COMPARA_CAMPOS ( vCOD1 IN CHAR, vCOD2 IN CHAR, vCOD3 IN CHAR, vCOD4 IN CHAR, vCOD5 IN CHAR, vCOD6 IN CHAR, vCOD_EMPRESA IN CHAR, vNUMERO_LINHA IN CHAR, vDATA_CARGA DATE) RETURN NUMBER IS
ATUALIZA NUMBER;
AGRUPADOR_HIST RHORGA_AGRUPADOR_H%ROWTYPE;
INSERCAO NUMBER;

BEGIN --BEGIN1
ATUALIZA:=0;


FOR C6 IN (
SELECT X.*,
CASE WHEN X.DESCR_SUGESP <> X.DESCR_ORGA AND X.ABREV_SUGESP <> X.ABREV_ORGA AND TRUNC(X.DATA_CRIACAO) <> TRUNC(X.DATA_IMPLANT) AND TRUNC(X.DATA_EXCLUSAO) <> TRUNC(X.DATA_EXTINCAO) THEN 'DESCRICAO,ABREVIACAO,DATA CRIACAO,DATA EXTINCAO DIFERENTE'
     WHEN X.DESCR_SUGESP <> X.DESCR_ORGA AND X.ABREV_SUGESP <> X.ABREV_ORGA AND TRUNC(X.DATA_CRIACAO) <> TRUNC(X.DATA_IMPLANT) AND TRUNC(X.DATA_EXCLUSAO) =  TRUNC(X.DATA_EXTINCAO) THEN 'DESCRICAO,ABREVIACAO,DATA CRIACAO DIFERENTE'
     WHEN X.DESCR_SUGESP <> X.DESCR_ORGA AND X.ABREV_SUGESP <> X.ABREV_ORGA AND TRUNC(X.DATA_CRIACAO) =  TRUNC(X.DATA_IMPLANT) AND TRUNC(X.DATA_EXCLUSAO) <> TRUNC(X.DATA_EXTINCAO) THEN 'DESCRICAO,ABREVIACAO,DATA EXTINCAO DIFERENTE'
     WHEN X.DESCR_SUGESP <> X.DESCR_ORGA AND X.ABREV_SUGESP <> X.ABREV_ORGA AND TRUNC(X.DATA_CRIACAO) =  TRUNC(X.DATA_IMPLANT) AND TRUNC(X.DATA_EXCLUSAO) =  TRUNC(X.DATA_EXTINCAO) THEN 'DESCRICAO,ABREVIACAO DIFERENTE'
     WHEN X.DESCR_SUGESP <> X.DESCR_ORGA AND X.ABREV_SUGESP =  X.ABREV_ORGA AND TRUNC(X.DATA_CRIACAO) <> TRUNC(X.DATA_IMPLANT) AND TRUNC(X.DATA_EXCLUSAO) <> TRUNC(X.DATA_EXTINCAO) THEN 'DESCRICAO,DATA CRIACAO,DATA EXTINCAO DIFERENTE'
     WHEN X.DESCR_SUGESP <> X.DESCR_ORGA AND X.ABREV_SUGESP =  X.ABREV_ORGA AND TRUNC(X.DATA_CRIACAO) <> TRUNC(X.DATA_IMPLANT) AND TRUNC(X.DATA_EXCLUSAO) =  TRUNC(X.DATA_EXTINCAO) THEN 'DESCRICAO,DATA CRIACAO DIFERENTE'
     WHEN X.DESCR_SUGESP <> X.DESCR_ORGA AND X.ABREV_SUGESP =  X.ABREV_ORGA AND TRUNC(X.DATA_CRIACAO) <> TRUNC(X.DATA_IMPLANT) AND TRUNC(X.DATA_EXCLUSAO) <> TRUNC(X.DATA_EXTINCAO) THEN 'DESCRICAO,DATA EXTINCAO DIFERENTE'
     WHEN X.DESCR_SUGESP <> X.DESCR_ORGA AND X.ABREV_SUGESP =  X.ABREV_ORGA AND TRUNC(X.DATA_CRIACAO) =  TRUNC(X.DATA_IMPLANT) AND TRUNC(X.DATA_EXCLUSAO) =  TRUNC(X.DATA_EXTINCAO) THEN 'DESCRICAO DIFERENTE'
     WHEN X.DESCR_SUGESP =  X.DESCR_ORGA AND X.ABREV_SUGESP <> X.ABREV_ORGA AND TRUNC(X.DATA_CRIACAO) <> TRUNC(X.DATA_IMPLANT) AND TRUNC(X.DATA_EXCLUSAO) <> TRUNC(X.DATA_EXTINCAO) THEN 'ABREVIACAO,DATA CRIACAO,DATA EXTINCAO DIFERENTE'
     WHEN X.DESCR_SUGESP =  X.DESCR_ORGA AND X.ABREV_SUGESP <> X.ABREV_ORGA AND TRUNC(X.DATA_CRIACAO) <> TRUNC(X.DATA_IMPLANT) AND TRUNC(X.DATA_EXCLUSAO) =  TRUNC(X.DATA_EXTINCAO) THEN 'ABREVIACAO,DATA CRIACAO DIFERENTE'
     WHEN X.DESCR_SUGESP =  X.DESCR_ORGA AND X.ABREV_SUGESP <> X.ABREV_ORGA AND TRUNC(X.DATA_CRIACAO) =  TRUNC(X.DATA_IMPLANT) AND TRUNC(X.DATA_EXCLUSAO) <> TRUNC(X.DATA_EXTINCAO) THEN 'ABREVIACAO,DATA EXTINCAO DIFERENTE'
     WHEN X.DESCR_SUGESP =  X.DESCR_ORGA AND X.ABREV_SUGESP <> X.ABREV_ORGA AND TRUNC(X.DATA_CRIACAO) =  TRUNC(X.DATA_IMPLANT) AND TRUNC(X.DATA_EXCLUSAO) =  TRUNC(X.DATA_EXTINCAO) THEN 'ABREVIACAO DIFERENTE'
     WHEN X.DESCR_SUGESP =  X.DESCR_ORGA AND X.ABREV_SUGESP =  X.ABREV_ORGA AND TRUNC(X.DATA_CRIACAO) <> TRUNC(X.DATA_IMPLANT) AND TRUNC(X.DATA_EXCLUSAO) <> TRUNC(X.DATA_EXTINCAO) THEN 'DATA CRIACAO,DATA EXTINCAO DIFERENTE'
     WHEN X.DESCR_SUGESP =  X.DESCR_ORGA AND X.ABREV_SUGESP =  X.ABREV_ORGA AND TRUNC(X.DATA_CRIACAO) <> TRUNC(X.DATA_IMPLANT) AND TRUNC(X.DATA_EXCLUSAO) =  TRUNC(X.DATA_EXTINCAO) THEN 'DATA CRIACAO DIFERENTE'
     WHEN X.DESCR_SUGESP =  X.DESCR_ORGA AND X.ABREV_SUGESP =  X.ABREV_ORGA AND TRUNC(X.DATA_CRIACAO) =  TRUNC(X.DATA_IMPLANT) AND TRUNC(X.DATA_EXCLUSAO) <> TRUNC(X.DATA_EXTINCAO) THEN 'DATA EXTINCAO DIFERENTE' 
     END AS COMPARACAO

FROM (
SELECT ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.FAZER, 
ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.CODIGO_EMPRESA,
ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.COD_AGRUP1, 
ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.COD_AGRUP2,
ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.COD_AGRUP3,
ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.COD_AGRUP4,
ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.COD_AGRUP5,
ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.COD_AGRUP6,
CASE WHEN ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.DESCRICAO IS NULL THEN 'VAZIO' ELSE ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.DESCRICAO END AS DESCR_SUGESP,
CASE WHEN RHORGA_AGRUPADOR.DESCRICAO IS NULL THEN 'VAZIO' ELSE RHORGA_AGRUPADOR.DESCRICAO END AS DESCR_ORGA,
CASE WHEN ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.ABREVIACAO IS NULL THEN 'VAZIO' ELSE ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.ABREVIACAO END AS ABREV_SUGESP,
CASE WHEN RHORGA_AGRUPADOR.ABREVIACAO IS NULL THEN 'VAZIO' ELSE RHORGA_AGRUPADOR.ABREVIACAO END AS ABREV_ORGA,
ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.DATA_CRIACAO,
RHORGA_AGRUPADOR.DATA_IMPLANT,
ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.DATA_EXCLUSAO,
RHORGA_AGRUPADOR.DATA_EXTINCAO,
ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.ANALISE,
RHORGA_AGRUPADOR.COD_AGRUP1 AS COD_AGRUP1_ORGA,
RHORGA_AGRUPADOR.TIPO_AGRUP,
ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.NUMERO_LINHA,
ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.DATA_CARGA

FROM 
ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT
LEFT JOIN RHORGA_AGRUPADOR ON
ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.COD_AGRUP1 = RHORGA_AGRUPADOR.COD_AGRUP1 AND
ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.COD_AGRUP2 = RHORGA_AGRUPADOR.COD_AGRUP2 AND
ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.COD_AGRUP3 = RHORGA_AGRUPADOR.COD_AGRUP3 AND
ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.COD_AGRUP4 = RHORGA_AGRUPADOR.COD_AGRUP4 AND
ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.COD_AGRUP5 = RHORGA_AGRUPADOR.COD_AGRUP5 AND
ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.COD_AGRUP6 = RHORGA_AGRUPADOR.COD_AGRUP6 AND
ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.CODIGO_EMPRESA = RHORGA_AGRUPADOR.CODIGO_EMPRESA AND
RHORGA_AGRUPADOR.TIPO_AGRUP IN ('L','U','C','G')

WHERE ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.CODIGO_EMPRESA = vCOD_EMPRESA
AND ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.DATA_PROCESSAMENTO IS NULL 
AND ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.STATUS_PROCESSAMENTO IS NULL 
AND ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.FAZER = 'U'
ORDER BY ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.CODIGO_EMPRESA,
ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.COD_AGRUP1, 
ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.COD_AGRUP2,
ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.COD_AGRUP3,
ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.COD_AGRUP4,
ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.COD_AGRUP5,
ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.COD_AGRUP6
) X
WHERE X.CODIGO_EMPRESA = vCOD_EMPRESA
AND X.COD_AGRUP1 = vCOD1
AND X.COD_AGRUP2 = vCOD2
AND X.COD_AGRUP3 = vCOD3
AND X.COD_AGRUP4 = vCOD4
AND X.COD_AGRUP5 = vCOD5
AND X.COD_AGRUP6 = vCOD6
AND SUBSTR(X.COD_AGRUP1,1,4) > '0000' /*ATUALIZA SOMENTE OS LOCAIS QUE SÃO CRIADOS PELO PROJETO DE APOSENTADORIA*/

) LOOP
QTD_LINHAS_ALTERADA:=0;

IF C6.COMPARACAO = 'DESCRICAO,ABREVIACAO,DATA CRIACAO,DATA EXTINCAO DIFERENTE' AND C6.COD_AGRUP1_ORGA IS NOT NULL THEN
ATUALIZA:= 0;

/*AGRUPADOR NO TIPO_AGRUP L,C,U,G*/ 
UPDATE RHORGA_AGRUPADOR SET DESCRICAO = C6.DESCR_SUGESP, ABREVIACAO = SUBSTR(C6.ABREV_SUGESP,1,15), DATA_IMPLANT = TO_DATE(C6.DATA_CRIACAO,'DD/MM/YYYY'), DATA_EXTINCAO = TO_DATE(C6.DATA_EXCLUSAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE TIPO_AGRUP = C6.TIPO_AGRUP AND COD_AGRUP1 = vCOD1 AND COD_AGRUP2 = vCOD2 AND COD_AGRUP3 = vCOD3 AND COD_AGRUP4 = vCOD4 AND COD_AGRUP5 = vCOD5 AND COD_AGRUP6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*LOTAÇÃO*/
UPDATE RHORGA_LOTACAO SET DESCRICAO = C6.DESCR_SUGESP, ABREVIACAO = SUBSTR(C6.ABREV_SUGESP,1,15), DATA_IMPLANT = TO_DATE(C6.DATA_CRIACAO,'DD/MM/YYYY'), DATA_EXTINCAO = TO_DATE(C6.DATA_EXCLUSAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_LOTACAO1 = VCOD1 AND COD_LOTACAO2 = vCOD2 AND COD_LOTACAO3 = vCOD3 AND COD_LOTACAO4 = vCOD4 AND COD_LOTACAO5 = vCOD5 AND COD_LOTACAO6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*UNIDADE*/
UPDATE RHORGA_UNIDADE SET DESCRICAO = C6.DESCR_SUGESP, ABREVIACAO = SUBSTR(C6.ABREV_SUGESP,1,15), DATA_IMPLANT = TO_DATE(C6.DATA_CRIACAO,'DD/MM/YYYY'), DATA_EXTINCAO = TO_DATE(C6.DATA_EXCLUSAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_UNIDADE1 = VCOD1 AND COD_UNIDADE2 = vCOD2 AND COD_UNIDADE3 = vCOD3 AND COD_UNIDADE4 = vCOD4 AND COD_UNIDADE5 = vCOD5 AND COD_UNIDADE6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*CUSTO CONTABIL*/
UPDATE RHORGA_CUSTO_CONT SET DESCRICAO = C6.DESCR_SUGESP, ABREVIACAO = SUBSTR(C6.ABREV_SUGESP,1,15), DATA_IMPLANT = TO_DATE(C6.DATA_CRIACAO,'DD/MM/YYYY'), DATA_EXTINCAO = TO_DATE(C6.DATA_EXCLUSAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_CCONTAB1 = VCOD1 AND COD_CCONTAB2 = vCOD2 AND COD_CCONTAB3 = vCOD3 AND COD_CCONTAB4 = vCOD4 AND COD_CCONTAB5 = vCOD5 AND COD_CCONTAB6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*CUSTO GERENCIAL*/
UPDATE RHORGA_CUSTO_GEREN SET DESCRICAO = C6.DESCR_SUGESP, ABREVIACAO = SUBSTR(C6.ABREV_SUGESP,1,15), DATA_IMPLANT = TO_DATE(C6.DATA_CRIACAO,'DD/MM/YYYY'), DATA_EXTINCAO = TO_DATE(C6.DATA_EXCLUSAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_CGERENC1 = VCOD1 AND COD_CGERENC2 = vCOD2 AND COD_CGERENC3 = vCOD3 AND COD_CGERENC4 = vCOD4 AND COD_CGERENC5 = vCOD5 AND COD_CGERENC6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;

IF QTD_LINHAS_ALTERADA > 0 THEN 
/*NO FINAL DO PROCESSO SE FOI REALIZADO A ATUALIZAÇÃO DOS CAMPOS, ATUALIZA OS CAMPOS DE STATUS_PROCESSAMENTO COM O OK E A DATA DE PROCESSAMENTO COM A DATA DO DIA */
UPDATE ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT SET DATA_PROCESSAMENTO = SYSDATE, LOGIN_PROCESSAMENTO = 'LOGIN', STATUS_PROCESSAMENTO = 'OK'
WHERE CODIGO_EMPRESA = vCOD_EMPRESA AND COD_AGRUP1 = VCOD1 AND COD_AGRUP2 = VCOD2 AND COD_AGRUP3 = VCOD3 AND COD_AGRUP4 = VCOD4 AND COD_AGRUP5 = VCOD5
AND COD_AGRUP6 = VCOD6 AND NUMERO_LINHA = C6.NUMERO_LINHA AND TRUNC(DATA_CARGA) = TRUNC(C6.DATA_CARGA) AND DATA_PROCESSAMENTO IS NULL AND STATUS_PROCESSAMENTO IS NULL ; COMMIT WORK;
END IF;

END IF;

IF C6.COMPARACAO = 'DESCRICAO,ABREVIACAO,DATA CRIACAO DIFERENTE' AND C6.COD_AGRUP1_ORGA IS NOT NULL THEN
ATUALIZA:=0;
/*AGRUPADOR NO TIPO_AGRUP L,C,U,G*/ 
UPDATE RHORGA_AGRUPADOR SET DESCRICAO = C6.DESCR_SUGESP, ABREVIACAO = SUBSTR(C6.ABREV_SUGESP,1,15), DATA_IMPLANT = TO_DATE(C6.DATA_CRIACAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE TIPO_AGRUP = C6.TIPO_AGRUP AND COD_AGRUP1 = vCOD1 AND COD_AGRUP2 = vCOD2 AND COD_AGRUP3 = vCOD3 AND COD_AGRUP4 = vCOD4 AND COD_AGRUP5 = vCOD5 AND COD_AGRUP6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*LOTAÇÃO*/
UPDATE RHORGA_LOTACAO SET DESCRICAO = C6.DESCR_SUGESP, ABREVIACAO = SUBSTR(C6.ABREV_SUGESP,1,15), DATA_IMPLANT = TO_DATE(C6.DATA_CRIACAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_LOTACAO1 = VCOD1 AND COD_LOTACAO2 = vCOD2 AND COD_LOTACAO3 = vCOD3 AND COD_LOTACAO4 = vCOD4 AND COD_LOTACAO5 = vCOD5 AND COD_LOTACAO6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*UNIDADE*/
UPDATE RHORGA_UNIDADE SET DESCRICAO = C6.DESCR_SUGESP, ABREVIACAO = SUBSTR(C6.ABREV_SUGESP,1,15), DATA_IMPLANT = TO_DATE(C6.DATA_CRIACAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_UNIDADE1 = VCOD1 AND COD_UNIDADE2 = vCOD2 AND COD_UNIDADE3 = vCOD3 AND COD_UNIDADE4 = vCOD4 AND COD_UNIDADE5 = vCOD5 AND COD_UNIDADE6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*CUSTO CONTABIL*/
UPDATE RHORGA_CUSTO_CONT SET DESCRICAO = C6.DESCR_SUGESP, ABREVIACAO = SUBSTR(C6.ABREV_SUGESP,1,15), DATA_IMPLANT = TO_DATE(C6.DATA_CRIACAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_CCONTAB1 = VCOD1 AND COD_CCONTAB2 = vCOD2 AND COD_CCONTAB3 = vCOD3 AND COD_CCONTAB4 = vCOD4 AND COD_CCONTAB5 = vCOD5 AND COD_CCONTAB6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*CUSTO GERENCIAL*/
UPDATE RHORGA_CUSTO_GEREN SET DESCRICAO = C6.DESCR_SUGESP, ABREVIACAO = SUBSTR(C6.ABREV_SUGESP,1,15), DATA_IMPLANT = TO_DATE(C6.DATA_CRIACAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_CGERENC1 = VCOD1 AND COD_CGERENC2 = vCOD2 AND COD_CGERENC3 = vCOD3 AND COD_CGERENC4 = vCOD4 AND COD_CGERENC5 = vCOD5 AND COD_CGERENC6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;

IF QTD_LINHAS_ALTERADA > 0 THEN 
/*NO FINAL DO PROCESSO SE FOI REALIZADO A ATUALIZAÇÃO DOS CAMPOS, ATUALIZA OS CAMPOS DE STATUS_PROCESSAMENTO COM O OK E A DATA DE PROCESSAMENTO COM A DATA DO DIA */
UPDATE ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT SET DATA_PROCESSAMENTO = SYSDATE, LOGIN_PROCESSAMENTO = 'LOGIN', STATUS_PROCESSAMENTO = 'OK'
WHERE CODIGO_EMPRESA = vCOD_EMPRESA AND COD_AGRUP1 = VCOD1 AND COD_AGRUP2 = VCOD2 AND COD_AGRUP3 = VCOD3 AND COD_AGRUP4 = VCOD4 AND COD_AGRUP5 = VCOD5
AND COD_AGRUP6 = VCOD6 AND NUMERO_LINHA = C6.NUMERO_LINHA AND TRUNC(DATA_CARGA) = TRUNC(C6.DATA_CARGA) AND DATA_PROCESSAMENTO IS NULL AND STATUS_PROCESSAMENTO IS NULL ; COMMIT WORK;
END IF;
END IF;

IF C6.COMPARACAO = 'DESCRICAO,ABREVIACAO,DATA EXTINCAO DIFERENTE' AND C6.COD_AGRUP1_ORGA IS NOT NULL THEN
ATUALIZA:= 0;

/*AGRUPADOR NO TIPO_AGRUP L,C,U,G*/ 
UPDATE RHORGA_AGRUPADOR SET DESCRICAO = C6.DESCR_SUGESP, ABREVIACAO = SUBSTR(C6.ABREV_SUGESP,1,15), DATA_EXTINCAO = TO_DATE(C6.DATA_EXCLUSAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE TIPO_AGRUP = C6.TIPO_AGRUP AND COD_AGRUP1 = vCOD1 AND COD_AGRUP2 = vCOD2 AND COD_AGRUP3 = vCOD3 AND COD_AGRUP4 = vCOD4 AND COD_AGRUP5 = vCOD5 AND COD_AGRUP6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*LOTAÇÃO*/
UPDATE RHORGA_LOTACAO SET DESCRICAO = C6.DESCR_SUGESP, ABREVIACAO = SUBSTR(C6.ABREV_SUGESP,1,15), DATA_EXTINCAO = TO_DATE(C6.DATA_EXCLUSAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_LOTACAO1 = VCOD1 AND COD_LOTACAO2 = vCOD2 AND COD_LOTACAO3 = vCOD3 AND COD_LOTACAO4 = vCOD4 AND COD_LOTACAO5 = vCOD5 AND COD_LOTACAO6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*UNIDADE*/
UPDATE RHORGA_UNIDADE SET DESCRICAO = C6.DESCR_SUGESP, ABREVIACAO = SUBSTR(C6.ABREV_SUGESP,1,15), DATA_EXTINCAO = TO_DATE(C6.DATA_EXCLUSAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_UNIDADE1 = VCOD1 AND COD_UNIDADE2 = vCOD2 AND COD_UNIDADE3 = vCOD3 AND COD_UNIDADE4 = vCOD4 AND COD_UNIDADE5 = vCOD5 AND COD_UNIDADE6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*CUSTO CONTABIL*/
UPDATE RHORGA_CUSTO_CONT SET DESCRICAO = C6.DESCR_SUGESP, ABREVIACAO = SUBSTR(C6.ABREV_SUGESP,1,15), DATA_EXTINCAO = TO_DATE(C6.DATA_EXCLUSAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_CCONTAB1 = VCOD1 AND COD_CCONTAB2 = vCOD2 AND COD_CCONTAB3 = vCOD3 AND COD_CCONTAB4 = vCOD4 AND COD_CCONTAB5 = vCOD5 AND COD_CCONTAB6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*CUSTO GERENCIAL*/
UPDATE RHORGA_CUSTO_GEREN SET DESCRICAO = C6.DESCR_SUGESP, ABREVIACAO = SUBSTR(C6.ABREV_SUGESP,1,15), DATA_EXTINCAO = TO_DATE(C6.DATA_EXCLUSAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_CGERENC1 = VCOD1 AND COD_CGERENC2 = vCOD2 AND COD_CGERENC3 = vCOD3 AND COD_CGERENC4 = vCOD4 AND COD_CGERENC5 = vCOD5 AND COD_CGERENC6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;

IF QTD_LINHAS_ALTERADA > 0 THEN 
/*NO FINAL DO PROCESSO SE FOI REALIZADO A ATUALIZAÇÃO DOS CAMPOS, ATUALIZA OS CAMPOS DE STATUS_PROCESSAMENTO COM O OK E A DATA DE PROCESSAMENTO COM A DATA DO DIA */
UPDATE ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT SET DATA_PROCESSAMENTO = SYSDATE, LOGIN_PROCESSAMENTO = 'LOGIN', STATUS_PROCESSAMENTO = 'OK'
WHERE CODIGO_EMPRESA = vCOD_EMPRESA AND COD_AGRUP1 = VCOD1 AND COD_AGRUP2 = VCOD2 AND COD_AGRUP3 = VCOD3 AND COD_AGRUP4 = VCOD4 AND COD_AGRUP5 = VCOD5
AND COD_AGRUP6 = VCOD6 AND NUMERO_LINHA = C6.NUMERO_LINHA AND TRUNC(DATA_CARGA) = TRUNC(C6.DATA_CARGA) AND DATA_PROCESSAMENTO IS NULL AND STATUS_PROCESSAMENTO IS NULL ; COMMIT WORK;
END IF;
END IF;

IF C6.COMPARACAO = 'DESCRICAO,ABREVIACAO DIFERENTE' AND C6.COD_AGRUP1_ORGA IS NOT NULL THEN
ATUALIZA:= 0;

/*AGRUPADOR NO TIPO_AGRUP L,C,U,G*/ 
UPDATE RHORGA_AGRUPADOR SET DESCRICAO = C6.DESCR_SUGESP, ABREVIACAO = SUBSTR(C6.ABREV_SUGESP,1,15), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE TIPO_AGRUP = C6.TIPO_AGRUP AND COD_AGRUP1 = vCOD1 AND COD_AGRUP2 = vCOD2 AND COD_AGRUP3 = vCOD3 AND COD_AGRUP4 = vCOD4 AND COD_AGRUP5 = vCOD5 AND COD_AGRUP6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*LOTAÇÃO*/
UPDATE RHORGA_LOTACAO SET DESCRICAO = C6.DESCR_SUGESP, ABREVIACAO = SUBSTR(C6.ABREV_SUGESP,1,15), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_LOTACAO1 = VCOD1 AND COD_LOTACAO2 = vCOD2 AND COD_LOTACAO3 = vCOD3 AND COD_LOTACAO4 = vCOD4 AND COD_LOTACAO5 = vCOD5 AND COD_LOTACAO6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*UNIDADE*/
UPDATE RHORGA_UNIDADE SET DESCRICAO = C6.DESCR_SUGESP, ABREVIACAO = SUBSTR(C6.ABREV_SUGESP,1,15), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_UNIDADE1 = VCOD1 AND COD_UNIDADE2 = vCOD2 AND COD_UNIDADE3 = vCOD3 AND COD_UNIDADE4 = vCOD4 AND COD_UNIDADE5 = vCOD5 AND COD_UNIDADE6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*CUSTO CONTABIL*/
UPDATE RHORGA_CUSTO_CONT SET DESCRICAO = C6.DESCR_SUGESP, ABREVIACAO = SUBSTR(C6.ABREV_SUGESP,1,15), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_CCONTAB1 = VCOD1 AND COD_CCONTAB2 = vCOD2 AND COD_CCONTAB3 = vCOD3 AND COD_CCONTAB4 = vCOD4 AND COD_CCONTAB5 = vCOD5 AND COD_CCONTAB6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*CUSTO GERENCIAL*/
UPDATE RHORGA_CUSTO_GEREN SET DESCRICAO = C6.DESCR_SUGESP, ABREVIACAO = SUBSTR(C6.ABREV_SUGESP,1,15), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_CGERENC1 = VCOD1 AND COD_CGERENC2 = vCOD2 AND COD_CGERENC3 = vCOD3 AND COD_CGERENC4 = vCOD4 AND COD_CGERENC5 = vCOD5 AND COD_CGERENC6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;

IF QTD_LINHAS_ALTERADA > 0 THEN 
/*NO FINAL DO PROCESSO SE FOI REALIZADO A ATUALIZAÇÃO DOS CAMPOS, ATUALIZA OS CAMPOS DE STATUS_PROCESSAMENTO COM O OK E A DATA DE PROCESSAMENTO COM A DATA DO DIA */
UPDATE ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT SET DATA_PROCESSAMENTO = SYSDATE, LOGIN_PROCESSAMENTO = 'LOGIN', STATUS_PROCESSAMENTO = 'OK'
WHERE CODIGO_EMPRESA = vCOD_EMPRESA AND COD_AGRUP1 = VCOD1 AND COD_AGRUP2 = VCOD2 AND COD_AGRUP3 = VCOD3 AND COD_AGRUP4 = VCOD4 AND COD_AGRUP5 = VCOD5
AND COD_AGRUP6 = VCOD6 AND NUMERO_LINHA = C6.NUMERO_LINHA AND TRUNC(DATA_CARGA) = TRUNC(C6.DATA_CARGA) AND DATA_PROCESSAMENTO IS NULL AND STATUS_PROCESSAMENTO IS NULL ; COMMIT WORK;
END IF;
END IF;

IF C6.COMPARACAO = 'DESCRICAO,DATA CRIACAO,DATA EXTINCAO DIFERENTE' AND C6.COD_AGRUP1_ORGA IS NOT NULL THEN
ATUALIZA:= 0;

/*AGRUPADOR NO TIPO_AGRUP L,C,U,G*/ 
UPDATE RHORGA_AGRUPADOR SET DESCRICAO = C6.DESCR_SUGESP, DATA_IMPLANT = TO_DATE(C6.DATA_CRIACAO,'DD/MM/YYYY'), DATA_EXTINCAO = TO_DATE(C6.DATA_EXCLUSAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE TIPO_AGRUP = C6.TIPO_AGRUP AND COD_AGRUP1 = vCOD1 AND COD_AGRUP2 = vCOD2 AND COD_AGRUP3 = vCOD3 AND COD_AGRUP4 = vCOD4 AND COD_AGRUP5 = vCOD5 AND COD_AGRUP6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*LOTAÇÃO*/
UPDATE RHORGA_LOTACAO SET DESCRICAO = C6.DESCR_SUGESP, DATA_IMPLANT = TO_DATE(C6.DATA_CRIACAO,'DD/MM/YYYY'), DATA_EXTINCAO = TO_DATE(C6.DATA_EXCLUSAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_LOTACAO1 = VCOD1 AND COD_LOTACAO2 = vCOD2 AND COD_LOTACAO3 = vCOD3 AND COD_LOTACAO4 = vCOD4 AND COD_LOTACAO5 = vCOD5 AND COD_LOTACAO6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*UNIDADE*/
UPDATE RHORGA_UNIDADE SET DESCRICAO = C6.DESCR_SUGESP, DATA_IMPLANT = TO_DATE(C6.DATA_CRIACAO,'DD/MM/YYYY'), DATA_EXTINCAO = TO_DATE(C6.DATA_EXCLUSAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_UNIDADE1 = VCOD1 AND COD_UNIDADE2 = vCOD2 AND COD_UNIDADE3 = vCOD3 AND COD_UNIDADE4 = vCOD4 AND COD_UNIDADE5 = vCOD5 AND COD_UNIDADE6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*CUSTO CONTABIL*/
UPDATE RHORGA_CUSTO_CONT SET DESCRICAO = C6.DESCR_SUGESP, DATA_IMPLANT = TO_DATE(C6.DATA_CRIACAO,'DD/MM/YYYY'), DATA_EXTINCAO = TO_DATE(C6.DATA_EXCLUSAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_CCONTAB1 = VCOD1 AND COD_CCONTAB2 = vCOD2 AND COD_CCONTAB3 = vCOD3 AND COD_CCONTAB4 = vCOD4 AND COD_CCONTAB5 = vCOD5 AND COD_CCONTAB6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*CUSTO GERENCIAL*/
UPDATE RHORGA_CUSTO_GEREN SET DESCRICAO = C6.DESCR_SUGESP, DATA_IMPLANT = TO_DATE(C6.DATA_CRIACAO,'DD/MM/YYYY'), DATA_EXTINCAO = TO_DATE(C6.DATA_EXCLUSAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_CGERENC1 = VCOD1 AND COD_CGERENC2 = vCOD2 AND COD_CGERENC3 = vCOD3 AND COD_CGERENC4 = vCOD4 AND COD_CGERENC5 = vCOD5 AND COD_CGERENC6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;

IF QTD_LINHAS_ALTERADA > 0 THEN 
/*NO FINAL DO PROCESSO SE FOI REALIZADO A ATUALIZAÇÃO DOS CAMPOS, ATUALIZA OS CAMPOS DE STATUS_PROCESSAMENTO COM O OK E A DATA DE PROCESSAMENTO COM A DATA DO DIA */
UPDATE ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT SET DATA_PROCESSAMENTO = SYSDATE, LOGIN_PROCESSAMENTO = 'LOGIN', STATUS_PROCESSAMENTO = 'OK'
WHERE CODIGO_EMPRESA = vCOD_EMPRESA AND COD_AGRUP1 = VCOD1 AND COD_AGRUP2 = VCOD2 AND COD_AGRUP3 = VCOD3 AND COD_AGRUP4 = VCOD4 AND COD_AGRUP5 = VCOD5
AND COD_AGRUP6 = VCOD6 AND NUMERO_LINHA = C6.NUMERO_LINHA AND TRUNC(DATA_CARGA) = TRUNC(C6.DATA_CARGA) AND DATA_PROCESSAMENTO IS NULL AND STATUS_PROCESSAMENTO IS NULL ; COMMIT WORK;
END IF;
END IF;

IF C6.COMPARACAO = 'DESCRICAO,DATA CRIACAO DIFEERNTE' AND C6.COD_AGRUP1_ORGA IS NOT NULL THEN
ATUALIZA:= 0;

/*AGRUPADOR NO TIPO_AGRUP L,C,U,G*/ 
UPDATE RHORGA_AGRUPADOR SET DESCRICAO = C6.DESCR_SUGESP, DATA_IMPLANT = TO_DATE(C6.DATA_CRIACAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE TIPO_AGRUP = C6.TIPO_AGRUP AND COD_AGRUP1 = vCOD1 AND COD_AGRUP2 = vCOD2 AND COD_AGRUP3 = vCOD3 AND COD_AGRUP4 = vCOD4 AND COD_AGRUP5 = vCOD5 AND COD_AGRUP6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*LOTAÇÃO*/
UPDATE RHORGA_LOTACAO SET DESCRICAO = C6.DESCR_SUGESP, DATA_IMPLANT = TO_DATE(C6.DATA_CRIACAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_LOTACAO1 = VCOD1 AND COD_LOTACAO2 = vCOD2 AND COD_LOTACAO3 = vCOD3 AND COD_LOTACAO4 = vCOD4 AND COD_LOTACAO5 = vCOD5 AND COD_LOTACAO6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*UNIDADE*/
UPDATE RHORGA_UNIDADE SET DESCRICAO = C6.DESCR_SUGESP, DATA_IMPLANT = TO_DATE(C6.DATA_CRIACAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_UNIDADE1 = VCOD1 AND COD_UNIDADE2 = vCOD2 AND COD_UNIDADE3 = vCOD3 AND COD_UNIDADE4 = vCOD4 AND COD_UNIDADE5 = vCOD5 AND COD_UNIDADE6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*CUSTO CONTABIL*/
UPDATE RHORGA_CUSTO_CONT SET DESCRICAO = C6.DESCR_SUGESP, DATA_IMPLANT = TO_DATE(C6.DATA_CRIACAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_CCONTAB1 = VCOD1 AND COD_CCONTAB2 = vCOD2 AND COD_CCONTAB3 = vCOD3 AND COD_CCONTAB4 = vCOD4 AND COD_CCONTAB5 = vCOD5 AND COD_CCONTAB6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*CUSTO GERENCIAL*/
UPDATE RHORGA_CUSTO_GEREN SET DESCRICAO = C6.DESCR_SUGESP, DATA_IMPLANT = TO_DATE(C6.DATA_CRIACAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_CGERENC1 = VCOD1 AND COD_CGERENC2 = vCOD2 AND COD_CGERENC3 = vCOD3 AND COD_CGERENC4 = vCOD4 AND COD_CGERENC5 = vCOD5 AND COD_CGERENC6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;

IF QTD_LINHAS_ALTERADA > 0 THEN 
/*NO FINAL DO PROCESSO SE FOI REALIZADO A ATUALIZAÇÃO DOS CAMPOS, ATUALIZA OS CAMPOS DE STATUS_PROCESSAMENTO COM O OK E A DATA DE PROCESSAMENTO COM A DATA DO DIA */
UPDATE ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT SET DATA_PROCESSAMENTO = SYSDATE, LOGIN_PROCESSAMENTO = 'LOGIN', STATUS_PROCESSAMENTO = 'OK'
WHERE CODIGO_EMPRESA = vCOD_EMPRESA AND COD_AGRUP1 = VCOD1 AND COD_AGRUP2 = VCOD2 AND COD_AGRUP3 = VCOD3 AND COD_AGRUP4 = VCOD4 AND COD_AGRUP5 = VCOD5
AND COD_AGRUP6 = VCOD6 AND NUMERO_LINHA = C6.NUMERO_LINHA AND TRUNC(DATA_CARGA) = TRUNC(C6.DATA_CARGA) AND DATA_PROCESSAMENTO IS NULL AND STATUS_PROCESSAMENTO IS NULL ; COMMIT WORK;
END IF;
END IF;

IF C6.COMPARACAO = 'DESCRICAO,DATA EXTINCAO DIFERENTE' AND C6.COD_AGRUP1_ORGA IS NOT NULL THEN
ATUALIZA:= 0;

/*AGRUPADOR NO TIPO_AGRUP L,C,U,G*/ 
UPDATE RHORGA_AGRUPADOR SET DESCRICAO = C6.DESCR_SUGESP, DATA_EXTINCAO = TO_DATE(C6.DATA_EXCLUSAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE TIPO_AGRUP = C6.TIPO_AGRUP AND COD_AGRUP1 = vCOD1 AND COD_AGRUP2 = vCOD2 AND COD_AGRUP3 = vCOD3 AND COD_AGRUP4 = vCOD4 AND COD_AGRUP5 = vCOD5 AND COD_AGRUP6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*LOTAÇÃO*/
UPDATE RHORGA_LOTACAO SET DESCRICAO = C6.DESCR_SUGESP, DATA_EXTINCAO = TO_DATE(C6.DATA_EXCLUSAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_LOTACAO1 = VCOD1 AND COD_LOTACAO2 = vCOD2 AND COD_LOTACAO3 = vCOD3 AND COD_LOTACAO4 = vCOD4 AND COD_LOTACAO5 = vCOD5 AND COD_LOTACAO6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*UNIDADE*/
UPDATE RHORGA_UNIDADE SET DESCRICAO = C6.DESCR_SUGESP, DATA_EXTINCAO = TO_DATE(C6.DATA_EXCLUSAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_UNIDADE1 = VCOD1 AND COD_UNIDADE2 = vCOD2 AND COD_UNIDADE3 = vCOD3 AND COD_UNIDADE4 = vCOD4 AND COD_UNIDADE5 = vCOD5 AND COD_UNIDADE6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*CUSTO CONTABIL*/
UPDATE RHORGA_CUSTO_CONT SET DESCRICAO = C6.DESCR_SUGESP, DATA_EXTINCAO = TO_DATE(C6.DATA_EXCLUSAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_CCONTAB1 = VCOD1 AND COD_CCONTAB2 = vCOD2 AND COD_CCONTAB3 = vCOD3 AND COD_CCONTAB4 = vCOD4 AND COD_CCONTAB5 = vCOD5 AND COD_CCONTAB6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*CUSTO GERENCIAL*/
UPDATE RHORGA_CUSTO_GEREN SET DESCRICAO = C6.DESCR_SUGESP, DATA_EXTINCAO = TO_DATE(C6.DATA_EXCLUSAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_CGERENC1 = VCOD1 AND COD_CGERENC2 = vCOD2 AND COD_CGERENC3 = vCOD3 AND COD_CGERENC4 = vCOD4 AND COD_CGERENC5 = vCOD5 AND COD_CGERENC6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;

IF QTD_LINHAS_ALTERADA > 0 THEN 
/*NO FINAL DO PROCESSO SE FOI REALIZADO A ATUALIZAÇÃO DOS CAMPOS, ATUALIZA OS CAMPOS DE STATUS_PROCESSAMENTO COM O OK E A DATA DE PROCESSAMENTO COM A DATA DO DIA */
UPDATE ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT SET DATA_PROCESSAMENTO = SYSDATE, LOGIN_PROCESSAMENTO = 'LOGIN', STATUS_PROCESSAMENTO = 'OK'
WHERE CODIGO_EMPRESA = vCOD_EMPRESA AND COD_AGRUP1 = VCOD1 AND COD_AGRUP2 = VCOD2 AND COD_AGRUP3 = VCOD3 AND COD_AGRUP4 = VCOD4 AND COD_AGRUP5 = VCOD5
AND COD_AGRUP6 = VCOD6 AND NUMERO_LINHA = C6.NUMERO_LINHA AND TRUNC(DATA_CARGA) = TRUNC(C6.DATA_CARGA) AND DATA_PROCESSAMENTO IS NULL AND STATUS_PROCESSAMENTO IS NULL ; COMMIT WORK;
END IF;
END IF;

IF C6.COMPARACAO = 'DESCRICAO DIFERENTE' AND C6.COD_AGRUP1_ORGA IS NOT NULL THEN
ATUALIZA:= 0;

/*AGRUPADOR NO TIPO_AGRUP L,C,U,G*/ 
UPDATE RHORGA_AGRUPADOR SET DESCRICAO = C6.DESCR_SUGESP, LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE TIPO_AGRUP = C6.TIPO_AGRUP AND COD_AGRUP1 = vCOD1 AND COD_AGRUP2 = vCOD2 AND COD_AGRUP3 = vCOD3 AND COD_AGRUP4 = vCOD4 AND COD_AGRUP5 = vCOD5 AND COD_AGRUP6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*LOTAÇÃO*/
UPDATE RHORGA_LOTACAO SET DESCRICAO = C6.DESCR_SUGESP, LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_LOTACAO1 = VCOD1 AND COD_LOTACAO2 = vCOD2 AND COD_LOTACAO3 = vCOD3 AND COD_LOTACAO4 = vCOD4 AND COD_LOTACAO5 = vCOD5 AND COD_LOTACAO6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*UNIDADE*/
UPDATE RHORGA_UNIDADE SET DESCRICAO = C6.DESCR_SUGESP, LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_UNIDADE1 = VCOD1 AND COD_UNIDADE2 = vCOD2 AND COD_UNIDADE3 = vCOD3 AND COD_UNIDADE4 = vCOD4 AND COD_UNIDADE5 = vCOD5 AND COD_UNIDADE6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*CUSTO CONTABIL*/
UPDATE RHORGA_CUSTO_CONT SET DESCRICAO = C6.DESCR_SUGESP, LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_CCONTAB1 = VCOD1 AND COD_CCONTAB2 = vCOD2 AND COD_CCONTAB3 = vCOD3 AND COD_CCONTAB4 = vCOD4 AND COD_CCONTAB5 = vCOD5 AND COD_CCONTAB6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*CUSTO GERENCIAL*/
UPDATE RHORGA_CUSTO_GEREN SET DESCRICAO = C6.DESCR_SUGESP, LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_CGERENC1 = VCOD1 AND COD_CGERENC2 = vCOD2 AND COD_CGERENC3 = vCOD3 AND COD_CGERENC4 = vCOD4 AND COD_CGERENC5 = vCOD5 AND COD_CGERENC6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;

IF QTD_LINHAS_ALTERADA > 0 THEN 
/*NO FINAL DO PROCESSO SE FOI REALIZADO A ATUALIZAÇÃO DOS CAMPOS, ATUALIZA OS CAMPOS DE STATUS_PROCESSAMENTO COM O OK E A DATA DE PROCESSAMENTO COM A DATA DO DIA */
UPDATE ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT SET DATA_PROCESSAMENTO = SYSDATE, LOGIN_PROCESSAMENTO = 'LOGIN', STATUS_PROCESSAMENTO = 'OK'
WHERE CODIGO_EMPRESA = vCOD_EMPRESA AND COD_AGRUP1 = VCOD1 AND COD_AGRUP2 = VCOD2 AND COD_AGRUP3 = VCOD3 AND COD_AGRUP4 = VCOD4 AND COD_AGRUP5 = VCOD5
AND COD_AGRUP6 = VCOD6 AND NUMERO_LINHA = C6.NUMERO_LINHA AND TRUNC(DATA_CARGA) = TRUNC(C6.DATA_CARGA) AND DATA_PROCESSAMENTO IS NULL AND STATUS_PROCESSAMENTO IS NULL ; COMMIT WORK;
END IF;
END IF;

IF C6.COMPARACAO = 'ABREVIACAO,DATA CRIACAO,DATA EXTINCAO DIFERENTE' AND C6.COD_AGRUP1_ORGA IS NOT NULL THEN
ATUALIZA:= 0;

/*AGRUPADOR NO TIPO_AGRUP L,C,U,G*/ 
UPDATE RHORGA_AGRUPADOR SET ABREVIACAO = SUBSTR(C6.ABREV_SUGESP,1,15), DATA_IMPLANT = TO_DATE(C6.DATA_CRIACAO,'DD/MM/YYYY'), DATA_EXTINCAO = TO_DATE(C6.DATA_EXCLUSAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE TIPO_AGRUP = C6.TIPO_AGRUP AND COD_AGRUP1 = vCOD1 AND COD_AGRUP2 = vCOD2 AND COD_AGRUP3 = vCOD3 AND COD_AGRUP4 = vCOD4 AND COD_AGRUP5 = vCOD5 AND COD_AGRUP6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*LOTAÇÃO*/
UPDATE RHORGA_LOTACAO SET ABREVIACAO = SUBSTR(C6.ABREV_SUGESP,1,15), DATA_IMPLANT = TO_DATE(C6.DATA_CRIACAO,'DD/MM/YYYY'), DATA_EXTINCAO = TO_DATE(C6.DATA_EXCLUSAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_LOTACAO1 = VCOD1 AND COD_LOTACAO2 = vCOD2 AND COD_LOTACAO3 = vCOD3 AND COD_LOTACAO4 = vCOD4 AND COD_LOTACAO5 = vCOD5 AND COD_LOTACAO6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*UNIDADE*/
UPDATE RHORGA_UNIDADE SET ABREVIACAO = SUBSTR(C6.ABREV_SUGESP,1,15), DATA_IMPLANT = TO_DATE(C6.DATA_CRIACAO,'DD/MM/YYYY'), DATA_EXTINCAO = TO_DATE(C6.DATA_EXCLUSAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_UNIDADE1 = VCOD1 AND COD_UNIDADE2 = vCOD2 AND COD_UNIDADE3 = vCOD3 AND COD_UNIDADE4 = vCOD4 AND COD_UNIDADE5 = vCOD5 AND COD_UNIDADE6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*CUSTO CONTABIL*/
UPDATE RHORGA_CUSTO_CONT SET ABREVIACAO = SUBSTR(C6.ABREV_SUGESP,1,15), DATA_IMPLANT = TO_DATE(C6.DATA_CRIACAO,'DD/MM/YYYY'), DATA_EXTINCAO = TO_DATE(C6.DATA_EXCLUSAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_CCONTAB1 = VCOD1 AND COD_CCONTAB2 = vCOD2 AND COD_CCONTAB3 = vCOD3 AND COD_CCONTAB4 = vCOD4 AND COD_CCONTAB5 = vCOD5 AND COD_CCONTAB6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*CUSTO GERENCIAL*/
UPDATE RHORGA_CUSTO_GEREN SET ABREVIACAO = SUBSTR(C6.ABREV_SUGESP,1,15), DATA_IMPLANT = TO_DATE(C6.DATA_CRIACAO,'DD/MM/YYYY'), DATA_EXTINCAO = TO_DATE(C6.DATA_EXCLUSAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_CGERENC1 = VCOD1 AND COD_CGERENC2 = vCOD2 AND COD_CGERENC3 = vCOD3 AND COD_CGERENC4 = vCOD4 AND COD_CGERENC5 = vCOD5 AND COD_CGERENC6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;

IF QTD_LINHAS_ALTERADA > 0 THEN 
/*NO FINAL DO PROCESSO SE FOI REALIZADO A ATUALIZAÇÃO DOS CAMPOS, ATUALIZA OS CAMPOS DE STATUS_PROCESSAMENTO COM O OK E A DATA DE PROCESSAMENTO COM A DATA DO DIA */
UPDATE ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT SET DATA_PROCESSAMENTO = SYSDATE, LOGIN_PROCESSAMENTO = 'LOGIN', STATUS_PROCESSAMENTO = 'OK'
WHERE CODIGO_EMPRESA = vCOD_EMPRESA AND COD_AGRUP1 = VCOD1 AND COD_AGRUP2 = VCOD2 AND COD_AGRUP3 = VCOD3 AND COD_AGRUP4 = VCOD4 AND COD_AGRUP5 = VCOD5
AND COD_AGRUP6 = VCOD6 AND NUMERO_LINHA = C6.NUMERO_LINHA AND TRUNC(DATA_CARGA) = TRUNC(C6.DATA_CARGA) AND DATA_PROCESSAMENTO IS NULL AND STATUS_PROCESSAMENTO IS NULL ; COMMIT WORK;
END IF;
END IF;

IF C6.COMPARACAO = 'ABREVIACAO,DATA CRIACAO DIFERENTE' AND C6.COD_AGRUP1_ORGA IS NOT NULL THEN
ATUALIZA:= 0;

/*AGRUPADOR NO TIPO_AGRUP L,C,U,G*/ 
UPDATE RHORGA_AGRUPADOR SET ABREVIACAO = SUBSTR(C6.ABREV_SUGESP,1,15), DATA_IMPLANT = TO_DATE(C6.DATA_CRIACAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE TIPO_AGRUP = C6.TIPO_AGRUP AND COD_AGRUP1 = vCOD1 AND COD_AGRUP2 = vCOD2 AND COD_AGRUP3 = vCOD3 AND COD_AGRUP4 = vCOD4 AND COD_AGRUP5 = vCOD5 AND COD_AGRUP6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*LOTAÇÃO*/
UPDATE RHORGA_LOTACAO SET ABREVIACAO = SUBSTR(C6.ABREV_SUGESP,1,15), DATA_IMPLANT = TO_DATE(C6.DATA_CRIACAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_LOTACAO1 = VCOD1 AND COD_LOTACAO2 = vCOD2 AND COD_LOTACAO3 = vCOD3 AND COD_LOTACAO4 = vCOD4 AND COD_LOTACAO5 = vCOD5 AND COD_LOTACAO6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*UNIDADE*/
UPDATE RHORGA_UNIDADE SET ABREVIACAO = SUBSTR(C6.ABREV_SUGESP,1,15), DATA_IMPLANT = TO_DATE(C6.DATA_CRIACAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_UNIDADE1 = VCOD1 AND COD_UNIDADE2 = vCOD2 AND COD_UNIDADE3 = vCOD3 AND COD_UNIDADE4 = vCOD4 AND COD_UNIDADE5 = vCOD5 AND COD_UNIDADE6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*CUSTO CONTABIL*/
UPDATE RHORGA_CUSTO_CONT SET ABREVIACAO = SUBSTR(C6.ABREV_SUGESP,1,15), DATA_IMPLANT = TO_DATE(C6.DATA_CRIACAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_CCONTAB1 = VCOD1 AND COD_CCONTAB2 = vCOD2 AND COD_CCONTAB3 = vCOD3 AND COD_CCONTAB4 = vCOD4 AND COD_CCONTAB5 = vCOD5 AND COD_CCONTAB6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*CUSTO GERENCIAL*/
UPDATE RHORGA_CUSTO_GEREN SET ABREVIACAO = SUBSTR(C6.ABREV_SUGESP,1,15), DATA_IMPLANT = TO_DATE(C6.DATA_CRIACAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_CGERENC1 = VCOD1 AND COD_CGERENC2 = vCOD2 AND COD_CGERENC3 = vCOD3 AND COD_CGERENC4 = vCOD4 AND COD_CGERENC5 = vCOD5 AND COD_CGERENC6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;

IF QTD_LINHAS_ALTERADA > 0 THEN 
/*NO FINAL DO PROCESSO SE FOI REALIZADO A ATUALIZAÇÃO DOS CAMPOS, ATUALIZA OS CAMPOS DE STATUS_PROCESSAMENTO COM O OK E A DATA DE PROCESSAMENTO COM A DATA DO DIA */
UPDATE ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT SET DATA_PROCESSAMENTO = SYSDATE, LOGIN_PROCESSAMENTO = 'LOGIN', STATUS_PROCESSAMENTO = 'OK'
WHERE CODIGO_EMPRESA = vCOD_EMPRESA AND COD_AGRUP1 = VCOD1 AND COD_AGRUP2 = VCOD2 AND COD_AGRUP3 = VCOD3 AND COD_AGRUP4 = VCOD4 AND COD_AGRUP5 = VCOD5
AND COD_AGRUP6 = VCOD6 AND NUMERO_LINHA = C6.NUMERO_LINHA AND TRUNC(DATA_CARGA) = TRUNC(C6.DATA_CARGA) AND DATA_PROCESSAMENTO IS NULL AND STATUS_PROCESSAMENTO IS NULL ; COMMIT WORK;
END IF;
END IF;

IF C6.COMPARACAO = 'ABREVIACAO,DATA EXTINCAO DIFERENTE' AND C6.COD_AGRUP1_ORGA IS NOT NULL THEN
ATUALIZA:= 0;

/*AGRUPADOR NO TIPO_AGRUP L,C,U,G*/ 
UPDATE RHORGA_AGRUPADOR SET ABREVIACAO = SUBSTR(C6.ABREV_SUGESP,1,15), DATA_EXTINCAO = TO_DATE(C6.DATA_EXCLUSAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE TIPO_AGRUP = C6.TIPO_AGRUP AND COD_AGRUP1 = vCOD1 AND COD_AGRUP2 = vCOD2 AND COD_AGRUP3 = vCOD3 AND COD_AGRUP4 = vCOD4 AND COD_AGRUP5 = vCOD5 AND COD_AGRUP6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*LOTAÇÃO*/
UPDATE RHORGA_LOTACAO SET ABREVIACAO = SUBSTR(C6.ABREV_SUGESP,1,15), DATA_EXTINCAO = TO_DATE(C6.DATA_EXCLUSAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_LOTACAO1 = VCOD1 AND COD_LOTACAO2 = vCOD2 AND COD_LOTACAO3 = vCOD3 AND COD_LOTACAO4 = vCOD4 AND COD_LOTACAO5 = vCOD5 AND COD_LOTACAO6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*UNIDADE*/
UPDATE RHORGA_UNIDADE SET ABREVIACAO = SUBSTR(C6.ABREV_SUGESP,1,15), DATA_EXTINCAO = TO_DATE(C6.DATA_EXCLUSAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_UNIDADE1 = VCOD1 AND COD_UNIDADE2 = vCOD2 AND COD_UNIDADE3 = vCOD3 AND COD_UNIDADE4 = vCOD4 AND COD_UNIDADE5 = vCOD5 AND COD_UNIDADE6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*CUSTO CONTABIL*/
UPDATE RHORGA_CUSTO_CONT SET ABREVIACAO = SUBSTR(C6.ABREV_SUGESP,1,15), DATA_EXTINCAO = TO_DATE(C6.DATA_EXCLUSAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_CCONTAB1 = VCOD1 AND COD_CCONTAB2 = vCOD2 AND COD_CCONTAB3 = vCOD3 AND COD_CCONTAB4 = vCOD4 AND COD_CCONTAB5 = vCOD5 AND COD_CCONTAB6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*CUSTO GERENCIAL*/
UPDATE RHORGA_CUSTO_GEREN SET ABREVIACAO = SUBSTR(C6.ABREV_SUGESP,1,15), DATA_EXTINCAO = TO_DATE(C6.DATA_EXCLUSAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_CGERENC1 = VCOD1 AND COD_CGERENC2 = vCOD2 AND COD_CGERENC3 = vCOD3 AND COD_CGERENC4 = vCOD4 AND COD_CGERENC5 = vCOD5 AND COD_CGERENC6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;

IF QTD_LINHAS_ALTERADA > 0 THEN 
/*NO FINAL DO PROCESSO SE FOI REALIZADO A ATUALIZAÇÃO DOS CAMPOS, ATUALIZA OS CAMPOS DE STATUS_PROCESSAMENTO COM O OK E A DATA DE PROCESSAMENTO COM A DATA DO DIA */
UPDATE ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT SET DATA_PROCESSAMENTO = SYSDATE, LOGIN_PROCESSAMENTO = 'LOGIN', STATUS_PROCESSAMENTO = 'OK'
WHERE CODIGO_EMPRESA = vCOD_EMPRESA AND COD_AGRUP1 = VCOD1 AND COD_AGRUP2 = VCOD2 AND COD_AGRUP3 = VCOD3 AND COD_AGRUP4 = VCOD4 AND COD_AGRUP5 = VCOD5
AND COD_AGRUP6 = VCOD6 AND NUMERO_LINHA = C6.NUMERO_LINHA AND TRUNC(DATA_CARGA) = TRUNC(C6.DATA_CARGA) AND DATA_PROCESSAMENTO IS NULL AND STATUS_PROCESSAMENTO IS NULL ; COMMIT WORK;
END IF;
END IF;

IF C6.COMPARACAO = 'ABREVIACAO DIFERENTE' AND C6.COD_AGRUP1_ORGA IS NOT NULL THEN
ATUALIZA:= 0;

/*AGRUPADOR NO TIPO_AGRUP L,C,U,G*/ 
UPDATE RHORGA_AGRUPADOR SET ABREVIACAO = SUBSTR(C6.ABREV_SUGESP,1,15), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE TIPO_AGRUP = C6.TIPO_AGRUP AND COD_AGRUP1 = vCOD1 AND COD_AGRUP2 = vCOD2 AND COD_AGRUP3 = vCOD3 AND COD_AGRUP4 = vCOD4 AND COD_AGRUP5 = vCOD5 AND COD_AGRUP6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*LOTAÇÃO*/
UPDATE RHORGA_LOTACAO SET ABREVIACAO = SUBSTR(C6.ABREV_SUGESP,1,15), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_LOTACAO1 = VCOD1 AND COD_LOTACAO2 = vCOD2 AND COD_LOTACAO3 = vCOD3 AND COD_LOTACAO4 = vCOD4 AND COD_LOTACAO5 = vCOD5 AND COD_LOTACAO6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*UNIDADE*/
UPDATE RHORGA_UNIDADE SET ABREVIACAO = SUBSTR(C6.ABREV_SUGESP,1,15), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_UNIDADE1 = VCOD1 AND COD_UNIDADE2 = vCOD2 AND COD_UNIDADE3 = vCOD3 AND COD_UNIDADE4 = vCOD4 AND COD_UNIDADE5 = vCOD5 AND COD_UNIDADE6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*CUSTO CONTABIL*/
UPDATE RHORGA_CUSTO_CONT SET ABREVIACAO = SUBSTR(C6.ABREV_SUGESP,1,15), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_CCONTAB1 = VCOD1 AND COD_CCONTAB2 = vCOD2 AND COD_CCONTAB3 = vCOD3 AND COD_CCONTAB4 = vCOD4 AND COD_CCONTAB5 = vCOD5 AND COD_CCONTAB6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*CUSTO GERENCIAL*/
UPDATE RHORGA_CUSTO_GEREN SET ABREVIACAO = SUBSTR(C6.ABREV_SUGESP,1,15), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_CGERENC1 = VCOD1 AND COD_CGERENC2 = vCOD2 AND COD_CGERENC3 = vCOD3 AND COD_CGERENC4 = vCOD4 AND COD_CGERENC5 = vCOD5 AND COD_CGERENC6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;

IF QTD_LINHAS_ALTERADA > 0 THEN 
/*NO FINAL DO PROCESSO SE FOI REALIZADO A ATUALIZAÇÃO DOS CAMPOS, ATUALIZA OS CAMPOS DE STATUS_PROCESSAMENTO COM O OK E A DATA DE PROCESSAMENTO COM A DATA DO DIA */
UPDATE ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT SET DATA_PROCESSAMENTO = SYSDATE, LOGIN_PROCESSAMENTO = 'LOGIN', STATUS_PROCESSAMENTO = 'OK'
WHERE CODIGO_EMPRESA = vCOD_EMPRESA AND COD_AGRUP1 = VCOD1 AND COD_AGRUP2 = VCOD2 AND COD_AGRUP3 = VCOD3 AND COD_AGRUP4 = VCOD4 AND COD_AGRUP5 = VCOD5
AND COD_AGRUP6 = VCOD6 AND NUMERO_LINHA = C6.NUMERO_LINHA AND TRUNC(DATA_CARGA) = TRUNC(C6.DATA_CARGA) AND DATA_PROCESSAMENTO IS NULL AND STATUS_PROCESSAMENTO IS NULL ; COMMIT WORK;
END IF;
END IF;

IF C6.COMPARACAO = 'DATA CRIACAO,DATA EXTINCAO DIFERENTE' AND C6.COD_AGRUP1_ORGA IS NOT NULL THEN
ATUALIZA:= 0;

/*AGRUPADOR NO TIPO_AGRUP L,C,U,G*/ 
UPDATE RHORGA_AGRUPADOR SET DATA_IMPLANT = TO_DATE(C6.DATA_CRIACAO,'DD/MM/YYYY'), DATA_EXTINCAO = TO_DATE(C6.DATA_EXCLUSAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE TIPO_AGRUP = C6.TIPO_AGRUP AND COD_AGRUP1 = vCOD1 AND COD_AGRUP2 = vCOD2 AND COD_AGRUP3 = vCOD3 AND COD_AGRUP4 = vCOD4 AND COD_AGRUP5 = vCOD5 AND COD_AGRUP6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*LOTAÇÃO*/
UPDATE RHORGA_LOTACAO SET DATA_IMPLANT = TO_DATE(C6.DATA_CRIACAO,'DD/MM/YYYY'), DATA_EXTINCAO = TO_DATE(C6.DATA_EXCLUSAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_LOTACAO1 = VCOD1 AND COD_LOTACAO2 = vCOD2 AND COD_LOTACAO3 = vCOD3 AND COD_LOTACAO4 = vCOD4 AND COD_LOTACAO5 = vCOD5 AND COD_LOTACAO6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*UNIDADE*/
UPDATE RHORGA_UNIDADE SET DATA_IMPLANT = TO_DATE(C6.DATA_CRIACAO,'DD/MM/YYYY'), DATA_EXTINCAO = TO_DATE(C6.DATA_EXCLUSAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_UNIDADE1 = VCOD1 AND COD_UNIDADE2 = vCOD2 AND COD_UNIDADE3 = vCOD3 AND COD_UNIDADE4 = vCOD4 AND COD_UNIDADE5 = vCOD5 AND COD_UNIDADE6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*CUSTO CONTABIL*/
UPDATE RHORGA_CUSTO_CONT SET DATA_IMPLANT = TO_DATE(C6.DATA_CRIACAO,'DD/MM/YYYY'), DATA_EXTINCAO = TO_DATE(C6.DATA_EXCLUSAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_CCONTAB1 = VCOD1 AND COD_CCONTAB2 = vCOD2 AND COD_CCONTAB3 = vCOD3 AND COD_CCONTAB4 = vCOD4 AND COD_CCONTAB5 = vCOD5 AND COD_CCONTAB6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*CUSTO GERENCIAL*/
UPDATE RHORGA_CUSTO_GEREN SET DATA_IMPLANT = TO_DATE(C6.DATA_CRIACAO,'DD/MM/YYYY'), DATA_EXTINCAO = TO_DATE(C6.DATA_EXCLUSAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_CGERENC1 = VCOD1 AND COD_CGERENC2 = vCOD2 AND COD_CGERENC3 = vCOD3 AND COD_CGERENC4 = vCOD4 AND COD_CGERENC5 = vCOD5 AND COD_CGERENC6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;

IF QTD_LINHAS_ALTERADA > 0 THEN 
/*NO FINAL DO PROCESSO SE FOI REALIZADO A ATUALIZAÇÃO DOS CAMPOS, ATUALIZA OS CAMPOS DE STATUS_PROCESSAMENTO COM O OK E A DATA DE PROCESSAMENTO COM A DATA DO DIA */
UPDATE ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT SET DATA_PROCESSAMENTO = SYSDATE, LOGIN_PROCESSAMENTO = 'LOGIN', STATUS_PROCESSAMENTO = 'OK'
WHERE CODIGO_EMPRESA = vCOD_EMPRESA AND COD_AGRUP1 = VCOD1 AND COD_AGRUP2 = VCOD2 AND COD_AGRUP3 = VCOD3 AND COD_AGRUP4 = VCOD4 AND COD_AGRUP5 = VCOD5
AND COD_AGRUP6 = VCOD6 AND NUMERO_LINHA = C6.NUMERO_LINHA AND TRUNC(DATA_CARGA) = TRUNC(C6.DATA_CARGA) AND DATA_PROCESSAMENTO IS NULL AND STATUS_PROCESSAMENTO IS NULL ; COMMIT WORK;
END IF;
END IF;

IF C6.COMPARACAO = 'DATA CRIACAO DIFERENTE' AND C6.COD_AGRUP1_ORGA IS NOT NULL THEN
ATUALIZA:= 0;

/*AGRUPADOR NO TIPO_AGRUP L,C,U,G*/ 
UPDATE RHORGA_AGRUPADOR SET DATA_IMPLANT = TO_DATE(C6.DATA_CRIACAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE TIPO_AGRUP = C6.TIPO_AGRUP AND COD_AGRUP1 = vCOD1 AND COD_AGRUP2 = vCOD2 AND COD_AGRUP3 = vCOD3 AND COD_AGRUP4 = vCOD4 AND COD_AGRUP5 = vCOD5 AND COD_AGRUP6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*LOTAÇÃO*/
UPDATE RHORGA_LOTACAO SET DATA_IMPLANT = TO_DATE(C6.DATA_CRIACAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_LOTACAO1 = VCOD1 AND COD_LOTACAO2 = vCOD2 AND COD_LOTACAO3 = vCOD3 AND COD_LOTACAO4 = vCOD4 AND COD_LOTACAO5 = vCOD5 AND COD_LOTACAO6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*UNIDADE*/
UPDATE RHORGA_UNIDADE SET DATA_IMPLANT = TO_DATE(C6.DATA_CRIACAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_UNIDADE1 = VCOD1 AND COD_UNIDADE2 = vCOD2 AND COD_UNIDADE3 = vCOD3 AND COD_UNIDADE4 = vCOD4 AND COD_UNIDADE5 = vCOD5 AND COD_UNIDADE6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*CUSTO CONTABIL*/
UPDATE RHORGA_CUSTO_CONT SET DATA_IMPLANT = TO_DATE(C6.DATA_CRIACAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_CCONTAB1 = VCOD1 AND COD_CCONTAB2 = vCOD2 AND COD_CCONTAB3 = vCOD3 AND COD_CCONTAB4 = vCOD4 AND COD_CCONTAB5 = vCOD5 AND COD_CCONTAB6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*CUSTO GERENCIAL*/
UPDATE RHORGA_CUSTO_GEREN SET DATA_IMPLANT = TO_DATE(C6.DATA_CRIACAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_CGERENC1 = VCOD1 AND COD_CGERENC2 = vCOD2 AND COD_CGERENC3 = vCOD3 AND COD_CGERENC4 = vCOD4 AND COD_CGERENC5 = vCOD5 AND COD_CGERENC6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;

IF QTD_LINHAS_ALTERADA > 0 THEN 
/*NO FINAL DO PROCESSO SE FOI REALIZADO A ATUALIZAÇÃO DOS CAMPOS, ATUALIZA OS CAMPOS DE STATUS_PROCESSAMENTO COM O OK E A DATA DE PROCESSAMENTO COM A DATA DO DIA */
UPDATE ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT SET DATA_PROCESSAMENTO = SYSDATE, LOGIN_PROCESSAMENTO = 'LOGIN', STATUS_PROCESSAMENTO = 'OK'
WHERE CODIGO_EMPRESA = vCOD_EMPRESA AND COD_AGRUP1 = VCOD1 AND COD_AGRUP2 = VCOD2 AND COD_AGRUP3 = VCOD3 AND COD_AGRUP4 = VCOD4 AND COD_AGRUP5 = VCOD5
AND COD_AGRUP6 = VCOD6 AND NUMERO_LINHA = C6.NUMERO_LINHA AND TRUNC(DATA_CARGA) = TRUNC(C6.DATA_CARGA) AND DATA_PROCESSAMENTO IS NULL AND STATUS_PROCESSAMENTO IS NULL ; COMMIT WORK;
END IF;
END IF;

IF C6.COMPARACAO = 'DATA EXTINCAO DIFERENTE' AND C6.COD_AGRUP1_ORGA IS NOT NULL THEN
ATUALIZA:= 0;

/*AGRUPADOR NO TIPO_AGRUP L,C,U,G*/ 
UPDATE RHORGA_AGRUPADOR SET DATA_EXTINCAO = TO_DATE(C6.DATA_EXCLUSAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE TIPO_AGRUP = C6.TIPO_AGRUP AND COD_AGRUP1 = vCOD1 AND COD_AGRUP2 = vCOD2 AND COD_AGRUP3 = vCOD3 AND COD_AGRUP4 = vCOD4 AND COD_AGRUP5 = vCOD5 AND COD_AGRUP6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*LOTAÇÃO*/
UPDATE RHORGA_LOTACAO SET DATA_EXTINCAO = TO_DATE(C6.DATA_EXCLUSAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_LOTACAO1 = VCOD1 AND COD_LOTACAO2 = vCOD2 AND COD_LOTACAO3 = vCOD3 AND COD_LOTACAO4 = vCOD4 AND COD_LOTACAO5 = vCOD5 AND COD_LOTACAO6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*UNIDADE*/
UPDATE RHORGA_UNIDADE SET DATA_EXTINCAO = TO_DATE(C6.DATA_EXCLUSAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_UNIDADE1 = VCOD1 AND COD_UNIDADE2 = vCOD2 AND COD_UNIDADE3 = vCOD3 AND COD_UNIDADE4 = vCOD4 AND COD_UNIDADE5 = vCOD5 AND COD_UNIDADE6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*CUSTO CONTABIL*/
UPDATE RHORGA_CUSTO_CONT SET DATA_EXTINCAO = TO_DATE(C6.DATA_EXCLUSAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_CCONTAB1 = VCOD1 AND COD_CCONTAB2 = vCOD2 AND COD_CCONTAB3 = vCOD3 AND COD_CCONTAB4 = vCOD4 AND COD_CCONTAB5 = vCOD5 AND COD_CCONTAB6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;
/*CUSTO GERENCIAL*/
UPDATE RHORGA_CUSTO_GEREN SET DATA_EXTINCAO = TO_DATE(C6.DATA_EXCLUSAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE COD_CGERENC1 = VCOD1 AND COD_CGERENC2 = vCOD2 AND COD_CGERENC3 = vCOD3 AND COD_CGERENC4 = vCOD4 AND COD_CGERENC5 = vCOD5 AND COD_CGERENC6 = vCOD6 AND CODIGO_EMPRESA = vCOD_EMPRESA;
QTD_LINHAS_ALTERADA:=SQL%ROWCOUNT; COMMIT WORK;

IF QTD_LINHAS_ALTERADA > 0 THEN 
/*NO FINAL DO PROCESSO SE FOI REALIZADO A ATUALIZAÇÃO DOS CAMPOS, ATUALIZA OS CAMPOS DE STATUS_PROCESSAMENTO COM O OK E A DATA DE PROCESSAMENTO COM A DATA DO DIA */
UPDATE ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT SET DATA_PROCESSAMENTO = SYSDATE, LOGIN_PROCESSAMENTO = 'LOGIN', STATUS_PROCESSAMENTO = 'OK'
WHERE CODIGO_EMPRESA = vCOD_EMPRESA AND COD_AGRUP1 = VCOD1 AND COD_AGRUP2 = VCOD2 AND COD_AGRUP3 = VCOD3 AND COD_AGRUP4 = VCOD4 AND COD_AGRUP5 = VCOD5
AND COD_AGRUP6 = VCOD6 AND NUMERO_LINHA = C6.NUMERO_LINHA AND TRUNC(DATA_CARGA) = TRUNC(C6.DATA_CARGA) AND DATA_PROCESSAMENTO IS NULL AND STATUS_PROCESSAMENTO IS NULL ; COMMIT WORK;
END IF;

END IF;

END LOOP;

--dbms_output.put_line('SAIU NO LOOP DA COMP E VAI ENTRAR NO LOOP DA AGRUPADOR_H');
/*INSERÇÃO/ATUALIZAÇÃO DO REGISTRO NA AGRUPADOR_H*/
BEGIN
SELECT DATA_DO_SISTEMA INTO vDATA_SISTEMA FROM RHPARM_P_SIST;
FOR C7 IN (
SELECT H.ANO_MES_REFERENCIA,
  G.*
FROM ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT N
LEFT JOIN RHORGA_AGRUPADOR G
ON G.COD_AGRUP1      = N.COD_AGRUP1
AND G.COD_AGRUP2     = N.COD_AGRUP2
AND G.COD_AGRUP3     = N.COD_AGRUP3
AND G.COD_AGRUP4     = N.COD_AGRUP4
AND G.COD_AGRUP5     = N.COD_AGRUP5
AND G.COD_AGRUP6     = N.COD_AGRUP6
AND G.CODIGO_EMPRESA = N.CODIGO_EMPRESA
LEFT JOIN
  (SELECT H.*
  FROM RHORGA_AGRUPADOR_H H
  WHERE H.TIPO_AGRUP      IN ('L','U','C','G')
  AND H.ANO_MES_REFERENCIA =
    (SELECT MAX (A.ANO_MES_REFERENCIA)
    FROM RHORGA_AGRUPADOR_H A
    WHERE A.COD_AGRUP1        = H.COD_AGRUP1
    AND A.COD_AGRUP2          = H.COD_AGRUP2
    AND A.COD_AGRUP3          = H.COD_AGRUP3
    AND A.COD_AGRUP4          = H.COD_AGRUP4
    AND A.COD_AGRUP5          = H.COD_AGRUP5
    AND A.COD_AGRUP6          = H.COD_AGRUP6
    AND A.CODIGO_EMPRESA      = H.CODIGO_EMPRESA
    AND A.TIPO_AGRUP          = A.TIPO_AGRUP
    AND A.ANO_MES_REFERENCIA <=
      (SELECT DATA_DO_SISTEMA FROM RHPARM_P_SIST
      )
    )
  ) H
ON H.COD_AGRUP1             = N.COD_AGRUP1
AND H.COD_AGRUP2            = N.COD_AGRUP2
AND H.COD_AGRUP3            = N.COD_AGRUP3
AND H.COD_AGRUP4            = N.COD_AGRUP4
AND H.COD_AGRUP5            = N.COD_AGRUP5
AND H.COD_AGRUP6            = N.COD_AGRUP6
AND H.CODIGO_EMPRESA        = N.CODIGO_EMPRESA
AND H.TIPO_AGRUP            = G.TIPO_AGRUP

WHERE N.COD_AGRUP1          = vCOD1
AND N.COD_AGRUP2            = vCOD2
AND N.COD_AGRUP3            = vCOD3
AND N.COD_AGRUP4            = vCOD4
AND N.COD_AGRUP5            = vCOD5
AND N.COD_AGRUP6            = vCOD6
AND N.CODIGO_EMPRESA        = vCOD_EMPRESA
AND N.NUMERO_LINHA          = vNUMERO_LINHA
AND N.DATA_CARGA            = TRUNC(vDATA_CARGA)
AND N.STATUS_PROCESSAMENTO  = 'OK'
AND N.FAZER = 'U'
) LOOP
--dbms_output.put_line('ENTROU NO LOOP DA ATUALIZAÇÃO');
IF C7.ANO_MES_REFERENCIA IS NOT NULL AND C7.ANO_MES_REFERENCIA >= TO_DATE(vDATA_SISTEMA,'DD/MM/YYYY') THEN
UPDATE RHORGA_AGRUPADOR_H SET DESCRICAO = C7.DESCRICAO, ABREVIACAO = C7.ABREVIACAO, DATA_IMPLANT = TO_DATE(C7.DATA_IMPLANT,'DD/MM/YYYY'), DATA_EXTINCAO = TO_DATE(C7.DATA_EXTINCAO,'DD/MM/YYYY'), LOGIN_USUARIO = 'IMPORT_PROJ_APOSENT', DT_ULT_ALTER_USUA = SYSDATE
WHERE TIPO_AGRUP = C7.TIPO_AGRUP AND COD_AGRUP1 = vCOD1 AND COD_AGRUP2 = vCOD2 AND COD_AGRUP3 = vCOD3 AND COD_AGRUP4 = vCOD4 AND COD_AGRUP5 = vCOD5 AND COD_AGRUP6 = vCOD6 AND 
CODIGO_EMPRESA = vCOD_EMPRESA AND ANO_MES_REFERENCIA = TO_DATE(C7.ANO_MES_REFERENCIA,'DD/MM/YYYY');

END IF;

IF C7.ANO_MES_REFERENCIA IS NULL OR C7.ANO_MES_REFERENCIA < TO_DATE(vDATA_SISTEMA,'DD/MM/YYYY') THEN
IF C7.TIPO_AGRUP = 'L' THEN 
AGRUPADOR_HIST.COD_AGRUP1 := vCOD1;
AGRUPADOR_HIST.COD_AGRUP2 := vCOD2;
AGRUPADOR_HIST.COD_AGRUP3 := vCOD3;
AGRUPADOR_HIST.COD_AGRUP4 := vCOD4;
AGRUPADOR_HIST.COD_AGRUP5 := vCOD5;
AGRUPADOR_HIST.COD_AGRUP6 := vCOD6;
AGRUPADOR_HIST.CODIGO_EMPRESA := vCOD_EMPRESA;
AGRUPADOR_HIST.DESCRICAO := C7.DESCRICAO;
AGRUPADOR_HIST.ABREVIACAO := SUBSTR(C7.ABREVIACAO,1,15);
AGRUPADOR_HIST.DATA_IMPLANT := C7.DATA_IMPLANT;
AGRUPADOR_HIST.DATA_EXTINCAO := C7.DATA_EXTINCAO;
AGRUPADOR_HIST.ANO_MES_REFERENCIA := vDATA_SISTEMA;
AGRUPADOR_HIST.LOGIN_USUARIO := 'IMPORT_PROJ_APOSENT';
AGRUPADOR_HIST.DT_ULT_ALTER_USUA := SYSDATE;
AGRUPADOR_HIST.ID_AGRUP := C7.ID_AGRUP;
AGRUPADOR_HIST.TIPO_AGRUP := 'L';
AGRUPADOR_HIST.COD_AGRUP_SUP1 := C7.COD_AGRUP_SUP1;
AGRUPADOR_HIST.COD_AGRUP_SUP2 := C7.COD_AGRUP_SUP2;
AGRUPADOR_HIST.COD_AGRUP_SUP3 := C7.COD_AGRUP_SUP3;
AGRUPADOR_HIST.COD_AGRUP_SUP4 := C7.COD_AGRUP_SUP4;
AGRUPADOR_HIST.COD_AGRUP_SUP5 := C7.COD_AGRUP_SUP5;
AGRUPADOR_HIST.COD_AGRUP_SUP6 := C7.COD_AGRUP_SUP6;

INSERT INTO RHORGA_AGRUPADOR_H VALUES AGRUPADOR_HIST;
QTD_LINHAS_AFETADAS:=SQL%ROWCOUNT;
COMMIT WORK;
END IF;

IF C7.TIPO_AGRUP = 'U' THEN 
AGRUPADOR_HIST.COD_AGRUP1 := vCOD1;
AGRUPADOR_HIST.COD_AGRUP2 := vCOD2;
AGRUPADOR_HIST.COD_AGRUP3 := vCOD3;
AGRUPADOR_HIST.COD_AGRUP4 := vCOD4;
AGRUPADOR_HIST.COD_AGRUP5 := vCOD5;
AGRUPADOR_HIST.COD_AGRUP6 := vCOD6;
AGRUPADOR_HIST.CODIGO_EMPRESA := vCOD_EMPRESA;
AGRUPADOR_HIST.DESCRICAO := C7.DESCRICAO;
AGRUPADOR_HIST.ABREVIACAO := SUBSTR(C7.ABREVIACAO,1,15);
AGRUPADOR_HIST.DATA_IMPLANT := C7.DATA_IMPLANT;
AGRUPADOR_HIST.DATA_EXTINCAO := C7.DATA_EXTINCAO;
AGRUPADOR_HIST.ANO_MES_REFERENCIA := vDATA_SISTEMA;
AGRUPADOR_HIST.LOGIN_USUARIO := 'IMPORT_PROJ_APOSENT';
AGRUPADOR_HIST.DT_ULT_ALTER_USUA := SYSDATE;
AGRUPADOR_HIST.ID_AGRUP := C7.ID_AGRUP;
AGRUPADOR_HIST.TIPO_AGRUP := 'U';
AGRUPADOR_HIST.COD_AGRUP_SUP1 := C7.COD_AGRUP_SUP1;
AGRUPADOR_HIST.COD_AGRUP_SUP2 := C7.COD_AGRUP_SUP2;
AGRUPADOR_HIST.COD_AGRUP_SUP3 := C7.COD_AGRUP_SUP3;
AGRUPADOR_HIST.COD_AGRUP_SUP4 := C7.COD_AGRUP_SUP4;
AGRUPADOR_HIST.COD_AGRUP_SUP5 := C7.COD_AGRUP_SUP5;
AGRUPADOR_HIST.COD_AGRUP_SUP6 := C7.COD_AGRUP_SUP6;

INSERT INTO RHORGA_AGRUPADOR_H VALUES AGRUPADOR_HIST;
QTD_LINHAS_AFETADAS:=SQL%ROWCOUNT;
COMMIT WORK;
END IF;

IF C7.TIPO_AGRUP = 'G' THEN 
AGRUPADOR_HIST.COD_AGRUP1 := vCOD1;
AGRUPADOR_HIST.COD_AGRUP2 := vCOD2;
AGRUPADOR_HIST.COD_AGRUP3 := vCOD3;
AGRUPADOR_HIST.COD_AGRUP4 := vCOD4;
AGRUPADOR_HIST.COD_AGRUP5 := vCOD5;
AGRUPADOR_HIST.COD_AGRUP6 := vCOD6;
AGRUPADOR_HIST.CODIGO_EMPRESA := vCOD_EMPRESA;
AGRUPADOR_HIST.DESCRICAO := C7.DESCRICAO;
AGRUPADOR_HIST.ABREVIACAO := SUBSTR(C7.ABREVIACAO,1,15);
AGRUPADOR_HIST.DATA_IMPLANT := C7.DATA_IMPLANT;
AGRUPADOR_HIST.DATA_EXTINCAO := C7.DATA_EXTINCAO;
AGRUPADOR_HIST.ANO_MES_REFERENCIA := vDATA_SISTEMA;
AGRUPADOR_HIST.LOGIN_USUARIO := 'IMPORT_PROJ_APOSENT';
AGRUPADOR_HIST.DT_ULT_ALTER_USUA := SYSDATE;
AGRUPADOR_HIST.ID_AGRUP := C7.ID_AGRUP;
AGRUPADOR_HIST.TIPO_AGRUP := 'G';
AGRUPADOR_HIST.COD_AGRUP_SUP1 := C7.COD_AGRUP_SUP1;
AGRUPADOR_HIST.COD_AGRUP_SUP2 := C7.COD_AGRUP_SUP2;
AGRUPADOR_HIST.COD_AGRUP_SUP3 := C7.COD_AGRUP_SUP3;
AGRUPADOR_HIST.COD_AGRUP_SUP4 := C7.COD_AGRUP_SUP4;
AGRUPADOR_HIST.COD_AGRUP_SUP5 := C7.COD_AGRUP_SUP5;
AGRUPADOR_HIST.COD_AGRUP_SUP6 := C7.COD_AGRUP_SUP6;

INSERT INTO RHORGA_AGRUPADOR_H VALUES AGRUPADOR_HIST;
QTD_LINHAS_AFETADAS:=SQL%ROWCOUNT;
COMMIT WORK;
END IF;

IF C7.TIPO_AGRUP = 'C' THEN 
AGRUPADOR_HIST.COD_AGRUP1 := vCOD1;
AGRUPADOR_HIST.COD_AGRUP2 := vCOD2;
AGRUPADOR_HIST.COD_AGRUP3 := vCOD3;
AGRUPADOR_HIST.COD_AGRUP4 := vCOD4;
AGRUPADOR_HIST.COD_AGRUP5 := vCOD5;
AGRUPADOR_HIST.COD_AGRUP6 := vCOD6;
AGRUPADOR_HIST.CODIGO_EMPRESA := vCOD_EMPRESA;
AGRUPADOR_HIST.DESCRICAO := C7.DESCRICAO;
AGRUPADOR_HIST.ABREVIACAO := SUBSTR(C7.ABREVIACAO,1,15);
AGRUPADOR_HIST.DATA_IMPLANT := C7.DATA_IMPLANT;
AGRUPADOR_HIST.DATA_EXTINCAO := C7.DATA_EXTINCAO;
AGRUPADOR_HIST.ANO_MES_REFERENCIA := vDATA_SISTEMA;
AGRUPADOR_HIST.LOGIN_USUARIO := 'IMPORT_PROJ_APOSENT';
AGRUPADOR_HIST.DT_ULT_ALTER_USUA := SYSDATE;
AGRUPADOR_HIST.ID_AGRUP := C7.ID_AGRUP;
AGRUPADOR_HIST.TIPO_AGRUP := 'C';
AGRUPADOR_HIST.COD_AGRUP_SUP1 := C7.COD_AGRUP_SUP1;
AGRUPADOR_HIST.COD_AGRUP_SUP2 := C7.COD_AGRUP_SUP2;
AGRUPADOR_HIST.COD_AGRUP_SUP3 := C7.COD_AGRUP_SUP3;
AGRUPADOR_HIST.COD_AGRUP_SUP4 := C7.COD_AGRUP_SUP4;
AGRUPADOR_HIST.COD_AGRUP_SUP5 := C7.COD_AGRUP_SUP5;
AGRUPADOR_HIST.COD_AGRUP_SUP6 := C7.COD_AGRUP_SUP6;

INSERT INTO RHORGA_AGRUPADOR_H VALUES AGRUPADOR_HIST;
QTD_LINHAS_AFETADAS:=SQL%ROWCOUNT;
COMMIT WORK;
END IF;

END IF;
INSERCAO := 1;
END LOOP;
END;

RETURN ATUALIZA; /*SE RETORNAR IGUAL A 1 INDICA QUE O DADO FOI ATUALIZADO*/

END; /*FIM FUNÇÃO*/


/* FOR ONDE IRÁ INICIAR TODO O PROCESSO */
BEGIN
--dbms_output.enable(NULL);

FOR C1 IN (
SELECT FAZER,
  CODIGO_EMPRESA,
  COD_AGRUP1,
  COD_AGRUP2,
  COD_AGRUP3,
  COD_AGRUP4,
  COD_AGRUP5,
  COD_AGRUP6,
  AGRUP_SUP1,
  AGRUP_SUP2,
  AGRUP_SUP3,
  AGRUP_SUP4,
  AGRUP_SUP5,
  AGRUP_SUP6,
  DESCRICAO,
  SUBSTR(ABREVIACAO,1,15) AS ABREVIACAO,
  DATA_CRIACAO,
  DATA_EXCLUSAO,
  DATA_CARGA,
  DATA_PROCESSAMENTO,
  LOGIN_PROCESSAMENTO,
  STATUS_PROCESSAMENTO,
  LOGIN_USUARIO,
  DT_ULT_ALTER_USUA,
  COD_AGRUP1_NOVO,
  NUMERO_LINHA,
  ANALISE
FROM ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT
WHERE DATA_CARGA =
  (SELECT MAX (a.DATA_CARGA)
  FROM ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT a
  WHERE a.COD_AGRUP1   = ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.COD_AGRUP1
  AND a.COD_AGRUP2     = ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.COD_AGRUP2
  AND a.COD_AGRUP3     = ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.COD_AGRUP3
  AND a.COD_AGRUP4     = ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.COD_AGRUP4
  AND a.COD_AGRUP5     = ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.COD_AGRUP5
  AND a.COD_AGRUP6     = ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.COD_AGRUP6
  AND a.codigo_empresa = ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.codigo_empresa
  AND a.NUMERO_LINHA   = ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT.NUMERO_LINHA
  )
AND FAZER NOT IN ('N')
ORDER BY CODIGO_EMPRESA, COD_AGRUP1, COD_AGRUP2, COD_AGRUP3, COD_AGRUP4, COD_AGRUP5, COD_AGRUP6, NUMERO_LINHA

)LOOP

/*SE FOR UMA ATUALIZAÇÃO NO CAMPOS DE DESCRICAO, ABREVIAÇÃO, DATA DE CRIAÇÃO E EXTINÇÃO, IRA ENTRAR NA FUNÇÃO ABAIXO*/
IF C1.STATUS_PROCESSAMENTO IS NULL AND C1.DATA_PROCESSAMENTO IS NULL AND C1.FAZER = 'U' THEN 
ATUALIZA_CAMPOS := COMPARA_CAMPOS ( C1.COD_AGRUP1, C1.COD_AGRUP2, C1.COD_AGRUP3, C1.COD_AGRUP4, C1.COD_AGRUP5, C1.COD_AGRUP6, C1.CODIGO_EMPRESA, C1.NUMERO_LINHA, C1.DATA_CARGA);

END IF; 

/*SE O DADO RECUPERADO NA TABELA TEMPORARIA POSSUI O STATUS_PROCESSAMENTO IS NULL E DATA DE PROCESSAMENTO IS NULL, IRÁ ENTRAR NA FUNÇÃO ONDE ANALISA SE O LOCAL ESTA CORRETO,
COM DATA DE INICIO, FIM E DESCRIÇÃO PREENCHIDA */
IF C1.STATUS_PROCESSAMENTO IS NULL AND C1.DATA_PROCESSAMENTO IS NULL AND C1.FAZER = 'I' THEN 
ANALISA_C := ANALISA_LOCAL ( C1.COD_AGRUP1, C1.COD_AGRUP2, C1.COD_AGRUP3, C1.COD_AGRUP4, C1.COD_AGRUP5, C1.COD_AGRUP6, C1.CODIGO_EMPRESA, C1.NUMERO_LINHA);

END IF; 

/*SE NA FUNÇÃO QUE ANALISA_LOCAL O DADO RETORNAR COM O VALOR DE 1, ONDE INDICA SE O LOCAL ESTA CORRETO, IRÁ CRIAR O CODIGO DE ACORDO COM A REGRA DA FUNÇÃO CRIACAO_COD */
IF ANALISA_C = 1 AND C1.STATUS_PROCESSAMENTO IS NULL AND C1.DATA_PROCESSAMENTO IS NULL AND C1.FAZER = 'I' THEN 

COD_AGRUP_NOVO := RETORNO_NOVO_CODIGO(NULL,0);
COD_AGRUP_NOVO := CRIACAO_COD ( C1.COD_AGRUP1, C1.COD_AGRUP2, C1.COD_AGRUP3, C1.COD_AGRUP4, C1.COD_AGRUP5, C1.COD_AGRUP6, C1.CODIGO_EMPRESA, C1.NUMERO_LINHA, C1.DATA_CARGA);
END IF;

/*SE NA FUNÇÃO QUE ANALISA_LOCAL E CRIACAO_COD O DADO RETORNAR COM O VALOR DE 1 E O DADO NÃO FOI PROCESSADO, IRÁ REALIZAR A INSERÇÃO NA TABELA RHORGA_AGRUPADOR E CHAMARÁ A FUNÇAO INSERT_INDIVIDUAL
PARA REALIZAR A INSERÇÃO NAS DEMAIS TABELAS */
IF COD_AGRUP_NOVO.REC_COD = 1 AND ANALISA_C = 1 AND C1.STATUS_PROCESSAMENTO IS NULL AND C1.DATA_PROCESSAMENTO IS NULL AND C1.FAZER = 'I' THEN
QTD_LINHAS_AFETADAS:=0;

--TIPO LOTAÇÃO
INSERT INTO RHORGA_AGRUPADOR (COD_AGRUP1, COD_AGRUP2, COD_AGRUP3, COD_AGRUP4, COD_AGRUP5, COD_AGRUP6, CODIGO_EMPRESA, DESCRICAO, LOGIN_USUARIO, DT_ULT_ALTER_USUA,ID_AGRUP,  c_livre_data16, TIPO_AGRUP, CGC, motivo_extincao, texto_associado, data_implant,DATA_EXTINCAO, LOGO, abreviacao, cgc_consol, razao_social, NATUREZA_ESTAB, COD_CALENDARIO, CEI_VALIDO, EMPRESA_PEQ_PORTE, MICROEMPRESA, PARTICIPA_PAT, ente_fed_resp_esocial, tp_insc_contra_esocial, COD_AGRUP_SUP1, COD_AGRUP_SUP2, COD_AGRUP_SUP3, COD_AGRUP_SUP4, COD_AGRUP_SUP5, COD_AGRUP_SUP6)
VALUES (LPAD(COD_AGRUP_NOVO.NOVO_COD,6,0),LPAD(C1.COD_AGRUP2,6,0),LPAD(C1.COD_AGRUP3,6,0),LPAD(C1.COD_AGRUP4,6,0),LPAD(C1.COD_AGRUP5,6,0),LPAD(C1.COD_AGRUP6,6,0),C1.CODIGO_EMPRESA,SUBSTR(C1.DESCRICAO,1,100),'IMPORT_PROJ_APOSENT',SYSDATE, (select max(id_agrup) + 1 from rhorga_agrupador where codigo_empresa = C1.CODIGO_EMPRESA),SYSDATE,'L', '18715383000140', 'EXCL', C1.DESCRICAO, C1.DATA_CRIACAO,c1.DATA_EXCLUSAO,'logo_pbh.png', C1.abreviacao, '18715383000140', 'PREF.MUN.BELO HORIZONTE', '0005', '0001', 'N', 'N', 'N', 'N', ' ', '1', C1.AGRUP_SUP1, C1.AGRUP_SUP2, C1.AGRUP_SUP3, C1.AGRUP_SUP4, C1.AGRUP_SUP5, C1.AGRUP_SUP6);
QTD_LINHAS_AFETADAS:=SQL%ROWCOUNT;
COMMIT WORK;

-- TIPO UNIDADE 
INSERT INTO RHORGA_AGRUPADOR (COD_AGRUP1, COD_AGRUP2, COD_AGRUP3, COD_AGRUP4, COD_AGRUP5, COD_AGRUP6, CODIGO_EMPRESA, DESCRICAO, LOGIN_USUARIO, DT_ULT_ALTER_USUA,ID_AGRUP,  c_livre_data16, TIPO_AGRUP, CGC, motivo_extincao, texto_associado, data_implant, DATA_EXTINCAO,LOGO, abreviacao, cgc_consol, razao_social, NATUREZA_ESTAB, COD_CALENDARIO, CEI_VALIDO, EMPRESA_PEQ_PORTE, MICROEMPRESA, PARTICIPA_PAT, ente_fed_resp_esocial, tp_insc_contra_esocial, COD_AGRUP_SUP1, COD_AGRUP_SUP2, COD_AGRUP_SUP3, COD_AGRUP_SUP4, COD_AGRUP_SUP5, COD_AGRUP_SUP6)
VALUES (LPAD(COD_AGRUP_NOVO.NOVO_COD,6,0),LPAD(C1.COD_AGRUP2,6,0),LPAD(C1.COD_AGRUP3,6,0),LPAD(C1.COD_AGRUP4,6,0),LPAD(C1.COD_AGRUP5,6,0),LPAD(C1.COD_AGRUP6,6,0),C1.CODIGO_EMPRESA,SUBSTR(C1.DESCRICAO,1,100),'IMPORT_PROJ_APOSENT',SYSDATE, (select max(id_agrup) + 1 from rhorga_agrupador where codigo_empresa = C1.CODIGO_EMPRESA),SYSDATE,'U', '18715383000140', 'EXCL', C1.DESCRICAO, C1.DATA_CRIACAO,c1.DATA_EXCLUSAO,'logo_pbh.png', C1.abreviacao, '18715383000140', 'PREF.MUN.BELO HORIZONTE', '0005', '0001', 'N', 'N', 'N', 'N', ' ', '1', C1.AGRUP_SUP1, C1.AGRUP_SUP2, C1.AGRUP_SUP3, C1.AGRUP_SUP4, C1.AGRUP_SUP5, C1.AGRUP_SUP6);
QTD_LINHAS_AFETADAS:=SQL%ROWCOUNT;
COMMIT WORK;

-- TIPO CUSTO CONTABIL
INSERT INTO RHORGA_AGRUPADOR (COD_AGRUP1, COD_AGRUP2, COD_AGRUP3, COD_AGRUP4, COD_AGRUP5, COD_AGRUP6, CODIGO_EMPRESA, DESCRICAO, LOGIN_USUARIO, DT_ULT_ALTER_USUA,ID_AGRUP,  c_livre_data16, TIPO_AGRUP, CGC, motivo_extincao, texto_associado, data_implant, DATA_EXTINCAO, LOGO, abreviacao, cgc_consol, razao_social, NATUREZA_ESTAB, COD_CALENDARIO, CEI_VALIDO, EMPRESA_PEQ_PORTE, MICROEMPRESA, PARTICIPA_PAT, ente_fed_resp_esocial, tp_insc_contra_esocial, COD_AGRUP_SUP1, COD_AGRUP_SUP2, COD_AGRUP_SUP3, COD_AGRUP_SUP4, COD_AGRUP_SUP5, COD_AGRUP_SUP6)
VALUES (LPAD(COD_AGRUP_NOVO.NOVO_COD,6,0),LPAD(C1.COD_AGRUP2,6,0),LPAD(C1.COD_AGRUP3,6,0),LPAD(C1.COD_AGRUP4,6,0),LPAD(C1.COD_AGRUP5,6,0),LPAD(C1.COD_AGRUP6,6,0),C1.CODIGO_EMPRESA,SUBSTR(C1.DESCRICAO,1,100),'IMPORT_PROJ_APOSENT',SYSDATE, (select max(id_agrup) + 1 from rhorga_agrupador where codigo_empresa = C1.CODIGO_EMPRESA),SYSDATE,'C', '18715383000140', 'EXCL', C1.DESCRICAO, C1.DATA_CRIACAO,c1.DATA_EXCLUSAO,'logo_pbh.png', C1.abreviacao, '18715383000140', 'PREF.MUN.BELO HORIZONTE', '0005', '0001', 'N', 'N', 'N', 'N', ' ', '1', C1.AGRUP_SUP1, C1.AGRUP_SUP2, C1.AGRUP_SUP3, C1.AGRUP_SUP4, C1.AGRUP_SUP5, C1.AGRUP_SUP6);
QTD_LINHAS_AFETADAS:=SQL%ROWCOUNT;
COMMIT WORK;

-- TIPO CUSTO GERENCIAL
INSERT INTO RHORGA_AGRUPADOR (COD_AGRUP1, COD_AGRUP2, COD_AGRUP3, COD_AGRUP4, COD_AGRUP5, COD_AGRUP6, CODIGO_EMPRESA, DESCRICAO, LOGIN_USUARIO, DT_ULT_ALTER_USUA,ID_AGRUP,  c_livre_data16, TIPO_AGRUP, CGC, motivo_extincao, texto_associado, data_implant, DATA_EXTINCAO, LOGO, abreviacao, cgc_consol, razao_social, NATUREZA_ESTAB, COD_CALENDARIO, CEI_VALIDO, EMPRESA_PEQ_PORTE, MICROEMPRESA, PARTICIPA_PAT, ente_fed_resp_esocial, tp_insc_contra_esocial, COD_AGRUP_SUP1, COD_AGRUP_SUP2, COD_AGRUP_SUP3, COD_AGRUP_SUP4, COD_AGRUP_SUP5, COD_AGRUP_SUP6)
VALUES (LPAD(COD_AGRUP_NOVO.NOVO_COD,6,0),LPAD(C1.COD_AGRUP2,6,0),LPAD(C1.COD_AGRUP3,6,0),LPAD(C1.COD_AGRUP4,6,0),LPAD(C1.COD_AGRUP5,6,0),LPAD(C1.COD_AGRUP6,6,0),C1.CODIGO_EMPRESA,SUBSTR(C1.DESCRICAO,1,100),'IMPORT_PROJ_APOSENT',SYSDATE, (select max(id_agrup) + 1 from rhorga_agrupador where codigo_empresa = C1.CODIGO_EMPRESA),SYSDATE,'G', '18715383000140', 'EXCL', C1.DESCRICAO, C1.DATA_CRIACAO,c1.DATA_EXCLUSAO,'logo_pbh.png', C1.abreviacao, '18715383000140', 'PREF.MUN.BELO HORIZONTE', '0005', '0001', 'N', 'N', 'N', 'N', ' ', '1', C1.AGRUP_SUP1, C1.AGRUP_SUP2, C1.AGRUP_SUP3, C1.AGRUP_SUP4, C1.AGRUP_SUP5, C1.AGRUP_SUP6);
QTD_LINHAS_AFETADAS:=SQL%ROWCOUNT;
COMMIT WORK;

IF QTD_LINHAS_AFETADAS > 0 THEN 
/* FUNÇÃO PARA REALIZAR A INSERÇÃO NAS TABELAS INDIVIDUAIS (UNIDADE, LOTAÇÃO, CONTABIL, GERENCIAL) E NA AGRUPADORA */ 
INSERT_LOCAL := INSERT_INDIVIDUAL(COD_AGRUP_NOVO.NOVO_COD, C1.COD_AGRUP2, C1.COD_AGRUP3, C1.COD_AGRUP4, C1.COD_AGRUP5, C1.COD_AGRUP6, C1.CODIGO_EMPRESA, C1.NUMERO_LINHA, C1.DATA_CARGA);


/*NO FINAL DO PROCESSO SE FOI REALIZADO A INSERÇÃO ATUALIZA OS CAMPOS DE STATUS_PROCESSAMENTO COM O OK E A DATA DE PROCESSAMENTO COM A DATA DO DIA */
UPDATE ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT SET DATA_PROCESSAMENTO = SYSDATE, LOGIN_PROCESSAMENTO = 'LOGIN', STATUS_PROCESSAMENTO = 'OK'
WHERE CODIGO_EMPRESA = ''||C1.CODIGO_EMPRESA||'' AND COD_AGRUP1 = ''||C1.COD_AGRUP1||'' AND COD_AGRUP2 = ''||C1.COD_AGRUP2||'' AND COD_AGRUP3 = ''||C1.COD_AGRUP3||'' AND COD_AGRUP4 = ''||C1.COD_AGRUP4||'' AND COD_AGRUP5 = ''||C1.COD_AGRUP5||''
AND COD_AGRUP6 = ''||C1.COD_AGRUP6||'' AND NUMERO_LINHA = ''||C1.NUMERO_LINHA||'' AND TRUNC(DATA_CARGA) = ''||TRUNC(C1.DATA_CARGA)||'' AND DATA_PROCESSAMENTO IS NULL AND STATUS_PROCESSAMENTO IS NULL ; COMMIT WORK;
END IF;

END IF;

END LOOP;
UPDATE ARTERH.SUGESP_LOCAIS_APOSENT_IMPORT SET DATA_PROCESSAMENTO = SYSDATE, LOGIN_PROCESSAMENTO = 'LOGIN', STATUS_PROCESSAMENTO = 'N', ANALISE = 'DADO NÃO PROCESSADO' WHERE DATA_PROCESSAMENTO IS NULL AND STATUS_PROCESSAMENTO IS NULL ;
END; 
END SUGESP_IMPORTA_LOCAIS_APOSENT;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "ARTERH"."PR_CARGA_TRANSPARENCIA" (PVMES IN  VARCHAR2,PVANO IN  VARCHAR2) AS
BEGIN
DECLARE
VANO_MES VARCHAR2(30);
VMES  VARCHAR2(02) := PVMES;
VANO VARCHAR2(04) := PVANO;
VDATA VARCHAR2(10);
BEGIN ------- 1
DBMS_OUTPUT.ENABLE(NULL);
VDATA := TO_CHAR('01/'|| VMES||'/'||VANO);

DECLARE
VCONTROLE1 NUMBER;
VCONTROLE2 NUMBER;
BEGIN -----2

DBMS_OUTPUT.PUT_LINE(VDATA);
VCONTROLE1:=0;
SELECT COUNT(1) QUANT  INTO VCONTROLE1 FROM PBHMOVI_TRANSP;
IF VCONTROLE1  IS NOT NULL THEN
DELETE FROM  PBHMOVI_TRANSP;
COMMIT;
END IF;
VCONTROLE2:=0;
SELECT COUNT(1) QUANT  INTO VCONTROLE2 FROM PBHPESS_TRANSP;
IF VCONTROLE2  IS NOT NULL THEN
DELETE FROM  PBHPESS_TRANSP;
COMMIT;
END IF;


END;----2
--IF (VCONTROLE3 IS NULL OR VCONTROLE3 = 0) AND (VCONTROLE2 IS NULL OR VCONTROLE2 = 0) AND(VCONTROLE1 IS NULL OR VCONTROLE1 = 0)
--THEN

BEGIN ---3
INSERT INTO PBHMOVI_TRANSP SELECT * FROM ARTERH.RHMOVI_MOVIMENTO WHERE TRUNC(ANO_MES_REFERENCIA)= TRUNC(TO_DATE(VDATA,'DD/MM/YYYY'));

COMMIT;
INSERT INTO PBHPESS_TRANSP SELECT C.* FROM ARTERH.RHPESS_CONTRATO C, ARTERH.RHPARM_SIT_FUNC F WHERE F.CONTROLE_FOLHA IN ('N','L','M') AND
C.DATA_RESCISAO IS NULL AND C.SITUACAO_FUNCIONAL = F.CODIGO AND TRUNC(ANO_MES_REFERENCIA)=
(SELECT MAX (A.ANO_MES_REFERENCIA)
FROM ARTERH.RHPESS_CONTRATO A
WHERE A.CODIGO            = C.CODIGO
AND A.CODIGO_EMPRESA      = C.CODIGO_EMPRESA
AND A.TIPO_CONTRATO       = C.TIPO_CONTRATO
AND A.ANO_MES_REFERENCIA <= TO_DATE(VDATA, 'DD/MM/YYYY')
);
COMMIT;
END;---3
   ---END IF;
END;---1
END;
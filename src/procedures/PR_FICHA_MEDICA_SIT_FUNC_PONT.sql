
  CREATE OR REPLACE EDITIONABLE PROCEDURE "ARTERH"."PR_FICHA_MEDICA_SIT_FUNC_PONT" (  CODIGO_EMPRESA IN VARCHAR2, CODIGO_PESSOA IN VARCHAR2,  DATA_OCORRENCIA IN VARCHAR2, OCORRENCIA IN number
, ID IN NUMBER, TABELA IN VARCHAR2, FAZER IN VARCHAR2 --, NEW_DATA_INI_AFAST DATE, OLD_DATA_INI_AFAST DATE, NEW_DATA_FIM_AFAST DATE, OLD_DATA_FIM_AFAST DATE
, DADO_ORIGEM_TC1 IN VARCHAR2, DADO_DESTINO_TC1 IN VARCHAR2, DADO_ORIGEM_TC2 IN VARCHAR2, DADO_DESTINO_TC2 IN VARCHAR2, DADO_ORIGEM_TC3 IN VARCHAR2, DADO_DESTINO_TC3 IN VARCHAR2
, TEM_CARGO_EFETIVO IN VARCHAR2
, ORIGEM IN VARCHAR2
, ID_EXTERNO IN VARCHAR2

) AS
--KELLYSSON 30/8/19

BEGIN-- 1 BEGIN
dbms_output.enable(null);

DECLARE
vCODIGO_EMPRESA VARCHAR2(4);
vCODIGO_PESSOA VARCHAR2(15);
vDATA_OCORRENCIA VARCHAR2(8);
vDT_REG_OCORRENCIA date;
vOCORRENCIA number;
vORIGEM VARCHAR2 (1);
vID_EXTERNO NUMBER;

vID number;
vTIPO_CONTRATO VARCHAR2(4);
vCODIGO_CONTRATO VARCHAR2(15);
vDT_INI_AFAST DATE;
vDT_FIM_AFAST DATE;

vTABELA VARCHAR2(30);
vFAZER VARCHAR2(100);
vNEW_DATA_INI_AFAST DATE;
vOLD_DATA_INI_AFAST DATE;
vNEW_DATA_FIM_AFAST DATE;
vOLD_DATA_FIM_AFAST DATE;
vDADO_ORIGEM_TC1 VARCHAR2(80);
vDADO_DESTINO_TC1 VARCHAR2(80);
vDADO_ORIGEM_TC2 VARCHAR2(80);
vDADO_DESTINO_TC2 VARCHAR2(80);
vDADO_ORIGEM_TC3 VARCHAR2(80);
vDADO_DESTINO_TC3 VARCHAR2(80);
vTEM_CARGO_EFETIVO VARCHAR2(3 BYTE);

vSIT_FUNC_ESTAVA VARCHAR2(4);
vDATA_INI_ESTAVA  DATE;
vDATA_FIM_ESTAVA  DATE;
vPROXIMA_SIT_ESTAVA VARCHAR2(4);
vDATA_INI_GRAVAR  DATE;
vDATA_FIM_GRAVAR DATE;
vDATA_INI_NAO_GRAVAR DATE;
vDATA_FIM_NAO_GRAVAR DATE;

vSIT_FUNC_DIA_ANTERIOR VARCHAR2(4);
vCONTROLE_FOLHA_ANTERIOR VARCHAR2(1);
vE_AFASTAMENTO_ANTERIOR VARCHAR2(1);
vDATA_INI_ESTAVA_DIA_ANT  DATE;
vDATA_FIM_ESTAVA_DIA_ANT  DATE;

vDE_PROXIMA_SITUACAO VARCHAR2(4);
vPARA_PROXIMA_SITUACAO VARCHAR2(4);

vLOGIN_USUARIO VARCHAR2(40);
vLOGIN_OS VARCHAR2(40);
vPOSSUI_INTERVALOS VARCHAR2 (1);
vDIA_ANTERIOR DATE;
vULT_DATA_INI_ANTES_DEFERIDO DATE;
vULT_DATA_FIM_ANTES_DEFERIDO DATE; --difere novo
--vULT_CONTROLE_FOLHA_ANTES_DEF VARCHAR2(1);
vINTERVALO NUMBER;
vDT_INI_AFAST_CORTE DATE;
--vE_RETROATIVO VARCHAR2(1);--Kellysson comentou em 17/10/19

vULT_DIA_APUR_IFPONTO DATE;

vEMPRESA_ATENDENTE VARCHAR2(4);
vCODIGO_ATENDENTE VARCHAR2(15);
vNOME_ATENDENTE VARCHAR2(70);
vINSCRICAO_CONSELHO VARCHAR2(30);
vUF_INSCRICAO VARCHAR2(4);
vCONSELHO_REGIONAL  VARCHAR2(4);
vCODIGO_DOENCA VARCHAR2(15);

vPESSOA_APOSENTADA VARCHAR2 (1); --NOVO EM 28/7/21
vCODIGO_PROC_MED VARCHAR2(15);--NOVO EM 15/10/21

vTEM_SF_ESPECIFICA VARCHAR2 (3); --NOVO EM 25/7/22

BEGIN -- 2 BEGIN
vCODIGO_EMPRESA := CODIGO_EMPRESA;
vCODIGO_PESSOA := CODIGO_PESSOA;
vDATA_OCORRENCIA := DATA_OCORRENCIA;
vDT_REG_OCORRENCIA:= null;
vOCORRENCIA := OCORRENCIA;
vORIGEM := ORIGEM ;
vID_EXTERNO := ID_EXTERNO;

vTIPO_CONTRATO := NULL;
vCODIGO_CONTRATO := NULL;
vDT_INI_AFAST := NULL;
vDT_FIM_AFAST := NULL;
vID := NULL;

vTABELA :=  TABELA;
vFAZER := FAZER;
vNEW_DATA_INI_AFAST := NULL;
vOLD_DATA_INI_AFAST := NULL;
vNEW_DATA_FIM_AFAST := NULL;
vOLD_DATA_FIM_AFAST := NULL;
vDADO_ORIGEM_TC1 := DADO_ORIGEM_TC1;
vDADO_DESTINO_TC1 := DADO_DESTINO_TC1;
vDADO_ORIGEM_TC2 := DADO_ORIGEM_TC2;
vDADO_DESTINO_TC2 := DADO_DESTINO_TC2;
vDADO_ORIGEM_TC3 := DADO_ORIGEM_TC3;
vDADO_DESTINO_TC3 := DADO_DESTINO_TC3;

vTEM_CARGO_EFETIVO := TEM_CARGO_EFETIVO;

vSIT_FUNC_ESTAVA := NULL;
vDATA_INI_ESTAVA  := NULL;
vDATA_FIM_ESTAVA  := NULL;
vPROXIMA_SIT_ESTAVA := NULL;
vDATA_INI_GRAVAR := NULL;
vDATA_FIM_GRAVAR := NULL;
vDATA_INI_NAO_GRAVAR := NULL;
vDATA_FIM_NAO_GRAVAR := NULL;

vSIT_FUNC_DIA_ANTERIOR := NULL;
vCONTROLE_FOLHA_ANTERIOR := NULL;
vE_AFASTAMENTO_ANTERIOR := NULL;
vDATA_INI_ESTAVA_DIA_ANT  := NULL;
vDATA_FIM_ESTAVA_DIA_ANT  := NULL;

vDE_PROXIMA_SITUACAO := NULL;
vPARA_PROXIMA_SITUACAO := NULL;

vLOGIN_USUARIO := NULL;
vLOGIN_OS := NULL;

vPOSSUI_INTERVALOS :=NULL;
vDIA_ANTERIOR :=NULL;
vULT_DATA_INI_ANTES_DEFERIDO :=NULL;
vULT_DATA_FIM_ANTES_DEFERIDO := NULL;
--vULT_CONTROLE_FOLHA_ANTES_DEF :=NULL;
vINTERVALO := 0;
--vDT_INI_AFAST_CORTE := TO_DATE('01/10/2019','DD/MM/YYYY');--Kellysson comentou em 17/10/19
--vE_RETROATIVO := NULL;

vULT_DIA_APUR_IFPONTO := NULL;

vEMPRESA_ATENDENTE := NULL;
vCODIGO_ATENDENTE := NULL;
vNOME_ATENDENTE := NULL;
vINSCRICAO_CONSELHO := NULL;
vUF_INSCRICAO := NULL;
vCONSELHO_REGIONAL := NULL;
vCODIGO_DOENCA := NULL;

vCODIGO_PROC_MED := NULL;--NOVO EM 15/10/21

vTEM_SF_ESPECIFICA := NULL; --NOVO EM 25/7/22



--data ultimo fechamento apuracao frequencia no Arterh
SELECT trunc(MAX(x.data_fim_folha)) into vULT_DIA_APUR_IFPONTO from RHPONT_APUR_AGRUP x where x.codigo_empresa = '0001' and x.tipo_apur = 'F' AND c_livre_selec01 = 2 AND id_agrup = 152123;

-----------------BUSCAR O REGISTRO EM QUESTAO NA TABELA DE LOG QUE UNIFICA AS 3 TABELAS DA FICHA MEDICA
--ORIGEM MANUAL LANCADA DIRETAMENTE NO ARTERH MODULO FICHA MEDICA
IF vORIGEM = 'M' THEN
SELECT
C.codigo_proc_med,-- NOVO EM 15/10/21
X.ID,
to_date(to_char(Y.data_ini_afast,'dd/mm/yyyy'),'dd/mm/yyyy'),
to_date(to_char(Y.data_fim_afast,'dd/mm/yyyy'),'dd/mm/yyyy'),
Y.TIPO_CONTRATO, Y.CODIGO_CONTRATO,
to_date(to_char(X.NEW_DATA_INI_AFAST,'dd/mm/yyyy'),'dd/mm/yyyy'),
to_date(to_char(X.OLD_DATA_INI_AFAST,'dd/mm/yyyy'),'dd/mm/yyyy'),
to_date(to_char(X.NEW_DATA_FIM_AFAST,'dd/mm/yyyy'),'dd/mm/yyyy'),
to_date(to_char(X.OLD_DATA_FIM_AFAST,'dd/mm/yyyy'),'dd/mm/yyyy'),
to_date(to_char(x.DT_REG_OCORRENCIA,'dd/mm/yyyy'),'dd/mm/yyyy'),
x.LOGIN_USUARIO, x.LOGIN_OS
,Y.EMPRESA_ATENDENTE ,Y.CODIGO_ATENDENTE, Y.NOME_ATENDENTE ,Y.INSCRICAO_CONSELHO ,Y.UF_INSCRICAO ,Y.CONSELHO_REGIONAL ,D.COD_DOENCA CODIGO_DOENCA
INTO 
vCODIGO_PROC_MED,-- NOVO EM 15/10/21
vID, vDT_INI_AFAST, vDT_FIM_AFAST, vTIPO_CONTRATO, vCODIGO_CONTRATO
,vNEW_DATA_INI_AFAST, vOLD_DATA_INI_AFAST, vNEW_DATA_FIM_AFAST, vOLD_DATA_FIM_AFAST , vDT_REG_OCORRENCIA, vLOGIN_USUARIO, vLOGIN_OS
,vEMPRESA_ATENDENTE ,vCODIGO_ATENDENTE ,vNOME_ATENDENTE ,vINSCRICAO_CONSELHO ,vUF_INSCRICAO ,vCONSELHO_REGIONAL  ,vCODIGO_DOENCA
FROM SUGESP_FICHAS_MEDICAS X
LEFT OUTER JOIN
RHMEDI_FICHA_MED Y ON Y.CODIGO_EMPRESA = X.CODIGO_EMPRESA AND Y.CODIGO_PESSOA = X.CODIGO_PESSOA AND Y.DT_REG_OCORRENCIA = X.DT_REG_OCORRENCIA AND Y.OCORRENCIA = X.OCORRENCIA
LEFT OUTER JOIN
RHMEDI_RL_FICH_DOE D ON D.CODIGO_EMPRESA = X.CODIGO_EMPRESA AND D.CODIGO_PESSOA = X.CODIGO_PESSOA AND D.DT_REG_OCORRENCIA = X.DT_REG_OCORRENCIA AND D.OCORRENCIA = X.OCORRENCIA
AND D.OCOR_DOENCA = 1
LEFT OUTER JOIN -- NOVO EM 15/10/21
RHMEDI_RL_FICH_PRO C ON C.CODIGO_EMPRESA = X.CODIGO_EMPRESA AND C.CODIGO_PESSOA = X.CODIGO_PESSOA AND C.DT_REG_OCORRENCIA = X.DT_REG_OCORRENCIA AND C.OCORRENCIA = X.OCORRENCIA
WHERE
X.CODIGO_EMPRESA = vCODIGO_EMPRESA AND X.CODIGO_PESSOA =  vCODIGO_PESSOA AND TRUNC(X.DT_REG_OCORRENCIA) = TO_DATE(vDATA_OCORRENCIA,'YYYYMMDD') AND X.OCORRENCIA = vOCORRENCIA
AND X.ID = (select max(id) FROM SUGESP_FICHAS_MEDICAS AUX where AUX.CODIGO_EMPRESA = vCODIGO_EMPRESA AND AUX.CODIGO_PESSOA = vCODIGO_PESSOA  AND TRUNC(AUX.DT_REG_OCORRENCIA) = TO_DATE(vDATA_OCORRENCIA,'YYYYMMDD') AND AUX.OCORRENCIA = vOCORRENCIA);

dbms_output.put_line(vID||'-'|| vDT_INI_AFAST||'-'|| vDT_FIM_AFAST||'-'|| vTIPO_CONTRATO||'-'|| vCODIGO_CONTRATO  ||'-'|| vDATA_OCORRENCIA ||'-'||vOCORRENCIA );
dbms_output.put_line(
'vTEM_CARGO_EFETIVO :'||vTEM_CARGO_EFETIVO||' vTABELA :'|| vTABELA ||'vFAZER: '||vFAZER ||
' vNEW_DATA_INI_AFAST :'||vNEW_DATA_INI_AFAST ||
' vOLD_DATA_INI_AFAST :'||vOLD_DATA_INI_AFAST ||
' vNEW_DATA_FIM_AFAST :'||vNEW_DATA_FIM_AFAST ||
' vOLD_DATA_FIM_AFAST :'||vOLD_DATA_FIM_AFAST ||
' vDADO_ORIGEM_TC1: '|| vDADO_ORIGEM_TC1 ||' vDADO_DESTINO_TC1: '||vDADO_DESTINO_TC1 || ' vDADO_ORIGEM_TC2: '|| vDADO_ORIGEM_TC2 || 'vDADO_DESTINO_TC2: '||vDADO_DESTINO_TC2 ||' vDADO_ORIGEM_TC3: '||vDADO_ORIGEM_TC3 ||' vDADO_DESTINO_TC3: '||vDADO_DESTINO_TC3 );

ELSIF vORIGEM = 'T' THEN
SELECT
C.codigo_proc_med,-- NOVO EM 15/10/21
X.ID,
to_date(to_char(Y.data_ini_afast,'dd/mm/yyyy'),'dd/mm/yyyy'),
to_date(to_char(Y.data_fim_afast,'dd/mm/yyyy'),'dd/mm/yyyy'),
Y.TIPO_CONTRATO, Y.CODIGO_CONTRATO
,to_date(to_char(X.NEW_DATA_INI_AFAST,'dd/mm/yyyy'),'dd/mm/yyyy'),
to_date(to_char(X.OLD_DATA_INI_AFAST,'dd/mm/yyyy'),'dd/mm/yyyy'),
to_date(to_char(X.NEW_DATA_FIM_AFAST,'dd/mm/yyyy'),'dd/mm/yyyy'),
to_date(to_char(X.OLD_DATA_FIM_AFAST,'dd/mm/yyyy'),'dd/mm/yyyy'),
to_date(to_char(x.DT_REG_OCORRENCIA,'dd/mm/yyyy'),'dd/mm/yyyy'),
x.LOGIN_USUARIO, x.LOGIN_OS
,Y.EMPRESA_ATENDENTE ,Y.CODIGO_ATENDENTE, Y.NOME_ATENDENTE ,Y.INSCRICAO_CONSELHO ,Y.UF_INSCRICAO ,Y.CONSELHO_REGIONAL ,D.COD_DOENCA CODIGO_DOENCA
INTO 
vCODIGO_PROC_MED,-- NOVO EM 15/10/21
vID, vDT_INI_AFAST, vDT_FIM_AFAST, vTIPO_CONTRATO, vCODIGO_CONTRATO
,vNEW_DATA_INI_AFAST, vOLD_DATA_INI_AFAST, vNEW_DATA_FIM_AFAST, vOLD_DATA_FIM_AFAST , vDT_REG_OCORRENCIA, vLOGIN_USUARIO, vLOGIN_OS
,vEMPRESA_ATENDENTE ,vCODIGO_ATENDENTE, vNOME_ATENDENTE, vINSCRICAO_CONSELHO, vUF_INSCRICAO, vCONSELHO_REGIONAL, vCODIGO_DOENCA

FROM SUGESP_FICHAS_MEDICAS X
LEFT OUTER JOIN
RHMEDI_FICHA_MED Y ON Y.CODIGO_EMPRESA = X.CODIGO_EMPRESA AND Y.CODIGO_PESSOA = X.CODIGO_PESSOA AND Y.DT_REG_OCORRENCIA = X.DT_REG_OCORRENCIA AND Y.OCORRENCIA = X.OCORRENCIA
LEFT OUTER JOIN
RHMEDI_RL_FICH_DOE D ON D.CODIGO_EMPRESA = X.CODIGO_EMPRESA AND D.CODIGO_PESSOA = X.CODIGO_PESSOA AND D.DT_REG_OCORRENCIA = X.DT_REG_OCORRENCIA AND D.OCORRENCIA = X.OCORRENCIA
AND D.OCOR_DOENCA = 1

LEFT OUTER JOIN -- NOVO EM 15/10/21
RHMEDI_RL_FICH_PRO C ON C.CODIGO_EMPRESA = X.CODIGO_EMPRESA AND C.CODIGO_PESSOA = X.CODIGO_PESSOA AND C.DT_REG_OCORRENCIA = X.DT_REG_OCORRENCIA AND C.OCORRENCIA = X.OCORRENCIA

WHERE
X.CODIGO_EMPRESA = vCODIGO_EMPRESA AND X.CODIGO_PESSOA =  vCODIGO_PESSOA AND TRUNC(X.DT_REG_OCORRENCIA) = TO_DATE(vDATA_OCORRENCIA,'YYYYMMDD') AND X.OCORRENCIA = vOCORRENCIA
AND X.ID = vID_EXTERNO;

dbms_output.put_line(vID||'-'|| vDT_INI_AFAST||'-'|| vDT_FIM_AFAST||'-'|| vTIPO_CONTRATO||'-'|| vCODIGO_CONTRATO  ||'-'|| vDATA_OCORRENCIA ||'-'||vOCORRENCIA );
dbms_output.put_line(
'vTEM_CARGO_EFETIVO :'||vTEM_CARGO_EFETIVO||' vTABELA :'|| vTABELA ||'vFAZER: '||vFAZER ||
' vNEW_DATA_INI_AFAST :'||vNEW_DATA_INI_AFAST ||
' vOLD_DATA_INI_AFAST :'||vOLD_DATA_INI_AFAST ||
' vNEW_DATA_FIM_AFAST :'||vNEW_DATA_FIM_AFAST ||
' vOLD_DATA_FIM_AFAST :'||vOLD_DATA_FIM_AFAST ||
' vDADO_ORIGEM_TC1: '|| vDADO_ORIGEM_TC1 ||' vDADO_DESTINO_TC1: '||vDADO_DESTINO_TC1 || ' vDADO_ORIGEM_TC2: '|| vDADO_ORIGEM_TC2 || 'vDADO_DESTINO_TC2: '||vDADO_DESTINO_TC2 ||' vDADO_ORIGEM_TC3: '||vDADO_ORIGEM_TC3 ||' vDADO_DESTINO_TC3: '||vDADO_DESTINO_TC3 );


END IF;

--INICIO--NOVO EM 25/7/22
SELECT
CASE WHEN TG10.SF_ESPECIFICA IS NULL THEN 'NAO' ELSE 'SIM' END
INTO vTEM_SF_ESPECIFICA
FROM 
SUGESP_FICHAS_MEDICAS X
LEFT OUTER JOIN RHMEDI_RL_FICH_PRO C ON X.CODIGO_EMPRESA = C.CODIGO_EMPRESA AND X.CODIGO_PESSOA = C.CODIGO_PESSOA AND X.DT_REG_OCORRENCIA = C.DT_REG_OCORRENCIA AND X.OCORRENCIA = C.OCORRENCIA
LEFT OUTER JOIN RHMEDI_FICHA_MED F ON F.CODIGO_EMPRESA = X.CODIGO_EMPRESA AND F.CODIGO_PESSOA = X.CODIGO_PESSOA AND F.DT_REG_OCORRENCIA = X.DT_REG_OCORRENCIA AND F.OCORRENCIA = X.OCORRENCIA
LEFT OUTER JOIN
RHMEDI_RL_FICH_DOE D ON D.CODIGO_EMPRESA = X.CODIGO_EMPRESA AND D.CODIGO_PESSOA = X.CODIGO_PESSOA AND D.DT_REG_OCORRENCIA = X.DT_REG_OCORRENCIA AND D.OCORRENCIA = X.OCORRENCIA
AND D.OCOR_DOENCA = 1
LEFT OUTER JOIN (SELECT A.* FROM RHPESS_CONTRATO A WHERE A.ANO_MES_REFERENCIA = (SELECT MAX(AUX.ANO_MES_REFERENCIA) FROM RHPESS_CONTRATO AUX WHERE AUX.CODIGO_EMPRESA = A.CODIGO_EMPRESA AND AUX.TIPO_CONTRATO = A.TIPO_CONTRATO AND AUX.CODIGO = A.CODIGO))
  A ON A.CODIGO_EMPRESA = F.CODIGO_EMPRESA AND A.TIPO_CONTRATO = F.TIPO_CONTRATO AND A.CODIGO = F.CODIGO_CONTRATO
LEFT OUTER JOIN RHTABS_VINCULO_EMP V ON V.CODIGO = A.VINCULO
LEFT OUTER JOIN(SELECT * FROM RHINTE_ED_IT_CONV WHERE CODIGO_CONVERSAO ='TEG1')TC1 
--ATE 2/7/20--ON SUBSTR(TC1.DADO_ORIGEM,1,24) =  F.NATUREZA_EXAME||X.OLD_CODIGO_PROC_MED||V.TP_REGIME_TRAB_ESOCIAL|| V.TP_REGIME_PREV_ESOCIAL||V.COD_CATEG_ESOCIAL --PROCEDIMENTO
ON SUBSTR(TC1.DADO_ORIGEM,1,23) = F.NATUREZA_EXAME||CASE WHEN X.TIPO_DML <> 'D' THEN C.CODIGO_PROC_MED ELSE X.OLD_CODIGO_PROC_MED END||V.CODIGO --novo em 2/7/20
LEFT OUTER JOIN RHPESS_PESSOA P ON P.CODIGO_EMPRESA = X.CODIGO_EMPRESA  AND P.CODIGO = X.CODIGO_PESSOA--NOVO EM 20/7/21

LEFT OUTER JOIN (
SELECT DADO_ORIGEM, SUBSTR(DADO_ORIGEM,1,4)PROCEDIMENTO, SUBSTR(DADO_ORIGEM,5,15)CONDUTA, SUBSTR(DADO_ORIGEM,20,4)VINCULO, SUBSTR(DADO_ORIGEM,24,4)EMPRESA, 
DADO_DESTINO, SUBSTR(DADO_DESTINO,1,4)SF_GERAL ,SUBSTR(DADO_DESTINO,5,4)SF_ESPECIFICA , SUBSTR(DADO_DESTINO,9,4)SP_GERAL ,SUBSTR(DADO_DESTINO,13,4)SP_ESPECIFICA 
FROM RHINTE_ED_IT_CONV WHERE CODIGO_CONVERSAO = 'TG10')TG10
ON TG10.PROCEDIMENTO =  F.NATUREZA_EXAME AND TG10.CONDUTA = CASE WHEN X.TIPO_DML <> 'D' THEN C.CODIGO_PROC_MED ELSE X.OLD_CODIGO_PROC_MED END AND TG10.VINCULO = V.CODIGO AND TG10.EMPRESA = X.CODIGO_EMPRESA  --NOVO EM 30/5/22

WHERE X.ID = vID;

dbms_output.put_line('vTEM_SF_ESPECIFICA: '||vTEM_SF_ESPECIFICA);

--FIM--NOVO EM 25/7/22



--Kellysson comentou em 17/10/19
/*
-------PARA FAZER O CORTE DE CENARIO ANTIGO E NOVO EM 1/10/19
IF trunc(vDT_INI_AFAST_CORTE)>= trunc(vDT_INI_AFAST) OR trunc(vDT_FIM_AFAST) < trunc(vDT_INI_AFAST_CORTE)  THEN
--vDT_INI_AFAST := vDT_INI_AFAST_CORTE;
--vULT_DATA_INI_ANTES_DEFERIDO := vDT_INI_AFAST_CORTE;
vE_RETROATIVO := 'N';
ELSE
vE_RETROATIVO := 'S';
END IF;
*/

--ultima situacao funcional da pessoa antes do periodo de deferimento da ficha medica
select
to_date(to_char(A.DATA_INIC_SITUACAO,'dd/mm/yyyy'),'dd/mm/yyyy') --A.COD_SIT_FUNCIONAL COD_SIT_FUNC --, S.DESCRICAO SITUACAO_FUNCIONAL
,to_date(to_char(A.DATA_FIM_SITUACAO,'dd/mm/yyyy'),'dd/mm/yyyy')
--, S.CONTROLE_FOLHA--, S.E_AFASTAMENTO,
--S.SITUACAO_PONTO COD_SIT_PONTO, P.DESCRICAO SITUACAO_PONTO, p.tipo_situacao, A.DATA_INIC_SITUACAO DATA_INICIO,
--A.DATA_FIM_SITUACAO DATA_FIM, A.PROXIMA_SITUACAO, s.qtde_dias_proximo, s.suspende_remunera
INTO vULT_DATA_INI_ANTES_DEFERIDO--, vULT_CONTROLE_FOLHA_ANTES_DEF
,vULT_DATA_FIM_ANTES_DEFERIDO
from RHCGED_ALT_SIT_FUN A
LEFT OUTER JOIN RHPARM_SIT_FUNC S ON S.CODIGO = A.COD_SIT_FUNCIONAL
LEFT OUTER JOIN RHPONT_SITUACAO P ON P.CODIGO = S.SITUACAO_PONTO
WHERE A.CODIGO_EMPRESA = vCODIGO_EMPRESA
AND A.TIPO_CONTRATO = vTIPO_CONTRATO
AND A.CODIGO = vCODIGO_CONTRATO
AND
(--( TO_DATE(A.DATA_INIC_SITUACAO,'DD/MM/YY') <= TO_DATE(C2.DATA_DIA,'DD/MM/YY')AND TO_DATE(A.DATA_FIM_SITUACAO,'DD/MM/YY') >=TO_DATE(C2.DATA_DIA,'DD/MM/YY'))
--OR
(A.DATA_INIC_SITUACAO = (SELECT MAX(AUX.DATA_INIC_SITUACAO)FROM RHCGED_ALT_SIT_FUN AUX
                                WHERE  A.CODIGO_EMPRESA = AUX.CODIGO_EMPRESA AND A.TIPO_CONTRATO = AUX.TIPO_CONTRATO AND A.CODIGO = AUX.CODIGO
                                AND trunc(AUX.DATA_INIC_SITUACAO) <= trunc(vDT_INI_AFAST))
                                ));



------------------------------------------------------------INICIO -- KELLYSSON 12/11/19 nova logica para popular variavel vPOSSUI_INTERVALOS
SELECT CASE WHEN SUM(X.QTD) <> 0 THEN 'S' ELSE 'N' END POSSUI_INTERVALOS
INTO vPOSSUI_INTERVALOS
FROM(
select
CASE WHEN S.CONTROLE_FOLHA = 'N' THEN 0 ELSE 1 END QTD,
A.COD_SIT_FUNCIONAL COD_SIT_FUNC, S.DESCRICAO SITUACAO_FUNCIONAL,
to_date(to_char(A.DATA_INIC_SITUACAO,'dd/mm/yyyy'),'dd/mm/yyyy') DATA_INICIO,
to_date(to_char(A.DATA_FIM_SITUACAO,'dd/mm/yyyy'),'dd/mm/yyyy') DATA_FIM,
S.CONTROLE_FOLHA, S.E_AFASTAMENTO,  S.SUSPENDE_REMUNERA, s.c_livre_selec02 SO_GERA_SIT_PONTO,
S.SITUACAO_PONTO COD_SIT_PONTO, P.DESCRICAO SITUACAO_PONTO, p.tipo_situacao
from RHCGED_ALT_SIT_FUN A
LEFT OUTER JOIN RHPARM_SIT_FUNC S ON S.CODIGO = A.COD_SIT_FUNCIONAL
LEFT OUTER JOIN RHPONT_SITUACAO P ON P.CODIGO = S.SITUACAO_PONTO
WHERE A.CODIGO_EMPRESA =  vCODIGO_EMPRESA
AND A.TIPO_CONTRATO = vTIPO_CONTRATO
AND A.CODIGO = vCODIGO_CONTRATO

AND
(
(trunc(A.DATA_INIC_SITUACAO) <= trunc(vDT_INI_AFAST) AND trunc(A.DATA_FIM_SITUACAO) >= trunc(vDT_FIM_AFAST))
OR
(trunc(A.DATA_fim_SITUACAO) between trunc(vDT_INI_AFAST) and trunc(vDT_FIM_AFAST) and A.DATA_fim_SITUACAO is not null)
or
(trunc(A.DATA_INIC_SITUACAO) between trunc(vDT_INI_AFAST) and trunc(vDT_FIM_AFAST) and A.DATA_fim_SITUACAO is not null)
or
(A.DATA_INIC_SITUACAO = (SELECT MAX(AUX.DATA_INIC_SITUACAO) FROM RHCGED_ALT_SIT_FUN AUX
                                WHERE A.CODIGO_EMPRESA = AUX.CODIGO_EMPRESA AND A.TIPO_CONTRATO = AUX.TIPO_CONTRATO AND A.CODIGO = AUX.CODIGO
                                AND trunc(AUX.DATA_INIC_SITUACAO) <= trunc(vDT_FIM_AFAST)
                                and Aux.DATA_FIM_SITUACAO is null))
)
)X;
-------------------------------------------------------------FIM -- KELLYSSON 12/11/19 nova logica para popular variavel vPOSSUI_INTERVALOS

--mudei de local em 11/9/21 e fiz alteracao no relacionamento pessoa contrato devido caso Toffalini bm 497979 email (Verificação de inconsistência de lançamento de fichas médicas / situação funcional (1005 e 6121))
--INICIO--novo em 28/7/21 para saber se pessoa ser aposentada
SELECT CASE WHEN P.data_aposenta IS NOT NULL OR C.data_aposenta_fgts IS NOT NULL THEN 'S' ELSE 'N' END PESSA_APOSENTADA 
INTO vPESSOA_APOSENTADA
FROM
RHPESS_PESSOA P 
LEFT OUTER JOIN 
(SELECT A.* FROM RHPESS_CONTRATO A WHERE A.ANO_MES_REFERENCIA = 
                    (SELECT MAX(AUX.ANO_MES_REFERENCIA) FROM RHPESS_CONTRATO AUX WHERE AUX.CODIGO_EMPRESA = A.CODIGO_EMPRESA AND AUX.TIPO_CONTRATO = A.TIPO_CONTRATO AND AUX.CODIGO = A.CODIGO)
                 AND A.CODIGO_EMPRESA = vCODIGO_EMPRESA  
                  AND  A.CODIGO =  vCODIGO_CONTRATO--COMENTADO EM 11/9/21 TROCADO PARA CONTRATO --AND A.CODIGO_PESSOA =  vCODIGO_PESSOA
                 )
C ON C.CODIGO_EMPRESA = P.CODIGO_EMPRESA AND C.CODIGO_PESSOA = P.CODIGO--comentado erro em 11/9/21 --C.CODIGO
WHERE
--C.ANO_MES_REFERENCIA = (SELECT MAX(A.ANO_MES_REFERENCIA) FROM RHPESS_CONTRATO A WHERE A.CODIGO_EMPRESA = C.CODIGO_EMPRESA AND A.TIPO_CONTRATO = C.TIPO_CONTRATO AND A.CODIGO = C.CODIGO)AND
P.CODIGO_EMPRESA = vCODIGO_EMPRESA  
AND P.CODIGO = vCODIGO_PESSOA;
dbms_output.put_line('--vPESSOA_APOSENTADA: '||vPESSOA_APOSENTADA);
--FIM--novo em 28/7/21 para saber se pessoa ser aposentada



---------------------------------------------------------------------------------SE O PERIODO DEFERIDO (TOTAL OU PARCIAL) SER RETROATIVO DO LANCAMENTO DA FICHA MEDICA --------------------------------------
--IF vE_RETROATIVO = 'N' THEN

-----------------------------------------------------------------------------------------------------------------------------------------ORIGEM DE UMA INSERCAO DE PROCEDIMENTO-----------------------------------------
------------------inicio---------maior if da logica
IF SUBSTR(vFAZER,1,1) = 'I' AND vFAZER NOT LIKE '%CRIA_DOENCA_GRAVE%' AND(vDADO_DESTINO_TC2 IS NULL and vDADO_DESTINO_TC3 IS NULL) THEN

--INSERT INTO  SUGESP_SIT_FUNC_PONTO_FICHAS (ID, ID_LOG_FICHA, TIPO_DML, TABELA, TEM_CARGO_EFETIVO, FAZER, CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, CODIGO_PESSOA,  DT_REG_OCORRENCIA, OCORRENCIA, DT_ULT_ALTER_USUA, LOGIN_USUARIO, LOGIN_OS, DADO_ORIGEM_TC1, DADO_DESTINO_TC1, DADO_ORIGEM_TC2, DADO_DESTINO_TC2, DADO_ORIGEM_TC3, DADO_DESTINO_TC3
--,LOG)
--VALUES ((SELECT MAX(ID)+1 FROM SUGESP_SIT_FUNC_PONTO_FICHAS),vID, 'U', vTABELA, vTEM_CARGO_EFETIVO, vFAZER, vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vCODIGO_PESSOA,  vDT_REG_OCORRENCIA, vOCORRENCIA, sysdate, vLOGIN_USUARIO, vLOGIN_OS, vDADO_ORIGEM_TC1, vDADO_DESTINO_TC1, vDADO_ORIGEM_TC2, vDADO_DESTINO_TC2, vDADO_ORIGEM_TC3, vDADO_DESTINO_TC3
--,'ATUALIZACOES SITUACOES FUNCIONAIS QUANDO: ORIGEM DE UMA INCLUSAO DE PROCEDIMENTO');


FOR C2 IN
(select D.DATA_DIA from RHTABS_DATAS D WHERE trunc(D.DATA_DIA) BETWEEN trunc(vDT_INI_AFAST) AND trunc(vDT_FIM_AFAST) order by d.data_dia)
LOOP
--dbms_output.put_line('C1.DATA_DIA - '|| C2.DATA_DIA);
--dbms_output.put_line('c1-'||vTIPO_CONTRATO||'-'||vCODIGO_CONTRATO ||'-'||vDT_INI_AFAST ||'-'|| vDT_FIM_AFAST);

--dbms_output.put_line(vSIT_FUNC_DIA_ANTERIOR||'-'||vCONTROLE_FOLHA_ANTERIOR ||'-'||vE_AFASTAMENTO_ANTERIOR);

FOR C3 IN(

SELECT K.* FROM (
/*
select  '1_FICHA_MEDICA_DEFERIDA' TIPO,F.SITUACAO_FUNCIONAL COD_SIT_FUNC, S.DESCRICAO SITUACAO_FUNCIONAL, 'L' CONTROLE_FOLHA, 'S' E_AFASTAMENTO, S.SITUACAO_PONTO COD_SIT_PONTO, P.DESCRICAO SITUACAO_PONTO, p.tipo_situacao, F.DATA_INI_AFAST DATA_INICIO, F.DATA_FIM_AFAST DATA_FIM
,F.DT_REG_OCORRENCIA, F.OCORRENCIA
FROM RHMEDI_FICHA_MED F
LEFT OUTER JOIN RHPARM_SIT_FUNC S ON S.CODIGO = F.SITUACAO_FUNCIONAL
LEFT OUTER JOIN RHPONT_SITUACAO P ON P.CODIGO = S.SITUACAO_PONTO
WHERE F.CODIGO_EMPRESA = vCODIGO_EMPRESA AND F.TIPO_CONTRATO = vTIPO_CONTRATO  AND F.CODIGO_CONTRATO = vCODIGO_CONTRATO
AND (TO_DATE(F.DATA_INI_AFAST,'DD/MM/YY') <= TO_DATE(C2.DATA_DIA,'DD/MM/YY')AND TO_DATE(F.DATA_FIM_AFAST,'DD/MM/YY') >= TO_DATE(C2.DATA_DIA,'DD/MM/YY'))
AND (TO_DATE(F.DT_REG_OCORRENCIA,'DD/MM/YY') <> TO_DATE(vDT_REG_OCORRENCIA,'DD/MM/YY')
    or( TO_DATE(F.DT_REG_OCORRENCIA,'DD/MM/YY') <> TO_DATE(vDT_REG_OCORRENCIA,'DD/MM/YY')and F.OCORRENCIA <> vOCORRENCIA)
    or( TO_DATE(F.DT_REG_OCORRENCIA,'DD/MM/YY') = TO_DATE(vDT_REG_OCORRENCIA,'DD/MM/YY')and F.OCORRENCIA <> vOCORRENCIA)
    )
UNION ALL
*/
select  '2_SIT_FUNC' TIPO, A.COD_SIT_FUNCIONAL COD_SIT_FUNC, S.DESCRICAO SITUACAO_FUNCIONAL, S.CONTROLE_FOLHA, S.E_AFASTAMENTO,
S.SITUACAO_PONTO COD_SIT_PONTO, P.DESCRICAO SITUACAO_PONTO, p.tipo_situacao,
to_date(to_char(A.DATA_INIC_SITUACAO,'dd/mm/yyyy'),'dd/mm/yyyy') DATA_INICIO,
to_date(to_char(A.DATA_FIM_SITUACAO,'dd/mm/yyyy'),'dd/mm/yyyy') DATA_FIM,
A.PROXIMA_SITUACAO, s.qtde_dias_proximo, s.suspende_remunera, s.c_livre_selec02 SO_GERA_SIT_PONTO
from RHCGED_ALT_SIT_FUN A
LEFT OUTER JOIN RHPARM_SIT_FUNC S ON S.CODIGO = A.COD_SIT_FUNCIONAL
LEFT OUTER JOIN RHPONT_SITUACAO P ON P.CODIGO = S.SITUACAO_PONTO
WHERE A.CODIGO_EMPRESA = vCODIGO_EMPRESA
AND A.TIPO_CONTRATO = vTIPO_CONTRATO
AND A.CODIGO = vCODIGO_CONTRATO
AND
(( trunc(A.DATA_INIC_SITUACAO) <= trunc(C2.DATA_DIA) AND trunc(A.DATA_FIM_SITUACAO) >= trunc(C2.DATA_DIA))
OR
(A.DATA_INIC_SITUACAO = (SELECT MAX(AUX.DATA_INIC_SITUACAO)FROM RHCGED_ALT_SIT_FUN AUX
                                WHERE  A.CODIGO_EMPRESA = AUX.CODIGO_EMPRESA AND A.TIPO_CONTRATO = AUX.TIPO_CONTRATO AND A.CODIGO = AUX.CODIGO
                                AND trunc(AUX.DATA_INIC_SITUACAO) <= trunc(C2.DATA_DIA)and Aux.DATA_FIM_SITUACAO is null))
)
/*
UNION ALL
SELECT  '1_FERIAS' TIPO, '9999' COD_SIT_FUNC, 'FERIAS' SITUACAO_FUNCIONAL, 'F' CONTROLE_FOLHA, 'N' E_AFASTAMENTO, P.SITUACAO_PONTO COD_SIT_PONTO, P.DESCRICAO SITUACAO_PONTO, 'P' tipo_situacao, f.dt_ini_gozo DATA_INICIO, f.dt_fim_gozo DATA_FIM
,NULL DT_REG_OCORRENCIA, NULL OCORRENCIA
FROM RHFERI_FERIAS F
LEFT OUTER JOIN RHPARM_P_FERI P ON P.CODIGO_EMPRESA = F.CODIGO_EMPRESA AND P.CODIGO = F.TIPO_FERIAS
WHERE F.CODIGO_EMPRESA = vCODIGO_EMPRESA  AND F.TIPO_CONTRATO = vTIPO_CONTRATO  AND F.CODIGO_CONTRATO = vCODIGO_CONTRATO
AND
(TO_DATE(F.DT_INI_GOZO,'DD/MM/YY') <=TO_DATE(C2.DATA_DIA,'DD/MM/YY')AND TO_DATE(F.DT_FIM_GOZO,'DD/MM/YY') >= TO_DATE(C2.DATA_DIA,'DD/MM/YY'))
--/*
UNION ALL
select  '9_FICHA_MEDICA_INDEFERIDA' TIPO, F.SITUACAO_FUNCIONAL COD_SIT_FUNC, S.DESCRICAO SITUACAO_FUNCIONAL, S.CONTROLE_FOLHA, S.E_AFASTAMENTO, S.SITUACAO_PONTO COD_SIT_PONTO, P.DESCRICAO SITUACAO_PONTO, p.tipo_situacao, F.c_livre_data01 DATA_INICIO, F.c_livre_data02 DATA_FIM
,F.DT_REG_OCORRENCIA, F.OCORRENCIA
FROM RHMEDI_FICHA_MED F
LEFT OUTER JOIN RHPARM_SIT_FUNC S ON S.CODIGO = F.SITUACAO_FUNCIONAL
LEFT OUTER JOIN RHPONT_SITUACAO P ON P.CODIGO = S.SITUACAO_PONTO
WHERE F.CODIGO_EMPRESA = vCODIGO_EMPRESA AND F.TIPO_CONTRATO = vTIPO_CONTRATO  AND F.CODIGO_CONTRATO = vCODIGO_CONTRATO
AND (TO_DATE(F.c_livre_data01,'DD/MM/YY') <= TO_DATE(C2.DATA_DIA,'DD/MM/YY')AND TO_DATE(F.c_livre_data02,'DD/MM/YY') >= TO_DATE(C2.DATA_DIA,'DD/MM/YY'))

UNION ALL
select  '3_SIT_PONTO' TIPO, NULL COD_SIT_FUNC, NULL SITUACAO_FUNCIONAL, NULL CONTROLE_FOLHA, NULL E_AFASTAMENTO, D.CODIGO_SITUACAO COD_SIT_PONTO, P.DESCRICAO SITUACAO_PONTO, p.tipo_situacao,  DATA DATA_INICIO,  NULL DATA_FIM
,NULL DT_REG_OCORRENCIA, NULL OCORRENCIA
from RHPONT_RES_SIT_DIA D
LEFT OUTER JOIN RHPONT_SITUACAO P ON P.CODIGO = D.CODIGO_SITUACAO
WHERE D.CODIGO_EMPRESA = vCODIGO_EMPRESA  AND D.TIPO_CONTRATO = vTIPO_CONTRATO AND D.CODIGO_CONTRATO = vCODIGO_CONTRATO
AND TO_DATE(D.DATA,'DD/MM/YY') = TO_DATE(C2.DATA_DIA,'DD/MM/YY')
*/
)K
ORDER BY K.TIPO

)
LOOP

--dbms_output.put_line(C2.DATA_DIA);
dbms_output.put_line(C2.DATA_DIA||'-'||C3.TIPO||'-'||C3.COD_SIT_FUNC ||'-'||C3.SITUACAO_FUNCIONAL ||'-'||C3.CONTROLE_FOLHA ||'-'|| C3.E_AFASTAMENTO||'-'||C3.COD_SIT_PONTO
||'-'||C3.SITUACAO_PONTO ||'-'||C3.tipo_situacao||'-'|| C3.DATA_INICIO ||'-'|| C3.DATA_FIM  ||'-'|| C3.PROXIMA_SITUACAO );

----------------------------------------------------------------LOGICA por DIA A DIA PARA MONTAR COMANDOS necessArios nas SITUACOES FUNCIONAIS----------------------------------------------------------------------------------
--------------------OU APENAS SITUACAO DE PONTO


-----------------------------------------------Pessoa SER da PBH e esta em CessAo OU SEMELHANTES?----------------------------------------------------------------
--IF vTEM_CARGO_EFETIVO = 'SIM' AND C3.CONTROLE_FOLHA = 'L' AND C3.E_AFASTAMENTO = 'N' THEN --COMENTADO EM 5/11/19
IF C3.SO_GERA_SIT_PONTO = '1' THEN
dbms_output.put_line('O QUE FAZER: Pessoa da PBH em cESSAo OU SEMELHANTES Gravar SituACAO Ponto');
------------------------------------------------INICIO--------------------------------CHAMAR PROCEDURE PARA TODA LOGICA NO NOVO CENARIO TABELA RHPONT_RES_SIT_DIA
--SUGESP_RES_SIT_DIA_V4('FICHA_MEDICA', vID, C2.DATA_DIA, vDADO_ORIGEM_TC1, vDADO_DESTINO_TC1);

--PR_FICHA_MEDICA_AJUSTE_SITPONT ('INSERE_PROCEDIMENTO',vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, C2.DATA_DIA, vDADO_ORIGEM_TC1, vDADO_DESTINO_TC1, vLOGIN_USUARIO );
FOR C4 IN (
SELECT SP.CODIGO_SITUACAO ULT_SP_NO_DIA, S.TIPO_SITUACAO , S.situacao_assoc
FROM RHPONT_RES_SIT_DIA SP
LEFT OUTER JOIN RHPONT_SITUACAO S ON SP.CODIGO_SITUACAO = S.CODIGO
WHERE SP.CODIGO_EMPRESA = vCODIGO_EMPRESA AND SP.TIPO_CONTRATO = vTIPO_CONTRATO AND SP.CODIGO_CONTRATO = vCODIGO_CONTRATO
AND trunc(SP.DATA) = trunc(C2.DATA_DIA)
AND SP.DT_ULT_ALTER_USUA = (SELECT MAX(AUX.DT_ULT_ALTER_USUA) FROM RHPONT_RES_SIT_DIA AUX WHERE AUX.CODIGO_EMPRESA = vCODIGO_EMPRESA AND AUX.TIPO_CONTRATO = vTIPO_CONTRATO 
AND AUX.CODIGO_CONTRATO = vCODIGO_CONTRATO
AND trunc(AUX.DATA) = trunc(C2.DATA_DIA))
)
LOOP
IF C2.DATA_DIA <= vULT_DIA_APUR_IFPONTO --PerIOodo do LanCamento (total/parcial) jA fechado Ifponto? = SIM
--AND vSP_NEW_CODIGO IS NOT NULL --LanCamento possui SituaCAo Ponto vinculada? = SIM
--AND C2.ULT_SP_NO_DIA IS NOT NULL AND C2.situacao_assoc IS NOT NULL --A ultima situaCAo ponto no dia possui situaCAo de estorno? = SIM
AND C4.TIPO_SITUACAO <> 'C'--A ultima situaCAo ponto no dia SER o ESTORNO de uma FALTA/ATRASOS ? = NAO
AND C4.TIPO_SITUACAO = 'F'--A ultima situaCAo ponto SER de FALTA/ATRASOS? = SIM
THEN
--4 TAREFA
dbms_output.put_line('4 TAREFA-Cria Estorno da SituaCAo de Ponto - '||C4.ULT_SP_NO_DIA ||'-'||C4.TIPO_SITUACAO||'-'||C4.situacao_assoc);
delete RHPONT_RES_SIT_DIA where CODIGO_EMPRESA = vCODIGO_EMPRESA and TIPO_CONTRATO = vTIPO_CONTRATO and CODIGO_CONTRATO = vCODIGO_CONTRATO and trunc(DATA) = trunc(C2.DATA_DIA) and CODIGO_SITUACAO = C4.situacao_assoc and REF_HORAS = 1 and TIPO_APURACAO = 'F';COMMIT;--NOVO EM 20/1/20
INSERT INTO RHPONT_RES_SIT_DIA (CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, DATA, CODIGO_SITUACAO, REF_HORAS, LOGIN_USUARIO, DT_ULT_ALTER_USUA, TIPO_APURACAO, FORCA_SITUACAO  )
VALUES (vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO ,trunc(C2.DATA_DIA), C4.situacao_assoc, 1, vLOGIN_USUARIO, SYSDATE - 1/24/60/60, 'F', 'N');
--7 TAREFA
dbms_output.put_line('7 TAREFA-Cria na data a situaCAO ponto para o bm - '||substr(vDADO_DESTINO_TC1,9,4) );
delete RHPONT_RES_SIT_DIA where CODIGO_EMPRESA = vCODIGO_EMPRESA and TIPO_CONTRATO = vTIPO_CONTRATO and CODIGO_CONTRATO = vCODIGO_CONTRATO and trunc(DATA) = trunc(C2.DATA_DIA) and CODIGO_SITUACAO = substr(vDADO_DESTINO_TC1,9,4) and REF_HORAS = 1 and TIPO_APURACAO = 'F';COMMIT;--NOVO EM 20/1/20
INSERT INTO RHPONT_RES_SIT_DIA (CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, DATA, CODIGO_SITUACAO, REF_HORAS, LOGIN_USUARIO, DT_ULT_ALTER_USUA, TIPO_APURACAO, FORCA_SITUACAO  )
VALUES (vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO ,trunc(C2.DATA_DIA), substr(vDADO_DESTINO_TC1,9,4) , 1, vLOGIN_USUARIO, SYSDATE + 1/24/60/60, 'F', 'N');
END IF;--4 TAREFA
END LOOP;--LOOP 2
---------------------------------------------------------FIM-----------------------CHAMAR PROCEDURE PARA TODA LOGICA NO NOVO CENARIO TABELA RHPONT_RES_SIT_DIA

-------------------------------------------------------Pessoa nAo esta em cessAo-----parte de situaCAo funcional--------------------------------------------------------------

--------------------------------------------------------------------------------PARTE DE INCLUSAO DE DADOS
ELSif C3.SO_GERA_SIT_PONTO = '2' THEN

--dbms_output.put_line('O QUE FAZER: Gravar SituaCAo Funcional');
vSIT_FUNC_ESTAVA := C3.COD_SIT_FUNC ;
vDATA_INI_ESTAVA := C3.DATA_INICIO;
vDATA_FIM_ESTAVA := C3.DATA_FIM;
vPROXIMA_SIT_ESTAVA := C3.PROXIMA_SITUACAO ;
--dbms_output.put_line( vSIT_FUNC_ESTAVA||'-'||vDATA_INI_ESTAVA||'-'||vDATA_FIM_ESTAVA);

-----------------------------------------COMBINACOES DO CAMPO FAZER

------------------------Periodo que a pessoa estava com situaCAo tipo NORMAL


----------------------------------------------------------------PRIMEIRO DIA FICHA
------------------------------------------------opcao 1/2
if TRUNC(C2.DATA_DIA) = TRUNC(vDT_INI_AFAST)
AND C3.CONTROLE_FOLHA = 'N'
AND C3.DATA_FIM IS NULL
and vPOSSUI_INTERVALOS = 'S' -- NOVO EM 18/11/19
THEN ---o que difere 1/2 do 2/2

dbms_output.put_line('1.1-Guarda data inicio: '||vDATA_INI_GRAVAR);
vDATA_INI_GRAVAR := C2.DATA_DIA;

--vPOSSUI_INTERVALOS := 'N'; -- COMENTADO KELLYSSON 12/11/19 nova logica para popular variavel vPOSSUI_INTERVALOS

/*
dbms_output.put_line('1.1-Finaliza a sit func (inicio-1d): '||C2.DATA_DIA);
INSERT INTO  SUGESP_SIT_FUNC_PONTO_FICHAS (ID, ID_LOG_FICHA, TIPO_DML, TABELA, TEM_CARGO_EFETIVO, FAZER, CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, CODIGO_PESSOA,  DT_REG_OCORRENCIA, OCORRENCIA, DT_ULT_ALTER_USUA, LOGIN_USUARIO, LOGIN_OS, DADO_ORIGEM_TC1, DADO_DESTINO_TC1, DADO_ORIGEM_TC2, DADO_DESTINO_TC2, DADO_ORIGEM_TC3, DADO_DESTINO_TC3,
NEW_COD_SIT_FUNCIONAL, OLD_COD_SIT_FUNCIONAL, NEW_DATA_INIC_SITUACAO, OLD_DATA_INIC_SITUACAO, NEW_DATA_FIM_SITUACAO, OLD_DATA_FIM_SITUACAO
,LOG)
VALUES ((SELECT MAX(ID)+1 FROM SUGESP_SIT_FUNC_PONTO_FICHAS),vID, 'U', vTABELA, vTEM_CARGO_EFETIVO, vFAZER, vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vCODIGO_PESSOA,  vDT_REG_OCORRENCIA, vOCORRENCIA, sysdate, vLOGIN_USUARIO, vLOGIN_OS, vDADO_ORIGEM_TC1, vDADO_DESTINO_TC1, vDADO_ORIGEM_TC2, vDADO_DESTINO_TC2, vDADO_ORIGEM_TC3, vDADO_DESTINO_TC3,
vSIT_FUNC_ESTAVA, vSIT_FUNC_ESTAVA , C3.DATA_INICIO, C3.DATA_INICIO, vDATA_INI_GRAVAR, C3.DATA_FIM
,'1.1-Finaliza a sit func (inicio-1d):');

UPDATE RHCGED_ALT_SIT_FUN set data_fim_situacao = trunc(vDATA_INI_GRAVAR)-1 , LOGIN_USUARIO = vLOGIN_USUARIO , DT_ULT_ALTER_USUA = SYSDATE where codigo_empresa = vCODIGO_EMPRESA and tipo_contrato = vTIPO_CONTRATO and codigo = vCODIGO_CONTRATO and trunc(data_inic_situacao) = trunc(vDATA_INI_ESTAVA);
COMMIT;
--SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO,vLOGIN_USUARIO);
*/
---------------------------------------------------opcao 2/2
elsif TRUNC(C2.DATA_DIA) = TRUNC(vDT_INI_AFAST)
--AND C3.CONTROLE_FOLHA = 'N'
AND C3.DATA_FIM IS not NULL
and vPOSSUI_INTERVALOS = 'S' -- NOVO EM 18/11/19
THEN ---o que difere 1/2 do 2/2

dbms_output.put_line('2.1-Guarda data inicio: '||vDATA_INI_GRAVAR);
vDATA_INI_GRAVAR := C2.DATA_DIA;

--vPOSSUI_INTERVALOS := 'S'; -- COMENTADO KELLYSSON 12/11/19 nova logica para popular variavel vPOSSUI_INTERVALOS
--vINTERVALO := 1;

if C3.CONTROLE_FOLHA = 'N' then
dbms_output.put_line('2.1-Altera Data fim (inicio-1d) a sit func: '||C2.DATA_DIA);
INSERT INTO  SUGESP_SIT_FUNC_PONTO_FICHAS (ID, ID_LOG_FICHA, TIPO_DML, TABELA, TEM_CARGO_EFETIVO, FAZER, CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, CODIGO_PESSOA,  DT_REG_OCORRENCIA, OCORRENCIA, DT_ULT_ALTER_USUA, LOGIN_USUARIO, LOGIN_OS, DADO_ORIGEM_TC1, DADO_DESTINO_TC1, DADO_ORIGEM_TC2, DADO_DESTINO_TC2, DADO_ORIGEM_TC3, DADO_DESTINO_TC3,
NEW_COD_SIT_FUNCIONAL, OLD_COD_SIT_FUNCIONAL, NEW_DATA_INIC_SITUACAO, OLD_DATA_INIC_SITUACAO, NEW_DATA_FIM_SITUACAO, OLD_DATA_FIM_SITUACAO
,LOG)
VALUES ((SELECT MAX(ID)+1 FROM SUGESP_SIT_FUNC_PONTO_FICHAS),vID, 'U', vTABELA, vTEM_CARGO_EFETIVO, vFAZER, vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vCODIGO_PESSOA,  vDT_REG_OCORRENCIA, vOCORRENCIA, sysdate, vLOGIN_USUARIO, vLOGIN_OS, vDADO_ORIGEM_TC1, vDADO_DESTINO_TC1, vDADO_ORIGEM_TC2, vDADO_DESTINO_TC2, vDADO_ORIGEM_TC3, vDADO_DESTINO_TC3,
vSIT_FUNC_ESTAVA, vSIT_FUNC_ESTAVA , C3.DATA_INICIO, C3.DATA_INICIO, vDATA_INI_GRAVAR, C3.DATA_FIM
,'2.1-Altera Data fim (inicio-1d) a sit func:');

UPDATE RHCGED_ALT_SIT_FUN set data_fim_situacao = trunc(vDATA_INI_GRAVAR)-1 , LOGIN_USUARIO = vLOGIN_USUARIO , DT_ULT_ALTER_USUA = SYSDATE
where codigo_empresa = vCODIGO_EMPRESA and tipo_contrato = vTIPO_CONTRATO and codigo = vCODIGO_CONTRATO and trunc(data_inic_situacao) = trunc(vDATA_INI_ESTAVA);
COMMIT;
--SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO,vLOGIN_USUARIO);


end if;

----------------------------------------------------------DIAS DO MEIO DO PERIODO
----------------------opcao 1/3 --inicio de periodo NORMAL
elsif trunc(C2.DATA_DIA) > trunc(vDT_INI_AFAST) AND trunc(C2.DATA_DIA) < trunc(vDT_FIM_AFAST)
AND C3.CONTROLE_FOLHA = 'N'
--AND vCONTROLE_FOLHA_ANTERIOR IS NOT NULL
and vCONTROLE_FOLHA_ANTERIOR <> C3.CONTROLE_FOLHA
AND vPOSSUI_INTERVALOS = 'S'--AND C3.DATA_FIM IS NULL
THEN

--IF vINTERVALO > 1--vDATA_INI_ESTAVA_DIA_ANT <> vULT_DATA_INI_ANTES_DEFERIDO --AND vULT_CONTROLE_FOLHA_ANTES_DEF
--THEN
/*
dbms_output.put_line('2.2-Finaliza a sit func (inicio-1d) '||C2.DATA_DIA);
INSERT INTO  SUGESP_SIT_FUNC_PONTO_FICHAS (ID, ID_LOG_FICHA, TIPO_DML, TABELA, TEM_CARGO_EFETIVO, FAZER, CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, CODIGO_PESSOA,  DT_REG_OCORRENCIA, OCORRENCIA, DT_ULT_ALTER_USUA, LOGIN_USUARIO, LOGIN_OS, DADO_ORIGEM_TC1, DADO_DESTINO_TC1, DADO_ORIGEM_TC2, DADO_DESTINO_TC2, DADO_ORIGEM_TC3, DADO_DESTINO_TC3,
NEW_COD_SIT_FUNCIONAL, OLD_COD_SIT_FUNCIONAL, NEW_DATA_INIC_SITUACAO, OLD_DATA_INIC_SITUACAO, NEW_DATA_FIM_SITUACAO, OLD_DATA_FIM_SITUACAO
,LOG)
VALUES ((SELECT MAX(ID)+1 FROM SUGESP_SIT_FUNC_PONTO_FICHAS),vID, 'U', vTABELA, vTEM_CARGO_EFETIVO, vFAZER, vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vCODIGO_PESSOA,  vDT_REG_OCORRENCIA, vOCORRENCIA, sysdate, vLOGIN_USUARIO, vLOGIN_OS, vDADO_ORIGEM_TC1, vDADO_DESTINO_TC1, vDADO_ORIGEM_TC2, vDADO_DESTINO_TC2, vDADO_ORIGEM_TC3, vDADO_DESTINO_TC3,
vSIT_FUNC_ESTAVA, vSIT_FUNC_ESTAVA , C3.DATA_INICIO, C3.DATA_INICIO, vDATA_INI_GRAVAR, C3.DATA_FIM
,'2.2-Finaliza a sit func (inicio-1d):');

UPDATE RHCGED_ALT_SIT_FUN set data_fim_situacao = trunc(vDATA_INI_GRAVAR)-1 , LOGIN_USUARIO = vLOGIN_USUARIO , DT_ULT_ALTER_USUA = SYSDATE
where codigo_empresa = vCODIGO_EMPRESA and tipo_contrato = vTIPO_CONTRATO and codigo = vCODIGO_CONTRATO and trunc(data_inic_situacao) = trunc(vDATA_INI_GRAVAR);
COMMIT;
--SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO,vLOGIN_USUARIO);
*/
--END IF;
dbms_output.put_line('2.2-Guarda data inicio: '||vDATA_INI_GRAVAR);
vDATA_INI_GRAVAR := C2.DATA_DIA;

--vINTERVALO := vINTERVALO + 1; --voltei em 26/11/19


/*
--------------------opcao 2/3 --inicio de periodo NORMAL
elsif trunc(C2.DATA_DIA) > trunc(vDT_INI_AFAST) AND trunc(C2.DATA_DIA) < trunc(vDT_FIM_AFAST)
AND C3.CONTROLE_FOLHA = 'N'
and vCONTROLE_FOLHA_ANTERIOR <> C3.CONTROLE_FOLHA
AND C3.DATA_FIM IS not NULL
THEN

--dbms_output.put_line('2.4-Altera CODIGO Da sit func: '||C2.DATA_DIA);
dbms_output.put_line('2.4-Guarda data inicio: '||vDATA_INI_GRAVAR);
vDATA_INI_GRAVAR := C2.DATA_DIA;
*/
-----------------------opcao 3/3 --FIM de periodo NORMAL
elsif trunc(C2.DATA_DIA) > trunc(vDT_INI_AFAST) AND trunc(C2.DATA_DIA) < trunc(vDT_FIM_AFAST)
AND C3.CONTROLE_FOLHA <> 'N'
and vCONTROLE_FOLHA_ANTERIOR = 'N' THEN

dbms_output.put_line('9.1-Guarda data FIM: '||vDATA_FIM_GRAVAR);
vDATA_FIM_GRAVAR := C2.DATA_DIA-1;


/*--inicio--comentado em 26/11/19
IF vPOSSUI_INTERVALOS = 'S' AND vDATA_INI_ESTAVA_DIA_ANT <> vULT_DATA_INI_ANTES_DEFERIDO --AND vULT_CONTROLE_FOLHA_ANTES_DEF
--AND vE_RETROATIVO = 'N'
THEN

dbms_output.put_line('2.4-Altera CODIGO Da sit func: '||C2.DATA_DIA);
dbms_output.put_line('10.1-Altera CODIGO Da sit func com sit func da Ficha NO PERIODO: '||vDATA_INI_ESTAVA_DIA_ANT||'-'||vULT_DATA_INI_ANTES_DEFERIDO);
INSERT INTO  SUGESP_SIT_FUNC_PONTO_FICHAS (ID, ID_LOG_FICHA, TIPO_DML, TABELA, TEM_CARGO_EFETIVO, FAZER, CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, CODIGO_PESSOA,  DT_REG_OCORRENCIA, OCORRENCIA, DT_ULT_ALTER_USUA, LOGIN_USUARIO, LOGIN_OS, DADO_ORIGEM_TC1, DADO_DESTINO_TC1, DADO_ORIGEM_TC2, DADO_DESTINO_TC2, DADO_ORIGEM_TC3, DADO_DESTINO_TC3,
NEW_COD_SIT_FUNCIONAL, OLD_COD_SIT_FUNCIONAL, NEW_DATA_INIC_SITUACAO, OLD_DATA_INIC_SITUACAO, NEW_DATA_FIM_SITUACAO, OLD_DATA_FIM_SITUACAO
,LOG)
VALUES ((SELECT MAX(ID)+1 FROM SUGESP_SIT_FUNC_PONTO_FICHAS),vID, 'U', vTABELA, vTEM_CARGO_EFETIVO, vFAZER, vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vCODIGO_PESSOA,  vDT_REG_OCORRENCIA, vOCORRENCIA, sysdate, vLOGIN_USUARIO, vLOGIN_OS, vDADO_ORIGEM_TC1, vDADO_DESTINO_TC1, vDADO_ORIGEM_TC2, vDADO_DESTINO_TC2, vDADO_ORIGEM_TC3, vDADO_DESTINO_TC3,
SUBSTR(vDADO_DESTINO_TC1,1,4), vSIT_FUNC_ESTAVA , C3.DATA_INICIO, C3.DATA_INICIO, C3.DATA_FIM, C3.DATA_FIM
,'10.1-Altera CODIGO Da sit func com sit func da Ficha NO PERIODO:'||vDATA_INI_ESTAVA_DIA_ANT||'-'||vULT_DATA_INI_ANTES_DEFERIDO);

UPDATE RHCGED_ALT_SIT_FUN set cod_sit_funcional = SUBSTR(vDADO_DESTINO_TC1,1,4), --data_fim_situacao = trunc(vDATA_FIM_GRAVAR),
LOGIN_USUARIO = vLOGIN_USUARIO , DT_ULT_ALTER_USUA = SYSDATE
where codigo_empresa = vCODIGO_EMPRESA and tipo_contrato = vTIPO_CONTRATO and codigo = vCODIGO_CONTRATO and trunc(data_inic_situacao) = trunc(vDATA_INI_ESTAVA_DIA_ANT);
COMMIT;
SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO,vLOGIN_USUARIO);

ELSIF vPOSSUI_INTERVALOS = 'S' AND vDATA_INI_ESTAVA_DIA_ANT = vULT_DATA_INI_ANTES_DEFERIDO
--AND vE_RETROATIVO = 'N'
THEN

dbms_output.put_line('10.1A-Crio periodo com sit func da Ficha: '||vDATA_INI_GRAVAR||'-'||vDATA_FIM_GRAVAR);
INSERT INTO  SUGESP_SIT_FUNC_PONTO_FICHAS (ID, ID_LOG_FICHA, TIPO_DML, TABELA, TEM_CARGO_EFETIVO, FAZER, CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, CODIGO_PESSOA,  DT_REG_OCORRENCIA, OCORRENCIA, DT_ULT_ALTER_USUA, LOGIN_USUARIO, LOGIN_OS, DADO_ORIGEM_TC1, DADO_DESTINO_TC1, DADO_ORIGEM_TC2, DADO_DESTINO_TC2, DADO_ORIGEM_TC3, DADO_DESTINO_TC3,
NEW_COD_SIT_FUNCIONAL,NEW_DATA_INIC_SITUACAO, NEW_DATA_FIM_SITUACAO, LOG)
VALUES ((SELECT MAX(ID)+1 FROM SUGESP_SIT_FUNC_PONTO_FICHAS),vID, 'I', vTABELA, vTEM_CARGO_EFETIVO, vFAZER, vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vCODIGO_PESSOA,  vDT_REG_OCORRENCIA, vOCORRENCIA, sysdate, vLOGIN_USUARIO, vLOGIN_OS, vDADO_ORIGEM_TC1, vDADO_DESTINO_TC1, vDADO_ORIGEM_TC2, vDADO_DESTINO_TC2, vDADO_ORIGEM_TC3, vDADO_DESTINO_TC3,
SUBSTR(vDADO_DESTINO_TC1,1,4) , trunc(vDATA_INI_GRAVAR), trunc(vDATA_FIM_GRAVAR), '10.1A-Crio periodo com sit func da Ficha');
INSERT INTO RHCGED_ALT_SIT_FUN (codigo_empresa, tipo_contrato, codigo, data_inic_situacao, data_FIM_situacao, cod_sit_funcional,  LOGIN_USUARIO, DT_ULT_ALTER_USUA )
values (vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, trunc(vDATA_INI_GRAVAR), trunc(vDATA_FIM_GRAVAR),SUBSTR(vDADO_DESTINO_TC1,1,4),vLOGIN_USUARIO, SYSDATE);
COMMIT;
SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vLOGIN_USUARIO);

END IF;
*/--fim--comentado em 26/11/19

--inicio--novo em 26/11/19
/*
IF vPOSSUI_INTERVALOS = 'S' and vINTERVALO = 1
THEN
--/*
dbms_output.put_line('10.1F-Crio periodo com sit func da Ficha: '||vDATA_INI_GRAVAR||'-'||vDATA_FIM_GRAVAR);
INSERT INTO  SUGESP_SIT_FUNC_PONTO_FICHAS (ID, ID_LOG_FICHA, TIPO_DML, TABELA, TEM_CARGO_EFETIVO, FAZER, CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, CODIGO_PESSOA,  DT_REG_OCORRENCIA, OCORRENCIA, DT_ULT_ALTER_USUA, LOGIN_USUARIO, LOGIN_OS, DADO_ORIGEM_TC1, DADO_DESTINO_TC1, DADO_ORIGEM_TC2, DADO_DESTINO_TC2, DADO_ORIGEM_TC3, DADO_DESTINO_TC3,
NEW_COD_SIT_FUNCIONAL,NEW_DATA_INIC_SITUACAO, NEW_DATA_FIM_SITUACAO, LOG)
VALUES ((SELECT MAX(ID)+1 FROM SUGESP_SIT_FUNC_PONTO_FICHAS),vID, 'I', vTABELA, vTEM_CARGO_EFETIVO, vFAZER, vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vCODIGO_PESSOA,  vDT_REG_OCORRENCIA, vOCORRENCIA, sysdate, vLOGIN_USUARIO, vLOGIN_OS, vDADO_ORIGEM_TC1, vDADO_DESTINO_TC1, vDADO_ORIGEM_TC2, vDADO_DESTINO_TC2, vDADO_ORIGEM_TC3, vDADO_DESTINO_TC3,
SUBSTR(vDADO_DESTINO_TC1,1,4) , trunc(vDATA_INI_GRAVAR), trunc(vDATA_FIM_GRAVAR), '10.1F-Crio periodo com sit func da Ficha');
INSERT INTO RHCGED_ALT_SIT_FUN (codigo_empresa, tipo_contrato, codigo, data_inic_situacao, data_FIM_situacao, cod_sit_funcional,  LOGIN_USUARIO, DT_ULT_ALTER_USUA )
values (vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, trunc(vDT_INI_AFAST), trunc(vDATA_FIM_GRAVAR),SUBSTR(vDADO_DESTINO_TC1,1,4),vLOGIN_USUARIO, SYSDATE);
COMMIT;
SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vLOGIN_USUARIO);
end if;
*/
--fim -- novo em 26/11/19

--vINTERVALO := vINTERVALO + 1; --novo em 26/11/19

---------------------------------------------------------------ULTIMO DIA FICHA
ELSIF TRUNC(C2.DATA_DIA) = trunc(vDT_FIM_AFAST) THEN
dbms_output.put_line('99-ULTIMO DIA');
--dbms_output.put_line('C3.DATA_FIM: '||C3.DATA_FIM);
dbms_output.put_line('9.3-Guarda data FIM: '||vDATA_FIM_GRAVAR);
vDATA_FIM_GRAVAR := C2.DATA_DIA;

--se no ultimo dia troca de <> N para = N GUARDA nova DATA INICIO E FIM para montar ultimo periodo de alteraÃƒÆ’Ã†â€™Ãƒâ€šÃ‚Â§ÃƒÆ’Ã†â€™Ãƒâ€šÃ‚Â£o
  if C3.CONTROLE_FOLHA = 'N'
  and vCONTROLE_FOLHA_ANTERIOR <> C3.CONTROLE_FOLHA THEN
  --dbms_output.put_line('2.3-Altera CODIGO Da sit func: '||C2.DATA_DIA);
  dbms_output.put_line('2.3-Guarda data inicio: '||vDATA_INI_GRAVAR);
  vDATA_INI_GRAVAR := C2.DATA_DIA;
  end if;

IF vPOSSUI_INTERVALOS = 'N' THEN
---INICIO IF DO ULTIMO DIA COM COMANDOS NA TABELARHCGED_ALT_SIT_FUN

--INICIO--NOVO EM 25/11/19
vDATA_INI_GRAVAR := vDT_INI_AFAST ;
vDATA_FIM_GRAVAR := vDT_FIM_AFAST;
--FIM--NOVO EM 25/11/19


--PARA DATA FIM DO AFASTAMENTO MENOR OU IGUAL AO DIA DE HOJE (SYSDATE)--PASSADO E PRESENTE e DATA FIM 'vazia' da ultima situaÃƒÆ’Ã†â€™Ãƒâ€šÃ‚Â§ÃƒÆ’Ã†â€™Ãƒâ€šÃ‚Â£o funcional periodo
if C3.CONTROLE_FOLHA = 'N' and C3.E_AFASTAMENTO = 'N' and c3.suspende_remunera = 'N' and trunc(C2.DATA_dia) <= trunc(sysdate)
and vDATA_INI_ESTAVA < vDATA_INI_GRAVAR --novo em 22/11/19
AND
--(--NOVO EM 18/11/19
C3.DATA_FIM IS NULL
--OR C3.DATA_FIM IS NOT NULL --NOVO EM 18/11/19
--)--NOVO EM 18/11/19
THEN
      dbms_output.put_line('1.1A-Finaliza a sit func (inicio-1d): '||vDT_INI_AFAST);
      INSERT INTO  SUGESP_SIT_FUNC_PONTO_FICHAS (ID, ID_LOG_FICHA, TIPO_DML, TABELA, TEM_CARGO_EFETIVO, FAZER, CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, CODIGO_PESSOA,  DT_REG_OCORRENCIA, OCORRENCIA, DT_ULT_ALTER_USUA, LOGIN_USUARIO, LOGIN_OS, DADO_ORIGEM_TC1, DADO_DESTINO_TC1, DADO_ORIGEM_TC2, DADO_DESTINO_TC2, DADO_ORIGEM_TC3, DADO_DESTINO_TC3,
      NEW_COD_SIT_FUNCIONAL, OLD_COD_SIT_FUNCIONAL, NEW_DATA_INIC_SITUACAO, OLD_DATA_INIC_SITUACAO, NEW_DATA_FIM_SITUACAO, OLD_DATA_FIM_SITUACAO
      ,LOG)
      VALUES ((SELECT MAX(ID)+1 FROM SUGESP_SIT_FUNC_PONTO_FICHAS),vID, 'U', vTABELA, vTEM_CARGO_EFETIVO, vFAZER, vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vCODIGO_PESSOA,  vDT_REG_OCORRENCIA, vOCORRENCIA, sysdate, vLOGIN_USUARIO, vLOGIN_OS, vDADO_ORIGEM_TC1, vDADO_DESTINO_TC1, vDADO_ORIGEM_TC2, vDADO_DESTINO_TC2, vDADO_ORIGEM_TC3, vDADO_DESTINO_TC3,
      vSIT_FUNC_ESTAVA, vSIT_FUNC_ESTAVA , C3.DATA_INICIO, C3.DATA_INICIO, vDT_INI_AFAST, C3.DATA_FIM
      ,'1.1A-Finaliza a sit func (inicio-1d):');
      UPDATE RHCGED_ALT_SIT_FUN set data_fim_situacao = trunc(vDT_INI_AFAST)-1 , LOGIN_USUARIO = vLOGIN_USUARIO , DT_ULT_ALTER_USUA = SYSDATE
      where codigo_empresa = vCODIGO_EMPRESA and tipo_contrato = vTIPO_CONTRATO and codigo = vCODIGO_CONTRATO and trunc(data_inic_situacao) = trunc(vDATA_INI_ESTAVA);
      COMMIT;
      --SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO,vLOGIN_USUARIO);

      dbms_output.put_line('10.15A-Crio periodo com sit func da Ficha: '||vDATA_INI_GRAVAR||'-'||vDATA_FIM_GRAVAR);
      INSERT INTO  SUGESP_SIT_FUNC_PONTO_FICHAS (ID, ID_LOG_FICHA, TIPO_DML, TABELA, TEM_CARGO_EFETIVO, FAZER, CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, CODIGO_PESSOA,  DT_REG_OCORRENCIA, OCORRENCIA, DT_ULT_ALTER_USUA, LOGIN_USUARIO, LOGIN_OS, DADO_ORIGEM_TC1, DADO_DESTINO_TC1, DADO_ORIGEM_TC2, DADO_DESTINO_TC2, DADO_ORIGEM_TC3, DADO_DESTINO_TC3,
      NEW_COD_SIT_FUNCIONAL,NEW_DATA_INIC_SITUACAO, NEW_DATA_FIM_SITUACAO, LOG)
      VALUES ((SELECT MAX(ID)+1 FROM SUGESP_SIT_FUNC_PONTO_FICHAS),vID, 'I', vTABELA, vTEM_CARGO_EFETIVO, vFAZER, vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vCODIGO_PESSOA,  vDT_REG_OCORRENCIA, vOCORRENCIA, sysdate, vLOGIN_USUARIO, vLOGIN_OS, vDADO_ORIGEM_TC1, vDADO_DESTINO_TC1, vDADO_ORIGEM_TC2, vDADO_DESTINO_TC2, vDADO_ORIGEM_TC3, vDADO_DESTINO_TC3,
      SUBSTR(vDADO_DESTINO_TC1,1,4) , trunc(vDATA_INI_GRAVAR), trunc(vDATA_FIM_GRAVAR), '10.15A-Crio periodo com sit func da Ficha');
IF vPESSOA_APOSENTADA = 'S' AND  vCODIGO_PROC_MED = '000000000000038' 
AND vTEM_SF_ESPECIFICA = 'NAO' --NOVO EM 25/7/22
THEN --ALTERADO EM 15/10/21--NOVO EM 28/7/21
DELETE RHCGED_ALT_SIT_FUN WHERE codigo_empresa = vCODIGO_EMPRESA AND tipo_contrato = vTIPO_CONTRATO AND codigo = vCODIGO_CONTRATO AND TRUNC(data_inic_situacao) = trunc(vDT_INI_AFAST) AND cod_sit_funcional = '6121' AND TRUNC(data_fim_situacao) =  trunc(vDT_FIM_AFAST);COMMIT;--NOVO EM 20/01/2020
      INSERT INTO RHCGED_ALT_SIT_FUN (ind_ef_retro_esocial,codigo_empresa, tipo_contrato, codigo, data_inic_situacao, cod_sit_funcional, data_fim_situacao, LOGIN_USUARIO, DT_ULT_ALTER_USUA, EMPRESA_ATENDENTE, CODIGO_ATENDENTE, NOME_ATENDENTE, INSCRICAO_CONSELHO, UF_CONSELHO, CONSELHO_REGIONAL, CODIGO_DOENCA)
      values ('N',vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, trunc(vDT_INI_AFAST), '6121',  trunc(vDT_FIM_AFAST), vLOGIN_USUARIO, SYSDATE, vEMPRESA_ATENDENTE, vCODIGO_ATENDENTE, vNOME_ATENDENTE, vINSCRICAO_CONSELHO, vUF_INSCRICAO, vCONSELHO_REGIONAL, vCODIGO_DOENCA);
      COMMIT;
      SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vLOGIN_USUARIO);      
ELSE
DELETE RHCGED_ALT_SIT_FUN WHERE codigo_empresa = vCODIGO_EMPRESA AND tipo_contrato = vTIPO_CONTRATO AND codigo = vCODIGO_CONTRATO AND TRUNC(data_inic_situacao) = trunc(vDT_INI_AFAST) 
AND cod_sit_funcional = CASE WHEN LENGTH(vDADO_ORIGEM_TC1) = 23 THEN SUBSTR(vDADO_DESTINO_TC1,1,4) ELSE SUBSTR(vDADO_DESTINO_TC1,5,4) END --NOVO 30/5/22 --COMENTADO 30/5/22--SUBSTR(vDADO_DESTINO_TC1,1,4) 
AND TRUNC(data_fim_situacao) =  trunc(vDT_FIM_AFAST);COMMIT;--NOVO EM 20/01/2020
      INSERT INTO RHCGED_ALT_SIT_FUN (ind_ef_retro_esocial,codigo_empresa, tipo_contrato, codigo, data_inic_situacao, cod_sit_funcional, data_fim_situacao, LOGIN_USUARIO, DT_ULT_ALTER_USUA, EMPRESA_ATENDENTE, CODIGO_ATENDENTE, NOME_ATENDENTE, INSCRICAO_CONSELHO, UF_CONSELHO, CONSELHO_REGIONAL, CODIGO_DOENCA)
      values ('N',vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, trunc(vDT_INI_AFAST), 
      CASE WHEN LENGTH(vDADO_ORIGEM_TC1) = 23 THEN SUBSTR(vDADO_DESTINO_TC1,1,4) ELSE SUBSTR(vDADO_DESTINO_TC1,5,4) END,
      --COMENTADO 30/5/22--SUBSTR(vDADO_DESTINO_TC1,1,4),  
      trunc(vDT_FIM_AFAST), vLOGIN_USUARIO, SYSDATE, vEMPRESA_ATENDENTE, vCODIGO_ATENDENTE, vNOME_ATENDENTE, vINSCRICAO_CONSELHO, vUF_INSCRICAO, vCONSELHO_REGIONAL, vCODIGO_DOENCA);
      COMMIT;
      SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vLOGIN_USUARIO);


END IF;--NOVO EM 28/7/21
      dbms_output.put_line('10.3A-Crio sit func NORMAL (dataINI + 1)com a que estava: '||vSIT_FUNC_ESTAVA ||'-'||vDATA_FIM_GRAVAR);
      INSERT INTO  SUGESP_SIT_FUNC_PONTO_FICHAS (ID, ID_LOG_FICHA, TIPO_DML, TABELA, TEM_CARGO_EFETIVO, FAZER, CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, CODIGO_PESSOA,  DT_REG_OCORRENCIA, OCORRENCIA, DT_ULT_ALTER_USUA, LOGIN_USUARIO, LOGIN_OS, DADO_ORIGEM_TC1, DADO_DESTINO_TC1, DADO_ORIGEM_TC2, DADO_DESTINO_TC2, DADO_ORIGEM_TC3, DADO_DESTINO_TC3,
      NEW_COD_SIT_FUNCIONAL,NEW_DATA_INIC_SITUACAO, LOG)
      VALUES ((SELECT MAX(ID)+1 FROM SUGESP_SIT_FUNC_PONTO_FICHAS),vID, 'I', vTABELA, vTEM_CARGO_EFETIVO, vFAZER, vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vCODIGO_PESSOA,  vDT_REG_OCORRENCIA, vOCORRENCIA, sysdate, vLOGIN_USUARIO, vLOGIN_OS, vDADO_ORIGEM_TC1, vDADO_DESTINO_TC1, vDADO_ORIGEM_TC2, vDADO_DESTINO_TC2, vDADO_ORIGEM_TC3, vDADO_DESTINO_TC3,
      vSIT_FUNC_ESTAVA , trunc(C2.DATA_DIA)+1, '10.3A-Crio sit func NORMAL (dataINI + 1)com a que estava');
DELETE RHCGED_ALT_SIT_FUN WHERE codigo_empresa = vCODIGO_EMPRESA AND tipo_contrato = vTIPO_CONTRATO AND codigo = vCODIGO_CONTRATO AND TRUNC(data_inic_situacao) = trunc(vDT_FIM_AFAST)+1 AND cod_sit_funcional = vSIT_FUNC_ESTAVA;COMMIT;--NOVO EM 20/01/2020
      INSERT INTO RHCGED_ALT_SIT_FUN (ind_ef_retro_esocial, codigo_empresa, tipo_contrato, codigo, data_inic_situacao, cod_sit_funcional, LOGIN_USUARIO, DT_ULT_ALTER_USUA)
      values ('N',vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, trunc(vDT_FIM_AFAST)+1, vSIT_FUNC_ESTAVA, vLOGIN_USUARIO, SYSDATE);
      COMMIT;
      SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vLOGIN_USUARIO);


--NOVO EM 22/11/19
ELSif C3.CONTROLE_FOLHA = 'N' and C3.E_AFASTAMENTO = 'N' and c3.suspende_remunera = 'N' and trunc(C2.DATA_dia) <= trunc(sysdate)
and vDATA_INI_ESTAVA = vDATA_INI_GRAVAR --novo em 22/11/19
AND
--(--NOVO EM 18/11/19
C3.DATA_FIM IS NULL
--OR C3.DATA_FIM IS NOT NULL --NOVO EM 18/11/19
--)--NOVO EM 18/11/19
THEN
      dbms_output.put_line('1.1D-Finaliza a sit func COM O FIM DA FICHA e ALTERO A SIT FUNC com A DA FICHA: '||vDT_INI_AFAST);
      INSERT INTO  SUGESP_SIT_FUNC_PONTO_FICHAS (ID, ID_LOG_FICHA, TIPO_DML, TABELA, TEM_CARGO_EFETIVO, FAZER, CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, CODIGO_PESSOA,  DT_REG_OCORRENCIA, OCORRENCIA, DT_ULT_ALTER_USUA, LOGIN_USUARIO, LOGIN_OS, DADO_ORIGEM_TC1, DADO_DESTINO_TC1, DADO_ORIGEM_TC2, DADO_DESTINO_TC2, DADO_ORIGEM_TC3, DADO_DESTINO_TC3,
      NEW_COD_SIT_FUNCIONAL, OLD_COD_SIT_FUNCIONAL, NEW_DATA_INIC_SITUACAO, OLD_DATA_INIC_SITUACAO, NEW_DATA_FIM_SITUACAO, OLD_DATA_FIM_SITUACAO
      ,LOG)
      VALUES ((SELECT MAX(ID)+1 FROM SUGESP_SIT_FUNC_PONTO_FICHAS),vID, 'U', vTABELA, vTEM_CARGO_EFETIVO, vFAZER, vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vCODIGO_PESSOA,  vDT_REG_OCORRENCIA, vOCORRENCIA, sysdate, vLOGIN_USUARIO, vLOGIN_OS, vDADO_ORIGEM_TC1, vDADO_DESTINO_TC1, vDADO_ORIGEM_TC2, vDADO_DESTINO_TC2, vDADO_ORIGEM_TC3, vDADO_DESTINO_TC3,
      vSIT_FUNC_ESTAVA, vSIT_FUNC_ESTAVA , C3.DATA_INICIO, C3.DATA_INICIO, vDT_INI_AFAST, C3.DATA_FIM
      ,'1.1D-Finaliza a sit func COM O FIM DA FICHA e ALTERO A SIT FUNC com A DA FICHA');
IF vPESSOA_APOSENTADA = 'S' AND  vCODIGO_PROC_MED = '000000000000038' 
AND vTEM_SF_ESPECIFICA = 'NAO' --NOVO EM 25/7/22
THEN --ALTERADO EM 15/10/21--NOVO EM 28/7/21
      UPDATE RHCGED_ALT_SIT_FUN set data_fim_situacao = trunc(vDT_FIM_AFAST), cod_sit_funcional = '6121', LOGIN_USUARIO = vLOGIN_USUARIO , DT_ULT_ALTER_USUA = SYSDATE , EMPRESA_ATENDENTE = vEMPRESA_ATENDENTE, CODIGO_ATENDENTE = vCODIGO_ATENDENTE, NOME_ATENDENTE = vNOME_ATENDENTE, INSCRICAO_CONSELHO = vINSCRICAO_CONSELHO, UF_CONSELHO = vUF_INSCRICAO, CONSELHO_REGIONAL = vCONSELHO_REGIONAL, CODIGO_DOENCA = vCODIGO_DOENCA
      where codigo_empresa = vCODIGO_EMPRESA and tipo_contrato = vTIPO_CONTRATO and codigo = vCODIGO_CONTRATO and trunc(data_inic_situacao) = trunc(vDATA_INI_ESTAVA);
      COMMIT;
      --SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO,vLOGIN_USUARIO);
ELSE 
      UPDATE RHCGED_ALT_SIT_FUN set data_fim_situacao = trunc(vDT_FIM_AFAST)
      , cod_sit_funcional = CASE WHEN LENGTH(vDADO_ORIGEM_TC1) = 23 THEN SUBSTR(vDADO_DESTINO_TC1,1,4) ELSE SUBSTR(vDADO_DESTINO_TC1,5,4) END --NOVO EM 30/5/22
      --COMENTADO 30/5/22--SUBSTR(vDADO_DESTINO_TC1,1,4)
      , LOGIN_USUARIO = vLOGIN_USUARIO , DT_ULT_ALTER_USUA = SYSDATE , EMPRESA_ATENDENTE = vEMPRESA_ATENDENTE, CODIGO_ATENDENTE = vCODIGO_ATENDENTE, NOME_ATENDENTE = vNOME_ATENDENTE, INSCRICAO_CONSELHO = vINSCRICAO_CONSELHO, UF_CONSELHO = vUF_INSCRICAO, CONSELHO_REGIONAL = vCONSELHO_REGIONAL, CODIGO_DOENCA = vCODIGO_DOENCA
      where codigo_empresa = vCODIGO_EMPRESA and tipo_contrato = vTIPO_CONTRATO and codigo = vCODIGO_CONTRATO and trunc(data_inic_situacao) = trunc(vDATA_INI_ESTAVA);
      COMMIT;

END IF;--NOVO EM 28/7/21

      dbms_output.put_line('10.3D-Crio sit func NORMAL (dataINI + 1)com a que estava: '||vSIT_FUNC_ESTAVA ||'-'||vDATA_FIM_GRAVAR);
      INSERT INTO  SUGESP_SIT_FUNC_PONTO_FICHAS (ID, ID_LOG_FICHA, TIPO_DML, TABELA, TEM_CARGO_EFETIVO, FAZER, CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, CODIGO_PESSOA,  DT_REG_OCORRENCIA, OCORRENCIA, DT_ULT_ALTER_USUA, LOGIN_USUARIO, LOGIN_OS, DADO_ORIGEM_TC1, DADO_DESTINO_TC1, DADO_ORIGEM_TC2, DADO_DESTINO_TC2, DADO_ORIGEM_TC3, DADO_DESTINO_TC3,
      NEW_COD_SIT_FUNCIONAL,NEW_DATA_INIC_SITUACAO, LOG)
      VALUES ((SELECT MAX(ID)+1 FROM SUGESP_SIT_FUNC_PONTO_FICHAS),vID, 'I', vTABELA, vTEM_CARGO_EFETIVO, vFAZER, vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vCODIGO_PESSOA,  vDT_REG_OCORRENCIA, vOCORRENCIA, sysdate, vLOGIN_USUARIO, vLOGIN_OS, vDADO_ORIGEM_TC1, vDADO_DESTINO_TC1, vDADO_ORIGEM_TC2, vDADO_DESTINO_TC2, vDADO_ORIGEM_TC3, vDADO_DESTINO_TC3,
      vSIT_FUNC_ESTAVA , trunc(C2.DATA_DIA)+1, '10.3D-Crio sit func NORMAL (dataINI + 1)com a que estava');
DELETE RHCGED_ALT_SIT_FUN WHERE codigo_empresa = vCODIGO_EMPRESA AND tipo_contrato = vTIPO_CONTRATO AND codigo = vCODIGO_CONTRATO AND TRUNC(data_inic_situacao) = trunc(vDT_FIM_AFAST)+1 AND cod_sit_funcional = vSIT_FUNC_ESTAVA;COMMIT;--NOVO EM 20/01/2020
      INSERT INTO RHCGED_ALT_SIT_FUN (ind_ef_retro_esocial, codigo_empresa, tipo_contrato, codigo, data_inic_situacao, cod_sit_funcional, LOGIN_USUARIO, DT_ULT_ALTER_USUA)
      values ('N', vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, trunc(vDT_FIM_AFAST)+1, vSIT_FUNC_ESTAVA, vLOGIN_USUARIO, SYSDATE);
      COMMIT;
      SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vLOGIN_USUARIO);



-- NOVO EM 18/11/19
--PARA DATA FIM DO AFASTAMENTO MENOR OU IGUAL AO DIA DE HOJE (SYSDATE)--PASSADO E PRESENTE e DATA FIM 'vazia' da ultima situaÃƒÆ’Ã†â€™Ãƒâ€šÃ‚Â§ÃƒÆ’Ã†â€™Ãƒâ€šÃ‚Â£o funcional periodo
ELSif C3.CONTROLE_FOLHA = 'N' and C3.E_AFASTAMENTO = 'N' and c3.suspende_remunera = 'N' and trunc(C2.DATA_dia) <= trunc(sysdate)
and vDATA_INI_ESTAVA < vDATA_INI_GRAVAR --novo em 22/11/19
AND
C3.DATA_FIM IS NOT NULL

THEN
      dbms_output.put_line('1.1B-Finaliza a sit func (inicio-1d): '||vDT_INI_AFAST);
      INSERT INTO  SUGESP_SIT_FUNC_PONTO_FICHAS (ID, ID_LOG_FICHA, TIPO_DML, TABELA, TEM_CARGO_EFETIVO, FAZER, CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, CODIGO_PESSOA,  DT_REG_OCORRENCIA, OCORRENCIA, DT_ULT_ALTER_USUA, LOGIN_USUARIO, LOGIN_OS, DADO_ORIGEM_TC1, DADO_DESTINO_TC1, DADO_ORIGEM_TC2, DADO_DESTINO_TC2, DADO_ORIGEM_TC3, DADO_DESTINO_TC3,
      NEW_COD_SIT_FUNCIONAL, OLD_COD_SIT_FUNCIONAL, NEW_DATA_INIC_SITUACAO, OLD_DATA_INIC_SITUACAO, NEW_DATA_FIM_SITUACAO, OLD_DATA_FIM_SITUACAO
      ,LOG)
      VALUES ((SELECT MAX(ID)+1 FROM SUGESP_SIT_FUNC_PONTO_FICHAS),vID, 'U', vTABELA, vTEM_CARGO_EFETIVO, vFAZER, vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vCODIGO_PESSOA,  vDT_REG_OCORRENCIA, vOCORRENCIA, sysdate, vLOGIN_USUARIO, vLOGIN_OS, vDADO_ORIGEM_TC1, vDADO_DESTINO_TC1, vDADO_ORIGEM_TC2, vDADO_DESTINO_TC2, vDADO_ORIGEM_TC3, vDADO_DESTINO_TC3,
      vSIT_FUNC_ESTAVA, vSIT_FUNC_ESTAVA , C3.DATA_INICIO, C3.DATA_INICIO, vDT_INI_AFAST, C3.DATA_FIM
      ,'1.1B-Finaliza a sit func (inicio-1d):');
      UPDATE RHCGED_ALT_SIT_FUN set data_fim_situacao = trunc(vDT_INI_AFAST)-1 , LOGIN_USUARIO = vLOGIN_USUARIO , DT_ULT_ALTER_USUA = SYSDATE
      where codigo_empresa = vCODIGO_EMPRESA and tipo_contrato = vTIPO_CONTRATO and codigo = vCODIGO_CONTRATO and trunc(data_inic_situacao) = trunc(vDATA_INI_ESTAVA);
      COMMIT;
      --SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO,vLOGIN_USUARIO);

      dbms_output.put_line('10.15B-Crio periodo com sit func da Ficha: '||vDATA_INI_GRAVAR||'-'||vDATA_FIM_GRAVAR);
      INSERT INTO  SUGESP_SIT_FUNC_PONTO_FICHAS (ID, ID_LOG_FICHA, TIPO_DML, TABELA, TEM_CARGO_EFETIVO, FAZER, CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, CODIGO_PESSOA,  DT_REG_OCORRENCIA, OCORRENCIA, DT_ULT_ALTER_USUA, LOGIN_USUARIO, LOGIN_OS, DADO_ORIGEM_TC1, DADO_DESTINO_TC1, DADO_ORIGEM_TC2, DADO_DESTINO_TC2, DADO_ORIGEM_TC3, DADO_DESTINO_TC3,
      NEW_COD_SIT_FUNCIONAL,NEW_DATA_INIC_SITUACAO, NEW_DATA_FIM_SITUACAO, LOG)
      VALUES ((SELECT MAX(ID)+1 FROM SUGESP_SIT_FUNC_PONTO_FICHAS),vID, 'I', vTABELA, vTEM_CARGO_EFETIVO, vFAZER, vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vCODIGO_PESSOA,  vDT_REG_OCORRENCIA, vOCORRENCIA, sysdate, vLOGIN_USUARIO, vLOGIN_OS, vDADO_ORIGEM_TC1, vDADO_DESTINO_TC1, vDADO_ORIGEM_TC2, vDADO_DESTINO_TC2, vDADO_ORIGEM_TC3, vDADO_DESTINO_TC3,
      CASE WHEN LENGTH(vDADO_ORIGEM_TC1) = 23 THEN SUBSTR(vDADO_DESTINO_TC1,1,4) ELSE SUBSTR(vDADO_DESTINO_TC1,5,4) END --NOVO EM 30/5/22
      --COMENTADO 30/5/22 --SUBSTR(vDADO_DESTINO_TC1,1,4) 
      , trunc(vDATA_INI_GRAVAR), trunc(vDATA_FIM_GRAVAR), '10.15B-Crio periodo com sit func da Ficha');
IF vPESSOA_APOSENTADA = 'S' AND  vCODIGO_PROC_MED = '000000000000038' 
AND vTEM_SF_ESPECIFICA = 'NAO' --NOVO EM 25/7/22
THEN --ALTERADO EM 15/10/21 --NOVO EM 28/7/21
DELETE RHCGED_ALT_SIT_FUN WHERE codigo_empresa = vCODIGO_EMPRESA AND tipo_contrato = vTIPO_CONTRATO AND codigo = vCODIGO_CONTRATO AND TRUNC(data_inic_situacao) = trunc(vDT_INI_AFAST) AND cod_sit_funcional = '6121';COMMIT;--NOVO EM 20/01/2020
      INSERT INTO RHCGED_ALT_SIT_FUN (ind_ef_retro_esocial, codigo_empresa, tipo_contrato, codigo, data_inic_situacao, cod_sit_funcional, data_fim_situacao, LOGIN_USUARIO, DT_ULT_ALTER_USUA, EMPRESA_ATENDENTE, CODIGO_ATENDENTE, NOME_ATENDENTE, INSCRICAO_CONSELHO, UF_CONSELHO, CONSELHO_REGIONAL, CODIGO_DOENCA )
      values ('N', vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, trunc(vDT_INI_AFAST), '6121', trunc(vDT_FIM_AFAST), vLOGIN_USUARIO, SYSDATE, vEMPRESA_ATENDENTE, vCODIGO_ATENDENTE, vNOME_ATENDENTE, vINSCRICAO_CONSELHO, vUF_INSCRICAO, vCONSELHO_REGIONAL, vCODIGO_DOENCA);
      COMMIT;
      SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vLOGIN_USUARIO);
ELSE 
DELETE RHCGED_ALT_SIT_FUN WHERE codigo_empresa = vCODIGO_EMPRESA AND tipo_contrato = vTIPO_CONTRATO AND codigo = vCODIGO_CONTRATO AND TRUNC(data_inic_situacao) = trunc(vDT_INI_AFAST) AND cod_sit_funcional = SUBSTR(vDADO_DESTINO_TC1,1,4);COMMIT;--NOVO EM 20/01/2020
      INSERT INTO RHCGED_ALT_SIT_FUN (ind_ef_retro_esocial, codigo_empresa, tipo_contrato, codigo, data_inic_situacao, cod_sit_funcional, data_fim_situacao, LOGIN_USUARIO, DT_ULT_ALTER_USUA, EMPRESA_ATENDENTE, CODIGO_ATENDENTE, NOME_ATENDENTE, INSCRICAO_CONSELHO, UF_CONSELHO, CONSELHO_REGIONAL, CODIGO_DOENCA )
      values ('N', vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, trunc(vDT_INI_AFAST), 
      CASE WHEN LENGTH(vDADO_ORIGEM_TC1) = 23 THEN SUBSTR(vDADO_DESTINO_TC1,1,4) ELSE SUBSTR(vDADO_DESTINO_TC1,5,4) END --NOVO EM 30/5/22
      --COMENTADO 30/5/22 --SUBSTR(vDADO_DESTINO_TC1,1,4)
      , trunc(vDT_FIM_AFAST), vLOGIN_USUARIO, SYSDATE, vEMPRESA_ATENDENTE, vCODIGO_ATENDENTE, vNOME_ATENDENTE, vINSCRICAO_CONSELHO, vUF_INSCRICAO, vCONSELHO_REGIONAL, vCODIGO_DOENCA);
      COMMIT;
      SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vLOGIN_USUARIO);

END IF;--NOVO EM 28/7/21
 --inicio --comentado para testar em 27/11/19 as 17h23
      dbms_output.put_line('10.3C-Crio sit func NORMAL (dataINI + 1)com a que estava + data fim que tinha: '||vSIT_FUNC_ESTAVA ||'-'||vDATA_FIM_GRAVAR);
      INSERT INTO  SUGESP_SIT_FUNC_PONTO_FICHAS (ID, ID_LOG_FICHA, TIPO_DML, TABELA, TEM_CARGO_EFETIVO, FAZER, CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, CODIGO_PESSOA,  DT_REG_OCORRENCIA, OCORRENCIA, DT_ULT_ALTER_USUA, LOGIN_USUARIO, LOGIN_OS, DADO_ORIGEM_TC1, DADO_DESTINO_TC1, DADO_ORIGEM_TC2, DADO_DESTINO_TC2, DADO_ORIGEM_TC3, DADO_DESTINO_TC3,
      NEW_COD_SIT_FUNCIONAL,NEW_DATA_INIC_SITUACAO, LOG)
      VALUES ((SELECT MAX(ID)+1 FROM SUGESP_SIT_FUNC_PONTO_FICHAS),vID, 'I', vTABELA, vTEM_CARGO_EFETIVO, vFAZER, vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vCODIGO_PESSOA,  vDT_REG_OCORRENCIA, vOCORRENCIA, sysdate, vLOGIN_USUARIO, vLOGIN_OS, vDADO_ORIGEM_TC1, vDADO_DESTINO_TC1, vDADO_ORIGEM_TC2, vDADO_DESTINO_TC2, vDADO_ORIGEM_TC3, vDADO_DESTINO_TC3,
      vSIT_FUNC_ESTAVA , trunc(C2.DATA_DIA)+1, '10.3C-Crio sit func NORMAL (dataINI + 1)com a que estava');
DELETE RHCGED_ALT_SIT_FUN WHERE codigo_empresa = vCODIGO_EMPRESA AND tipo_contrato = vTIPO_CONTRATO AND codigo = vCODIGO_CONTRATO AND TRUNC(data_inic_situacao) = trunc(vDT_FIM_AFAST)+1 AND cod_sit_funcional = vSIT_FUNC_ESTAVA;COMMIT;--NOVO EM 20/01/2020
      INSERT INTO RHCGED_ALT_SIT_FUN (ind_ef_retro_esocial, codigo_empresa, tipo_contrato, codigo, data_inic_situacao, cod_sit_funcional, LOGIN_USUARIO, DT_ULT_ALTER_USUA, data_fim_situacao )
      values ('N',vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, trunc(vDT_FIM_AFAST)+1, vSIT_FUNC_ESTAVA, vLOGIN_USUARIO, SYSDATE, vULT_DATA_FIM_ANTES_DEFERIDO);
      COMMIT;
      SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vLOGIN_USUARIO);
--fim --comentado para testar em 27/11/19 as 17h23


-- NOVO EM 22/11/19
--PARA DATA FIM DO AFASTAMENTO MENOR OU IGUAL AO DIA DE HOJE (SYSDATE)--PASSADO E PRESENTE e DATA FIM 'vazia' da ultima situaÃƒÆ’Ã†â€™Ãƒâ€šÃ‚Â§ÃƒÆ’Ã†â€™Ãƒâ€šÃ‚Â£o funcional periodo
ELSif C3.CONTROLE_FOLHA = 'N' and C3.E_AFASTAMENTO = 'N' and c3.suspende_remunera = 'N' and trunc(C2.DATA_dia) <= trunc(sysdate)
and vDATA_INI_ESTAVA = vDATA_INI_GRAVAR --novo em 22/11/19
AND
C3.DATA_FIM IS NOT NULL

THEN
      dbms_output.put_line('1.1E-Finaliza a sit func COM O FIM DA FICHA e ALTERO A SIT FUNC com A DA FICHA: '||vDT_INI_AFAST);
      INSERT INTO  SUGESP_SIT_FUNC_PONTO_FICHAS (ID, ID_LOG_FICHA, TIPO_DML, TABELA, TEM_CARGO_EFETIVO, FAZER, CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, CODIGO_PESSOA,  DT_REG_OCORRENCIA, OCORRENCIA, DT_ULT_ALTER_USUA, LOGIN_USUARIO, LOGIN_OS, DADO_ORIGEM_TC1, DADO_DESTINO_TC1, DADO_ORIGEM_TC2, DADO_DESTINO_TC2, DADO_ORIGEM_TC3, DADO_DESTINO_TC3,
      NEW_COD_SIT_FUNCIONAL, OLD_COD_SIT_FUNCIONAL, NEW_DATA_INIC_SITUACAO, OLD_DATA_INIC_SITUACAO, NEW_DATA_FIM_SITUACAO, OLD_DATA_FIM_SITUACAO
      ,LOG)
      VALUES ((SELECT MAX(ID)+1 FROM SUGESP_SIT_FUNC_PONTO_FICHAS),vID, 'U', vTABELA, vTEM_CARGO_EFETIVO, vFAZER, vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vCODIGO_PESSOA,  vDT_REG_OCORRENCIA, vOCORRENCIA, sysdate, vLOGIN_USUARIO, vLOGIN_OS, vDADO_ORIGEM_TC1, vDADO_DESTINO_TC1, vDADO_ORIGEM_TC2, vDADO_DESTINO_TC2, vDADO_ORIGEM_TC3, vDADO_DESTINO_TC3,
      vSIT_FUNC_ESTAVA, vSIT_FUNC_ESTAVA , C3.DATA_INICIO, C3.DATA_INICIO, vDT_INI_AFAST, C3.DATA_FIM
      ,'1.1E-Finaliza a sit func COM O FIM DA FICHA e ALTERO A SIT FUNC com A DA FICHA');
IF vPESSOA_APOSENTADA = 'S' AND  vCODIGO_PROC_MED = '000000000000038' 
AND vTEM_SF_ESPECIFICA = 'NAO' --NOVO EM 25/7/22
THEN --ALTERADO EM 15/10/21--NOVO EM 28/7/21
      UPDATE RHCGED_ALT_SIT_FUN set data_fim_situacao = trunc(vDT_FIM_AFAST), cod_sit_funcional = '6121', LOGIN_USUARIO = vLOGIN_USUARIO , DT_ULT_ALTER_USUA = SYSDATE, EMPRESA_ATENDENTE = vEMPRESA_ATENDENTE, CODIGO_ATENDENTE = vCODIGO_ATENDENTE, NOME_ATENDENTE = vNOME_ATENDENTE, INSCRICAO_CONSELHO = vINSCRICAO_CONSELHO, UF_CONSELHO = vUF_INSCRICAO, CONSELHO_REGIONAL = vCONSELHO_REGIONAL, CODIGO_DOENCA = vCODIGO_DOENCA
      where codigo_empresa = vCODIGO_EMPRESA and tipo_contrato = vTIPO_CONTRATO and codigo = vCODIGO_CONTRATO and trunc(data_inic_situacao) = trunc(vDATA_INI_ESTAVA);
      COMMIT;
ELSE 
      UPDATE RHCGED_ALT_SIT_FUN set data_fim_situacao = trunc(vDT_FIM_AFAST), cod_sit_funcional = 
      CASE WHEN LENGTH(vDADO_ORIGEM_TC1) = 23 THEN SUBSTR(vDADO_DESTINO_TC1,1,4) ELSE SUBSTR(vDADO_DESTINO_TC1,5,4) END --NOVO EM 30/5/22
      --COMENTADO 30/5/22 --SUBSTR(vDADO_DESTINO_TC1,1,4)
      , LOGIN_USUARIO = vLOGIN_USUARIO , DT_ULT_ALTER_USUA = SYSDATE, EMPRESA_ATENDENTE = vEMPRESA_ATENDENTE, CODIGO_ATENDENTE = vCODIGO_ATENDENTE, NOME_ATENDENTE = vNOME_ATENDENTE, INSCRICAO_CONSELHO = vINSCRICAO_CONSELHO, UF_CONSELHO = vUF_INSCRICAO, CONSELHO_REGIONAL = vCONSELHO_REGIONAL, CODIGO_DOENCA = vCODIGO_DOENCA
      where codigo_empresa = vCODIGO_EMPRESA and tipo_contrato = vTIPO_CONTRATO and codigo = vCODIGO_CONTRATO and trunc(data_inic_situacao) = trunc(vDATA_INI_ESTAVA);
      COMMIT;
      --SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO,vLOGIN_USUARIO);

END IF;--NOVO EM 28/7/21
      dbms_output.put_line('10.3E-Crio sit func NORMAL (dataINI + 1)com a que estava + data fim que tinha: '||vSIT_FUNC_ESTAVA ||'-'||vDATA_FIM_GRAVAR);
      INSERT INTO  SUGESP_SIT_FUNC_PONTO_FICHAS (ID, ID_LOG_FICHA, TIPO_DML, TABELA, TEM_CARGO_EFETIVO, FAZER, CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, CODIGO_PESSOA,  DT_REG_OCORRENCIA, OCORRENCIA, DT_ULT_ALTER_USUA, LOGIN_USUARIO, LOGIN_OS, DADO_ORIGEM_TC1, DADO_DESTINO_TC1, DADO_ORIGEM_TC2, DADO_DESTINO_TC2, DADO_ORIGEM_TC3, DADO_DESTINO_TC3,
      NEW_COD_SIT_FUNCIONAL,NEW_DATA_INIC_SITUACAO, LOG)
      VALUES ((SELECT MAX(ID)+1 FROM SUGESP_SIT_FUNC_PONTO_FICHAS),vID, 'I', vTABELA, vTEM_CARGO_EFETIVO, vFAZER, vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vCODIGO_PESSOA,  vDT_REG_OCORRENCIA, vOCORRENCIA, sysdate, vLOGIN_USUARIO, vLOGIN_OS, vDADO_ORIGEM_TC1, vDADO_DESTINO_TC1, vDADO_ORIGEM_TC2, vDADO_DESTINO_TC2, vDADO_ORIGEM_TC3, vDADO_DESTINO_TC3,
      vSIT_FUNC_ESTAVA , trunc(C2.DATA_DIA)+1, '10.3E-Crio sit func NORMAL (dataINI + 1)com a que estava');
DELETE RHCGED_ALT_SIT_FUN WHERE codigo_empresa = vCODIGO_EMPRESA AND tipo_contrato = vTIPO_CONTRATO AND codigo = vCODIGO_CONTRATO AND TRUNC(data_inic_situacao) = trunc(vDT_FIM_AFAST)+1 AND cod_sit_funcional = vSIT_FUNC_ESTAVA;COMMIT;--NOVO EM 20/01/2020
      INSERT INTO RHCGED_ALT_SIT_FUN (ind_ef_retro_esocial,codigo_empresa, tipo_contrato, codigo, data_inic_situacao, cod_sit_funcional, LOGIN_USUARIO, DT_ULT_ALTER_USUA, data_fim_situacao )
      values ('N', vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, trunc(vDT_FIM_AFAST)+1, vSIT_FUNC_ESTAVA, vLOGIN_USUARIO, SYSDATE, vULT_DATA_FIM_ANTES_DEFERIDO);
      COMMIT;
      SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vLOGIN_USUARIO);



--PARA DATA FIM DO AFASTAMENTO MAIOR AO DIA DE HOJE (SYSDATE)--FUTURO e DATA FIM 'vazia' da ultima situaCAo funcional periodo
elsif C3.CONTROLE_FOLHA = 'N' and C3.E_AFASTAMENTO = 'N' and c3.suspende_remunera = 'N' and trunc(C2.DATA_dia) > trunc(sysdate)
and vDATA_INI_ESTAVA < vDATA_INI_GRAVAR --novo em 22/11/19
AND
--( --NOVO EM 18/11/19
C3.DATA_FIM IS NULL
--OR C3.DATA_FIM IS NOT NULL --NOVO EM 18/11/19
--)--NOVO EM 18/11/19
THEN
      dbms_output.put_line('1.1C-Finaliza a sit func (inicio-1d): '||vDT_INI_AFAST);
      INSERT INTO  SUGESP_SIT_FUNC_PONTO_FICHAS (ID, ID_LOG_FICHA, TIPO_DML, TABELA, TEM_CARGO_EFETIVO, FAZER, CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, CODIGO_PESSOA,  DT_REG_OCORRENCIA, OCORRENCIA, DT_ULT_ALTER_USUA, LOGIN_USUARIO, LOGIN_OS, DADO_ORIGEM_TC1, DADO_DESTINO_TC1, DADO_ORIGEM_TC2, DADO_DESTINO_TC2, DADO_ORIGEM_TC3, DADO_DESTINO_TC3,
      NEW_COD_SIT_FUNCIONAL, OLD_COD_SIT_FUNCIONAL, NEW_DATA_INIC_SITUACAO, OLD_DATA_INIC_SITUACAO, NEW_DATA_FIM_SITUACAO, OLD_DATA_FIM_SITUACAO
      ,LOG)
      VALUES ((SELECT MAX(ID)+1 FROM SUGESP_SIT_FUNC_PONTO_FICHAS),vID, 'U', vTABELA, vTEM_CARGO_EFETIVO, vFAZER, vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vCODIGO_PESSOA,  vDT_REG_OCORRENCIA, vOCORRENCIA, sysdate, vLOGIN_USUARIO, vLOGIN_OS, vDADO_ORIGEM_TC1, vDADO_DESTINO_TC1, vDADO_ORIGEM_TC2, vDADO_DESTINO_TC2, vDADO_ORIGEM_TC3, vDADO_DESTINO_TC3,
      vSIT_FUNC_ESTAVA, vSIT_FUNC_ESTAVA , C3.DATA_INICIO, C3.DATA_INICIO, vDT_INI_AFAST, C3.DATA_FIM
      ,'1.1C-Finaliza a sit func (inicio-1d):');
      UPDATE RHCGED_ALT_SIT_FUN set data_fim_situacao = trunc(vDT_INI_AFAST)-1 , LOGIN_USUARIO = vLOGIN_USUARIO , DT_ULT_ALTER_USUA = SYSDATE
      where codigo_empresa = vCODIGO_EMPRESA and tipo_contrato = vTIPO_CONTRATO and codigo = vCODIGO_CONTRATO and trunc(data_inic_situacao) = trunc(vDATA_INI_ESTAVA);
      COMMIT;
      --SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO,vLOGIN_USUARIO);

      IF SUBSTR(vDADO_DESTINO_TC1,1,4) <> '1025' THEN --NOVO IF PARA DIFERENCIAR A 1025-AFASTAMENTO PRELIMINAR A APOSENSTADORIA CAMPO PROXIMA SITUACAO, FIXANDO NA 1715
      dbms_output.put_line('10.15C-Crio periodo com sit func da Ficha E PROXIMA SITUACAO com a que estava sit func NORMAL: '||vDATA_INI_GRAVAR||'-'||vDATA_FIM_GRAVAR);
      INSERT INTO  SUGESP_SIT_FUNC_PONTO_FICHAS (ID, ID_LOG_FICHA, TIPO_DML, TABELA, TEM_CARGO_EFETIVO, FAZER, CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, CODIGO_PESSOA,  DT_REG_OCORRENCIA, OCORRENCIA, DT_ULT_ALTER_USUA, LOGIN_USUARIO, LOGIN_OS, DADO_ORIGEM_TC1, DADO_DESTINO_TC1, DADO_ORIGEM_TC2, DADO_DESTINO_TC2, DADO_ORIGEM_TC3, DADO_DESTINO_TC3,
      NEW_COD_SIT_FUNCIONAL,NEW_DATA_INIC_SITUACAO, NEW_DATA_FIM_SITUACAO, LOG)
      VALUES ((SELECT MAX(ID)+1 FROM SUGESP_SIT_FUNC_PONTO_FICHAS),vID, 'I', vTABELA, vTEM_CARGO_EFETIVO, vFAZER, vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vCODIGO_PESSOA,  vDT_REG_OCORRENCIA, vOCORRENCIA, sysdate, vLOGIN_USUARIO, vLOGIN_OS, vDADO_ORIGEM_TC1, vDADO_DESTINO_TC1, vDADO_ORIGEM_TC2, vDADO_DESTINO_TC2, vDADO_ORIGEM_TC3, vDADO_DESTINO_TC3,
      SUBSTR(vDADO_DESTINO_TC1,1,4) , trunc(vDATA_INI_GRAVAR), trunc(vDATA_FIM_GRAVAR), '10.15C-Crio periodo com sit func da Ficha E PROXIMA SITUACAO com a que estava sit func NORMAL');
IF vPESSOA_APOSENTADA = 'S' AND  vCODIGO_PROC_MED = '000000000000038' 
AND vTEM_SF_ESPECIFICA = 'NAO' --NOVO EM 25/7/22
THEN --ALTERADO EM 15/10/21 --NOVO EM 28/7/21
DELETE RHCGED_ALT_SIT_FUN WHERE codigo_empresa = vCODIGO_EMPRESA AND tipo_contrato = vTIPO_CONTRATO AND codigo = vCODIGO_CONTRATO AND TRUNC(data_inic_situacao) = trunc(vDATA_INI_GRAVAR) AND cod_sit_funcional = '6121';COMMIT;--NOVO EM 20/01/2020
      INSERT INTO RHCGED_ALT_SIT_FUN (ind_ef_retro_esocial, codigo_empresa, tipo_contrato, codigo, data_inic_situacao, cod_sit_funcional, data_fim_situacao, proxima_situacao, LOGIN_USUARIO, DT_ULT_ALTER_USUA, EMPRESA_ATENDENTE, CODIGO_ATENDENTE, NOME_ATENDENTE, INSCRICAO_CONSELHO, UF_CONSELHO, CONSELHO_REGIONAL, CODIGO_DOENCA )
      values ('N', vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, trunc(vDATA_INI_GRAVAR), '6121', trunc(vDATA_FIM_GRAVAR), vSIT_FUNC_ESTAVA, vLOGIN_USUARIO, SYSDATE, vEMPRESA_ATENDENTE, vCODIGO_ATENDENTE, vNOME_ATENDENTE, vINSCRICAO_CONSELHO, vUF_INSCRICAO, vCONSELHO_REGIONAL, vCODIGO_DOENCA);
      COMMIT;
ELSE 
DELETE RHCGED_ALT_SIT_FUN WHERE codigo_empresa = vCODIGO_EMPRESA AND tipo_contrato = vTIPO_CONTRATO AND codigo = vCODIGO_CONTRATO AND TRUNC(data_inic_situacao) = trunc(vDATA_INI_GRAVAR) AND cod_sit_funcional = SUBSTR(vDADO_DESTINO_TC1,1,4);COMMIT;--NOVO EM 20/01/2020
      INSERT INTO RHCGED_ALT_SIT_FUN (ind_ef_retro_esocial, codigo_empresa, tipo_contrato, codigo, data_inic_situacao, cod_sit_funcional, data_fim_situacao, proxima_situacao, LOGIN_USUARIO, DT_ULT_ALTER_USUA, EMPRESA_ATENDENTE, CODIGO_ATENDENTE, NOME_ATENDENTE, INSCRICAO_CONSELHO, UF_CONSELHO, CONSELHO_REGIONAL, CODIGO_DOENCA )
      values ('N', vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, trunc(vDATA_INI_GRAVAR), 
      CASE WHEN LENGTH(vDADO_ORIGEM_TC1) = 23 THEN SUBSTR(vDADO_DESTINO_TC1,1,4) ELSE SUBSTR(vDADO_DESTINO_TC1,5,4) END --NOVO 30/5/22
      --COMENTADO 30/5/22--SUBSTR(vDADO_DESTINO_TC1,1,4)
      , trunc(vDATA_FIM_GRAVAR), vSIT_FUNC_ESTAVA, vLOGIN_USUARIO, SYSDATE, vEMPRESA_ATENDENTE, vCODIGO_ATENDENTE, vNOME_ATENDENTE, vINSCRICAO_CONSELHO, vUF_INSCRICAO, vCONSELHO_REGIONAL, vCODIGO_DOENCA);
      COMMIT;

END IF;--NOVO EM 28/7/21
      ELSE
      dbms_output.put_line('10.15C-Crio periodo com sit func da Ficha E PROXIMA SITUACAO 1715-APOSENTADO TRANSFERIDO: '||vDATA_INI_GRAVAR||'-'||vDATA_FIM_GRAVAR);
      INSERT INTO  SUGESP_SIT_FUNC_PONTO_FICHAS (ID, ID_LOG_FICHA, TIPO_DML, TABELA, TEM_CARGO_EFETIVO, FAZER, CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, CODIGO_PESSOA,  DT_REG_OCORRENCIA, OCORRENCIA, DT_ULT_ALTER_USUA, LOGIN_USUARIO, LOGIN_OS, DADO_ORIGEM_TC1, DADO_DESTINO_TC1, DADO_ORIGEM_TC2, DADO_DESTINO_TC2, DADO_ORIGEM_TC3, DADO_DESTINO_TC3,
      NEW_COD_SIT_FUNCIONAL,NEW_DATA_INIC_SITUACAO, NEW_DATA_FIM_SITUACAO, LOG)
      VALUES ((SELECT MAX(ID)+1 FROM SUGESP_SIT_FUNC_PONTO_FICHAS),vID, 'I', vTABELA, vTEM_CARGO_EFETIVO, vFAZER, vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vCODIGO_PESSOA,  vDT_REG_OCORRENCIA, vOCORRENCIA, sysdate, vLOGIN_USUARIO, vLOGIN_OS, vDADO_ORIGEM_TC1, vDADO_DESTINO_TC1, vDADO_ORIGEM_TC2, vDADO_DESTINO_TC2, vDADO_ORIGEM_TC3, vDADO_DESTINO_TC3,
      SUBSTR(vDADO_DESTINO_TC1,1,4) , trunc(vDATA_INI_GRAVAR), trunc(vDATA_FIM_GRAVAR), '10.15C-Crio periodo com sit func da Ficha E PROXIMA SITUACAO 1715-APOSENTADO TRANSFERIDO');
IF vPESSOA_APOSENTADA = 'S' AND  vCODIGO_PROC_MED = '000000000000038' 
AND vTEM_SF_ESPECIFICA = 'NAO' --NOVO EM 25/7/22
THEN --ALTERADO EM 15/10/21 --NOVO EM 28/7/21
DELETE RHCGED_ALT_SIT_FUN WHERE codigo_empresa = vCODIGO_EMPRESA AND tipo_contrato = vTIPO_CONTRATO AND codigo = vCODIGO_CONTRATO AND TRUNC(data_inic_situacao) = trunc(vDATA_INI_GRAVAR) AND cod_sit_funcional = '6121';COMMIT;--NOVO EM 20/01/2020
      INSERT INTO RHCGED_ALT_SIT_FUN (ind_ef_retro_esocial, codigo_empresa, tipo_contrato, codigo, data_inic_situacao, cod_sit_funcional, data_fim_situacao, proxima_situacao, LOGIN_USUARIO, DT_ULT_ALTER_USUA, EMPRESA_ATENDENTE, CODIGO_ATENDENTE, NOME_ATENDENTE, INSCRICAO_CONSELHO, UF_CONSELHO, CONSELHO_REGIONAL, CODIGO_DOENCA )
      values ('N', vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, trunc(vDATA_INI_GRAVAR), '6121', trunc(vDATA_FIM_GRAVAR), '1715', vLOGIN_USUARIO, SYSDATE, vEMPRESA_ATENDENTE, vCODIGO_ATENDENTE, vNOME_ATENDENTE, vINSCRICAO_CONSELHO, vUF_INSCRICAO, vCONSELHO_REGIONAL, vCODIGO_DOENCA);
      COMMIT;
ELSE 
DELETE RHCGED_ALT_SIT_FUN WHERE codigo_empresa = vCODIGO_EMPRESA AND tipo_contrato = vTIPO_CONTRATO AND codigo = vCODIGO_CONTRATO AND TRUNC(data_inic_situacao) = trunc(vDATA_INI_GRAVAR) AND cod_sit_funcional = SUBSTR(vDADO_DESTINO_TC1,1,4);COMMIT;--NOVO EM 20/01/2020
      INSERT INTO RHCGED_ALT_SIT_FUN (ind_ef_retro_esocial, codigo_empresa, tipo_contrato, codigo, data_inic_situacao, cod_sit_funcional, data_fim_situacao, proxima_situacao, LOGIN_USUARIO, DT_ULT_ALTER_USUA, EMPRESA_ATENDENTE, CODIGO_ATENDENTE, NOME_ATENDENTE, INSCRICAO_CONSELHO, UF_CONSELHO, CONSELHO_REGIONAL, CODIGO_DOENCA )
      values ('N', vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, trunc(vDATA_INI_GRAVAR), 
      CASE WHEN LENGTH(vDADO_ORIGEM_TC1) = 23 THEN SUBSTR(vDADO_DESTINO_TC1,1,4) ELSE SUBSTR(vDADO_DESTINO_TC1,5,4) END --NOVO 30/5/22
      --COMENTADO 30/5/22--SUBSTR(vDADO_DESTINO_TC1,1,4)
      , trunc(vDATA_FIM_GRAVAR), '1715', vLOGIN_USUARIO, SYSDATE, vEMPRESA_ATENDENTE, vCODIGO_ATENDENTE, vNOME_ATENDENTE, vINSCRICAO_CONSELHO, vUF_INSCRICAO, vCONSELHO_REGIONAL, vCODIGO_DOENCA);
      COMMIT;

END IF;--NOVO EM 28/7/21

      END IF;--NOVO IF PARA DIFERENCIAR A 1025-AFASTAMENTO PRELIMINAR A APOSENSTADORIA CAMPO PROXIMA SITUACAO, FIXANDO NA 1715
      SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vLOGIN_USUARIO);



--NOVO EM 22/11/19
--PARA DATA FIM DO AFASTAMENTO MAIOR AO DIA DE HOJE (SYSDATE)--FUTURO e DATA FIM 'vazia' da ultima situaCAo funcional periodo
elsif C3.CONTROLE_FOLHA = 'N' and C3.E_AFASTAMENTO = 'N' and c3.suspende_remunera = 'N' and trunc(C2.DATA_dia) > trunc(sysdate)
and vDATA_INI_ESTAVA = vDATA_INI_GRAVAR --novo em 22/11/19
AND
--( --NOVO EM 18/11/19
C3.DATA_FIM IS NULL
--OR C3.DATA_FIM IS NOT NULL --NOVO EM 18/11/19
--)--NOVO EM 18/11/19
THEN

      dbms_output.put_line('1.1F-Finaliza a sit func COM O FIM DA FICHA e ALTERO A SIT FUNC com A DA FICHA: '||vDT_INI_AFAST);
      INSERT INTO  SUGESP_SIT_FUNC_PONTO_FICHAS (ID, ID_LOG_FICHA, TIPO_DML, TABELA, TEM_CARGO_EFETIVO, FAZER, CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, CODIGO_PESSOA,  DT_REG_OCORRENCIA, OCORRENCIA, DT_ULT_ALTER_USUA, LOGIN_USUARIO, LOGIN_OS, DADO_ORIGEM_TC1, DADO_DESTINO_TC1, DADO_ORIGEM_TC2, DADO_DESTINO_TC2, DADO_ORIGEM_TC3, DADO_DESTINO_TC3,
      NEW_COD_SIT_FUNCIONAL, OLD_COD_SIT_FUNCIONAL, NEW_DATA_INIC_SITUACAO, OLD_DATA_INIC_SITUACAO, NEW_DATA_FIM_SITUACAO, OLD_DATA_FIM_SITUACAO
      ,LOG)
      VALUES ((SELECT MAX(ID)+1 FROM SUGESP_SIT_FUNC_PONTO_FICHAS),vID, 'U', vTABELA, vTEM_CARGO_EFETIVO, vFAZER, vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vCODIGO_PESSOA,  vDT_REG_OCORRENCIA, vOCORRENCIA, sysdate, vLOGIN_USUARIO, vLOGIN_OS, vDADO_ORIGEM_TC1, vDADO_DESTINO_TC1, vDADO_ORIGEM_TC2, vDADO_DESTINO_TC2, vDADO_ORIGEM_TC3, vDADO_DESTINO_TC3,
      vSIT_FUNC_ESTAVA, vSIT_FUNC_ESTAVA , C3.DATA_INICIO, C3.DATA_INICIO, vDT_INI_AFAST, C3.DATA_FIM
      ,'1.1F-Finaliza a sit func COM O FIM DA FICHA e ALTERO A SIT FUNC com A DA FICHA');
IF vPESSOA_APOSENTADA = 'S' AND  vCODIGO_PROC_MED = '000000000000038' 
AND vTEM_SF_ESPECIFICA = 'NAO' --NOVO EM 25/7/22
THEN --ALTERADO EM 15/10/21 --NOVO EM 28/7/21
      UPDATE RHCGED_ALT_SIT_FUN set data_fim_situacao = trunc(vDT_FIM_AFAST), cod_sit_funcional = '6121', LOGIN_USUARIO = vLOGIN_USUARIO , DT_ULT_ALTER_USUA = SYSDATE, EMPRESA_ATENDENTE = vEMPRESA_ATENDENTE, CODIGO_ATENDENTE = vCODIGO_ATENDENTE, NOME_ATENDENTE = vNOME_ATENDENTE, INSCRICAO_CONSELHO = vINSCRICAO_CONSELHO, UF_CONSELHO = vUF_INSCRICAO, CONSELHO_REGIONAL = vCONSELHO_REGIONAL, CODIGO_DOENCA = vCODIGO_DOENCA
      where codigo_empresa = vCODIGO_EMPRESA and tipo_contrato = vTIPO_CONTRATO and codigo = vCODIGO_CONTRATO and trunc(data_inic_situacao) = trunc(vDATA_INI_ESTAVA);
      COMMIT;
ELSE 
      UPDATE RHCGED_ALT_SIT_FUN set data_fim_situacao = trunc(vDT_FIM_AFAST), cod_sit_funcional = 
      CASE WHEN LENGTH(vDADO_ORIGEM_TC1) = 23 THEN SUBSTR(vDADO_DESTINO_TC1,1,4) ELSE SUBSTR(vDADO_DESTINO_TC1,5,4) END --NOVO 30/5/22
      --COMENTADO 30/5/22--SUBSTR(vDADO_DESTINO_TC1,1,4)
      , LOGIN_USUARIO = vLOGIN_USUARIO , DT_ULT_ALTER_USUA = SYSDATE, EMPRESA_ATENDENTE = vEMPRESA_ATENDENTE, CODIGO_ATENDENTE = vCODIGO_ATENDENTE, NOME_ATENDENTE = vNOME_ATENDENTE, INSCRICAO_CONSELHO = vINSCRICAO_CONSELHO, UF_CONSELHO = vUF_INSCRICAO, CONSELHO_REGIONAL = vCONSELHO_REGIONAL, CODIGO_DOENCA = vCODIGO_DOENCA
      where codigo_empresa = vCODIGO_EMPRESA and tipo_contrato = vTIPO_CONTRATO and codigo = vCODIGO_CONTRATO and trunc(data_inic_situacao) = trunc(vDATA_INI_ESTAVA);
      COMMIT;
      --SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO,vLOGIN_USUARIO);

END IF;--NOVO EM 28/7/21

      IF SUBSTR(vDADO_DESTINO_TC1,1,4) <> '1025' THEN --NOVO IF PARA DIFERENCIAR A 1025-AFASTAMENTO PRELIMINAR A APOSENSTADORIA CAMPO PROXIMA SITUACAO, FIXANDO NA 1715
      dbms_output.put_line('10.15C-Crio periodo com sit func da Ficha E PROXIMA SITUACAO com a que estava sit func NORMAL: '||vDATA_INI_GRAVAR||'-'||vDATA_FIM_GRAVAR);
      INSERT INTO  SUGESP_SIT_FUNC_PONTO_FICHAS (ID, ID_LOG_FICHA, TIPO_DML, TABELA, TEM_CARGO_EFETIVO, FAZER, CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, CODIGO_PESSOA,  DT_REG_OCORRENCIA, OCORRENCIA, DT_ULT_ALTER_USUA, LOGIN_USUARIO, LOGIN_OS, DADO_ORIGEM_TC1, DADO_DESTINO_TC1, DADO_ORIGEM_TC2, DADO_DESTINO_TC2, DADO_ORIGEM_TC3, DADO_DESTINO_TC3,
      NEW_COD_SIT_FUNCIONAL,NEW_DATA_INIC_SITUACAO, NEW_DATA_FIM_SITUACAO, LOG)
      VALUES ((SELECT MAX(ID)+1 FROM SUGESP_SIT_FUNC_PONTO_FICHAS),vID, 'I', vTABELA, vTEM_CARGO_EFETIVO, vFAZER, vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vCODIGO_PESSOA,  vDT_REG_OCORRENCIA, vOCORRENCIA, sysdate, vLOGIN_USUARIO, vLOGIN_OS, vDADO_ORIGEM_TC1, vDADO_DESTINO_TC1, vDADO_ORIGEM_TC2, vDADO_DESTINO_TC2, vDADO_ORIGEM_TC3, vDADO_DESTINO_TC3,
      SUBSTR(vDADO_DESTINO_TC1,1,4) , trunc(vDATA_INI_GRAVAR), trunc(vDATA_FIM_GRAVAR), '10.15C-Crio periodo com sit func da Ficha E PROXIMA SITUACAO com a que estava sit func NORMAL');
IF vPESSOA_APOSENTADA = 'S' AND  vCODIGO_PROC_MED = '000000000000038' 
AND vTEM_SF_ESPECIFICA = 'NAO' --NOVO EM 25/7/22
THEN --ALTERADO EM 15/10/21--NOVO EM 28/7/21
DELETE RHCGED_ALT_SIT_FUN WHERE codigo_empresa = vCODIGO_EMPRESA AND tipo_contrato = vTIPO_CONTRATO AND codigo = vCODIGO_CONTRATO AND TRUNC(data_inic_situacao) = trunc(vDATA_INI_GRAVAR) AND cod_sit_funcional = '6121';COMMIT;--NOVO EM 20/01/2020
      INSERT INTO RHCGED_ALT_SIT_FUN (ind_ef_retro_esocial, codigo_empresa, tipo_contrato, codigo, data_inic_situacao, cod_sit_funcional, data_fim_situacao, proxima_situacao, LOGIN_USUARIO, DT_ULT_ALTER_USUA, EMPRESA_ATENDENTE, CODIGO_ATENDENTE, NOME_ATENDENTE, INSCRICAO_CONSELHO, UF_CONSELHO, CONSELHO_REGIONAL, CODIGO_DOENCA )
      values ('N', vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, trunc(vDATA_INI_GRAVAR), '6121', trunc(vDATA_FIM_GRAVAR), vSIT_FUNC_ESTAVA, vLOGIN_USUARIO, SYSDATE, vEMPRESA_ATENDENTE, vCODIGO_ATENDENTE, vNOME_ATENDENTE, vINSCRICAO_CONSELHO, vUF_INSCRICAO, vCONSELHO_REGIONAL, vCODIGO_DOENCA);
      COMMIT;
ELSE 
DELETE RHCGED_ALT_SIT_FUN WHERE codigo_empresa = vCODIGO_EMPRESA AND tipo_contrato = vTIPO_CONTRATO AND codigo = vCODIGO_CONTRATO AND TRUNC(data_inic_situacao) = trunc(vDATA_INI_GRAVAR) AND cod_sit_funcional = SUBSTR(vDADO_DESTINO_TC1,1,4);COMMIT;--NOVO EM 20/01/2020
      INSERT INTO RHCGED_ALT_SIT_FUN (ind_ef_retro_esocial, codigo_empresa, tipo_contrato, codigo, data_inic_situacao, cod_sit_funcional, data_fim_situacao, proxima_situacao, LOGIN_USUARIO, DT_ULT_ALTER_USUA, EMPRESA_ATENDENTE, CODIGO_ATENDENTE, NOME_ATENDENTE, INSCRICAO_CONSELHO, UF_CONSELHO, CONSELHO_REGIONAL, CODIGO_DOENCA )
      values ('N', vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, trunc(vDATA_INI_GRAVAR), 
      CASE WHEN LENGTH(vDADO_ORIGEM_TC1) = 23 THEN SUBSTR(vDADO_DESTINO_TC1,1,4) ELSE SUBSTR(vDADO_DESTINO_TC1,5,4) END --NOVO 30/5/22
      --COMENTADO 30/5/22--SUBSTR(vDADO_DESTINO_TC1,1,4)
      , trunc(vDATA_FIM_GRAVAR), vSIT_FUNC_ESTAVA, vLOGIN_USUARIO, SYSDATE, vEMPRESA_ATENDENTE, vCODIGO_ATENDENTE, vNOME_ATENDENTE, vINSCRICAO_CONSELHO, vUF_INSCRICAO, vCONSELHO_REGIONAL, vCODIGO_DOENCA);
      COMMIT;

END IF;--NOVO EM 28/7/21
      ELSE
      dbms_output.put_line('10.15C-Crio periodo com sit func da Ficha E PROXIMA SITUACAO 1715-APOSENTADO TRANSFERIDO: '||vDATA_INI_GRAVAR||'-'||vDATA_FIM_GRAVAR);
      INSERT INTO  SUGESP_SIT_FUNC_PONTO_FICHAS (ID, ID_LOG_FICHA, TIPO_DML, TABELA, TEM_CARGO_EFETIVO, FAZER, CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, CODIGO_PESSOA,  DT_REG_OCORRENCIA, OCORRENCIA, DT_ULT_ALTER_USUA, LOGIN_USUARIO, LOGIN_OS, DADO_ORIGEM_TC1, DADO_DESTINO_TC1, DADO_ORIGEM_TC2, DADO_DESTINO_TC2, DADO_ORIGEM_TC3, DADO_DESTINO_TC3,
      NEW_COD_SIT_FUNCIONAL,NEW_DATA_INIC_SITUACAO, NEW_DATA_FIM_SITUACAO, LOG)
      VALUES ((SELECT MAX(ID)+1 FROM SUGESP_SIT_FUNC_PONTO_FICHAS),vID, 'I', vTABELA, vTEM_CARGO_EFETIVO, vFAZER, vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vCODIGO_PESSOA,  vDT_REG_OCORRENCIA, vOCORRENCIA, sysdate, vLOGIN_USUARIO, vLOGIN_OS, vDADO_ORIGEM_TC1, vDADO_DESTINO_TC1, vDADO_ORIGEM_TC2, vDADO_DESTINO_TC2, vDADO_ORIGEM_TC3, vDADO_DESTINO_TC3,
      SUBSTR(vDADO_DESTINO_TC1,1,4) , trunc(vDATA_INI_GRAVAR), trunc(vDATA_FIM_GRAVAR), '10.15C-Crio periodo com sit func da Ficha E PROXIMA SITUACAO 1715-APOSENTADO TRANSFERIDO');
IF vPESSOA_APOSENTADA = 'S' AND  vCODIGO_PROC_MED = '000000000000038' 
AND vTEM_SF_ESPECIFICA = 'NAO' --NOVO EM 25/7/22
THEN --ALTERADO EM 15/10/21 --NOVO EM 28/7/21
DELETE RHCGED_ALT_SIT_FUN WHERE codigo_empresa = vCODIGO_EMPRESA AND tipo_contrato = vTIPO_CONTRATO AND codigo = vCODIGO_CONTRATO AND TRUNC(data_inic_situacao) = trunc(vDATA_INI_GRAVAR) AND cod_sit_funcional = '6121';COMMIT;--NOVO EM 20/01/2020
      INSERT INTO RHCGED_ALT_SIT_FUN (ind_ef_retro_esocial, codigo_empresa, tipo_contrato, codigo, data_inic_situacao, cod_sit_funcional, data_fim_situacao, proxima_situacao, LOGIN_USUARIO, DT_ULT_ALTER_USUA, EMPRESA_ATENDENTE, CODIGO_ATENDENTE, NOME_ATENDENTE, INSCRICAO_CONSELHO, UF_CONSELHO, CONSELHO_REGIONAL, CODIGO_DOENCA )
      values ('N', vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, trunc(vDATA_INI_GRAVAR), '6121', trunc(vDATA_FIM_GRAVAR), '1715', vLOGIN_USUARIO, SYSDATE, vEMPRESA_ATENDENTE, vCODIGO_ATENDENTE, vNOME_ATENDENTE, vINSCRICAO_CONSELHO, vUF_INSCRICAO, vCONSELHO_REGIONAL, vCODIGO_DOENCA);
      COMMIT;
ELSE 
DELETE RHCGED_ALT_SIT_FUN WHERE codigo_empresa = vCODIGO_EMPRESA AND tipo_contrato = vTIPO_CONTRATO AND codigo = vCODIGO_CONTRATO AND TRUNC(data_inic_situacao) = trunc(vDATA_INI_GRAVAR) AND cod_sit_funcional = SUBSTR(vDADO_DESTINO_TC1,1,4);COMMIT;--NOVO EM 20/01/2020
      INSERT INTO RHCGED_ALT_SIT_FUN (ind_ef_retro_esocial, codigo_empresa, tipo_contrato, codigo, data_inic_situacao, cod_sit_funcional, data_fim_situacao, proxima_situacao, LOGIN_USUARIO, DT_ULT_ALTER_USUA, EMPRESA_ATENDENTE, CODIGO_ATENDENTE, NOME_ATENDENTE, INSCRICAO_CONSELHO, UF_CONSELHO, CONSELHO_REGIONAL, CODIGO_DOENCA )
      values ('N', vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, trunc(vDATA_INI_GRAVAR), 
      CASE WHEN LENGTH(vDADO_ORIGEM_TC1) = 23 THEN SUBSTR(vDADO_DESTINO_TC1,1,4) ELSE SUBSTR(vDADO_DESTINO_TC1,5,4) END --NOVO 30/5/22
      --COMENTADO 30/5/22--SUBSTR(vDADO_DESTINO_TC1,1,4)
      , trunc(vDATA_FIM_GRAVAR), '1715', vLOGIN_USUARIO, SYSDATE, vEMPRESA_ATENDENTE, vCODIGO_ATENDENTE, vNOME_ATENDENTE, vINSCRICAO_CONSELHO, vUF_INSCRICAO, vCONSELHO_REGIONAL, vCODIGO_DOENCA);
      COMMIT;

END IF;--NOVO EM 28/7/21
      END IF;
      SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vLOGIN_USUARIO);
/*
--nAo deve ter este cenarios apos 1/10/19 nAo desenvolver por este motivo
--PARA DATA FIM DO AFASTAMENTO MENOR OU IGUAL AO DIA DE HOJE (SYSDATE)--PASSADO E PRESENTE e DATA FIM preenchid da ultima situaCAo funcional periodo
elsif C3.CONTROLE_FOLHA = 'N' and C3.E_AFASTAMENTO = 'N' and c3.suspende_remunera = 'N' and trunc(C2.DATA_dia) <= trunc(sysdate) AND C3.DATA_FIM IS not NULL THEN
      dbms_output.put_line('2.7-Altera CODIGO Da sit func: '||C2.DATA_DIA);
      dbms_output.put_line('1.2-Finaliza a sit func (fim): '||C2.DATA_DIA);
      INSERT INTO  SUGESP_SIT_FUNC_PONTO_FICHAS (ID, ID_LOG_FICHA, TIPO_DML, TABELA, TEM_CARGO_EFETIVO, FAZER, CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, CODIGO_PESSOA,  DT_REG_OCORRENCIA, OCORRENCIA, DT_ULT_ALTER_USUA, LOGIN_USUARIO, LOGIN_OS, DADO_ORIGEM_TC1, DADO_DESTINO_TC1, DADO_ORIGEM_TC2, DADO_DESTINO_TC2, DADO_ORIGEM_TC3, DADO_DESTINO_TC3,
      NEW_COD_SIT_FUNCIONAL, OLD_COD_SIT_FUNCIONAL, NEW_DATA_INIC_SITUACAO, OLD_DATA_INIC_SITUACAO, NEW_DATA_FIM_SITUACAO, OLD_DATA_FIM_SITUACAO
      ,LOG)
      VALUES ((SELECT MAX(ID)+1 FROM SUGESP_SIT_FUNC_PONTO_FICHAS),vID, 'U', vTABELA, vTEM_CARGO_EFETIVO, vFAZER, vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vCODIGO_PESSOA,  vDT_REG_OCORRENCIA, vOCORRENCIA, sysdate, vLOGIN_USUARIO, vLOGIN_OS, vDADO_ORIGEM_TC1, vDADO_DESTINO_TC1, vDADO_ORIGEM_TC2, vDADO_DESTINO_TC2, vDADO_ORIGEM_TC3, vDADO_DESTINO_TC3,
      SUBSTR(vDADO_DESTINO_TC1,1,4), vSIT_FUNC_ESTAVA , vDATA_INI_GRAVAR, C3.DATA_INICIO, vDATA_FIM_GRAVAR, C3.DATA_FIM
      ,'2.7+1.2-Altera CODIGO Da sit func com sit func da Ficha NO PERIODO:');
      UPDATE RHCGED_ALT_SIT_FUN set cod_sit_funcional = SUBSTR(vDADO_DESTINO_TC1,1,4), data_fim_situacao = trunc(vDATA_FIM_GRAVAR) , LOGIN_USUARIO = vLOGIN_USUARIO , DT_ULT_ALTER_USUA = SYSDATE where codigo_empresa = vCODIGO_EMPRESA and tipo_contrato = vTIPO_CONTRATO and codigo = vCODIGO_CONTRATO and trunc(data_inic_situacao) = trunc(vDATA_INI_ESTAVA);
      COMMIT;
      SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vLOGIN_USUARIO);

      dbms_output.put_line('10.4-Crio sit func NORMAL com a que estava INICIO = (dataINI + 1) e FIM = vDATA_FIM_ESTAVA : '||vSIT_FUNC_ESTAVA ||'-'||vDATA_FIM_GRAVAR ||'-'||vDATA_FIM_ESTAVA );
      INSERT INTO  SUGESP_SIT_FUNC_PONTO_FICHAS (ID, ID_LOG_FICHA, TIPO_DML, TABELA, TEM_CARGO_EFETIVO, FAZER, CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, CODIGO_PESSOA,  DT_REG_OCORRENCIA, OCORRENCIA, DT_ULT_ALTER_USUA, LOGIN_USUARIO, LOGIN_OS, DADO_ORIGEM_TC1, DADO_DESTINO_TC1, DADO_ORIGEM_TC2, DADO_DESTINO_TC2, DADO_ORIGEM_TC3, DADO_DESTINO_TC3,
      NEW_COD_SIT_FUNCIONAL,NEW_DATA_INIC_SITUACAO, NEW_DATA_FIM_SITUACAO, LOG)
      VALUES ((SELECT MAX(ID)+1 FROM SUGESP_SIT_FUNC_PONTO_FICHAS),vID, 'I', vTABELA, vTEM_CARGO_EFETIVO, vFAZER, vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vCODIGO_PESSOA,  vDT_REG_OCORRENCIA, vOCORRENCIA, sysdate, vLOGIN_USUARIO, vLOGIN_OS, vDADO_ORIGEM_TC1, vDADO_DESTINO_TC1, vDADO_ORIGEM_TC2, vDADO_DESTINO_TC2, vDADO_ORIGEM_TC3, vDADO_DESTINO_TC3,
      vSIT_FUNC_ESTAVA , trunc(C2.DATA_DIA)+1, vDATA_FIM_ESTAVA, '10.4-Crio sit func NORMAL com a que estava INICIO = (dataINI + 1) e FIM = vDATA_FIM_ESTAVA');
      INSERT INTO RHCGED_ALT_SIT_FUN (codigo_empresa, tipo_contrato, codigo, data_inic_situacao, cod_sit_funcional, LOGIN_USUARIO, DT_ULT_ALTER_USUA )values (vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, trunc(C2.DATA_DIA)+1, vSIT_FUNC_ESTAVA, vLOGIN_USUARIO, SYSDATE);
      COMMIT;
      SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vLOGIN_USUARIO);
*/
/*
--nAo deve ter este cenarios apos 1/10/19 nAo desenvolver por este motivo
--PARA DATA FIM DO AFASTAMENTO MAIOR AO DIA DE HOJE (SYSDATE)--FUTURO e DATA FIM 'preenchida' da ultima situaCAo funcional periodo
elsif C3.CONTROLE_FOLHA = 'N' and C3.E_AFASTAMENTO = 'N' and c3.suspende_remunera = 'N' and trunc(C2.DATA_dia) > trunc(sysdate) AND C3.DATA_FIM IS NOT NULL THEN
      dbms_output.put_line('2.9-Altera CODIGO Da sit func: '||C2.DATA_DIA);
      dbms_output.put_line('10.7-Crio periodo com sit func da Ficha: '||vDATA_INI_GRAVAR||'-'||vDATA_FIM_GRAVAR);
      INSERT INTO  SUGESP_SIT_FUNC_PONTO_FICHAS (ID, ID_LOG_FICHA, TIPO_DML, TABELA, TEM_CARGO_EFETIVO, FAZER, CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, CODIGO_PESSOA,  DT_REG_OCORRENCIA, OCORRENCIA, DT_ULT_ALTER_USUA, LOGIN_USUARIO, LOGIN_OS, DADO_ORIGEM_TC1, DADO_DESTINO_TC1, DADO_ORIGEM_TC2, DADO_DESTINO_TC2, DADO_ORIGEM_TC3, DADO_DESTINO_TC3,
      NEW_COD_SIT_FUNCIONAL, OLD_COD_SIT_FUNCIONAL, NEW_DATA_INIC_SITUACAO, OLD_DATA_INIC_SITUACAO, NEW_DATA_FIM_SITUACAO, OLD_DATA_FIM_SITUACAO
      ,LOG)
      VALUES ((SELECT MAX(ID)+1 FROM SUGESP_SIT_FUNC_PONTO_FICHAS),vID, 'U', vTABELA, vTEM_CARGO_EFETIVO, vFAZER, vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vCODIGO_PESSOA,  vDT_REG_OCORRENCIA, vOCORRENCIA, sysdate, vLOGIN_USUARIO, vLOGIN_OS, vDADO_ORIGEM_TC1, vDADO_DESTINO_TC1, vDADO_ORIGEM_TC2, vDADO_DESTINO_TC2, vDADO_ORIGEM_TC3, vDADO_DESTINO_TC3,
      SUBSTR(vDADO_DESTINO_TC1,1,4), vSIT_FUNC_ESTAVA , vDATA_INI_GRAVAR, C3.DATA_INICIO, vDATA_FIM_GRAVAR, C3.DATA_FIM
      ,'2.9-Altera CODIGO Da sit func +10.7-Crio periodo com sit func da Ficha');
      UPDATE RHCGED_ALT_SIT_FUN set cod_sit_funcional = SUBSTR(vDADO_DESTINO_TC1,1,4), data_fim_situacao = trunc(vDATA_FIM_GRAVAR), proxima_situacao = vPROXIMA_SIT_ESTAVA, LOGIN_USUARIO = vLOGIN_USUARIO , DT_ULT_ALTER_USUA = SYSDATE where codigo_empresa = vCODIGO_EMPRESA and tipo_contrato = vTIPO_CONTRATO and codigo = vCODIGO_CONTRATO and trunc(data_inic_situacao) = trunc(vDATA_INI_ESTAVA);
      COMMIT;
      SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vLOGIN_USUARIO);

      -- dbms_output.put_line('10.8-Crio alt sit func. codigo = com a que estava sit func NORMAL com a data fim que estava : '||vSIT_FUNC_ESTAVA||'-'||vDATA_FIM_ESTAVA ||'-'||vPROXIMA_SIT_ESTAVA);
      dbms_output.put_line('10.8-Crio sit func NORMAL com a que estava INICIO = (dataINI + 1) e FIM = vDATA_FIM_ESTAVA : '||vSIT_FUNC_ESTAVA ||'-'||vDATA_FIM_GRAVAR ||'-'||vDATA_FIM_ESTAVA );
      INSERT INTO  SUGESP_SIT_FUNC_PONTO_FICHAS (ID, ID_LOG_FICHA, TIPO_DML, TABELA, TEM_CARGO_EFETIVO, FAZER, CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, CODIGO_PESSOA,  DT_REG_OCORRENCIA, OCORRENCIA, DT_ULT_ALTER_USUA, LOGIN_USUARIO, LOGIN_OS, DADO_ORIGEM_TC1, DADO_DESTINO_TC1, DADO_ORIGEM_TC2, DADO_DESTINO_TC2, DADO_ORIGEM_TC3, DADO_DESTINO_TC3,
      NEW_COD_SIT_FUNCIONAL,NEW_DATA_INIC_SITUACAO, NEW_DATA_FIM_SITUACAO, LOG)
      VALUES ((SELECT MAX(ID)+1 FROM SUGESP_SIT_FUNC_PONTO_FICHAS),vID, 'I', vTABELA, vTEM_CARGO_EFETIVO, vFAZER, vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vCODIGO_PESSOA,  vDT_REG_OCORRENCIA, vOCORRENCIA, sysdate, vLOGIN_USUARIO, vLOGIN_OS, vDADO_ORIGEM_TC1, vDADO_DESTINO_TC1, vDADO_ORIGEM_TC2, vDADO_DESTINO_TC2, vDADO_ORIGEM_TC3, vDADO_DESTINO_TC3,
      vSIT_FUNC_ESTAVA , trunc(C2.DATA_DIA)+1, vDATA_FIM_ESTAVA, '10.8-Crio sit func NORMAL com a que estava INICIO = (dataINI + 1) e FIM = vDATA_FIM_ESTAVA');
      INSERT INTO RHCGED_ALT_SIT_FUN (codigo_empresa, tipo_contrato, codigo, data_inic_situacao, cod_sit_funcional, LOGIN_USUARIO, DT_ULT_ALTER_USUA )values (vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, trunc(C2.DATA_DIA)+1, vSIT_FUNC_ESTAVA, vLOGIN_USUARIO, SYSDATE);
      COMMIT;
      SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vLOGIN_USUARIO);
*/
/*
--nAo deve ter este cenario em 1/10/19,  DESENVOLVER DURANTE OUT/19, nAo desenvolver por este motivo
--PARA LICENCA MEDICA PENDENTE e DATA FIM 'preenchida' da ultima situaCAo funcional periodo
elsif C3.CONTROLE_FOLHA = 'N' and C3.E_AFASTAMENTO = 'S' and c3.suspende_remunera = 'N' and trunc(C2.DATA_dia) <= trunc(sysdate) AND C3.DATA_FIM IS not NULL THEN
and trunc(C2.DATA_dia) <= trunc(sysdate)
THEN
      dbms_output.put_line('2.10-Altera CODIGO Da sit func: '||C2.DATA_DIA);
      dbms_output.put_line('10.9-Crio periodo com sit func da Ficha: '||vDATA_INI_GRAVAR||'-'||vDATA_FIM_GRAVAR);
      INSERT INTO  SUGESP_SIT_FUNC_PONTO_FICHAS (ID, ID_LOG_FICHA, TIPO_DML, TABELA, TEM_CARGO_EFETIVO, FAZER, CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, CODIGO_PESSOA,  DT_REG_OCORRENCIA, OCORRENCIA, DT_ULT_ALTER_USUA, LOGIN_USUARIO, LOGIN_OS, DADO_ORIGEM_TC1, DADO_DESTINO_TC1, DADO_ORIGEM_TC2, DADO_DESTINO_TC2, DADO_ORIGEM_TC3, DADO_DESTINO_TC3,
      NEW_COD_SIT_FUNCIONAL, OLD_COD_SIT_FUNCIONAL, NEW_DATA_INIC_SITUACAO, OLD_DATA_INIC_SITUACAO, NEW_DATA_FIM_SITUACAO, OLD_DATA_FIM_SITUACAO
      ,LOG)
      VALUES ((SELECT MAX(ID)+1 FROM SUGESP_SIT_FUNC_PONTO_FICHAS),vID, 'U', vTABELA, vTEM_CARGO_EFETIVO, vFAZER, vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vCODIGO_PESSOA,  vDT_REG_OCORRENCIA, vOCORRENCIA, sysdate, vLOGIN_USUARIO, vLOGIN_OS, vDADO_ORIGEM_TC1, vDADO_DESTINO_TC1, vDADO_ORIGEM_TC2, vDADO_DESTINO_TC2, vDADO_ORIGEM_TC3, vDADO_DESTINO_TC3,
      SUBSTR(vDADO_DESTINO_TC1,1,4), vSIT_FUNC_ESTAVA , vDATA_INI_GRAVAR, C3.DATA_INICIO, vDATA_FIM_GRAVAR, C3.DATA_FIM
      ,'2.10-Altera CODIGO Da sit func +10.9-Crio periodo com sit func da Ficha');
      UPDATE RHCGED_ALT_SIT_FUN set cod_sit_funcional = SUBSTR(vDADO_DESTINO_TC1,1,4), data_fim_situacao = trunc(vDATA_FIM_GRAVAR), proxima_situacao = vPROXIMA_SIT_ESTAVA, LOGIN_USUARIO = vLOGIN_USUARIO , DT_ULT_ALTER_USUA = SYSDATE where codigo_empresa = vCODIGO_EMPRESA and tipo_contrato = vTIPO_CONTRATO and codigo = vCODIGO_CONTRATO and trunc(data_inic_situacao) = trunc(vDATA_INI_ESTAVA);
      COMMIT;
      SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vLOGIN_USUARIO);

      dbms_output.put_line('10.10-Crio sit func NORMAL (dataini + 1)com a o codigo da PROXIMA SITUACAO que estava: '||vPROXIMA_SIT_ESTAVA ||'-'||vDATA_FIM_GRAVAR);
      INSERT INTO  SUGESP_SIT_FUNC_PONTO_FICHAS (ID, ID_LOG_FICHA, TIPO_DML, TABELA, TEM_CARGO_EFETIVO, FAZER, CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, CODIGO_PESSOA,  DT_REG_OCORRENCIA, OCORRENCIA, DT_ULT_ALTER_USUA, LOGIN_USUARIO, LOGIN_OS, DADO_ORIGEM_TC1, DADO_DESTINO_TC1, DADO_ORIGEM_TC2, DADO_DESTINO_TC2, DADO_ORIGEM_TC3, DADO_DESTINO_TC3,
      NEW_COD_SIT_FUNCIONAL,NEW_DATA_INIC_SITUACAO, NEW_DATA_FIM_SITUACAO, LOG)
      VALUES ((SELECT MAX(ID)+1 FROM SUGESP_SIT_FUNC_PONTO_FICHAS),vID, 'I', vTABELA, vTEM_CARGO_EFETIVO, vFAZER, vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vCODIGO_PESSOA,  vDT_REG_OCORRENCIA, vOCORRENCIA, sysdate, vLOGIN_USUARIO, vLOGIN_OS, vDADO_ORIGEM_TC1, vDADO_DESTINO_TC1, vDADO_ORIGEM_TC2, vDADO_DESTINO_TC2, vDADO_ORIGEM_TC3, vDADO_DESTINO_TC3,
      vSIT_FUNC_ESTAVA , trunc(C2.DATA_DIA)+1, vDATA_FIM_ESTAVA, '10.10-Crio sit func NORMAL (dataini + 1)com a o codigo da PROXIMA SITUACAO que estava');
      INSERT INTO RHCGED_ALT_SIT_FUN (codigo_empresa, tipo_contrato, codigo, data_inic_situacao, cod_sit_funcional, LOGIN_USUARIO, DT_ULT_ALTER_USUA )values (vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, trunc(C2.DATA_DIA)+1, vPROXIMA_SIT_ESTAVA, vLOGIN_USUARIO, SYSDATE);
      COMMIT;
      SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vLOGIN_USUARIO);
*/

/*
--nAO deve ter este cenario em 1/10/19,  DESENVOLVER DURANTE OUT/19, nAo desenvolver por este motivo
--PARA INFREQUENCIA MENOR OU MAIOR QUE 30 DIAS
elsif C3.CONTROLE_FOLHA = 'N' and C3.E_AFASTAMENTO = 'N' and c3.suspende_remunera = 'S' THEN
      dbms_output.put_line('2.11-Altera CODIGO Da sit func: '||C2.DATA_DIA);
      dbms_output.put_line('10.11-Crio periodo com sit func da Ficha: '||vDATA_INI_GRAVAR||'-'||vDATA_FIM_GRAVAR);
      INSERT INTO  SUGESP_SIT_FUNC_PONTO_FICHAS (ID, ID_LOG_FICHA, TIPO_DML, TABELA, TEM_CARGO_EFETIVO, FAZER, CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, CODIGO_PESSOA,  DT_REG_OCORRENCIA, OCORRENCIA, DT_ULT_ALTER_USUA, LOGIN_USUARIO, LOGIN_OS, DADO_ORIGEM_TC1, DADO_DESTINO_TC1, DADO_ORIGEM_TC2, DADO_DESTINO_TC2, DADO_ORIGEM_TC3, DADO_DESTINO_TC3,
      NEW_COD_SIT_FUNCIONAL, OLD_COD_SIT_FUNCIONAL, NEW_DATA_INIC_SITUACAO, OLD_DATA_INIC_SITUACAO, NEW_DATA_FIM_SITUACAO, OLD_DATA_FIM_SITUACAO
      ,LOG)
      VALUES ((SELECT MAX(ID)+1 FROM SUGESP_SIT_FUNC_PONTO_FICHAS),vID, 'U', vTABELA, vTEM_CARGO_EFETIVO, vFAZER, vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vCODIGO_PESSOA,  vDT_REG_OCORRENCIA, vOCORRENCIA, sysdate, vLOGIN_USUARIO, vLOGIN_OS, vDADO_ORIGEM_TC1, vDADO_DESTINO_TC1, vDADO_ORIGEM_TC2, vDADO_DESTINO_TC2, vDADO_ORIGEM_TC3, vDADO_DESTINO_TC3,
      SUBSTR(vDADO_DESTINO_TC1,1,4), vSIT_FUNC_ESTAVA , vDATA_INI_GRAVAR, C3.DATA_INICIO, vDATA_FIM_GRAVAR, C3.DATA_FIM
      ,'2.11-Altera CODIGO Da sit func +10.11-Crio periodo com sit func da Ficha');
      UPDATE RHCGED_ALT_SIT_FUN set cod_sit_funcional = SUBSTR(vDADO_DESTINO_TC1,1,4), data_fim_situacao = trunc(vDATA_FIM_GRAVAR), proxima_situacao = vPROXIMA_SIT_ESTAVA, LOGIN_USUARIO = vLOGIN_USUARIO , DT_ULT_ALTER_USUA = SYSDATE where codigo_empresa = vCODIGO_EMPRESA and tipo_contrato = vTIPO_CONTRATO and codigo = vCODIGO_CONTRATO and trunc(data_inic_situacao) = trunc(vDATA_INI_ESTAVA);
      COMMIT;
      SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vLOGIN_USUARIO);

     --PARA ver qual estava por ultima do DE/PARA PROXIMA SITUACAO
          SELECT CODIGO, proxima_sit_func INTO vDE_PROXIMA_SITUACAO , vPARA_PROXIMA_SITUACAO FROM RHPARM_SIT_FUNC WHERE CODIGO = vSIT_FUNC_ESTAVA;
          if vPARA_PROXIMA_SITUACAO IS NULL THEN
              SELECT CODIGO, proxima_sit_func INTO vDE_PROXIMA_SITUACAO , vPARA_PROXIMA_SITUACAO FROM RHPARM_SIT_FUNC WHERE proxima_sit_func = vSIT_FUNC_ESTAVA;
          end if;
     --PARA ver se o fim do afastamento com a data do dia do processamento jÃƒÆ’Ã†â€™Ãƒâ€šÃ‚Â¡ passou 30 dias ou nÃƒÆ’Ã†â€™Ãƒâ€šÃ‚Â£o
    if trunc(C2.DATA_dia) <= trunc(sysdate) AND trunc(sysdate)- trunc(C2.DATA_dia) <= 30 then
          dbms_output.put_line('10.12- Crio sit func NORMAL CODIGO:' ||vDE_PROXIMA_SITUACAO || 'com data inicio(datafim + 1) e data fim (inicio+1 + campo s.qtde_dias_proximo)com a campo PROXIMA SITUACAO preenchido com vPARA_PROXIMA_SITUACAO');
        INSERT INTO  SUGESP_SIT_FUNC_PONTO_FICHAS (ID, ID_LOG_FICHA, TIPO_DML, TABELA, TEM_CARGO_EFETIVO, FAZER, CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, CODIGO_PESSOA,  DT_REG_OCORRENCIA, OCORRENCIA, DT_ULT_ALTER_USUA, LOGIN_USUARIO, LOGIN_OS, DADO_ORIGEM_TC1, DADO_DESTINO_TC1, DADO_ORIGEM_TC2, DADO_DESTINO_TC2, DADO_ORIGEM_TC3, DADO_DESTINO_TC3,
        NEW_COD_SIT_FUNCIONAL, NEW_DATA_INIC_SITUACAO, NEW_DATA_FIM_SITUACAO, LOG)
        VALUES ((SELECT MAX(ID)+1 FROM SUGESP_SIT_FUNC_PONTO_FICHAS),vID, 'I', vTABELA, vTEM_CARGO_EFETIVO, vFAZER, vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vCODIGO_PESSOA,  vDT_REG_OCORRENCIA, vOCORRENCIA, sysdate, vLOGIN_USUARIO, vLOGIN_OS, vDADO_ORIGEM_TC1, vDADO_DESTINO_TC1, vDADO_ORIGEM_TC2, vDADO_DESTINO_TC2, vDADO_ORIGEM_TC3, vDADO_DESTINO_TC3,
        vDE_PROXIMA_SITUACAO, trunc(C2.DATA_DIA)+1, trunc(C2.DATA_DIA)+1+c3.qtde_dias_proximo, '10.12- Crio sit func NORMAL:' ||vDE_PROXIMA_SITUACAO || 'com data inicio(datafim + 1) e data fim (inicio+1 + campo s.qtde_dias_proximo)com a campo PROXIMA SITUACAO preenchido com vPARA_PROXIMA_SITUACAO');
          INSERT INTO RHCGED_ALT_SIT_FUN (codigo_empresa, tipo_contrato, codigo, data_inic_situacao, cod_sit_funcional, data_fim_situacao, proxima_situacao, LOGIN_USUARIO, DT_ULT_ALTER_USUA )
          values (vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, trunc(C2.DATA_DIA)+1, vDE_PROXIMA_SITUACAO, trunc(C2.DATA_DIA)+1+c3.qtde_dias_proximo, vPARA_PROXIMA_SITUACAO, vLOGIN_USUARIO, SYSDATE);
          COMMIT;
          SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vLOGIN_USUARIO);
    else
          dbms_output.put_line('10.13- Crio sit func NORMAL CODIGO:' ||vDE_PROXIMA_SITUACAO || 'com data inicio(datafim + 1) e data fim (inicio+1 + campo s.qtde_dias_proximo)com a campo PROXIMA SITUACAO preenchido com vPARA_PROXIMA_SITUACAO');
        INSERT INTO  SUGESP_SIT_FUNC_PONTO_FICHAS (ID, ID_LOG_FICHA, TIPO_DML, TABELA, TEM_CARGO_EFETIVO, FAZER, CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, CODIGO_PESSOA,  DT_REG_OCORRENCIA, OCORRENCIA, DT_ULT_ALTER_USUA, LOGIN_USUARIO, LOGIN_OS, DADO_ORIGEM_TC1, DADO_DESTINO_TC1, DADO_ORIGEM_TC2, DADO_DESTINO_TC2, DADO_ORIGEM_TC3, DADO_DESTINO_TC3,
        NEW_COD_SIT_FUNCIONAL, NEW_DATA_INIC_SITUACAO, NEW_DATA_FIM_SITUACAO, LOG)
        VALUES ((SELECT MAX(ID)+1 FROM SUGESP_SIT_FUNC_PONTO_FICHAS),vID, 'I', vTABELA, vTEM_CARGO_EFETIVO, vFAZER, vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vCODIGO_PESSOA,  vDT_REG_OCORRENCIA, vOCORRENCIA, sysdate, vLOGIN_USUARIO, vLOGIN_OS, vDADO_ORIGEM_TC1, vDADO_DESTINO_TC1, vDADO_ORIGEM_TC2, vDADO_DESTINO_TC2, vDADO_ORIGEM_TC3, vDADO_DESTINO_TC3,
        vDE_PROXIMA_SITUACAO, trunc(C2.DATA_DIA)+1, trunc(C2.DATA_DIA)+1+c3.qtde_dias_proximo, '10.13- Crio sit func NORMAL:' ||vDE_PROXIMA_SITUACAO || 'com data inicio(datafim + 1) e data fim (inicio+1 + campo s.qtde_dias_proximo)com a campo PROXIMA SITUACAO preenchido com vPARA_PROXIMA_SITUACAO');
          INSERT INTO RHCGED_ALT_SIT_FUN (codigo_empresa, tipo_contrato, codigo, data_inic_situacao, cod_sit_funcional, data_fim_situacao, proxima_situacao, LOGIN_USUARIO, DT_ULT_ALTER_USUA )
          values (vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, trunc(C2.DATA_DIA)+1, vDE_PROXIMA_SITUACAO, trunc(C2.DATA_DIA)+1+c3.qtde_dias_proximo, vPARA_PROXIMA_SITUACAO, vLOGIN_USUARIO, SYSDATE);
          COMMIT;
          SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vLOGIN_USUARIO);
          dbms_output.put_line('10.14- Crio sit func NORMAL CODIGO:' ||vPARA_PROXIMA_SITUACAO || 'com data inicio(c2.data_dia+1+31) sem data fim  e sem PREENCHER campo PROXIMA SITUACAO');
        INSERT INTO  SUGESP_SIT_FUNC_PONTO_FICHAS (ID, ID_LOG_FICHA, TIPO_DML, TABELA, TEM_CARGO_EFETIVO, FAZER, CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, CODIGO_PESSOA,  DT_REG_OCORRENCIA, OCORRENCIA, DT_ULT_ALTER_USUA, LOGIN_USUARIO, LOGIN_OS, DADO_ORIGEM_TC1, DADO_DESTINO_TC1, DADO_ORIGEM_TC2, DADO_DESTINO_TC2, DADO_ORIGEM_TC3, DADO_DESTINO_TC3,
        NEW_COD_SIT_FUNCIONAL, NEW_DATA_INIC_SITUACAO, LOG)
        VALUES ((SELECT MAX(ID)+1 FROM SUGESP_SIT_FUNC_PONTO_FICHAS),vID, 'I', vTABELA, vTEM_CARGO_EFETIVO, vFAZER, vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vCODIGO_PESSOA,  vDT_REG_OCORRENCIA, vOCORRENCIA, sysdate, vLOGIN_USUARIO, vLOGIN_OS, vDADO_ORIGEM_TC1, vDADO_DESTINO_TC1, vDADO_ORIGEM_TC2, vDADO_DESTINO_TC2, vDADO_ORIGEM_TC3, vDADO_DESTINO_TC3,
        vPARA_PROXIMA_SITUACAO, trunc(C2.DATA_DIA)+1+c3.qtde_dias_proximo, '10.14- Crio sit func NORMAL:' ||vDE_PROXIMA_SITUACAO || 'com data inicio(c2.data_dia+1+31) sem data fim  e sem PREENCHER campo PROXIMA SITUACAO');
          INSERT INTO RHCGED_ALT_SIT_FUN (codigo_empresa, tipo_contrato, codigo, data_inic_situacao, cod_sit_funcional,  LOGIN_USUARIO, DT_ULT_ALTER_USUA )
          values (vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, trunc(C2.DATA_DIA)+1+c3.qtde_dias_proximo, vPARA_PROXIMA_SITUACAO,  vLOGIN_USUARIO, SYSDATE);
          COMMIT;
          end if;
*/
end if; --voltei em 19/11/19 ----------comentando 18/11/19 17h18-------------- FIM IF DO ULTIMO DIA COM COMANDOS NA TABELARHCGED_ALT_SIT_FUN

-- FIM IF DO ULTIMO DIA COM COMANDOS NA TABELARHCGED_ALT_SIT_FUN

ELSIF vPOSSUI_INTERVALOS = 'S' THEN

--PARA DATA FIM DO AFASTAMENTO MENOR OU IGUAL AO DIA DE HOJE (SYSDATE)--PASSADO E PRESENTE e DATA FIM 'vazia' da ultima situaCAo funcional periodo
if C3.CONTROLE_FOLHA = 'N' and C3.E_AFASTAMENTO = 'N' and c3.suspende_remunera = 'N' and trunc(C2.DATA_dia) <= trunc(sysdate)
--and vDATA_INI_ESTAVA < vDATA_INI_GRAVAR --novo em 22/11/19
AND
--(--NOVO EM 19/11/19
C3.DATA_FIM IS NULL
--OR C3.DATA_FIM IS NOT NULL --NOVO EM 19/11/19
--)--NOVO EM 19/11/19
THEN
  dbms_output.put_line('10.1B-Altera CODIGO Da sit func com sit func da Ficha NO PERIODO MAIS DATA FIM DO DEFERIMENTO: '||vDATA_INI_ESTAVA||'-'|| vDT_FIM_AFAST);
  INSERT INTO  SUGESP_SIT_FUNC_PONTO_FICHAS (ID, ID_LOG_FICHA, TIPO_DML, TABELA, TEM_CARGO_EFETIVO, FAZER, CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, CODIGO_PESSOA,  DT_REG_OCORRENCIA, OCORRENCIA, DT_ULT_ALTER_USUA, LOGIN_USUARIO, LOGIN_OS, DADO_ORIGEM_TC1, DADO_DESTINO_TC1, DADO_ORIGEM_TC2, DADO_DESTINO_TC2, DADO_ORIGEM_TC3, DADO_DESTINO_TC3,
  NEW_COD_SIT_FUNCIONAL, OLD_COD_SIT_FUNCIONAL, NEW_DATA_INIC_SITUACAO, OLD_DATA_INIC_SITUACAO, NEW_DATA_FIM_SITUACAO, OLD_DATA_FIM_SITUACAO
  ,LOG)
  VALUES ((SELECT MAX(ID)+1 FROM SUGESP_SIT_FUNC_PONTO_FICHAS),vID, 'U', vTABELA, vTEM_CARGO_EFETIVO, vFAZER, vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vCODIGO_PESSOA,  vDT_REG_OCORRENCIA, vOCORRENCIA, sysdate, vLOGIN_USUARIO, vLOGIN_OS, vDADO_ORIGEM_TC1, vDADO_DESTINO_TC1, vDADO_ORIGEM_TC2, vDADO_DESTINO_TC2, vDADO_ORIGEM_TC3, vDADO_DESTINO_TC3,
  CASE WHEN LENGTH(vDADO_ORIGEM_TC1) = 23 THEN SUBSTR(vDADO_DESTINO_TC1,1,4) ELSE SUBSTR(vDADO_DESTINO_TC1,5,4) END --NOVO 30/5/22
  --COMENTADO 30/5/22-- SUBSTR(vDADO_DESTINO_TC1,1,4)
  ,vSIT_FUNC_ESTAVA , C3.DATA_INICIO, C3.DATA_INICIO, C3.DATA_FIM, C3.DATA_FIM
  ,'10.1B-Altera CODIGO Da sit func com sit func da Ficha NO PERIODO:'||vDATA_INI_ESTAVA||'-'|| vDT_FIM_AFAST);
IF vPESSOA_APOSENTADA = 'S' AND  vCODIGO_PROC_MED = '000000000000038' 
AND vTEM_SF_ESPECIFICA = 'NAO' --NOVO EM 25/7/22
THEN --ALTERADO EM 15/10/21--NOVO EM 28/7/21
  UPDATE RHCGED_ALT_SIT_FUN set cod_sit_funcional = '6121', data_fim_situacao = trunc(vDT_FIM_AFAST),  LOGIN_USUARIO = vLOGIN_USUARIO , DT_ULT_ALTER_USUA = SYSDATE, EMPRESA_ATENDENTE = vEMPRESA_ATENDENTE, CODIGO_ATENDENTE = vCODIGO_ATENDENTE, NOME_ATENDENTE = vNOME_ATENDENTE, INSCRICAO_CONSELHO = vINSCRICAO_CONSELHO, UF_CONSELHO = vUF_INSCRICAO, CONSELHO_REGIONAL = vCONSELHO_REGIONAL, CODIGO_DOENCA = vCODIGO_DOENCA
  where codigo_empresa = vCODIGO_EMPRESA and tipo_contrato = vTIPO_CONTRATO and codigo = vCODIGO_CONTRATO and trunc(data_inic_situacao) = trunc(vDATA_INI_ESTAVA);
  COMMIT;
  SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO,vLOGIN_USUARIO);
ELSE 
UPDATE RHCGED_ALT_SIT_FUN set cod_sit_funcional = 
  CASE WHEN LENGTH(vDADO_ORIGEM_TC1) = 23 THEN SUBSTR(vDADO_DESTINO_TC1,1,4) ELSE SUBSTR(vDADO_DESTINO_TC1,5,4) END --NOVO 30/5/22
    --COMENTADO 30/5/22--SUBSTR(vDADO_DESTINO_TC1,1,4)
  , data_fim_situacao = trunc(vDT_FIM_AFAST),  LOGIN_USUARIO = vLOGIN_USUARIO , DT_ULT_ALTER_USUA = SYSDATE, EMPRESA_ATENDENTE = vEMPRESA_ATENDENTE, CODIGO_ATENDENTE = vCODIGO_ATENDENTE, NOME_ATENDENTE = vNOME_ATENDENTE, INSCRICAO_CONSELHO = vINSCRICAO_CONSELHO, UF_CONSELHO = vUF_INSCRICAO, CONSELHO_REGIONAL = vCONSELHO_REGIONAL, CODIGO_DOENCA = vCODIGO_DOENCA
  where codigo_empresa = vCODIGO_EMPRESA and tipo_contrato = vTIPO_CONTRATO and codigo = vCODIGO_CONTRATO and trunc(data_inic_situacao) = trunc(vDATA_INI_ESTAVA);
  COMMIT;
  SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO,vLOGIN_USUARIO);
END IF;--NOVO EM 28/7/21

  dbms_output.put_line('10.3B-Crio sit func NORMAL (dataINI + 1)com a que estava : '||vSIT_FUNC_ESTAVA ||'-'||vDATA_FIM_GRAVAR);
  INSERT INTO  SUGESP_SIT_FUNC_PONTO_FICHAS (ID, ID_LOG_FICHA, TIPO_DML, TABELA, TEM_CARGO_EFETIVO, FAZER, CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, CODIGO_PESSOA,  DT_REG_OCORRENCIA, OCORRENCIA, DT_ULT_ALTER_USUA, LOGIN_USUARIO, LOGIN_OS, DADO_ORIGEM_TC1, DADO_DESTINO_TC1, DADO_ORIGEM_TC2, DADO_DESTINO_TC2, DADO_ORIGEM_TC3, DADO_DESTINO_TC3,
  NEW_COD_SIT_FUNCIONAL,NEW_DATA_INIC_SITUACAO, LOG)
  VALUES ((SELECT MAX(ID)+1 FROM SUGESP_SIT_FUNC_PONTO_FICHAS),vID, 'I', vTABELA, vTEM_CARGO_EFETIVO, vFAZER, vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vCODIGO_PESSOA,  vDT_REG_OCORRENCIA, vOCORRENCIA, sysdate, vLOGIN_USUARIO, vLOGIN_OS, vDADO_ORIGEM_TC1, vDADO_DESTINO_TC1, vDADO_ORIGEM_TC2, vDADO_DESTINO_TC2, vDADO_ORIGEM_TC3, vDADO_DESTINO_TC3,
  vSIT_FUNC_ESTAVA , trunc(C2.DATA_DIA)+1, '10.3B-Crio sit func NORMAL (dataINI + 1)com a que estava ');
DELETE RHCGED_ALT_SIT_FUN WHERE codigo_empresa = vCODIGO_EMPRESA AND tipo_contrato = vTIPO_CONTRATO AND codigo = vCODIGO_CONTRATO AND TRUNC(data_inic_situacao) = trunc(C2.DATA_DIA)+1 AND cod_sit_funcional = vSIT_FUNC_ESTAVA;COMMIT;--NOVO EM 20/01/2020
  INSERT INTO RHCGED_ALT_SIT_FUN (codigo_empresa, tipo_contrato, codigo, data_inic_situacao, cod_sit_funcional, LOGIN_USUARIO, DT_ULT_ALTER_USUA )
  values (vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, trunc(C2.DATA_DIA)+1, vSIT_FUNC_ESTAVA ,vLOGIN_USUARIO, SYSDATE);
  COMMIT;
  SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vLOGIN_USUARIO);



--PARA DATA FIM DO AFASTAMENTO MAIOR AO DIA DE HOJE (SYSDATE)--FUTURO e DATA FIM 'vazia' da ultima situaÃƒÆ’Ã†â€™Ãƒâ€šÃ‚Â§ÃƒÆ’Ã†â€™Ãƒâ€šÃ‚Â£o funcional periodo
elsif C3.CONTROLE_FOLHA = 'N' and C3.E_AFASTAMENTO = 'N' and c3.suspende_remunera = 'N' and trunc(C2.DATA_dia) > trunc(sysdate)
--and vDATA_INI_ESTAVA < vDATA_INI_GRAVAR --novo em 22/11/19
AND C3.DATA_FIM IS NULL
THEN
 dbms_output.put_line('10.1D-Altera CODIGO Da sit func com sit func da Ficha NO PERIODO MAIS DATA FIM DO DEFERIMENTO E PROXIMA SITUACAO QUE ESTAVA: '||vDATA_INI_ESTAVA||'-'|| vDT_FIM_AFAST);
  INSERT INTO  SUGESP_SIT_FUNC_PONTO_FICHAS (ID, ID_LOG_FICHA, TIPO_DML, TABELA, TEM_CARGO_EFETIVO, FAZER, CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, CODIGO_PESSOA,  DT_REG_OCORRENCIA, OCORRENCIA, DT_ULT_ALTER_USUA, LOGIN_USUARIO, LOGIN_OS, DADO_ORIGEM_TC1, DADO_DESTINO_TC1, DADO_ORIGEM_TC2, DADO_DESTINO_TC2, DADO_ORIGEM_TC3, DADO_DESTINO_TC3,
  NEW_COD_SIT_FUNCIONAL, OLD_COD_SIT_FUNCIONAL, NEW_DATA_INIC_SITUACAO, OLD_DATA_INIC_SITUACAO, NEW_DATA_FIM_SITUACAO, OLD_DATA_FIM_SITUACAO
  ,LOG)
  VALUES ((SELECT MAX(ID)+1 FROM SUGESP_SIT_FUNC_PONTO_FICHAS),vID, 'U', vTABELA, vTEM_CARGO_EFETIVO, vFAZER, vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vCODIGO_PESSOA,  vDT_REG_OCORRENCIA, vOCORRENCIA, sysdate, vLOGIN_USUARIO, vLOGIN_OS, vDADO_ORIGEM_TC1, vDADO_DESTINO_TC1, vDADO_ORIGEM_TC2, vDADO_DESTINO_TC2, vDADO_ORIGEM_TC3, vDADO_DESTINO_TC3,
  CASE WHEN LENGTH(vDADO_ORIGEM_TC1) = 23 THEN SUBSTR(vDADO_DESTINO_TC1,1,4) ELSE SUBSTR(vDADO_DESTINO_TC1,5,4) END --NOVO 30/5/22
  --COMENTADO 30/5/22--SUBSTR(vDADO_DESTINO_TC1,1,4)
  , vSIT_FUNC_ESTAVA , C3.DATA_INICIO, C3.DATA_INICIO, C3.DATA_FIM, C3.DATA_FIM
  ,'10.1D-Altera CODIGO Da sit func com sit func da Ficha NO PERIODO E PROXIMA SITUACAO QUE ESTAVA:'||vDATA_INI_ESTAVA||'-'|| vDT_FIM_AFAST);
IF vPESSOA_APOSENTADA = 'S' AND  vCODIGO_PROC_MED = '000000000000038' 
AND vTEM_SF_ESPECIFICA = 'NAO' --NOVO EM 25/7/22
THEN --ALTERADO EM 15/10/21 --NOVO EM 28/7/21
  UPDATE RHCGED_ALT_SIT_FUN set cod_sit_funcional = '6121', data_fim_situacao = trunc(vDT_FIM_AFAST), PROXIMA_SITUACAO = vSIT_FUNC_ESTAVA,  LOGIN_USUARIO = vLOGIN_USUARIO , DT_ULT_ALTER_USUA = SYSDATE, EMPRESA_ATENDENTE = vEMPRESA_ATENDENTE, CODIGO_ATENDENTE = vCODIGO_ATENDENTE, NOME_ATENDENTE = vNOME_ATENDENTE, INSCRICAO_CONSELHO = vINSCRICAO_CONSELHO, UF_CONSELHO = vUF_INSCRICAO, CONSELHO_REGIONAL = vCONSELHO_REGIONAL, CODIGO_DOENCA = vCODIGO_DOENCA
  where codigo_empresa = vCODIGO_EMPRESA and tipo_contrato = vTIPO_CONTRATO and codigo = vCODIGO_CONTRATO and trunc(data_inic_situacao) = trunc(vDATA_INI_ESTAVA);
  COMMIT;
  SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO,vLOGIN_USUARIO);
ELSE 
  UPDATE RHCGED_ALT_SIT_FUN set cod_sit_funcional = 
  CASE WHEN LENGTH(vDADO_ORIGEM_TC1) = 23 THEN SUBSTR(vDADO_DESTINO_TC1,1,4) ELSE SUBSTR(vDADO_DESTINO_TC1,5,4) END --NOVO 30/5/22
  --COMENTADO 30/5/22--SUBSTR(vDADO_DESTINO_TC1,1,4)
  , data_fim_situacao = trunc(vDT_FIM_AFAST), PROXIMA_SITUACAO = vSIT_FUNC_ESTAVA,  LOGIN_USUARIO = vLOGIN_USUARIO , DT_ULT_ALTER_USUA = SYSDATE, EMPRESA_ATENDENTE = vEMPRESA_ATENDENTE, CODIGO_ATENDENTE = vCODIGO_ATENDENTE, NOME_ATENDENTE = vNOME_ATENDENTE, INSCRICAO_CONSELHO = vINSCRICAO_CONSELHO, UF_CONSELHO = vUF_INSCRICAO, CONSELHO_REGIONAL = vCONSELHO_REGIONAL, CODIGO_DOENCA = vCODIGO_DOENCA
  where codigo_empresa = vCODIGO_EMPRESA and tipo_contrato = vTIPO_CONTRATO and codigo = vCODIGO_CONTRATO and trunc(data_inic_situacao) = trunc(vDATA_INI_ESTAVA);
  COMMIT;
  SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO,vLOGIN_USUARIO);

END IF;--NOVO EM 28/7/21

end if; -- FIM IF DO ULTIMO DIA COM COMANDOS NA TABELARHCGED_ALT_SIT_FUN

-- FIM IF DO ULTIMO DIA COM COMANDOS NA TABELARHCGED_ALT_SIT_FUN

END IF;

--FIM IF vPOSSUI_INTERVALOS = 'N' THEN
--comentado em 19/11/19 enD if; ------------NOVO 18/11/19 17H18 PARA ULTIMO DIA SEPARAR O vPOSSUI_INTERVALOS 'S' ou 'N'

end if;----------------------------------------------------------------------------Pessoa nÃƒÆ’Ã†â€™Ãƒâ€šÃ‚Â£o esta em cessÃƒÆ’Ã†â€™Ãƒâ€šÃ‚Â£o--parte de situaÃƒÆ’Ã†â€™Ãƒâ€šÃ‚Â§ÃƒÆ’Ã†â€™Ãƒâ€šÃ‚Â£o funcional

/*
--ORIGEM DE UMA EXCLUsÃƒÆ’Ã†â€™Ãƒâ€šÃ‚Â£o de PROCEDIMENTO
ELSIF SUBSTR(vFAZER,1,1) = 'E' AND vFAZER NOT LIKE '%CRIA_DOENCA_GRAVE%' AND(vDADO_DESTINO_TC2 IS NOT NULL OR vDADO_DESTINO_TC3 IS NOT NULL) THEN
dbms_output.put_line('ATUALIZAÃƒÆ’Ã†â€™ÃƒÂ¢Ã¢â€šÂ¬Ã‚Â¡ÃƒÆ’Ã†â€™ÃƒÂ¢Ã¢â€šÂ¬Ã‚Â¢ES SITUAÃƒÆ’Ã†â€™ÃƒÂ¢Ã¢â€šÂ¬Ã‚Â¡ÃƒÆ’Ã†â€™ÃƒÂ¢Ã¢â€šÂ¬Ã‚Â¢ES FUNCIONAIS QUANDO: ORIGEM DE UMA INCLUSÃƒÆ’Ã†â€™Ãƒâ€ Ã¢â‚¬â„¢O DE PROCEDIMENTO');

--ORIGEM DE UMA inCLUsÃƒÆ’Ã†â€™Ãƒâ€šÃ‚Â£o de DOENÃƒÆ’Ã†â€™ÃƒÂ¢Ã¢â€šÂ¬Ã‚Â¡A GRAVE
ELSIF SUBSTR(vFAZER,1,1) = 'I' AND vFAZER LIKE '%CRIA_DOENCA_GRAVE%' AND(vDADO_DESTINO_TC2 IS NOT NULL OR vDADO_DESTINO_TC3 IS NOT NULL) THEN
dbms_output.put_line('ATUALIZAÃƒÆ’Ã†â€™ÃƒÂ¢Ã¢â€šÂ¬Ã‚Â¡ÃƒÆ’Ã†â€™ÃƒÂ¢Ã¢â€šÂ¬Ã‚Â¢ES CODIGOS SITUAÃƒÆ’Ã†â€™ÃƒÂ¢Ã¢â€šÂ¬Ã‚Â¡ÃƒÆ’Ã†â€™ÃƒÂ¢Ã¢â€šÂ¬Ã‚Â¢ES FUNCIONAIS CRIADAS: ORIGEM DE UMA INCLUSÃƒÆ’Ã†â€™Ãƒâ€ Ã¢â‚¬â„¢O DE PROCEDIMENTO, com o das DOENCAS GRAVES');

--ORIGEM DE UMA exCLUsÃƒÆ’Ã†â€™Ãƒâ€šÃ‚Â£o de DOENÃƒÆ’Ã†â€™ÃƒÂ¢Ã¢â€šÂ¬Ã‚Â¡A GRAVE
ELSIF SUBSTR(vFAZER,1,1) = 'E' AND vFAZER LIKE '%TIRA_DOENCA_GRAVE%' AND(vDADO_DESTINO_TC2 IS NOT NULL OR vDADO_DESTINO_TC3 IS NOT NULL) THEN
dbms_output.put_line('ATUALIZAÃƒÆ’Ã†â€™ÃƒÂ¢Ã¢â€šÂ¬Ã‚Â¡ÃƒÆ’Ã†â€™ÃƒÂ¢Ã¢â€šÂ¬Ã‚Â¢ES CODIGOS SITUAÃƒÆ’Ã†â€™ÃƒÂ¢Ã¢â€šÂ¬Ã‚Â¡ÃƒÆ’Ã†â€™ÃƒÂ¢Ã¢â€šÂ¬Ã‚Â¢ES FUNCIONAIS CRIADAS: ORIGEM DE UMA INCLUSÃƒÆ’Ã†â€™Ãƒâ€ Ã¢â‚¬â„¢O DE PROCEDIMENTO, tirando as alterados para DOENCAS GRAVES');

END IF;--COMBINAÃƒÆ’Ã†â€™ÃƒÂ¢Ã¢â€šÂ¬Ã‚Â¡OES DO CAMPO FAZER
*/

--difere
/*
--GUARDA VALORES DO DIA ATUAL PARA O PROXIMO DIA
vSIT_FUNC_DIA_ANTERIOR := C3.COD_SIT_FUNC;
vCONTROLE_FOLHA_ANTERIOR := C3.CONTROLE_FOLHA;
vE_AFASTAMENTO_ANTERIOR :=  C3.E_AFASTAMENTO;
vDATA_INI_ESTAVA_DIA_ANT  := C3.DATA_INICIO;
vDATA_FIM_ESTAVA_DIA_ANT  := C3.DATA_FIM;
vDIA_ANTERIOR := C2.DATA_DIA;
*/
--difere
--difere

---------------novo em 22/11/19 colocaria aqui UPDATE para sit func 1220 e 1221
--dbms_output.put_line('chama procedure PR_FICHA_MEDICA_AJUSTE_SITFUNC');
--PR_FICHA_MEDICA_AJUSTE_SITFUNC( vID);
---------------novo em 22/11/19 colocaria aqui UPDATE para sit func 1220 e 1221



END IF;--LOGICA por DIA A DIA PARA MONTAR COMANDOS de situacao funcional-----------------IF C3.SO_GERA_SIT_PONTO = '1' THEN--------------------------------------------------------------------------------------

--GUARDA VALORES DO DIA ATUAL PARA O PROXIMO DIA
--/*
vSIT_FUNC_DIA_ANTERIOR := C3.COD_SIT_FUNC;
vCONTROLE_FOLHA_ANTERIOR := C3.CONTROLE_FOLHA;
vE_AFASTAMENTO_ANTERIOR :=  C3.E_AFASTAMENTO;
vDATA_INI_ESTAVA_DIA_ANT  := C3.DATA_INICIO;
vDATA_FIM_ESTAVA_DIA_ANT  := C3.DATA_FIM;
vDIA_ANTERIOR := C2.DATA_DIA;
--*/
end loop;--c3ÃƒÆ’Ã¢â‚¬Å¡Ãƒâ€šÃ‚Âº loop
END LOOP; --c2ÃƒÆ’Ã¢â‚¬Å¡Ãƒâ€šÃ‚Âº loop



-------colocando neste local em 26/12/19--------novo em 22/11/19 colocaria aqui UPDATE para sit func 1220 e 1221
dbms_output.put_line('chama procedure PR_FICHA_MEDICA_AJUSTE_SITFUNC com vID = '||vID );
PR_FICHA_MEDICA_AJUSTE_SITFUNC( vID);
---------------novo em 22/11/19 colocaria aqui UPDATE para sit func 1220 e 1221














-----------------------------------------------------------------------------------ORIGEM DE UMA inCLUsAo de DOENCA GRAVE CAMPO C_LIVRE_DESCR02 = 'S'--------------------------------------------------------------------------------------------------
ELSIF SUBSTR(vFAZER,1,1) = 'I' AND vFAZER LIKE '%CRIA_DOENCA_GRAVE%' AND(vDADO_DESTINO_TC2 IS NULL AND vDADO_DESTINO_TC3 IS NULL) THEN
dbms_output.put_line('ATUALIZACOES CODIGOS SITUACES FUNCIONAIS CRIADAS: ORIGEM DE UMA INCLUSAO DE PROCEDIMENTO, com o das DOENCAS GRAVES');
INSERT INTO  SUGESP_SIT_FUNC_PONTO_FICHAS (ID, ID_LOG_FICHA, TIPO_DML, TABELA, TEM_CARGO_EFETIVO, FAZER, CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, CODIGO_PESSOA, DT_REG_OCORRENCIA, OCORRENCIA, DT_ULT_ALTER_USUA, LOGIN_USUARIO, LOGIN_OS, DADO_ORIGEM_TC1, DADO_DESTINO_TC1, DADO_ORIGEM_TC2, DADO_DESTINO_TC2, DADO_ORIGEM_TC3, DADO_DESTINO_TC3
,LOG)
VALUES ((SELECT MAX(ID)+1 FROM SUGESP_SIT_FUNC_PONTO_FICHAS),vID, 'U', vTABELA, vTEM_CARGO_EFETIVO, vFAZER, vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vCODIGO_PESSOA, vDT_REG_OCORRENCIA, vOCORRENCIA, sysdate, vLOGIN_USUARIO, vLOGIN_OS, vDADO_ORIGEM_TC1, vDADO_DESTINO_TC1, vDADO_ORIGEM_TC2, vDADO_DESTINO_TC2, vDADO_ORIGEM_TC3, vDADO_DESTINO_TC3
,'ATUALIZACOES CODIGOS SITUACOES FUNCIONAIS CRIADAS: ORIGEM DE UMA INCLUSAO DE PROCEDIMENTO, com o das DOENCAS GRAVES CAMPO C_LIVRE_DESCR02 = ''S');


FOR C1 IN (
select   A.COD_SIT_FUNCIONAL COD_SIT_FUNC, S.DESCRICAO SITUACAO_FUNCIONAL, S.CONTROLE_FOLHA, S.E_AFASTAMENTO,
S.SITUACAO_PONTO COD_SIT_PONTO, P.DESCRICAO SITUACAO_PONTO, p.tipo_situacao,
to_date(to_char(A.DATA_INIC_SITUACAO,'dd/mm/yyyy'),'dd/mm/yyyy') DATA_INICIO,
to_date(to_char(A.DATA_FIM_SITUACAO,'dd/mm/yyyy'),'dd/mm/yyyy') DATA_FIM,
A.PROXIMA_SITUACAO, s.qtde_dias_proximo, s.suspende_remunera, s.c_livre_selec02 SO_GERA_SIT_PONTO
from RHCGED_ALT_SIT_FUN A
LEFT OUTER JOIN RHPARM_SIT_FUNC S ON S.CODIGO = A.COD_SIT_FUNCIONAL
LEFT OUTER JOIN RHPONT_SITUACAO P ON P.CODIGO = S.SITUACAO_PONTO
WHERE A.CODIGO_EMPRESA = vCODIGO_EMPRESA
AND A.TIPO_CONTRATO = vTIPO_CONTRATO
AND A.CODIGO = vCODIGO_CONTRATO
AND
( trunc(A.DATA_INIC_SITUACAO) >= trunc(vDT_INI_AFAST) AND trunc(A.DATA_INIC_SITUACAO) <= trunc(vDT_FIM_AFAST))

)


LOOP
dbms_output.put_line(C1.COD_SIT_FUNC||' - C_LIVRE_DESCR02 = S');

-----------------------------------------------Pessoa SER da PBH e esta em CessAo OU SEMELHANTES?----------------------------------------------------------------
IF C1.SO_GERA_SIT_PONTO = '1' THEN
dbms_output.put_line('O QUE FAZER: Pessoa da PBH em CESSA OU SEMELHANTES Gravar SituaCAo Ponto');
--------------------------------------------------------------------------------CHAMAR PROCEDURE PARA TODA LOGICA NO NOVO CENARIO TABELA RHPONT_RES_SIT_DIA
--SUGESP_RES_SIT_DIA_V4('FICHA_MEDICA', vID, C2.DATA_DIA, vDADO_ORIGEM_TC1, vDADO_DESTINO_TC1);
--COMENTADO 30/5/22--if SUBSTR(vDADO_DESTINO_TC1,1,4) = c1.COD_SIT_FUNC then
--comentado em 22/8/23 --if LENGTH(vDADO_DESTINO_TC1) = 23 AND SUBSTR(vDADO_DESTINO_TC1,1,4) = c1.COD_SIT_FUNC then --AJUSTADO EM 30/5/22
if LENGTH(vDADO_DESTINO_TC1) = 24 AND SUBSTR(vDADO_DESTINO_TC1,1,4) = c1.COD_SIT_FUNC then --novo em 22/8/23 email (Verificar código enfermidades graves)
dbms_output.put_line(C1.COD_SIT_FUNC||' - trocar para SIT PONTO - '|| SUBSTR(vDADO_DESTINO_TC1,17,4));

  UPDATE RHPONT_RES_SIT_DIA set CODIGO_SITUACAO = SUBSTR(vDADO_DESTINO_TC1,21,4), --PARECE ESTAR COM ERRO SUSPEITA EM 30/5/22
  LOGIN_USUARIO = vLOGIN_USUARIO , DT_ULT_ALTER_USUA = SYSDATE
  where codigo_empresa = vCODIGO_EMPRESA and tipo_contrato = vTIPO_CONTRATO and codigo_contrato = vCODIGO_CONTRATO and trunc(data) between trunc(vDT_INI_AFAST) and trunc(vDT_FIM_AFAST);
  COMMIT;

--INICIO--comentado este ELSIF em 22/8/23 visto que nao esta certo a largura vDADO_DESTINO_TC1 e tambem SUBSTR(vDADO_DESTINO_TC1,5,4) ser da parte do leiaute de INDEFERIMENTOS QUE NAO FOI IMPLANTADA AINDA
/*
ELSif LENGTH(vDADO_DESTINO_TC1) = 27 AND SUBSTR(vDADO_DESTINO_TC1,5,4) = c1.COD_SIT_FUNC then --NOVO EM 30/5/22
dbms_output.put_line(C1.COD_SIT_FUNC||' - trocar para SIT PONTO - '|| SUBSTR(vDADO_DESTINO_TC1,17,4));

  UPDATE RHPONT_RES_SIT_DIA set CODIGO_SITUACAO = SUBSTR(vDADO_DESTINO_TC1,13,4),
  LOGIN_USUARIO = vLOGIN_USUARIO , DT_ULT_ALTER_USUA = SYSDATE
  where codigo_empresa = vCODIGO_EMPRESA and tipo_contrato = vTIPO_CONTRATO and codigo_contrato = vCODIGO_CONTRATO and trunc(data) between trunc(vDT_INI_AFAST) and trunc(vDT_FIM_AFAST);
  COMMIT;
*/  
--FIM--comentado este ELSIF em 22/8/23 visto que nao esta certo a largura vDADO_DESTINO_TC1 e tambem SUBSTR(vDADO_DESTINO_TC1,5,4) ser da parte do leiaute de INDEFERIMENTOS QUE NAO FOI IMPLANTADA AINDA


end if;
--------------------------------------------------------------------------------CHAMAR PROCEDURE PARA TODA LOGICA NO NOVO CENARIO TABELA RHPONT_RES_SIT_DIA
---PAREI AQUI EM 30/5/22 17H44

-------------------------------------------------------Pessoa nAO esta em cessAo-----parte de situaCAo funcional--------------------------------------------------------------
--------------------------------------------------------------------------------PARTE DE INCLUSAO DE DADOS
ELSif C1.SO_GERA_SIT_PONTO = '2' THEN

if LENGTH(vDADO_DESTINO_TC1) = 24 AND --novo em 22/8/23 email (Verificar código enfermidades graves)
--comentado em 22/8/23 --if LENGTH(vDADO_DESTINO_TC1) = 23 AND --AJUSTE EM 31/5/22
SUBSTR(vDADO_DESTINO_TC1,1,4) = c1.COD_SIT_FUNC then
dbms_output.put_line(C1.COD_SIT_FUNC||' - trocar para SIT FUNC- '|| SUBSTR(vDADO_DESTINO_TC1,17,4));
IF vPESSOA_APOSENTADA = 'S' AND  vCODIGO_PROC_MED = '000000000000038' 
AND vTEM_SF_ESPECIFICA = 'NAO' --NOVO EM 25/7/22
THEN --ALTERADO EM 15/10/21--NOVO EM 28/7/21
  UPDATE RHCGED_ALT_SIT_FUN set cod_sit_funcional = '6121', LOGIN_USUARIO = vLOGIN_USUARIO , DT_ULT_ALTER_USUA = SYSDATE
  where codigo_empresa = vCODIGO_EMPRESA and tipo_contrato = vTIPO_CONTRATO and codigo = vCODIGO_CONTRATO and trunc(data_inic_situacao) = trunc(c1.DATA_INICIO);
  COMMIT;
  SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO,vLOGIN_USUARIO);--INCLUI EM 15/10/21
ELSE 
  UPDATE RHCGED_ALT_SIT_FUN set cod_sit_funcional = SUBSTR(vDADO_DESTINO_TC1,17,4), LOGIN_USUARIO = vLOGIN_USUARIO , DT_ULT_ALTER_USUA = SYSDATE --SUSPEITO DE ERRO EM 31/5/22 COLUNA 17 SER PARA DOENCA GRAVE
  where codigo_empresa = vCODIGO_EMPRESA and tipo_contrato = vTIPO_CONTRATO and codigo = vCODIGO_CONTRATO and trunc(data_inic_situacao) = trunc(c1.DATA_INICIO);
  COMMIT;
  SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO,vLOGIN_USUARIO);

END IF;--NOVO EM 28/7/21
---------------novo em 22/11/19 colocaria aqui UPDATE para sit func 1220 e 1221

else
dbms_output.put_line(C1.COD_SIT_FUNC||' - fazer nada- ');
end if;


--inicio--if comentado em 22/8/23 pois nao ha vDADO_DESTINO_TC1 = 27
/*
--inicio novo 31/5/22
if  LENGTH(vDADO_DESTINO_TC1) = 27 AND SUBSTR(vDADO_DESTINO_TC1,5,4) = c1.COD_SIT_FUNC then
dbms_output.put_line(C1.COD_SIT_FUNC||' - trocar para SIT FUNC- '|| SUBSTR(vDADO_DESTINO_TC1,17,4));
IF vPESSOA_APOSENTADA = 'S' AND  vCODIGO_PROC_MED = '000000000000038' 
AND vTEM_SF_ESPECIFICA = 'NAO' --NOVO EM 25/7/22
THEN --ALTERADO EM 15/10/21--NOVO EM 28/7/21
  UPDATE RHCGED_ALT_SIT_FUN set cod_sit_funcional = '6121', LOGIN_USUARIO = vLOGIN_USUARIO , DT_ULT_ALTER_USUA = SYSDATE
  where codigo_empresa = vCODIGO_EMPRESA and tipo_contrato = vTIPO_CONTRATO and codigo = vCODIGO_CONTRATO and trunc(data_inic_situacao) = trunc(c1.DATA_INICIO);
  COMMIT;
  SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO,vLOGIN_USUARIO);--INCLUI EM 15/10/21
ELSE 
  UPDATE RHCGED_ALT_SIT_FUN set cod_sit_funcional = SUBSTR(vDADO_DESTINO_TC1,17,4), LOGIN_USUARIO = vLOGIN_USUARIO , DT_ULT_ALTER_USUA = SYSDATE --SUSPEITO DE ERRO EM 31/5/22 COLUNA 17 SER PARA DOENCA GRAVE
  where codigo_empresa = vCODIGO_EMPRESA and tipo_contrato = vTIPO_CONTRATO and codigo = vCODIGO_CONTRATO and trunc(data_inic_situacao) = trunc(c1.DATA_INICIO);
  COMMIT;
  SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO,vLOGIN_USUARIO);

END IF;--NOVO EM 28/7/21
---------------novo em 22/11/19 colocaria aqui UPDATE para sit func 1220 e 1221

else
dbms_output.put_line(C1.COD_SIT_FUNC||' - fazer nada- ');
end if;
--fim novo 31/5/22
*/
--fim--if comentado em 22/8/23 pois nao ha vDADO_DESTINO_TC1 = 27




END IF;--IF C1.SO_GERA_SIT_PONTO = '1' THEN
END LOOP;






-----------------------------------------------------------------------------------ORIGEM DE UMA inCLUSo de DOENCA GRAVE LISTAS DE DOENCAS COMBINAS ANEXOS 1 E 2--------------------------------------------------------------------------------------------------
ELSIF SUBSTR(vFAZER,1,1) = 'I' AND vFAZER LIKE '%CRIA_DOENCA_GRAVE%' AND(vDADO_DESTINO_TC2 IS NOT NULL OR vDADO_DESTINO_TC3 IS NOT NULL) THEN
dbms_output.put_line('ATUALIZACES CODIGOS SITUACES FUNCIONAIS CRIADAS: ORIGEM DE UMA INCLUSAO DE PROCEDIMENTO, com o das DOENCAS GRAVES LISTAS DE DOENCAS COMBINAS ANEXOS 1 E 2');
INSERT INTO  SUGESP_SIT_FUNC_PONTO_FICHAS (ID, ID_LOG_FICHA, TIPO_DML, TABELA, TEM_CARGO_EFETIVO, FAZER, CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, CODIGO_PESSOA,  DT_REG_OCORRENCIA, OCORRENCIA, DT_ULT_ALTER_USUA, LOGIN_USUARIO, LOGIN_OS, DADO_ORIGEM_TC1, DADO_DESTINO_TC1, DADO_ORIGEM_TC2, DADO_DESTINO_TC2, DADO_ORIGEM_TC3, DADO_DESTINO_TC3
,LOG)
VALUES ((SELECT MAX(ID)+1 FROM SUGESP_SIT_FUNC_PONTO_FICHAS),vID, 'U', vTABELA, vTEM_CARGO_EFETIVO, vFAZER, vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vCODIGO_PESSOA,  vDT_REG_OCORRENCIA, vOCORRENCIA, sysdate, vLOGIN_USUARIO, vLOGIN_OS, vDADO_ORIGEM_TC1, vDADO_DESTINO_TC1, vDADO_ORIGEM_TC2, vDADO_DESTINO_TC2, vDADO_ORIGEM_TC3, vDADO_DESTINO_TC3
,'ATUALIZACES CODIGOS SITUACOES FUNCIONAIS CRIADAS: ORIGEM DE UMA INCLUSAO DE PROCEDIMENTO, com o das DOENCAS GRAVES: DOENCAS COMBINAS ANEXOS 1 E 2');


FOR C1 IN (
select   A.COD_SIT_FUNCIONAL COD_SIT_FUNC, S.DESCRICAO SITUACAO_FUNCIONAL, S.CONTROLE_FOLHA, S.E_AFASTAMENTO,
S.SITUACAO_PONTO COD_SIT_PONTO, P.DESCRICAO SITUACAO_PONTO, p.tipo_situacao,
to_date(to_char(A.DATA_INIC_SITUACAO,'dd/mm/yyyy'),'dd/mm/yyyy') DATA_INICIO,
to_date(to_char(A.DATA_FIM_SITUACAO,'dd/mm/yyyy'),'dd/mm/yyyy') DATA_FIM,
A.PROXIMA_SITUACAO, s.qtde_dias_proximo, s.suspende_remunera, s.c_livre_selec02 SO_GERA_SIT_PONTO
from RHCGED_ALT_SIT_FUN A
LEFT OUTER JOIN RHPARM_SIT_FUNC S ON S.CODIGO = A.COD_SIT_FUNCIONAL
LEFT OUTER JOIN RHPONT_SITUACAO P ON P.CODIGO = S.SITUACAO_PONTO
WHERE A.CODIGO_EMPRESA = vCODIGO_EMPRESA
AND A.TIPO_CONTRATO = vTIPO_CONTRATO
AND A.CODIGO = vCODIGO_CONTRATO
AND
( trunc(A.DATA_INIC_SITUACAO) >= trunc(vDT_INI_AFAST) AND trunc(A.DATA_INIC_SITUACAO) <= trunc(vDT_FIM_AFAST))
)

LOOP
dbms_output.put_line(C1.COD_SIT_FUNC ||' - ANEXOS 1 E 2');

-----------------------------------------------Pessoa SER da PBH e esta em CessAo OU SEMELHANTES?----------------------------------------------------------------
IF C1.SO_GERA_SIT_PONTO = '1' THEN
dbms_output.put_line('O QUE FAZER: Pessoa da PBH em CESSAO OU SEMELHANTES Gravar SituaCAo Ponto');
--------------------------------------------------------------------------------CHAMAR PROCEDURE PARA TODA LOGICA NO NOVO CENARIO TABELA RHPONT_RES_SIT_DIA
--SUGESP_RES_SIT_DIA_V4('FICHA_MEDICA', vID, C2.DATA_DIA, vDADO_ORIGEM_TC1, vDADO_DESTINO_TC1);
if LENGTH(vDADO_DESTINO_TC1) = 24 AND --novo em 22/8/23 email (Verificar código enfermidades graves)
--comentado em 22/8/23 --if LENGTH(vDADO_DESTINO_TC1) = 23 AND --AJUSTADO EM 31/5/22
SUBSTR(vDADO_DESTINO_TC1,1,4) = c1.COD_SIT_FUNC then
dbms_output.put_line(C1.COD_SIT_FUNC||' - trocar para SIT PONTO - '|| SUBSTR(vDADO_DESTINO_TC1,17,4));

  UPDATE RHPONT_RES_SIT_DIA set CODIGO_SITUACAO = SUBSTR(vDADO_DESTINO_TC1,21,4),--SUSPEITO DE ERRO EM 31/5/22 COLUNA 17 SER PARA DOENCA GRAVE
  LOGIN_USUARIO = vLOGIN_USUARIO , DT_ULT_ALTER_USUA = SYSDATE
  where codigo_empresa = vCODIGO_EMPRESA and tipo_contrato = vTIPO_CONTRATO and codigo_contrato = vCODIGO_CONTRATO and trunc(data) between trunc(vDT_INI_AFAST) and trunc(vDT_FIM_AFAST);
  COMMIT;

end if;

--inicio--comentado em 22/8/23 if com erro no vDADO_DESTINO_TC1 = 27
/*
--NOVO INICIO EM 31/5/22
if LENGTH(vDADO_DESTINO_TC1) = 27 AND 
SUBSTR(vDADO_DESTINO_TC1,5,4) = c1.COD_SIT_FUNC then
dbms_output.put_line(C1.COD_SIT_FUNC||' - trocar para SIT PONTO - '|| SUBSTR(vDADO_DESTINO_TC1,17,4));

  UPDATE RHPONT_RES_SIT_DIA set CODIGO_SITUACAO = SUBSTR(vDADO_DESTINO_TC1,21,4),--SUSPEITO DE ERRO EM 31/5/22 COLUNA 17 SER PARA DOENCA GRAVE
  LOGIN_USUARIO = vLOGIN_USUARIO , DT_ULT_ALTER_USUA = SYSDATE
  where codigo_empresa = vCODIGO_EMPRESA and tipo_contrato = vTIPO_CONTRATO and codigo_contrato = vCODIGO_CONTRATO and trunc(data) between trunc(vDT_INI_AFAST) and trunc(vDT_FIM_AFAST);
  COMMIT;

end if;
--FIM INICIO EM 31/5/22
*/
--fim--comentado em 22/8/23 if com erro no vDADO_DESTINO_TC1 = 27


--------------------------------------------------------------------------------CHAMAR PROCEDURE PARA TODA LOGICA NO NOVO CENARIO TABELA RHPONT_RES_SIT_DIA
-------------------------------------------------------Pessoa nAo esta em cessA-----parte de situaACo funcional--------------------------------------------------------------
--------------------------------------------------------------------------------PARTE DE INCLUSAO DE DADOS
ELSif C1.SO_GERA_SIT_PONTO = '2' THEN

if LENGTH(vDADO_DESTINO_TC1) = 24 AND --novo em 22/8/23 email (Verificar código enfermidades graves)
--comentado em 22/8/23 --if LENGTH(vDADO_DESTINO_TC1) = 23 AND --AJUSTADO EM 31/5/22
SUBSTR(vDADO_DESTINO_TC1,1,4) = c1.COD_SIT_FUNC then
dbms_output.put_line(C1.COD_SIT_FUNC||' - trocar para - '|| SUBSTR(vDADO_DESTINO_TC1,17,4));
IF vPESSOA_APOSENTADA = 'S' AND  vCODIGO_PROC_MED = '000000000000038' 
AND vTEM_SF_ESPECIFICA = 'NAO' --NOVO EM 25/7/22
THEN --ALTERADO EM 15/10/21--NOVO EM 28/7/21
  UPDATE RHCGED_ALT_SIT_FUN set cod_sit_funcional = '6121',
  LOGIN_USUARIO = vLOGIN_USUARIO , DT_ULT_ALTER_USUA = SYSDATE
  where codigo_empresa = vCODIGO_EMPRESA and tipo_contrato = vTIPO_CONTRATO and codigo = vCODIGO_CONTRATO and trunc(data_inic_situacao) = trunc(c1.DATA_INICIO);
  COMMIT;
  SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO,vLOGIN_USUARIO);
ELSE 
  UPDATE RHCGED_ALT_SIT_FUN set cod_sit_funcional = SUBSTR(vDADO_DESTINO_TC1,17,4),--SUSPEITO DE ERRO EM 31/5/22 COLUNA 17 SER PARA DOENCA GRAVE
  LOGIN_USUARIO = vLOGIN_USUARIO , DT_ULT_ALTER_USUA = SYSDATE
  where codigo_empresa = vCODIGO_EMPRESA and tipo_contrato = vTIPO_CONTRATO and codigo = vCODIGO_CONTRATO and trunc(data_inic_situacao) = trunc(c1.DATA_INICIO);
  COMMIT;
  SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO,vLOGIN_USUARIO);

END IF;--NOVO EM 28/7/21
---------------novo em 22/11/19 colocaria aqui UPDATE para sit func 1220 e 1221
else
dbms_output.put_line(C1.COD_SIT_FUNC||' - fazer nada- ');
end if;


--inicio--comentado em 22/8/23 aparentemente codigo repetido e erro no vDADO_DESTINO_TC1 = 27
/*
--NOVO INICIO 31/5/22
if LENGTH(vDADO_DESTINO_TC1) = 27 AND --AJUSTADO EM 31/5/22
SUBSTR(vDADO_DESTINO_TC1,5,4) = c1.COD_SIT_FUNC then
dbms_output.put_line(C1.COD_SIT_FUNC||' - trocar para - '|| SUBSTR(vDADO_DESTINO_TC1,17,4));
IF vPESSOA_APOSENTADA = 'S' AND  vCODIGO_PROC_MED = '000000000000038' 
AND vTEM_SF_ESPECIFICA = 'NAO' --NOVO EM 25/7/22
THEN --ALTERADO EM 15/10/21--NOVO EM 28/7/21
  UPDATE RHCGED_ALT_SIT_FUN set cod_sit_funcional = '6121',
  LOGIN_USUARIO = vLOGIN_USUARIO , DT_ULT_ALTER_USUA = SYSDATE
  where codigo_empresa = vCODIGO_EMPRESA and tipo_contrato = vTIPO_CONTRATO and codigo = vCODIGO_CONTRATO and trunc(data_inic_situacao) = trunc(c1.DATA_INICIO);
  COMMIT;
  SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO,vLOGIN_USUARIO);
ELSE 
  UPDATE RHCGED_ALT_SIT_FUN set cod_sit_funcional = SUBSTR(vDADO_DESTINO_TC1,17,4),--SUSPEITO DE ERRO EM 31/5/22 COLUNA 17 SER PARA DOENCA GRAVE
  LOGIN_USUARIO = vLOGIN_USUARIO , DT_ULT_ALTER_USUA = SYSDATE
  where codigo_empresa = vCODIGO_EMPRESA and tipo_contrato = vTIPO_CONTRATO and codigo = vCODIGO_CONTRATO and trunc(data_inic_situacao) = trunc(c1.DATA_INICIO);
  COMMIT;
  SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO,vLOGIN_USUARIO);

END IF;--NOVO EM 28/7/21
---------------novo em 22/11/19 colocaria aqui UPDATE para sit func 1220 e 1221
else
dbms_output.put_line(C1.COD_SIT_FUNC||' - fazer nada- ');
end if;
--NOVO FIM 31/5/22
*/
--fim--comentado em 22/8/23 aparentemente codigo repetido e erro no vDADO_DESTINO_TC1 = 27


END IF;--IF C1.SO_GERA_SIT_PONTO = '1' THEN
END LOOP;





--a principio desenvolver durante out/19
---------------------------------------------------------------------------------------ORIGEM DE UMA exCLUsAA GRAVE-----------------------------------------------------------------------------------------------
ELSIF SUBSTR(vFAZER,1,1) = 'E' AND vFAZER LIKE '%TIRA_DOENCA_GRAVE%' /* AND(vDADO_DESTINO_TC2 IS NOT NULL OR vDADO_DESTINO_TC3 IS NOT NULL)*/ THEN
dbms_output.put_line('ATUALIZCES FUNCIONAIS CRIADAS: ORIGEM DE UMA INCLUSAO DE PROCEDIMENTO, tirando as alterados para DOENCAS GRAVES');
INSERT INTO  SUGESP_SIT_FUNC_PONTO_FICHAS (ID, ID_LOG_FICHA, TIPO_DML, TABELA, TEM_CARGO_EFETIVO, FAZER, CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, CODIGO_PESSOA,  DT_REG_OCORRENCIA, OCORRENCIA, DT_ULT_ALTER_USUA, LOGIN_USUARIO, LOGIN_OS, DADO_ORIGEM_TC1, DADO_DESTINO_TC1, DADO_ORIGEM_TC2, DADO_DESTINO_TC2, DADO_ORIGEM_TC3, DADO_DESTINO_TC3
,LOG)
VALUES ((SELECT MAX(ID)+1 FROM SUGESP_SIT_FUNC_PONTO_FICHAS),vID, 'U', vTABELA, vTEM_CARGO_EFETIVO, vFAZER, vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vCODIGO_PESSOA,  vDT_REG_OCORRENCIA, vOCORRENCIA, sysdate, vLOGIN_USUARIO, vLOGIN_OS, vDADO_ORIGEM_TC1, vDADO_DESTINO_TC1, vDADO_ORIGEM_TC2, vDADO_DESTINO_TC2, vDADO_ORIGEM_TC3, vDADO_DESTINO_TC3
,'ATUALIZACOES FUNCIONAIS CRIADAS: ORIGEM DE UMA INCLUSAO DE PROCEDIMENTO, tirando as alterados para DOENCAS GRAVES');

FOR C1 IN (
select   A.COD_SIT_FUNCIONAL COD_SIT_FUNC, S.DESCRICAO SITUACAO_FUNCIONAL, S.CONTROLE_FOLHA, S.E_AFASTAMENTO,
S.SITUACAO_PONTO COD_SIT_PONTO, P.DESCRICAO SITUACAO_PONTO, p.tipo_situacao,
to_date(to_char(A.DATA_INIC_SITUACAO,'dd/mm/yyyy'),'dd/mm/yyyy') DATA_INICIO,
to_date(to_char(A.DATA_FIM_SITUACAO,'dd/mm/yyyy'),'dd/mm/yyyy') DATA_FIM,
A.PROXIMA_SITUACAO, s.qtde_dias_proximo, s.suspende_remunera, s.c_livre_selec02 SO_GERA_SIT_PONTO
from RHCGED_ALT_SIT_FUN A
LEFT OUTER JOIN RHPARM_SIT_FUNC S ON S.CODIGO = A.COD_SIT_FUNCIONAL
LEFT OUTER JOIN RHPONT_SITUACAO P ON P.CODIGO = S.SITUACAO_PONTO
WHERE A.CODIGO_EMPRESA = vCODIGO_EMPRESA
AND A.TIPO_CONTRATO = vTIPO_CONTRATO
AND A.CODIGO = vCODIGO_CONTRATO
AND
( trunc(A.DATA_INIC_SITUACAO) >= trunc(vDT_INI_AFAST) AND trunc(A.DATA_INIC_SITUACAO) <= trunc(vDT_FIM_AFAST))
)

LOOP
dbms_output.put_line(C1.COD_SIT_FUNC ||' - EXCLUINDO DOENCA GRAVE');

-----------------------------------------------Pessoa SER da PBH e esta em CessAo OU SEMELHANTES?----------------------------------------------------------------
IF C1.SO_GERA_SIT_PONTO = '1' THEN
dbms_output.put_line('O QUE FAZER: Pessoa da PBH em CeSSAo OU SEMELHANTES Gravar SituaCAo Ponto');
--------------------------------------------------------------------------------CHAMAR PROCEDURE PARA TODA LOGICA NO NOVO CENARIO TABELA RHPONT_RES_SIT_DIA
--SUGESP_RES_SIT_DIA_V4('FICHA_MEDICA', vID, C2.DATA_DIA, vDADO_ORIGEM_TC1, vDADO_DESTINO_TC1);

if LENGTH(vDADO_DESTINO_TC1) = 24 AND --novo em 22/8/23 email (Verificar código enfermidades graves)
--comentado em 22/8/23 --if LENGTH(vDADO_DESTINO_TC1) = 23 AND --AJUSTADO EM 31/5/22
SUBSTR(vDADO_DESTINO_TC1,1,4) = c1.COD_SIT_FUNC then
dbms_output.put_line(C1.COD_SIT_FUNC||' - trocar para SIT PONTO - '|| SUBSTR(vDADO_DESTINO_TC1,9,4));

  UPDATE RHPONT_RES_SIT_DIA set CODIGO_SITUACAO = SUBSTR(vDADO_DESTINO_TC1,21,4),--SUSPEITO DE ERRO EM 31/5/22 COLUNA 17 SER PARA DOENCA GRAVE
  LOGIN_USUARIO = vLOGIN_USUARIO , DT_ULT_ALTER_USUA = SYSDATE
  where codigo_empresa = vCODIGO_EMPRESA and tipo_contrato = vTIPO_CONTRATO and codigo_contrato = vCODIGO_CONTRATO and trunc(data) between trunc(vDT_INI_AFAST) and trunc(vDT_FIM_AFAST);
  COMMIT;
end if;

--inicio--comentado em 22/8/23--- parece nao fazer sentido parte de indferimento e erro no LENGTH(vDADO_DESTINO_TC1) = 27
/*
--INICIO NOVO 31/5/22
if LENGTH(vDADO_DESTINO_TC1) = 27 AND SUBSTR(vDADO_DESTINO_TC1,5,4) = c1.COD_SIT_FUNC then
dbms_output.put_line(C1.COD_SIT_FUNC||' - trocar para SIT PONTO - '|| SUBSTR(vDADO_DESTINO_TC1,9,4));

  UPDATE RHPONT_RES_SIT_DIA set CODIGO_SITUACAO = SUBSTR(vDADO_DESTINO_TC1,21,4),--SUSPEITO DE ERRO EM 31/5/22 COLUNA 17 SER PARA DOENCA GRAVE
  LOGIN_USUARIO = vLOGIN_USUARIO , DT_ULT_ALTER_USUA = SYSDATE
  where codigo_empresa = vCODIGO_EMPRESA and tipo_contrato = vTIPO_CONTRATO and codigo_contrato = vCODIGO_CONTRATO and trunc(data) between trunc(vDT_INI_AFAST) and trunc(vDT_FIM_AFAST);
  COMMIT;
end if;
--FIM NOVO 31/5/22
*/
--fim--comentado em 22/8/23--- parece nao fazer sentido parte de indferimento e erro no LENGTH(vDADO_DESTINO_TC1) = 27

--------------------------------------------------------------------------------CHAMAR PROCEDURE PARA TODA LOGICA NO NOVO CENARIO TABELA RHPONT_RES_SIT_DIA
-------------------------------------------------------Pessoa nAo esta em cessAo-----parte de situaCAo funcional--------------------------------------------------------------
--------------------------------------------------------------------------------PARTE DE INCLUSAO DE DADOS
ELSif C1.SO_GERA_SIT_PONTO = '2' THEN

if  SUBSTR(vDADO_DESTINO_TC1,17,4) = c1.COD_SIT_FUNC then --SUSPEITO DE ERRO EM 31/5/22 COLUNA 17 SER PARA DOENCA GRAVE
dbms_output.put_line(C1.COD_SIT_FUNC||' - trocar para - '|| SUBSTR(vDADO_DESTINO_TC1,1,4));
IF vPESSOA_APOSENTADA = 'S' AND  vCODIGO_PROC_MED = '000000000000038' 
AND vTEM_SF_ESPECIFICA = 'NAO' --NOVO EM 25/7/22
THEN --ALTERADO EM 15/10/21 --NOVO EM 28/7/21
  UPDATE RHCGED_ALT_SIT_FUN set cod_sit_funcional = '6121',
  LOGIN_USUARIO = vLOGIN_USUARIO , DT_ULT_ALTER_USUA = SYSDATE
  where codigo_empresa = vCODIGO_EMPRESA and tipo_contrato = vTIPO_CONTRATO and codigo = vCODIGO_CONTRATO and trunc(data_inic_situacao) = trunc(c1.DATA_INICIO);
  COMMIT;
  SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO,vLOGIN_USUARIO);
ELSE 
  UPDATE RHCGED_ALT_SIT_FUN set cod_sit_funcional = SUBSTR(vDADO_DESTINO_TC1,1,4),
  LOGIN_USUARIO = vLOGIN_USUARIO , DT_ULT_ALTER_USUA = SYSDATE
  where codigo_empresa = vCODIGO_EMPRESA and tipo_contrato = vTIPO_CONTRATO and codigo = vCODIGO_CONTRATO and trunc(data_inic_situacao) = trunc(c1.DATA_INICIO);
  COMMIT;
  SUGESP_ALT_SIT_FUNC_ULT_CONTRA(vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO,vLOGIN_USUARIO);

END IF;--NOVO EM 28/7/21
---------------novo em 22/11/19 colocaria aqui UPDATE para sit func 1220 e 1221


else
dbms_output.put_line(C1.COD_SIT_FUNC||' - fazer nada- ');
end if;

END IF;--IF C1.SO_GERA_SIT_PONTO = '1' THEN
END LOOP;




--a principio desenvolver durante out/19
----------------------------------------------------------------------------------ORIGEM DE UMA EXCLUsAo de PROCEDIMENTO---------------------------------------------------------------------------------------------------
ELSIF SUBSTR(vFAZER,1,1) = 'E' AND vFAZER NOT LIKE '%CRIA_DOENCA_GRAVE%' AND(vDADO_DESTINO_TC2 IS NULL OR vDADO_DESTINO_TC3 IS NULL) THEN
dbms_output.put_line('ATUALIZACES FUNCIONAIS QUANDO: ORIGEM DE UMA exCLUSAO DE PROCEDIMENTO');
INSERT INTO  SUGESP_SIT_FUNC_PONTO_FICHAS (ID, ID_LOG_FICHA, TIPO_DML, TABELA, TEM_CARGO_EFETIVO, FAZER, CODIGO_EMPRESA, TIPO_CONTRATO, CODIGO_CONTRATO, CODIGO_PESSOA,  DT_REG_OCORRENCIA, OCORRENCIA, DT_ULT_ALTER_USUA, LOGIN_USUARIO, LOGIN_OS, DADO_ORIGEM_TC1, DADO_DESTINO_TC1, DADO_ORIGEM_TC2, DADO_DESTINO_TC2, DADO_ORIGEM_TC3, DADO_DESTINO_TC3
,LOG)
VALUES ((SELECT MAX(ID)+1 FROM SUGESP_SIT_FUNC_PONTO_FICHAS),vID, 'U', vTABELA, vTEM_CARGO_EFETIVO, vFAZER, vCODIGO_EMPRESA, vTIPO_CONTRATO, vCODIGO_CONTRATO, vCODIGO_PESSOA,  vDT_REG_OCORRENCIA, vOCORRENCIA, sysdate, vLOGIN_USUARIO, vLOGIN_OS, vDADO_ORIGEM_TC1, vDADO_DESTINO_TC1, vDADO_ORIGEM_TC2, vDADO_DESTINO_TC2, vDADO_ORIGEM_TC3, vDADO_DESTINO_TC3
,'ATUALIZACES FUNCIONAIS QUANDO: ORIGEM DE UMA exCLUSAO DE PROCEDIMENTO');


END IF;--COMBINACOES DO CAMPO FAZER
------------------fim---------maior if da logica


/*
--PARTE QUE ÃƒÆ’Ã†â€™ÃƒÂ¢Ã¢â€šÂ¬Ã‚Â° RETROATIVO
ELSE
-------******CHAMAR PROCEDURE para VERIFICAR SE O RETROATIVO TEM PARTE QUE PASSA DO DIA 1/10/19
dbms_output.put_line('chama procedure PR_CORTE_TEG');
PR_CORTE_TEG;--( vID);
-------******CHAMAR PROCEDURE para VERIFICAR SE O RETROATIVO TEM PARTE QUE PASSA DO DIA 1/10/19


END IF; --RETROATIVO OU NÃƒÆ’Ã†â€™Ãƒâ€ Ã¢â‚¬â„¢O
*/

END;-- END 2ÃƒÆ’Ã¢â‚¬Å¡Ãƒâ€šÃ‚Âº BEGIN
END;-- 1ÃƒÆ’Ã¢â‚¬Å¡Ãƒâ€šÃ‚Âº BEGIN

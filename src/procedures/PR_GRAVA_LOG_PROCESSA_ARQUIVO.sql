
  CREATE OR REPLACE EDITIONABLE PROCEDURE "ARTERH"."PR_GRAVA_LOG_PROCESSA_ARQUIVO" (PCODIGO_EMPRESA IN CHAR, PID_ARQUIVO IN NUMBER, PSITUACAO_PROCESSAMENTO IN CHAR, POBSERVACAO IN VARCHAR2 DEFAULT NULL) AS
  vCATEGORIA_LOG      NUMBER;
  vTIPO_LOG           NUMBER;
  vNUMERO_LINHA_LOG   NUMBER;
  vCODIGO_LOG         CHAR(4);
  vDETALHE_LOG        VARCHAR2(4000);
  
  CODIGO_LOG_PROCESSAMENTO_02 CONSTANT CHAR(4) := 'P002';
  CODIGO_LOG_PROCESSAMENTO_03 CONSTANT CHAR(4) := 'P003';
  CODIGO_LOG_PROCESSAMENTO_04 CONSTANT CHAR(4) := 'P004';  
  CODIGO_LOG_PROCESSAMENTO_05 CONSTANT CHAR(4) := 'P005';
  CODIGO_LOG_PROCESSAMENTO_06 CONSTANT CHAR(4) := 'P006';
  CODIGO_LOG_PROCESSAMENTO_07 CONSTANT CHAR(4) := 'P007';  
  CODIGO_LOG_PROCESSAMENTO_50 CONSTANT CHAR(4) := 'P050';
      
  LOG_EXCEPTION EXCEPTION;

PRAGMA AUTONOMOUS_TRANSACTION;
BEGIN

  vCATEGORIA_LOG    := 1;
  vTIPO_LOG         := 50;
  vNUMERO_LINHA_LOG := 0;
  vDETALHE_LOG      := POBSERVACAO;

    IF PSITUACAO_PROCESSAMENTO IS NULL THEN
       raise_application_error (-20001,'GRAVA LOG PROCESSAMENTO - ERRO NO CONTROLE DE PROCESSAMENTO. SITUACAO NULA.');
    END IF;
    
    IF PSITUACAO_PROCESSAMENTO NOT IN ('00','01','02','03','04','05','06','07') THEN
       raise_application_error (-20001,'GRAVA LOG PROCESSAMENTO - ERRO NO CONTROLE DE PROCESSAMENTO. SITUACAO INVALIDA. = ' || PSITUACAO_PROCESSAMENTO);
    END IF;
    
    BEGIN
    update RHPBH_ARQUIVO set SITUACAO = PSITUACAO_PROCESSAMENTO,
                             DATA_ULTIMO_PROCESSAMENTO = sysdate
     where ID_ARQUIVO = PID_ARQUIVO;
    EXCEPTION
    WHEN OTHERS THEN
         RAISE LOG_EXCEPTION;
    END;
/*
     CASE WHEN PSITUACAO_PROCESSAMENTO = '02' THEN vCODIGO_LOG := PSITUACAO_PROCESSAMENTO || ' Validação de Leiaute em Processamento';
          WHEN PSITUACAO_PROCESSAMENTO = '03' THEN vCODIGO_LOG := PSITUACAO_PROCESSAMENTO || ' Validação de Leiaute Processada';
          WHEN PSITUACAO_PROCESSAMENTO = '04' THEN vCODIGO_LOG := PSITUACAO_PROCESSAMENTO || ' Em processamento';
          WHEN PSITUACAO_PROCESSAMENTO = '05' THEN vCODIGO_LOG := PSITUACAO_PROCESSAMENTO || ' Processado';
          WHEN PSITUACAO_PROCESSAMENTO = '06' THEN vCODIGO_LOG := PSITUACAO_PROCESSAMENTO || ' Em Processamento - Inclusão';
          WHEN PSITUACAO_PROCESSAMENTO = '07' THEN vCODIGO_LOG := PSITUACAO_PROCESSAMENTO || ' Processado Finalizado';
                                              ELSE vCODIGO_LOG := PSITUACAO_PROCESSAMENTO || ' CONTROLE PROCESSAMENTO';
     END CASE;
*/
     CASE WHEN PSITUACAO_PROCESSAMENTO = '02' THEN vCODIGO_LOG := CODIGO_LOG_PROCESSAMENTO_02;
          WHEN PSITUACAO_PROCESSAMENTO = '03' THEN vCODIGO_LOG := CODIGO_LOG_PROCESSAMENTO_03;
          WHEN PSITUACAO_PROCESSAMENTO = '04' THEN vCODIGO_LOG := CODIGO_LOG_PROCESSAMENTO_04;
          WHEN PSITUACAO_PROCESSAMENTO = '05' THEN vCODIGO_LOG := CODIGO_LOG_PROCESSAMENTO_05;
          WHEN PSITUACAO_PROCESSAMENTO = '06' THEN vCODIGO_LOG := CODIGO_LOG_PROCESSAMENTO_06;
          WHEN PSITUACAO_PROCESSAMENTO = '07' THEN vCODIGO_LOG := CODIGO_LOG_PROCESSAMENTO_07;
                                              ELSE vCODIGO_LOG := CODIGO_LOG_PROCESSAMENTO_50;
     END CASE;

    BEGIN

     INSERT INTO RHPBH_ARQUIVO_LOG(ID_LOG, DATA_LOG, CATEGORIA, TIPO, ID_ARQUIVO, NUMERO_LINHA, CODIGO_LOG, DETALHE, CODIGO_EMPRESA)
     values (SQ_RHPBH_PS_IMPORTACAO_LOG.NEXTVAL, sysdate, vCATEGORIA_LOG, vTIPO_LOG, PID_ARQUIVO, vNUMERO_LINHA_LOG, vCODIGO_LOG, vDETALHE_LOG, PCODIGO_EMPRESA);

    EXCEPTION
    WHEN OTHERS THEN
         RAISE LOG_EXCEPTION;
    END;

    COMMIT;
END;
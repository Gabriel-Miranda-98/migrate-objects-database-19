
  CREATE OR REPLACE EDITIONABLE FUNCTION "ARTERH"."FU_CALCULA_HORARIO_NOVO" (DIA_OCORRENCIA1 IN VARCHAR2,HORARIO_NORMAL_1 IN VARCHAR2, DIA_OCORRENCIA2 IN VARCHAR2, HORARIO_NORMAL_2 IN VARCHAR2 ,DIA_OCORRENCIA3 IN VARCHAR2 ,HORARIO_NORMAL_3 IN VARCHAR2 ,
DIA_OCORRENCIA4 IN VARCHAR2,HORARIO_NORMAL_4 IN VARCHAR2,DIA_OCORRENCIA5 IN VARCHAR2,HORARIO_NORMAL_5 IN VARCHAR2,DIA_OCORRENCIA6 IN VARCHAR2, HORARIO_NORMAL_6 IN VARCHAR2,
DIA_OCORRENCIA7 IN VARCHAR2, HORARIO_NORMAL_7 IN VARCHAR2,DIA_OCORRENCIA8 IN VARCHAR2,HORARIO_NORMAL_8 IN VARCHAR2)
   RETURN VARCHAR2 IS
    VJORNADA_TOTAL VARCHAR2(10);
BEGIN

select 
CASE
WHEN 
SUBSTR(TO_CHAR(JORNADA_TOTAL),10,1) = 1 
THEN 
SUBSTR('00/00/0000 ' || ((SUBSTR(TO_CHAR(JORNADA_TOTAL),10,1)*24)+SUBSTR(TO_CHAR(JORNADA_TOTAL),12,2)) || ':00:00',12,5)
ELSE
SUBSTR(TO_CHAR(JORNADA_TOTAL),12,5) 
END HORARIO
INTO VJORNADA_TOTAL
 from (
SELECT GRUPO_1+GRUPO_2+GRUPO_3+GRUPO_4  AS JORNADA_TOTAL --- OS GRUPOS VEM DO C√ÅLCULO DO TIMESTAMP 
  FROM ( SELECT FIM.DATA_1,
  FIM.DATA_2,
  FIM.DATA_3,
  FIM.DATA_4,
  FIM.DATA_5,
  FIM.DATA_6,
  FIM.DATA_7,
  FIM.DATA_8,
  TO_TIMESTAMP(FIM.DATA_2,'DD/MM/RRRR HH24:MI:SS')-TO_TIMESTAMP(FIM.DATA_1,'DD/MM/RRRR HH24:MI:SS') as  GRUPO_1,
  TO_TIMESTAMP(FIM.DATA_4,'DD/MM/RRRR HH24:MI:SS')-TO_TIMESTAMP(FIM.DATA_3,'DD/MM/RRRR HH24:MI:SS')as GRUPO_2,
  TO_TIMESTAMP(FIM.DATA_6,'DD/MM/RRRR HH24:MI:SS')-TO_TIMESTAMP(FIM.DATA_5,'DD/MM/RRRR HH24:MI:SS')as GRUPO_3,
  TO_TIMESTAMP(FIM.DATA_8,'DD/MM/RRRR HH24:MI:SS')-TO_TIMESTAMP(FIM.DATA_7,'DD/MM/RRRR HH24:MI:SS')as GRUPO_4
  FROM (SELECT X.*, regexp_substr(REPLACE(X.CORRENTE,';;','; ;'), '[^;]+', 1, 1)DATA_1,
  regexp_substr(REPLACE(X.CORRENTE,';;','; ;'), '[^;]+', 1, 2)DATA_2,
  regexp_substr(REPLACE(X.CORRENTE,';;','; ;'), '[^;]+', 1, 3)DATA_3,
  regexp_substr(REPLACE(X.CORRENTE,';;','; ;'), '[^;]+', 1, 4)DATA_4,
  regexp_substr(REPLACE(X.CORRENTE,';;','; ;'), '[^;]+', 1, 5)DATA_5,
  regexp_substr(REPLACE(X.CORRENTE,';;','; ;'), '[^;]+', 1, 6)DATA_6,
  regexp_substr(REPLACE(X.CORRENTE,';;','; ;'), '[^;]+', 1, 7)DATA_7,
  regexp_substr(REPLACE(X.CORRENTE,';;','; ;'), '[^;]+', 1, 8)DATA_8
  FROM (SELECT LISTAGG(X.CORRENTE, '; ') WITHIN GROUP (ORDER BY X.ORDEM)AS CORRENTE FROM (
  SELECT  ROWNUM AS ORDEM,CASE
    WHEN DIA_OCORRENCIA='C'
    THEN TO_CHAR(TO_DATE(SYSDATE||' '||REGEXP_REPLACE(lpad(TO_CHAR(trim( HORA )),4,'0'), '([0-9]{2})([0-9]{2})', '\1:\2'),'DD/MM/RRRR HH24:MI:SS'),'DD/MM/RRRR HH24:MI:SS')
     WHEN DIA_OCORRENCIA='S'
    THEN TO_CHAR(TO_DATE(SYSDATE+1||' '||REGEXP_REPLACE(lpad(TO_CHAR(trim( HORA )),4,'0'), '([0-9]{2})([0-9]{2})', '\1:\2'),'DD/MM/RRRR HH24:MI:SS'),'DD/MM/RRRR HH24:MI:SS')
    WHEN DIA_OCORRENCIA='A'
    THEN TO_CHAR(TO_DATE(SYSDATE-1||' '||REGEXP_REPLACE(lpad(TO_CHAR(trim( HORA )),4,'0'), '([0-9]{2})([0-9]{2})', '\1:\2'),'DD/MM/RRRR HH24:MI:SS'),'DD/MM/RRRR HH24:MI:SS')
    END AS CORRENTE  FROM (SELECT ROWNUM AS LINHA ,X.*,regexp_substr(REPLACE(X.CONFG,';;','; ;'), '[^;]+', 1, LEVEL)AS DIA_OCORRENCIA ,regexp_substr(REPLACE(X.CONFG,';;','; ;'), '[^;]+', 1, LEVEL+1)AS HORA
  FROM (SELECT DIA_OCORRENCIA1||';'||HORARIO_NORMAL_1||';'||DIA_OCORRENCIA2||';'||HORARIO_NORMAL_2||';'||DIA_OCORRENCIA3||';'||HORARIO_NORMAL_3||';'||DIA_OCORRENCIA4||';'||HORARIO_NORMAL_4||';'||DIA_OCORRENCIA5||';'||HORARIO_NORMAL_5
  ||';'||DIA_OCORRENCIA6||';'||HORARIO_NORMAL_6||';'||DIA_OCORRENCIA7||';'||HORARIO_NORMAL_7||';'||DIA_OCORRENCIA8||';'||HORARIO_NORMAL_8
  AS CONFG
  FROM DUAL)X
  CONNECT BY  regexp_substr(REPLACE(X.CONFG,';;','; ;'), '[^;]+', 1, LEVEL) IS NOT NULL)X
  WHERE LINHA IN ('1','3','5','7','9','11','13','15','17','19','21','23')
  )X
  )X
  )FIM
))FIMM;

--raise_application_error (-20003,JORNADA_TOTAL);
--RETURN JORNADA_TOTAL;
RETURN VJORNADA_TOTAL;
END FU_CALCULA_HORARIO_NOVO;
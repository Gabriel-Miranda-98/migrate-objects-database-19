
  CREATE OR REPLACE EDITIONABLE FUNCTION "ARTERH"."FU_CAL_DATAS" ( pDT_INICIO IN DATE, pDT_FIM IN DATE )
/*ESSA FUNÇÃO CALCULA A QUANTIDADE DE DIAS UTEIS DO MES, FERIADOS E QUANTIDADE DE DIAS UTEIS SEM FERIADO */
RETURN DATA_VALES
AS
  RETORNO DATA_VALES;
BEGIN
  RETORNO:=DATA_VALES(NULL,NULL,NULL,NULL,NULL);

 SELECT X1.data_inicio,
  X1.data_fim,
  X1.dias_uteis_SEM_FERIADO,
  X1.QTD_FERIADOS,
  X1.DIAS_UTEIS_MES
   INTO RETORNO.DATA_INI,
    RETORNO.DATA_FIM ,
    RETORNO.DIAS_UTEIS_SEM_FERIADO,
    RETORNO.QTD_FERIADOS,
    RETORNO.DIAS_UTEIS_MES
FROM
  (SELECT X.data_inicio,
    data_fim,
    X.dias_uteis_SEM_FERIADO,
    x.QTD_FERIADOS,
    X.dias_uteis_SEM_FERIADO-QTD_FERIADOS AS DIAS_UTEIS_MES
  FROM
    (SELECT X.*,
      (SELECT COUNT(1)QUANT
      FROM ARTERH.RHPARM_CALEND_DT DT
      WHERE CALEND='F'
      AND DT.DATA_DIA BETWEEN X.DATA_INICIO AND X.DATA_FIM
      AND DT.CODIGO='0001'
      AND to_char(DT.DATA_DIA,'DY') NOT IN ('SÁB','DOM','SUN','SAT')

      ) AS QTD_FERIADOS
    FROM
      (SELECT X.*,
        TO_CHAR((TO_DATE(DATA_INICIO,'DD/MM/YYYY'))+LEVEL-1,'dd/mm/yyyy')AS data_semana,
        TO_CHAR((TO_DATE(DATA_INICIO,'DD/MM/YYYY'))+LEVEL-1,'DY')        AS DIA_SEMANA,
        (SELECT COUNT(1)QUANT
        FROM DUAL
        WHERE TO_CHAR((TO_DATE(DATA_INICIO,'DD/MM/YYYY'))                                                       +LEVEL-1,'DY') NOT IN ('SÁB','DOM','SUN','SAT')
          CONNECT BY LEVEL                                                   <= ((TO_DATE(DATA_FIM,'DD/MM/YYYY')-TO_DATE(DATA_INICIO,'DD/MM/YYYY'))+1)
        ) AS dias_uteis_SEM_FERIADO
      FROM
        ( SELECT pDT_INICIO AS DATA_INICIO,  pDT_FIM  AS DATA_FIM FROM DUAL
        )X
        CONNECT BY LEVEL <= ((TO_DATE(DATA_FIM,'DD/MM/YYYY')-TO_DATE(DATA_INICIO,'DD/MM/YYYY'))+1)
      )X
    )X
  )x1
  group by 
  X1.data_inicio,
  X1.data_fim,
  X1.dias_uteis_SEM_FERIADO,
  X1.QTD_FERIADOS,
  X1.DIAS_UTEIS_MES;
  RETURN RETORNO;
END ;